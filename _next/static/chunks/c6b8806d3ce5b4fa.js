(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51375,e=>{"use strict";var r=e.i(47167),s=e.i(20786),t=e.i(92808),a=e.i(43476),n=e.i(71645),l=e.i(18566),o=e.i(32313),i=e.i(63707);let d=e=>{let{activeTab:r,onTabChange:s}=e;return(0,a.jsxs)("div",{className:"mb-6 border-b",children:[(0,a.jsx)("button",{onClick:()=>s("inventory"),className:"mr-6 pb-2 ".concat("inventory"===r?"border-b-2 border-black":"text-gray-400"),children:"Inventory"}),(0,a.jsx)("button",{onClick:()=>s("orders"),className:"pb-2 ".concat("orders"===r?"border-b-2 border-black":"text-gray-400"),children:"Orders"})]})},c=e=>{let{source:r,loading:s}=e;return s?(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 text-blue-800 rounded-sm text-sm font-inter",children:(0,a.jsx)("span",{children:"â³ Loading inventory from Supabase..."})}):r?(0,a.jsx)("div",{className:"mb-4 p-3 rounded-sm text-sm font-inter ".concat((()=>{switch(r){case"supabase":return"bg-green-50 border border-green-200 text-green-800";case"localStorage":return"bg-yellow-50 border border-yellow-200 text-yellow-800";default:return"bg-gray-50 border border-gray-200 text-gray-800"}})()),children:(()=>{switch(r){case"supabase":return(0,a.jsxs)("span",{children:["âœ… ",(0,a.jsx)("strong",{children:"Loaded from Supabase:"})," All saved inventory quantities are displayed. Data is persisted and will be available after deployment."]});case"localStorage":return(0,a.jsxs)("span",{children:["âš ï¸ ",(0,a.jsx)("strong",{children:"Using cached data:"})," Supabase unavailable. Showing cached quantities from localStorage."]});default:return(0,a.jsxs)("span",{children:["â„¹ï¸ ",(0,a.jsx)("strong",{children:"Using default quantities:"}),' No saved data found. Set quantities and click "Save Changes" to persist to Supabase.']})}})()}):null},u=e=>{let{onRefresh:r,onSave:s,loadingInventory:t,saved:n}=e;return(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("button",{onClick:r,disabled:t,className:"font-inter px-4 py-2 uppercase text-xs bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50",children:t?"Refreshing...":"ðŸ”„ Refresh from Supabase"}),(0,a.jsx)("button",{onClick:s,disabled:t,className:"font-inter px-6 py-2 uppercase text-sm ".concat(n?"bg-green-600 text-white":t?"bg-gray-400 text-white cursor-not-allowed":"bg-black text-white hover:bg-gray-800"),children:t?"Loading...":n?"âœ“ Saved to Supabase":"Save Changes to Supabase"})]})},m=e=>{let{quantity:r,size:s="small"}=e;if(null==r)return null;let t="large"===s?"w-6 h-6":"w-5 h-5",n="large"===s?"w-4 h-4":"w-3 h-3";return 0===r?(0,a.jsx)("div",{className:"bg-red-500 text-white rounded-full ".concat(t," flex items-center justify-center shadow-lg"),children:(0,a.jsx)("svg",{className:n,fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}):null!==r&&r>0&&r<=5?(0,a.jsx)("div",{className:"bg-orange-500 text-white rounded-full ".concat(t," flex items-center justify-center shadow-lg"),children:(0,a.jsx)("svg",{className:n,fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}):null!==r&&r>5?(0,a.jsx)("div",{className:"bg-green-500 text-white rounded-full ".concat(t," flex items-center justify-center shadow-lg"),children:(0,a.jsx)("svg",{className:n,fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}):null},h=e=>{let{quantity:r,size:s="normal"}=e,t=0===r,n=null!==r&&r>0&&r<=5,l=null!==r&&r>5,o=null==r,i="small"===s?"p-1.5":"p-2",d="small"===s?"text-[10px]":"text-xs",c="small"===s?"mt-1 w-full":"";return t?(0,a.jsx)("div",{className:"".concat(i," bg-red-50 border border-red-200 rounded-sm ").concat(c),children:(0,a.jsx)("p",{className:"".concat(d," text-red-700 font-medium font-inter ").concat("small"===s?"text-center":""),children:"OUT OF STOCK"})}):n?(0,a.jsx)("div",{className:"".concat(i," bg-orange-50 border border-orange-200 rounded-sm ").concat(c),children:(0,a.jsxs)("p",{className:"".concat(d," text-orange-700 font-medium font-inter ").concat("small"===s?"text-center":""),children:["LOW STOCK (",r,")"]})}):l?(0,a.jsx)("div",{className:"".concat(i," bg-green-50 border border-green-200 rounded-sm ").concat(c),children:(0,a.jsxs)("p",{className:"".concat(d," text-green-700 font-medium font-inter ").concat("small"===s?"text-center":""),children:["IN STOCK (",r,")"]})}):o?(0,a.jsx)("div",{className:"".concat(i," bg-gray-50 border border-gray-200 rounded-sm ").concat(c),children:(0,a.jsx)("p",{className:"".concat(d," text-gray-600 font-medium font-inter ").concat("small"===s?"text-center":""),children:"UNLIMITED"})}):null},g=e=>{var r;let{caseItem:s,index:t,onQuantityChange:n}=e,l=void 0!==s.quantity?s.quantity:null,o=0===l,i=null==l;return(0,a.jsxs)("div",{className:"mb-8 border border-gray-200 rounded-sm p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 font-inter",children:s.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[!i&&(0,a.jsx)("div",{children:(0,a.jsx)(m,{quantity:l,size:"large"})}),o&&(0,a.jsx)("span",{className:"text-xs text-red-600 font-medium",children:"SOLD OUT"})]})]}),(0,a.jsxs)("div",{className:"mb-6 pb-4 border-b border-gray-100",children:[(0,a.jsx)("label",{className:"text-sm text-gray-600 font-medium mb-2 block font-inter",children:"Overall Quantity (Optional):"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"number",min:"0",value:null!=(r=s.quantity)?r:"",onChange:e=>n("case",t,null,e.target.value),className:"w-24 px-3 py-2 border border-gray-300 rounded-sm text-sm focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"}),(0,a.jsx)(h,{quantity:l,size:"normal"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-4 font-inter",children:"Quantity per Color:"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.colors.map((e,r)=>{var s;let l=void 0!==e.quantity?e.quantity:null,o=null==l;return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-sm hover:border-gray-300 transition-colors relative",children:[!o&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 z-10",children:(0,a.jsx)(m,{quantity:l,size:"small"})}),(0,a.jsx)("div",{className:"w-12 h-12 rounded-full border-2 border-gray-300 shadow-sm",style:{backgroundColor:e.color},title:e.color}),e.name&&(0,a.jsx)("span",{className:"text-xs text-gray-600 text-center font-inter",children:e.name}),(0,a.jsxs)("div",{className:"w-full flex flex-col items-center gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500 font-inter",children:"Qty:"}),(0,a.jsx)("input",{type:"number",min:"0",value:null!=(s=e.quantity)?s:"",onChange:e=>n("case",t,null,e.target.value,r),className:"w-full px-2 py-1 border border-gray-300 rounded-sm text-xs text-center focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"})]}),(0,a.jsx)(h,{quantity:l,size:"small"})]},r)})})]})]})},x=e=>{let{cases:r,onQuantityChange:s}=e;return(0,a.jsxs)("div",{className:"bg-white border p-6 rounded-sm",children:[(0,a.jsx)("h2",{className:"text-xl mb-6 font-inter",children:"Passport Cases"}),r.map((e,r)=>(0,a.jsx)(g,{caseItem:e,index:r,onQuantityChange:s},r))]})},p=e=>{var r;let{charm:s,index:t,category:n,onQuantityChange:l}=e,o=void 0!==s.quantity?s.quantity:null,i=null==o;return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-sm hover:border-gray-300 transition-colors relative",children:[!i&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 z-10",children:(0,a.jsx)(m,{quantity:o,size:"small"})}),s.image&&(0,a.jsx)("div",{className:"w-16 h-16 flex items-center justify-center border border-gray-200 rounded-sm bg-white",children:(0,a.jsx)("img",{src:s.image,alt:s.name,className:"max-w-full max-h-full object-contain"})}),(0,a.jsx)("span",{className:"text-xs text-gray-700 text-center font-inter font-medium",children:s.name}),(0,a.jsxs)("div",{className:"w-full flex flex-col items-center gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500 font-inter",children:"Qty:"}),(0,a.jsx)("input",{type:"number",min:"0",value:null!=(r=s.quantity)?r:"",onChange:e=>l("charm",t,n,e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-sm text-xs text-center focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"})]}),(0,a.jsx)(h,{quantity:o,size:"small"})]})},v=e=>{let{charms:r,onQuantityChange:s}=e;return(0,a.jsxs)("div",{className:"bg-white border p-6 rounded-sm mt-8",children:[(0,a.jsx)("h2",{className:"text-xl mb-6 font-inter",children:"Charms"}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Flags"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:r.flags.map((e,r)=>(0,a.jsx)(p,{charm:e,index:r,category:"flags",onQuantityChange:s},r))})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Colorful Charms"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:r.colorful.map((e,r)=>(0,a.jsx)(p,{charm:e,index:r,category:"colorful",onQuantityChange:s},r))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Bronze Charms"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:r.bronze.map((e,r)=>(0,a.jsx)(p,{charm:e,index:r,category:"bronze",onQuantityChange:s},r))})]})]})},b=e=>{let{products:r,inventorySource:s,loadingInventory:t,saved:n,onRefresh:l,onSave:o,onQuantityChange:i}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c,{source:s,loading:t}),(0,a.jsx)(u,{onRefresh:l,onSave:o,loadingInventory:t,saved:n}),(0,a.jsx)(x,{cases:r.cases,onQuantityChange:i}),(0,a.jsx)(v,{charms:r.pins,onQuantityChange:i})]})};var y=e.i(67110);let f=e=>{var r,s;let{orders:t,loadingOrders:l,ordersError:o,onRefresh:d}=e,[c,u]=(0,n.useState)(null),[m,h]=(0,n.useState)("all"),[g,x]=(0,n.useState)("all"),[p,v]=(0,n.useState)(new Set),[b,f]=(0,n.useState)(null),[j,N]=(0,n.useState)(""),[w,k]=(0,n.useState)(""),[S,_]=(0,n.useState)(""),C=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",E=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gbp";return e||0===e?new Intl.NumberFormat("en-GB",{style:"currency",currency:r.toUpperCase()}).format(e):"N/A"},T=e=>{u(c===e?null:e)},I=async(e,r,s,t,a)=>{v(r=>new Set(r).add(e));try{let n=(0,i.getApiUrl)("/api/orders/".concat(e,"/dispatched"));console.log("Updating dispatched status:",{orderId:e,dispatched:r,tracking_number:s,tracking_link:t,carrier:a,apiUrl:n});let l={dispatched:r,tracking_number:s?s.trim():"",tracking_link:t?t.trim():"",carrier:a?String(a).trim():""};console.log("ðŸ“¤ Sending dispatch update:",l);let o=await fetch(n,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),c=o.headers.get("content-type");if(c&&c.includes("text/html"))throw Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");if(!o.ok){let e="Failed to update dispatched status";try{let r=await o.json();e=r.message||r.error||e}catch(r){e="HTTP ".concat(o.status,": ").concat(o.statusText)}throw Error(e)}let u=await o.json();console.log("âœ… Dispatched status updated:",u),u.dispatchEmailSent?alert("Order marked as dispatched. Tracking email with tracking info sent to the customer."):u.dispatchEmailError&&alert("Order marked as dispatched, but the tracking email could not be sent: ".concat(u.dispatchEmailError,". Check server logs and RESEND_API_KEY in .env")),f(null),N(""),k(""),_(""),d&&d()}catch(r){console.error("Error updating dispatched status:",r);let e=r.message||"Failed to update dispatched status. Make sure the backend server is running.";alert("Failed to update dispatched status: ".concat(e))}finally{v(r=>{let s=new Set(r);return s.delete(e),s})}},D=e=>{var r;return(null==(r=e.metadata)?void 0:r.dispatched)===!0},L=(0,n.useMemo)(()=>{if(!t||0===t.length)return[];let e=new Map;return t.forEach(r=>{if(r.order_date){let s=new Date(r.order_date),t=s.getFullYear(),a=s.getMonth(),n="".concat(t,"-").concat(String(a+1).padStart(2,"0")),l=s.toLocaleDateString("en-US",{year:"numeric",month:"long"});e.has(n)||e.set(n,{key:n,label:l,year:t,month:a})}}),Array.from(e.values()).sort((e,r)=>e.year!==r.year?r.year-e.year:r.month-e.month)},[t]),O=(0,n.useMemo)(()=>{let e=t;if("all"!==m){let[r,s]=m.split("-").map(Number);e=e.filter(e=>{if(!e.order_date)return!1;let t=new Date(e.order_date);return t.getFullYear()===r&&t.getMonth()===s-1})}return"succeeded"===g?e=e.filter(e=>{var r;return(null==(r=e.metadata)?void 0:r.dispatched)!==!0}):"dispatched"===g&&(e=e.filter(e=>{var r;return(null==(r=e.metadata)?void 0:r.dispatched)===!0})),e},[t,m,g]),A=(0,n.useMemo)(()=>O.reduce((e,r)=>e+(r.total_amount||0),0),[O]);return l?(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-8 text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading orders..."})]}):o?(0,a.jsx)("div",{className:"bg-white border rounded-lg p-6",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-4",children:[(0,a.jsx)("p",{className:"text-red-800 font-medium",children:"Error loading orders"}),(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:o}),d&&(0,a.jsx)("button",{onClick:d,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Retry"})]})}):t&&0!==t.length?0===O.length&&("all"!==m||"all"!==g)?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Orders"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[t.length," total order(s) â€¢ ",O.length," match filters"]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 items-center",children:[(0,a.jsxs)("select",{value:g,onChange:e=>x(e.target.value),className:"px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm bg-white",children:[(0,a.jsx)("option",{value:"all",children:"All Orders"}),(0,a.jsx)("option",{value:"succeeded",children:"Succeeded"}),(0,a.jsx)("option",{value:"dispatched",children:"Dispatched"})]}),(0,a.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm bg-white",children:[(0,a.jsx)("option",{value:"all",children:"All Months"}),L.map(e=>(0,a.jsx)("option",{value:e.key,children:e.label},e.key))]}),d&&(0,a.jsx)("button",{onClick:d,className:"px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 text-sm",children:"Refresh"})]})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-8 text-center",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"No orders found for the selected filters."}),(0,a.jsx)("button",{onClick:()=>{h("all"),x("all")},className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 text-sm",children:"Show All Orders"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Orders"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["all"===m&&"all"===g?(0,a.jsxs)("span",{children:[O.length," order(s) found"]}):(0,a.jsxs)("span",{children:[O.length," order(s)","all"!==g&&(0,a.jsxs)("span",{children:[" (","succeeded"===g?"Succeeded":"Dispatched",")"]}),"all"!==m&&(0,a.jsxs)("span",{children:[" in ",(null==(r=L.find(e=>e.key===m))?void 0:r.label)||"selected period"]}),A>0&&O.length>0&&(0,a.jsxs)("span",{className:"ml-2 font-medium",children:["â€¢ Total: ",E(A,(null==(s=O[0])?void 0:s.currency)||"gbp")]})]}),("all"!==m||"all"!==g)&&(0,a.jsxs)("span",{className:"text-gray-400 ml-2",children:["(of ",t.length," total)"]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 items-center",children:[(0,a.jsxs)("select",{value:g,onChange:e=>x(e.target.value),className:"px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm bg-white",children:[(0,a.jsx)("option",{value:"all",children:"All Orders"}),(0,a.jsx)("option",{value:"succeeded",children:"Succeeded"}),(0,a.jsx)("option",{value:"dispatched",children:"Dispatched"})]}),(0,a.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm bg-white",children:[(0,a.jsx)("option",{value:"all",children:"All Months"}),L.map(e=>(0,a.jsx)("option",{value:e.key,children:e.label},e.key))]}),d&&(0,a.jsx)("button",{onClick:d,className:"px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 text-sm",children:"Refresh"})]})]}),O.map(e=>{var r,s,n,l,o,i,d,u,m,h,g,x,v,b,j,w,S,L,O,A,R,U;let q=c===e.order_id,z=e.items||[],M=e.shipping_address||{};return(0,a.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1 cursor-pointer",onClick:()=>T(e.order_id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsxs)("h3",{className:"font-semibold text-lg",children:["Order #",(0,y.getOrderDisplayId)(e)]}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(D(e)?"bg-blue-100 text-blue-800":"succeeded"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:D(e)?"Dispatched":e.status||"unknown"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Customer:"})," ",e.customer_name||e.customer_email]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Date:"})," ",C(e.order_date)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Total:"})," ",E(e.total_amount,e.currency)]})]}),((null==(r=e.tracking)?void 0:r.tracking_number)||(null==(s=e.tracking)?void 0:s.tracking_link)||(null==(n=e.tracking)?void 0:n.carrier)||(null==(l=e.metadata)?void 0:l.carrier))&&(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm",children:[((null==(o=e.tracking)?void 0:o.carrier)||(null==(i=e.metadata)?void 0:i.carrier))&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Carrier:"}),(0,a.jsx)("span",{className:"text-gray-900",children:(null==(d=e.tracking)?void 0:d.carrier)||(null==(u=e.metadata)?void 0:u.carrier)})]}),(null==(m=e.tracking)?void 0:m.tracking_number)&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Tracking #:"}),(0,a.jsx)("span",{className:"text-gray-900 font-mono text-xs bg-gray-100 px-2 py-1 rounded",children:e.tracking.tracking_number})]}),(null==(h=e.tracking)?void 0:h.tracking_link)&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Track:"}),(0,a.jsxs)("a",{href:e.tracking.tracking_link,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"View Tracking"]})]})]})}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:[z.length," item(s) â€¢ ",e.customer_email]})]}),(0,a.jsxs)("div",{className:"ml-4 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",onClick:r=>{r.stopPropagation(),((e,r)=>{let s=t.find(r=>r.order_id===e);if(r)window.confirm("Are you sure you want to mark this order as not dispatched? This will clear tracking information.")&&I(e,!1,"","","");else{var a,n,l;N((null==s||null==(a=s.tracking)?void 0:a.tracking_number)||""),k((null==s||null==(n=s.tracking)?void 0:n.tracking_link)||(null==s||null==(l=s.metadata)?void 0:l.tracking_link)||""),_("EVRI"),f({orderId:e,currentDispatched:r})}})(e.order_id,D(e))},children:(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:D(e),onChange:()=>{},disabled:p.has(e.order_id),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 cursor-pointer disabled:opacity-50"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:p.has(e.order_id)?"Updating...":"Dispatched"})]})}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>T(e.order_id),children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform ".concat(q?"transform rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 9l-7 7-7-7"})})})]})]})}),q&&(0,a.jsxs)("div",{className:"border-t bg-gray-50 p-6",children:[((null==(g=e.tracking)?void 0:g.tracking_number)||(null==(x=e.tracking)?void 0:x.tracking_link)||(null==(v=e.tracking)?void 0:v.carrier)||(null==(b=e.metadata)?void 0:b.carrier)||(null==(j=e.metadata)?void 0:j.dispatched_at))&&(0,a.jsxs)("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsxs)("h4",{className:"font-semibold mb-3 text-gray-900 flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Dispatch Information"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(null==(w=e.metadata)?void 0:w.dispatched_at)&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Dispatched Date:"})," ",(0,a.jsx)("span",{className:"text-gray-900",children:C(e.metadata.dispatched_at)})]}),((null==(S=e.tracking)?void 0:S.carrier)||(null==(L=e.metadata)?void 0:L.carrier))&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Carrier:"})," ",(0,a.jsx)("span",{className:"text-gray-900",children:(null==(O=e.tracking)?void 0:O.carrier)||(null==(A=e.metadata)?void 0:A.carrier)})]}),(null==(R=e.tracking)?void 0:R.tracking_number)&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Tracking Number:"})," ",(0,a.jsx)("span",{className:"text-gray-900 font-mono bg-white px-2 py-1 rounded border border-blue-200",children:e.tracking.tracking_number})]}),(null==(U=e.tracking)?void 0:U.tracking_link)&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Tracking Link:"})," ",(0,a.jsxs)("a",{href:e.tracking.tracking_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline inline-flex items-center gap-1 break-all",children:[(0,a.jsx)("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),(0,a.jsx)("span",{className:"break-all",children:e.tracking.tracking_link})]})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)("button",{onClick:r=>{var s,a,n,l;let o;r.stopPropagation(),s=e.order_id,N((null==(o=t.find(e=>e.order_id===s))||null==(a=o.tracking)?void 0:a.tracking_number)||""),k((null==o||null==(n=o.tracking)?void 0:n.tracking_link)||(null==o||null==(l=o.metadata)?void 0:l.tracking_link)||""),_("EVRI"),f({orderId:s,currentDispatched:D(o)})},className:"px-3 py-1.5 text-xs text-gray-700 hover:text-gray-900 border border-gray-300 rounded hover:bg-white transition-colors",disabled:p.has(e.order_id),children:D(e)?"Edit Tracking Info":"Add/Edit Tracking Info"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-3 text-gray-900",children:"Customer Information"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Name:"})," ",e.customer_name||"N/A"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Email:"})," ",(0,a.jsx)("a",{href:"mailto:".concat(e.customer_email),className:"text-blue-600 hover:underline",children:e.customer_email})]}),e.customer_phone&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Phone:"})," ",(0,a.jsx)("a",{href:"tel:".concat(e.customer_phone),className:"text-blue-600 hover:underline",children:e.customer_phone})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-3 text-gray-900",children:"Shipping Address"}),M.line1?(0,a.jsxs)("div",{className:"text-sm space-y-1",children:[(0,a.jsx)("div",{children:M.line1}),M.line2&&(0,a.jsx)("div",{children:M.line2}),(0,a.jsxs)("div",{children:[M.city,M.state&&", ".concat(M.state)]}),(0,a.jsxs)("div",{children:[M.postal_code," ",M.country]})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No shipping address provided"})]})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h4",{className:"font-semibold mb-3 text-gray-900",children:"Order Items"}),(0,a.jsx)("div",{className:"space-y-4",children:z.map((r,s)=>(0,a.jsxs)("div",{className:"bg-white border rounded p-4 flex gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:r.design_image?(0,a.jsx)("img",{src:r.design_image,alt:r.name||"Custom design",className:"w-24 h-24 object-cover rounded border",onError:e=>{r.case_image&&e.target.src!==r.case_image?e.target.src=r.case_image:e.target.style.display="none"}}):r.case_image?(0,a.jsx)("img",{src:r.case_image,alt:r.name||"Case",className:"w-24 h-24 object-cover rounded border",onError:e=>{e.target.style.display="none"}}):(0,a.jsx)("div",{className:"w-24 h-24 bg-gray-200 rounded border flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"No image"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900",children:r.name||"Custom Case"}),(0,a.jsxs)("div",{className:"mt-1 space-y-1 text-sm text-gray-600",children:[r.case_type&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Type:"})," ",r.case_type]}),r.color&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Color:"})," ",r.color]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Quantity:"})," ",r.quantity||1]}),r.pins&&r.pins.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Pins:"})," ",r.pins.map((e,s)=>(0,a.jsxs)("span",{children:[e.name||e,s<r.pins.length-1?", ":""]},s))]}),r.custom_design&&(0,a.jsx)("span",{className:"inline-block px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded mt-1",children:"Custom Design"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:E(r.total_price||r.unit_price||0,e.currency)}),r.quantity>1&&(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[E(r.unit_price||0,e.currency)," each"]})]})]},s))})]}),(0,a.jsx)("div",{className:"mt-6 pt-4 border-t",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Payment Intent:"})," ",(0,a.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:e.payment_intent_id||"N/A"})]}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Order ID:"})," ",(0,a.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:e.order_id})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total Amount"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:E(e.total_amount,e.currency)})]})]})})]})]},e.order_id)}),b&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:b.currentDispatched?"Edit Tracking Information":"Dispatch Order"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:b.currentDispatched?"Update tracking information for this dispatched order:":"Enter tracking information for this order (optional):"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Carrier"}),(0,a.jsx)("div",{className:"w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-900 font-medium",children:"EVRI"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tracking Number"}),(0,a.jsx)("input",{type:"text",value:j,onChange:e=>N(e.target.value),placeholder:"e.g., 16 digit Evri tracking number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tracking Link (sent to customer in email)"}),(0,a.jsx)("input",{type:"url",value:w,onChange:e=>k(e.target.value),placeholder:"https://www.evri.com/track-a-parcel or your tracking URL",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-3 justify-end",children:[(0,a.jsx)("button",{onClick:()=>{f(null),N(""),k(""),_("")},className:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",disabled:p.has(b.orderId),children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{b&&I(b.orderId,!0,j,w,"EVRI")},disabled:p.has(b.orderId),className:"px-4 py-2 text-sm bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p.has(b.orderId)?b.currentDispatched?"Updating...":"Dispatching...":b.currentDispatched?"Update Tracking":"Dispatch Order"})]})]})})]}):(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-8 text-center",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"No orders found."}),d&&(0,a.jsx)("button",{onClick:d,className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800",children:"Refresh"})]})},j=(0,e.i(34290).getSupabaseClient)();e.s(["default",0,()=>{let e=(0,l.useRouter)(),[c,u]=(0,n.useState)("inventory"),[m,h]=(0,n.useState)(o.default),[g,x]=(0,n.useState)(!1),[p,v]=(0,n.useState)([]),[y,N]=(0,n.useState)(!1),[w,k]=(0,n.useState)(null),[S,_]=(0,n.useState)(!0),[C,E]=(0,n.useState)(null),[T,I]=(0,n.useState)(null),[D,L]=(0,n.useState)(!1),[O,A]=(0,n.useState)(!1),R=(e,r)=>{r.cases&&(e.cases=e.cases.map((e,a)=>{var n;let l=(0,t._)((0,s._)({},e),{quantity:void 0!==r.cases[a]&&null!==r.cases[a]?r.cases[a]:e.quantity});return(null==(n=r.caseColors)?void 0:n[a])&&(l.colors=l.colors.map((e,n)=>(0,t._)((0,s._)({},e),{quantity:void 0!==r.caseColors[a][n]&&null!==r.caseColors[a][n]?r.caseColors[a][n]:e.quantity}))),l})),r.pins&&["flags","colorful","bronze"].forEach(a=>{r.pins[a]&&(e.pins[a]=e.pins[a].map((e,n)=>(0,t._)((0,s._)({},e),{quantity:void 0!==r.pins[a][n]&&null!==r.pins[a][n]?r.pins[a][n]:e.quantity})))})};(0,n.useEffect)(()=>{window.__dashboardInventoryLoading||(window.__dashboardInventoryLoading=!1,window.__dashboardInventoryLoaded=!1)},[]),(0,n.useEffect)(()=>{window.__dashboardInventoryLoading?console.log("â­ï¸ Dashboard: Already loading (skipping StrictMode duplicate)"):window.__dashboardInventoryLoaded?console.log("â­ï¸ Dashboard: Already loaded (skipping StrictMode duplicate)"):(window.__dashboardInventoryLoading=!0,console.log("ðŸ”’ Dashboard: Set loading flag (module-level), starting fetch"),(async()=>{_(!0),console.log("ðŸ“¥ Dashboard: Loading inventory from Supabase...");try{await new Promise(e=>setTimeout(e,100));let e=(0,i.getApiUrl)("/api/inventory");console.log("ðŸ“¡ Dashboard: Fetching from:",e);let r=await fetch(e),s=r.headers.get("content-type")||"",t=await r.text(),a=null;if(s.includes("application/json"))try{a=JSON.parse(t)}catch(e){throw console.error("âŒ Dashboard: Response claimed JSON but parse failed:",e),Error("Invalid JSON from API: ".concat(t.substring(0,300)))}else if(!r.ok&&t.trim().length>0)try{a=JSON.parse(t)}catch(e){a={error:t.substring(0,500),message:t.substring(0,500)}}if(r.ok&&a&&a.success&&a.inventory){let e={cases:a.inventory.cases,caseColors:a.inventory.caseColors,pins:a.inventory.pins},r=structuredClone(o.default);R(r,e),h(r),E("supabase"),console.log("âœ… Dashboard: Inventory loaded from Supabase inventory_items table"),window.__dashboardInventoryLoaded=!0,window.__dashboardInventoryLoading=!1,_(!1);return}if(!r.ok){let e=a&&(a.error||a.message)||t.substring(0,500)||"HTTP ".concat(r.status,": ").concat(r.statusText);console.error("âŒ Dashboard: Supabase API returned non-OK response:",r.status,e),a&&console.error("âŒ Dashboard: Error details:",a),500===r.status&&console.error("âŒ Dashboard: Server error - check server console (node server.js) for details"),h(o.default),E("default"),console.warn("âš ï¸ Dashboard: Using default quantities from products.json")}window.__dashboardInventoryLoaded=!0,window.__dashboardInventoryLoading=!1,_(!1)}catch(e){console.error("\nâŒ ========== DASHBOARD INVENTORY LOAD ERROR =========="),console.error("Failed to load from Supabase:",e.message),console.error("Error name:",e.name),e.stack&&console.error("Error stack:",e.stack),console.error("========================================================\n"),window.__dashboardInventoryLoading=!1,h(o.default),E("default"),console.warn("âš ï¸ Dashboard: Failed to load from Supabase, using default quantities from products.json"),window.__dashboardInventoryLoaded=!0,window.__dashboardInventoryLoading=!1,_(!1)}})())},[]),(0,n.useEffect)(()=>()=>{},[]),(0,n.useEffect)(()=>{let e=localStorage.getItem("userEmail"),s="thehappycase.shop@gmail.com".trim();if(e){let r=e.toLowerCase().trim();if(r===s){A(!0),L(!0),console.log("âœ… User authorized via localStorage:",r),j&&j.auth.getUser().then(e=>{let{data:r,error:s}=e;if(!s&&(null==r?void 0:r.user)){var t;I(r.user),console.log("âœ… Supabase user also authenticated:",null==(t=r.user)?void 0:t.id)}});return}}if(!j){var t;void 0!==r.default&&(null==(t=r.default.env)?void 0:t.NODE_ENV)==="development"&&console.warn("âš ï¸ Supabase client not initialized. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in .env"),L(!0),A(!1);return}j.auth.getUser().then(r=>{var t;let{data:a,error:n}=r;if(n){if(console.error("âŒ Error getting user:",n),e&&e.toLowerCase().trim()===s){A(!0),L(!0),console.log("âœ… User authorized via localStorage (Supabase auth failed)");return}L(!0),A(!1);return}let l=a.user;I(l),L(!0);let o=null==l||null==(t=l.email)?void 0:t.toLowerCase().trim();if(o===s)A(!0),console.log("âœ… User authenticated and authorized via Supabase:",null==l?void 0:l.id);else{if(e&&e.toLowerCase().trim()===s){A(!0),console.log("âœ… User authorized via localStorage (Supabase email different)");return}A(!1),console.warn("âŒ Unauthorized access attempt. User email:",o||e),console.warn("âŒ Authorized email:",s)}})},[]),(0,n.useEffect)(()=>{D&&O&&"orders"===c&&U((null==T?void 0:T.id)||null)},[c,D,O,T]);let U=async function(){var e,r,s,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;N(!0),k(null);try{let r;await new Promise(e=>setTimeout(e,100));let s=(0,i.getApiUrl)("/get-orders?limit=100");console.log("ðŸ“¡ Fetching all orders from:",s),console.log("ðŸ“Š Dashboard: Fetching all orders (no email filter)"),a?console.log("ðŸ‘¤ User ID:",a):console.log("ðŸ“Š Fetching orders without user ID (showing all orders)");let t=await fetch(s);if((t.headers.get("content-type")||"").includes("text/html"))throw Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");let n=await t.text();if(!n||""===n.trim())throw console.error("âŒ Empty response received. Status:",t.status,t.statusText),console.error("âŒ Response headers:",Object.fromEntries(t.headers.entries())),Error("Server returned empty response. Check server logs for errors. Make sure the backend server is running on port 3001.");try{r=JSON.parse(n)}catch(e){throw console.error("âŒ Failed to parse JSON response:",e),console.error("âŒ Response status:",t.status,t.statusText),console.error("âŒ Response text (first 500 chars):",n.substring(0,500)),Error("Server returned invalid JSON: ".concat(e.message,". Response: ").concat(n.substring(0,200)))}if(!t.ok){let e=(null==r?void 0:r.error)||(null==r?void 0:r.message)||"Server error: ".concat(t.status," ").concat(t.statusText);throw console.error("âŒ Server error response:",{status:t.status,error:e,data:r}),Error(e)}if(r.success)v(r.orders||[]),console.log("âœ… Loaded ".concat((null==(e=r.orders)?void 0:e.length)||0," orders from Supabase"));else{let e=r.error||r.message||"Failed to fetch orders";console.error("âŒ API returned success=false:",e),k(e)}}catch(a){console.error("âŒ Error fetching orders:",a),console.error("âŒ Error details:",{name:a.name,message:a.message,stack:a.stack});let e=a.message||"Failed to fetch orders.";(null==(r=a.message)?void 0:r.includes("HTML"))||(null==(s=a.message)?void 0:s.includes("404"))?e="Backend server not reachable. Make sure the server is running: npm run server":(null==(t=a.message)?void 0:t.includes("empty response"))&&(e="Server returned empty response. Check if the backend server is running on port 3001."),k(e)}finally{N(!1)}},q=async()=>{let e={cases:m.cases.map(e=>{var r;return null!=(r=e.quantity)?r:null}),caseColors:m.cases.map(e=>{var r;return null==(r=e.colors)?void 0:r.map(e=>{var r;return null!=(r=e.quantity)?r:null})}),pins:{flags:m.pins.flags.map(e=>{var r;return null!=(r=e.quantity)?r:null}),colorful:m.pins.colorful.map(e=>{var r;return null!=(r=e.quantity)?r:null}),bronze:m.pins.bronze.map(e=>{var r;return null!=(r=e.quantity)?r:null})}};try{let r,s=await fetch((0,i.getApiUrl)("/api/inventory"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=s.headers.get("content-type")||"";if(t.includes("application/json"))try{r=await s.json()}catch(e){throw console.error("âŒ Failed to parse JSON response:",e),Error("Server returned invalid JSON response. Make sure the backend server is running on port 3001.")}else{let e="";try{e=await s.text()}catch(r){e="Could not read response body"}let r=t.includes("text/html")||t.includes("text/plain")?"Backend server returned ".concat(t," instead of JSON. This usually means:\n1. The backend server is not running (start with: npm run server)\n2. The proxy is not configured correctly\n3. The endpoint does not exist\n\nResponse preview: ").concat(e.substring(0,200)):"Server returned non-JSON response (".concat(t||"unknown","). Make sure the backend server is running on port 3001.\n\nResponse preview: ").concat(e.substring(0,200));throw console.error("âŒ Error saving inventory:",r),console.error("âŒ Full response text:",e),Error("Server returned non-JSON response (".concat(t,"). Make sure the backend server is running on port 3001."))}if(s.ok){if(console.log("âœ… Inventory saved to Supabase:",r),console.log("ðŸ“Š Saved ".concat(r.updatedCount||0," items to inventory_items table")),console.log("ðŸ’¾ All inventory data is now persisted in Supabase and will be available after deployment"),r.success&&r.updatedCount>0){console.log("âœ… Verification: Inventory successfully saved to Supabase database"),console.log("âœ… This data will persist after deployment");let s={cases:e.cases,caseColors:e.caseColors,pins:e.pins},t=structuredClone(o.default);R(t,s),h(t),E("supabase"),window.dispatchEvent(new CustomEvent("inventoryUpdated",{detail:{timestamp:Date.now(),updatedCount:r.updatedCount}})),console.log("ðŸ“¢ Broadcasted inventoryUpdated event to refresh other pages")}x(!0),setTimeout(()=>x(!1),3e3)}else{let e="Unknown error";try{let r=await s.json();e=r.error||r.message||"Unknown error"}catch(r){e="HTTP ".concat(s.status,": ").concat(s.statusText)}console.error("Failed to save inventory to Supabase:",e),alert("Failed to save to Supabase: ".concat(e)),x(!1)}}catch(r){console.error("Error saving inventory to Supabase:",r);let e=r.message||"Unknown error";alert(e.includes("HTML")||e.includes("404")?"Error: Backend server not reachable.\n\nTroubleshooting steps:\n1. Check if backend server is running: npm run server\n2. Verify server is on port 3001\n3. Restart React dev server if you just configured proxy\n4. Check setupProxy.js is in src/ directory":"Error saving to Supabase: ".concat(e)),x(!1)}},z=async()=>{_(!0),E(null);try{let e=await fetch((0,i.getApiUrl)("/api/inventory"));if(e.ok){let r=await e.json();if(r.success&&r.inventory){let e={cases:r.inventory.cases,caseColors:r.inventory.caseColors,pins:r.inventory.pins},s=structuredClone(o.default);R(s,e),h(s),E("supabase"),console.log("âœ… Refreshed: Inventory reloaded from Supabase")}}}catch(e){console.error("Failed to refresh from Supabase:",e)}finally{_(!1)}};return D?O?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-light mb-6 font-inter",children:"Dashboard"}),(0,a.jsx)(d,{activeTab:c,onTabChange:u}),"inventory"===c&&(0,a.jsx)(b,{products:m,inventorySource:C,loadingInventory:S,saved:g,onRefresh:z,onSave:q,onQuantityChange:function(e,r,s,t){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=structuredClone(m);"case"===e&&(null!==a?n.cases[r].colors[a].quantity=parseInt(t)||0:n.cases[r].quantity=parseInt(t)||0),"charm"===e&&(n.pins[s][r].quantity=parseInt(t)||0),h(n),x(!1)}}),"orders"===c&&(0,a.jsx)(f,{orders:p,loadingOrders:y,ordersError:w,onRefresh:()=>O&&U((null==T?void 0:T.id)||null)})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-8 md:p-12 text-center",children:[(0,a.jsx)("div",{className:"text-red-600 mb-4",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",style:{fontFamily:"'Poppins', sans-serif"},children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6 font-inter",children:"You do not have permission to access the dashboard. This area is restricted to authorized personnel only."}),(null==T?void 0:T.email)&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mb-6 font-inter",children:["Your email: ",(0,a.jsx)("span",{className:"font-medium",children:T.email})]}),(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Go to Home"})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600 font-inter",children:"Checking authorization..."})]})})})}],51375)}]);