(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67110,e=>{"use strict";let t=e=>e&&"N/A"!==e?String(e).slice(-8).toUpperCase():"N/A";e.s(["calculateTotalAmount",0,e=>e&&0!==e.length?e.reduce((e,t)=>e+(t.totalPrice||t.price||0)*(t.quantity||1),0):0,"formatDate",0,e=>e?new Date(1e3*e).toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A","getDisplayOrderNumber",0,(e,r)=>t(e),"getOrderDisplayId",0,e=>e&&(e.order_number||t(e.order_id))||"N/A","getOrderNumberFromPaymentIntentId",0,t])},19790,e=>{"use strict";var t=e.i(43476);e.i(71645);var r=e.i(22123),a=e.i(28690);e.s(["default",0,e=>{let{item:s}=e,i=s.design_image||s.designImage||s.case_image||s.caseImage||s.image,n=s.caseName||s.name||"Custom Case",o=0;void 0!==s.total_price?o=parseFloat(s.total_price)||0:void 0!==s.totalPrice?o=(parseFloat(s.totalPrice)||0)*(s.quantity||1):void 0!==s.price&&(o=(parseFloat(s.price)||0)*(s.quantity||1));let l=s.color?(0,a.getColorName)(s.color,s.case_image||s.caseImage||s.image):null;return(0,t.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[i&&(0,t.jsx)("img",{src:(0,r.normalizeImagePath)(i),alt:n,className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded",loading:"lazy"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900 mb-1 font-inter",children:n}),l&&(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Color: ",(0,t.jsx)("span",{className:"font-medium",children:l})]}),(s.pinsDetails&&s.pinsDetails.length>0||s.pins&&Array.isArray(s.pins)&&s.pins.length>0)&&(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Charms: ",(0,t.jsx)("span",{className:"font-medium",children:(s.pinsDetails||s.pins||[]).length})]}),s.quantity>1&&(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Quantity: ",(0,t.jsx)("span",{className:"font-medium",children:s.quantity})]}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-2 font-inter",children:["£",o.toFixed(2)]})]})]})})}])},90438,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(34290),i=e.i(63707),n=e.i(19790),o=e.i(67110);let l=(0,s.getSupabaseClient)();e.s(["default",0,()=>{let e=(0,a.useRouter)(),s=(0,a.useSearchParams)(),d=s.get("email")||"",[c,m]=(0,r.useState)(d),[g,u]=(0,r.useState)(""),[x,h]=(0,r.useState)(d?"code":"email"),[p,y]=(0,r.useState)(!1),[f,b]=(0,r.useState)(""),[v,N]=(0,r.useState)(!1),[j,w]=(0,r.useState)([]),[S,I]=(0,r.useState)(!1),[C,P]=(0,r.useState)(""),[k,A]=(0,r.useState)(!1);(0,r.useEffect)(()=>{window.scrollTo({top:0,behavior:"smooth"});let e=localStorage.getItem("userEmail"),t="true"===localStorage.getItem("isLoggedIn");t&&e&&(A(!0),m(e),D(e)),d&&!t&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)&&E(d)},[e,s,d]);let D=async e=>{I(!0),P("");try{let t;if(!e)throw Error("Email is required to fetch orders");let r=(0,i.getApiUrl)("/get-orders?email=".concat(encodeURIComponent(e))),a=await fetch(r);if((a.headers.get("content-type")||"").includes("text/html"))throw Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");let s=await a.text();if(!s||""===s.trim())throw Error("Server returned empty response (".concat(a.status,"). Check server logs for errors."));try{t=JSON.parse(s)}catch(e){throw Error("Server returned invalid JSON (".concat(a.status,"): ").concat(e.message))}if(!a.ok){let e=(null==t?void 0:t.error)||(null==t?void 0:t.message)||"Server error: ".concat(a.status," ").concat(a.statusText);throw Error(e)}t.success&&void 0!==t.orders?w(t.orders||[]):t.error?P(t.error||"Failed to load orders"):w(Array.isArray(t)?t:t.orders||[])}catch(e){console.error("Error fetching orders:",e),P(e.message||"Failed to load your orders. Please try again later.")}finally{I(!1)}},E=async e=>{y(!0),b("");try{if(!l)throw Error("Supabase is not configured. Please check your environment variables.");let{data:t,error:r}=await l.auth.signInWithOtp({email:e,options:{emailRedirectTo:null}});if(r){b(r.message||"Failed to send verification code. Please try again."),y(!1);return}y(!1),h("code"),N(!0),setTimeout(()=>N(!1),3e3)}catch(e){y(!1),b(e.message||"Failed to send verification code. Please try again.")}},F=async e=>{if(e.preventDefault(),!c)return void b("Please enter your email address");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c))return void b("Please enter a valid email address");y(!0),b(""),N(!1);try{if(!l)throw Error("Supabase is not configured. Please check your environment variables.");let{data:e,error:t}=await l.auth.signInWithOtp({email:c.trim(),options:{emailRedirectTo:null}});if(t){b(t.message||"Failed to send verification code. Please try again."),y(!1);return}y(!1),h("code"),N(!0),setTimeout(()=>N(!1),3e3)}catch(e){y(!1),b(e.message||"Failed to send verification code. Please try again.")}},O=async e=>{if(e.preventDefault(),!g||6!==g.length)return void b("Please enter the 6-digit code");y(!0),b(""),N(!1);try{if(!l)throw Error("Supabase is not configured. Please check your environment variables.");let{data:e,error:t}=await l.auth.verifyOtp({email:c.trim(),token:g.trim(),type:"email"});if(t){b(t.message||"Invalid code. Please try again."),y(!1);return}let{data:{user:r},error:a}=await l.auth.getUser();if(a||!r){b("Failed to get user information. Please try again."),y(!1);return}let s=r.email||c;localStorage.setItem("userEmail",s),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",r.id),A(!0),h("orders"),await D(s)}catch(e){b(e.message||"Invalid code. Please try again."),y(!1)}};return(0,t.jsx)("div",{className:"min-h-screen bg-white py-12 md:py-16",children:(0,t.jsxs)("div",{className:"".concat(k?"max-w-6xl":"max-w-md"," mx-auto px-4 sm:px-6 lg:px-8"),children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("h1",{className:"text-title md:text-title-lg font-light text-gray-900 mb-2 font-inter tracking-title",children:k?"My Orders":"email"===x?"Log In":"Verify Code"}),(0,t.jsx)("div",{className:"w-16 h-px bg-gray-300 mx-auto mb-4"}),k&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-gray-600 font-inter",children:c}),(0,t.jsx)("button",{onClick:()=>{localStorage.removeItem("userEmail"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userId"),A(!1),w([]),h("email"),m(""),u("")},className:"mt-2 text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline",children:"Sign Out"})]})]}),v&&"code"===x&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-green-800 font-light font-inter",children:["Verification code sent to ",(0,t.jsx)("strong",{children:c})]})}),f&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-red-800 font-light font-inter",children:f})}),"email"===x&&(0,t.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Email Address *"}),(0,t.jsx)("input",{type:"email",value:c,onChange:e=>{m(e.target.value),b("")},placeholder:"your.email@example.com",autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-base",required:!0})]}),(0,t.jsx)("button",{type:"submit",disabled:p,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Sending Code...":"Send Verification Code"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 text-center font-light font-inter",children:"By continuing, you agree to our Terms of Use and Privacy Policy."})]}),"code"===x&&(0,t.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600 font-light font-inter mb-4 text-center",children:["We've sent a 6-digit verification code to ",(0,t.jsx)("strong",{children:c}),". Please enter it below."]}),(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Verification Code *"}),(0,t.jsx)("input",{type:"text",value:g,onChange:e=>{u(e.target.value.replace(/\D/g,"").slice(0,6)),b("")},placeholder:"000000",maxLength:6,autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-2xl text-center tracking-widest",required:!0})]}),(0,t.jsx)("button",{type:"submit",disabled:p||6!==g.length,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Verifying...":"Verify Code"}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{u(""),b(""),N(!1),F({preventDefault:()=>{}})},disabled:p,className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline disabled:opacity-50",children:"Resend Code"}),(0,t.jsx)("button",{type:"button",onClick:()=>{h("email"),u(""),b(""),N(!1),e.push("/Login")},className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter",children:"← Back to email"})]})]}),k&&(0,t.jsx)("div",{className:"mt-8",children:S?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600 font-inter",children:"Loading your orders..."})]}):C?(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-red-800 font-light font-inter",children:C}),(0,t.jsx)("button",{onClick:()=>D(c),className:"mt-4 px-6 py-2 text-sm bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Try Again"})]}):0===j.length?(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg shadow-sm p-8 md:p-12 text-center",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-4",children:(0,t.jsx)("svg",{className:"mx-auto h-16 w-16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2 font-inter",children:"No Orders Yet"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6 font-inter",children:"You haven't placed any orders yet. Start shopping to see your orders here!"}),(0,t.jsx)("button",{onClick:()=>e.push("/"),className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Start Shopping"})]}):(0,t.jsx)("div",{className:"space-y-6",children:j.map(e=>{var r,a;return(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-1 font-inter",children:["Order #",(0,o.getOrderDisplayId)(e)]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 font-inter",children:["Placed on ",(e=>{let t;if(!e)return"N/A";if("string"==typeof e)t=new Date(e);else{if("number"!=typeof e)return"N/A";t=new Date(1e3*e)}return t.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})(e.order_date)]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:items-end gap-2",children:[(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold font-inter ".concat("succeeded"===e.status||"complete"===e.status?"bg-green-100 text-green-800":"processing"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:(null==(r=e.status)?void 0:r.charAt(0).toUpperCase())+(null==(a=e.status)?void 0:a.slice(1))}),(0,t.jsxs)("p",{className:"text-lg font-bold text-gray-900 font-inter",children:["£",parseFloat(e.total_amount).toFixed(2)]})]})]})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"space-y-4",children:e.items&&Array.isArray(e.items)&&e.items.length>0?e.items.map((e,r)=>(0,t.jsx)(n.default,{item:e},r)):(0,t.jsx)("p",{className:"text-gray-600 font-inter",children:"No items found in this order."})})})]},e.order_id)})})})]})})}])}]);