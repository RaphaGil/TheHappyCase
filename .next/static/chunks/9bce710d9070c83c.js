(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51810,e=>{"use strict";var t=e.i(42613);e.i(44737);var r=e.i(46168),s=e.i(87709);e.s(["default",0,e=>{let{item:a}=e,i=a.design_image||a.designImage||a.case_image||a.caseImage||a.image,o=a.caseName||a.name||"Custom Case",n=0;void 0!==a.total_price?n=parseFloat(a.total_price)||0:void 0!==a.totalPrice?n=(parseFloat(a.totalPrice)||0)*(a.quantity||1):void 0!==a.price&&(n=(parseFloat(a.price)||0)*(a.quantity||1));let l=a.color?(0,s.getColorName)(a.color,a.case_image||a.caseImage||a.image):null;return(0,t.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[i&&(0,t.jsx)("img",{src:(0,r.normalizeImagePath)(i),alt:o,className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded",loading:"lazy"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900 mb-1 font-inter",children:o}),l&&(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Color: ",(0,t.jsx)("span",{className:"font-medium",children:l})]}),(a.pinsDetails&&a.pinsDetails.length>0||a.pins&&Array.isArray(a.pins)&&a.pins.length>0)&&(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Charms: ",(0,t.jsx)("span",{className:"font-medium",children:(a.pinsDetails||a.pins||[]).length})]}),a.quantity>1&&(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Quantity: ",(0,t.jsx)("span",{className:"font-medium",children:a.quantity})]}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-2 font-inter",children:["Â£",n.toFixed(2)]})]})]})})}])},74837,e=>{"use strict";var t=e.i(42613),r=e.i(44737),s=e.i(26125),a=e.i(78461),i=e.i(90564),o=e.i(51810);let n=(0,a.getSupabaseClient)();e.s(["default",0,()=>{let e=(0,s.useRouter)(),a=(0,s.useSearchParams)(),l=a.get("email")||"",[c,d]=(0,r.useState)(l),[m,g]=(0,r.useState)(""),[u,x]=(0,r.useState)(l?"code":"email"),[h,p]=(0,r.useState)(!1),[f,y]=(0,r.useState)(""),[b,v]=(0,r.useState)(!1),[j,N]=(0,r.useState)([]),[w,S]=(0,r.useState)(!1),[P,C]=(0,r.useState)(""),[k,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{window.scrollTo({top:0,behavior:"smooth"});let e=localStorage.getItem("userEmail"),t="true"===localStorage.getItem("isLoggedIn");t&&e&&(I(!0),d(e),E(e)),l&&!t&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)&&T(l)},[e,a,l]);let E=async e=>{S(!0),C("");try{let t;if(!e)throw Error("Email is required to fetch orders");let r=(0,i.getApiUrl)("/get-orders?email=".concat(encodeURIComponent(e)));console.log("ðŸ“¡ Fetching orders by email:",e);let s=await fetch(r);if((s.headers.get("content-type")||"").includes("text/html"))throw Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");let a=await s.text();if(!a||""===a.trim())throw Error("Server returned empty response (".concat(s.status,"). Check server logs for errors."));try{t=JSON.parse(a)}catch(e){throw Error("Server returned invalid JSON (".concat(s.status,"): ").concat(e.message))}if(!s.ok){let e=(null==t?void 0:t.error)||(null==t?void 0:t.message)||"Server error: ".concat(s.status," ").concat(s.statusText);throw Error(e)}t.success&&void 0!==t.orders?N(t.orders||[]):t.error?C(t.error||"Failed to load orders"):N(Array.isArray(t)?t:t.orders||[])}catch(e){console.error("Error fetching orders:",e),C(e.message||"Failed to load your orders. Please try again later.")}finally{S(!1)}},T=async e=>{p(!0),y("");try{if(!n)throw Error("Supabase is not configured. Please check your environment variables.");let{data:t,error:r}=await n.auth.signInWithOtp({email:e,options:{emailRedirectTo:null}});if(r){console.error("âŒ Error sending OTP:",r),y(r.message||"Failed to send verification code. Please try again."),p(!1);return}console.log("âœ… OTP sent successfully:",t),p(!1),x("code"),v(!0),setTimeout(()=>v(!1),3e3)}catch(e){console.error("âŒ Exception sending OTP:",e),p(!1),y(e.message||"Failed to send verification code. Please try again.")}},O=async e=>{if(e.preventDefault(),!c)return void y("Please enter your email address");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c))return void y("Please enter a valid email address");p(!0),y(""),v(!1);try{if(!n)throw Error("Supabase is not configured. Please check your environment variables.");let{data:e,error:t}=await n.auth.signInWithOtp({email:c.trim(),options:{emailRedirectTo:null}});if(t){console.error("âŒ Error sending OTP:",t),y(t.message||"Failed to send verification code. Please try again."),p(!1);return}console.log("âœ… OTP sent successfully:",e),p(!1),x("code"),v(!0),setTimeout(()=>v(!1),3e3)}catch(e){console.error("âŒ Exception sending OTP:",e),p(!1),y(e.message||"Failed to send verification code. Please try again.")}},F=async e=>{if(e.preventDefault(),!m||6!==m.length)return void y("Please enter the 6-digit code");p(!0),y(""),v(!1);try{if(!n)throw Error("Supabase is not configured. Please check your environment variables.");let{data:e,error:t}=await n.auth.verifyOtp({email:c.trim(),token:m.trim(),type:"email"});if(t){console.error("âŒ Error verifying OTP:",t),y(t.message||"Invalid code. Please try again."),p(!1);return}console.log("âœ… OTP verified successfully:",e);let{data:{user:r},error:s}=await n.auth.getUser();if(s||!r){console.error("âŒ Error getting user:",s),y("Failed to get user information. Please try again."),p(!1);return}let a=r.email||c;localStorage.setItem("userEmail",a),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",r.id),console.log("âœ… User logged in:",a),console.log("âœ… User ID:",r.id),I(!0),x("orders"),await E(a)}catch(e){console.error("âŒ Exception verifying OTP:",e),y(e.message||"Invalid code. Please try again."),p(!1)}};return(0,t.jsx)("div",{className:"min-h-screen bg-white py-12 md:py-16",children:(0,t.jsxs)("div",{className:"".concat(k?"max-w-6xl":"max-w-md"," mx-auto px-4 sm:px-6 lg:px-8"),children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("h1",{className:"text-title md:text-title-lg font-light text-gray-900 mb-2 font-inter tracking-title",children:k?"My Orders":"email"===u?"Log In":"Verify Code"}),(0,t.jsx)("div",{className:"w-16 h-px bg-gray-300 mx-auto mb-4"}),k&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-gray-600 font-inter",children:c}),(0,t.jsx)("button",{onClick:()=>{localStorage.removeItem("userEmail"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userId"),I(!1),N([]),x("email"),d(""),g("")},className:"mt-2 text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline",children:"Sign Out"})]})]}),b&&"code"===u&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-green-800 font-light font-inter",children:["Verification code sent to ",(0,t.jsx)("strong",{children:c})]})}),f&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-red-800 font-light font-inter",children:f})}),"email"===u&&(0,t.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Email Address *"}),(0,t.jsx)("input",{type:"email",value:c,onChange:e=>{d(e.target.value),y("")},placeholder:"your.email@example.com",autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-base",required:!0})]}),(0,t.jsx)("button",{type:"submit",disabled:h,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Sending Code...":"Send Verification Code"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 text-center font-light font-inter",children:"By continuing, you agree to our Terms of Use and Privacy Policy."})]}),"code"===u&&(0,t.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600 font-light font-inter mb-4 text-center",children:["We've sent a 6-digit verification code to ",(0,t.jsx)("strong",{children:c}),". Please enter it below."]}),(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Verification Code *"}),(0,t.jsx)("input",{type:"text",value:m,onChange:e=>{g(e.target.value.replace(/\D/g,"").slice(0,6)),y("")},placeholder:"000000",maxLength:6,autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-2xl text-center tracking-widest",required:!0})]}),(0,t.jsx)("button",{type:"submit",disabled:h||6!==m.length,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Verifying...":"Verify Code"}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{g(""),y(""),v(!1),O({preventDefault:()=>{}})},disabled:h,className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline disabled:opacity-50",children:"Resend Code"}),(0,t.jsx)("button",{type:"button",onClick:()=>{x("email"),g(""),y(""),v(!1),e.push("/login")},className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter",children:"â† Back to email"})]})]}),k&&(0,t.jsx)("div",{className:"mt-8",children:w?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600 font-inter",children:"Loading your orders..."})]}):P?(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-red-800 font-light font-inter",children:P}),(0,t.jsx)("button",{onClick:()=>E(c),className:"mt-4 px-6 py-2 text-sm bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Try Again"})]}):0===j.length?(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg shadow-sm p-8 md:p-12 text-center",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-4",children:(0,t.jsx)("svg",{className:"mx-auto h-16 w-16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2 font-inter",children:"No Orders Yet"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6 font-inter",children:"You haven't placed any orders yet. Start shopping to see your orders here!"}),(0,t.jsx)("button",{onClick:()=>e.push("/"),className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Start Shopping"})]}):(0,t.jsx)("div",{className:"space-y-6",children:j.map(e=>{var r,s;return(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-1 font-inter",children:["Order #",e.order_id.slice(-8).toUpperCase()]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 font-inter",children:["Placed on ",(e=>{let t;if(!e)return"N/A";if("string"==typeof e)t=new Date(e);else{if("number"!=typeof e)return"N/A";t=new Date(1e3*e)}return t.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})(e.order_date)]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:items-end gap-2",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold font-inter ".concat("succeeded"===e.status||"complete"===e.status?"bg-green-100 text-green-800":"processing"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:(null==(r=e.status)?void 0:r.charAt(0).toUpperCase())+(null==(s=e.status)?void 0:s.slice(1))})}),(0,t.jsxs)("p",{className:"text-lg font-bold text-gray-900 font-inter",children:["Â£",parseFloat(e.total_amount).toFixed(2)]})]})]})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"space-y-4",children:e.items&&Array.isArray(e.items)&&e.items.length>0?e.items.map((e,r)=>(0,t.jsx)(o.default,{item:e},r)):(0,t.jsx)("p",{className:"text-gray-600 font-inter",children:"No items found in this order."})})})]},e.order_id)})})})]})})}])}]);