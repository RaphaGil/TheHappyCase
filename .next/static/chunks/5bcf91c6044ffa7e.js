(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51810,e=>{"use strict";var s=e.i(42613);e.i(44737);var t=e.i(46168),r=e.i(87709);e.s(["default",0,e=>{let{item:n}=e,a=n.design_image||n.designImage||n.case_image||n.caseImage||n.image,o=n.caseName||n.name||"Custom Case",i=0;void 0!==n.total_price?i=parseFloat(n.total_price)||0:void 0!==n.totalPrice?i=(parseFloat(n.totalPrice)||0)*(n.quantity||1):void 0!==n.price&&(i=(parseFloat(n.price)||0)*(n.quantity||1));let l=n.color?(0,r.getColorName)(n.color,n.case_image||n.caseImage||n.image):null;return(0,s.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[a&&(0,s.jsx)("img",{src:(0,t.normalizeImagePath)(a),alt:o,className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded",loading:"lazy"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900 mb-1 font-inter",children:o}),l&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Color: ",(0,s.jsx)("span",{className:"font-medium",children:l})]}),(n.pinsDetails&&n.pinsDetails.length>0||n.pins&&Array.isArray(n.pins)&&n.pins.length>0)&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Charms: ",(0,s.jsx)("span",{className:"font-medium",children:(n.pinsDetails||n.pins||[]).length})]}),n.quantity>1&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Quantity: ",(0,s.jsx)("span",{className:"font-medium",children:n.quantity})]}),(0,s.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-2 font-inter",children:["Â£",i.toFixed(2)]})]})]})})}])},67510,e=>{"use strict";var s=e.i(42613),t=e.i(44737),r=e.i(26125),n=e.i(90564),a=e.i(78461);let o="thehappycase_order_data",i=(0,a.getSupabaseClient)(),l=()=>(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 font-inter",children:"Loading payment details..."})]})}),c=()=>{let e=(0,r.useRouter)();return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center max-w-md mx-auto px-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",style:{fontFamily:"'Poppins', sans-serif"},children:"Invalid Access"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6 font-inter",children:"This page can only be accessed after a successful payment."}),(0,s.jsx)("button",{onClick:()=>e.push("/"),className:"px-6 py-3 rounded-md bg-gray-900 hover:bg-gray-800 text-white transition-all duration-200 font-inter",children:"Go Home"})]})})};var d=e.i(39933),m=e.i(33340);let u=()=>(0,s.jsxs)("div",{className:"text-center mb-8 md:mb-12",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 md:w-24 md:h-24 rounded-full bg-green-100 mb-6",children:(0,s.jsx)(d.FontAwesomeIcon,{icon:m.faCheckCircle,className:"text-green-600 text-4xl md:text-5xl"})}),(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-3",style:{fontFamily:"'Poppins', sans-serif"},children:"Payment Successful!"}),(0,s.jsx)("p",{className:"text-base md:text-lg text-gray-600 max-w-2xl mx-auto font-inter",children:"Thank you for your order. We've received your payment and will process your items shortly."})]});var x=e.i(51810);let g=e=>{let{orderId:t,orderDate:r,subtotal:n,shippingCost:a,vatAmount:o,totalAmount:i,orderStatus:l,items:c}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 md:p-8",children:[(0,s.jsx)("h2",{className:"text-xl md:text-2xl font-semibold mb-6 text-gray-900",style:{fontFamily:"'Poppins', sans-serif"},children:"Order Details"}),(0,s.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Order ID:"}),(0,s.jsx)("span",{className:"text-gray-900 font-mono text-sm",children:t})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Date:"}),(0,s.jsx)("span",{className:"text-gray-900 font-inter",children:r?new Date(1e3*r).toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]}),(0,s.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center py-1",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Subtotal:"}),(0,s.jsxs)("span",{className:"text-gray-900 font-inter",children:["Â£",n.toFixed(2)]})]}),a>0&&(0,s.jsxs)("div",{className:"flex justify-between items-center py-1",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Shipping:"}),(0,s.jsxs)("span",{className:"text-gray-900 font-inter",children:["Â£",a.toFixed(2)]})]}),o>0&&(0,s.jsxs)("div",{className:"flex justify-between items-center py-1",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"VAT:"}),(0,s.jsxs)("span",{className:"text-gray-900 font-inter",children:["Â£",o.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-gray-200 mt-2",children:[(0,s.jsx)("span",{className:"text-gray-900 font-semibold font-inter",children:"Total:"}),(0,s.jsxs)("span",{className:"text-gray-900 font-semibold text-lg font-inter",children:["Â£",i.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-gray-200",children:[(0,s.jsx)("span",{className:"font-medium text-green-600 capitalize font-inter",children:"Status:"}),(0,s.jsx)("span",{className:"text-green-600 font-semibold capitalize font-inter",children:l})]})]}),c&&c.length>0&&(0,s.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 font-inter",children:"Items Ordered:"}),(0,s.jsx)("div",{className:"space-y-3",children:c.map((e,t)=>(0,s.jsx)(x.default,{item:e},t))})]})]})},p=e=>{let{customerInfo:t}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 md:p-8",children:[(0,s.jsx)("h2",{className:"text-xl md:text-2xl font-semibold mb-6 text-gray-900",style:{fontFamily:"'Poppins', sans-serif"},children:"Shipping Information"}),t&&t.name&&(0,s.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,s.jsxs)("div",{className:"py-2 border-b border-gray-100",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Name:"}),(0,s.jsx)("p",{className:"text-gray-900 font-inter",children:t.name})]}),t.email&&(0,s.jsxs)("div",{className:"py-2 border-b border-gray-100",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Email:"}),(0,s.jsx)("p",{className:"text-gray-900 font-inter",children:t.email})]}),t.address&&t.address.line1&&(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Address:"}),(0,s.jsxs)("p",{className:"text-gray-900 font-inter",children:[t.address.line1,t.address.line2&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),t.address.line2]}),(0,s.jsx)("br",{}),t.address.city," ",t.address.postal_code,(0,s.jsx)("br",{}),t.address.country]})]})]}),(0,s.jsxs)("div",{className:"mt-6 p-4 md:p-5 bg-blue-50 rounded-lg border border-blue-100",children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-900 mb-2 font-inter",children:"What's Next?"}),(0,s.jsx)("p",{className:"text-sm md:text-base text-blue-800 mb-3 font-inter",children:"Your order will be processed within 1-2 business days. You will receive a shipping confirmation email with tracking details once your items are dispatched."}),(0,s.jsxs)("p",{className:"text-sm md:text-base text-blue-800 font-inter",children:[(0,s.jsx)("strong",{children:"Estimated delivery:"})," 3-5 business days"]})]})]})},f=()=>{let e=(0,r.useRouter)();return(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mt-8 md:mt-12",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/"),className:"px-6 py-3 rounded-md font-medium inline-flex items-center justify-center bg-gray-900 hover:bg-gray-800 text-white transition-all duration-200 font-inter",children:[(0,s.jsx)(d.FontAwesomeIcon,{icon:m.faHome,className:"mr-2"}),"Continue Shopping"]}),(0,s.jsxs)("button",{onClick:()=>window.print(),className:"px-6 py-3 rounded-md font-medium inline-flex items-center justify-center bg-white hover:bg-gray-50 text-gray-900 border border-gray-300 hover:border-gray-400 transition-all duration-200 font-inter",children:[(0,s.jsx)(d.FontAwesomeIcon,{icon:m.faShoppingBag,className:"mr-2"}),"Print Receipt"]})]})},h=()=>(0,s.jsx)("div",{className:"mt-8 md:mt-12 text-center",children:(0,s.jsxs)("p",{className:"text-gray-600 font-inter",children:["Questions about your order? Contact us at"," ",(0,s.jsx)("a",{href:"mailto:support@thehappycase.com",className:"text-gray-900 hover:underline font-medium",children:"support@thehappycase.com"})]})});e.s(["default",0,()=>{var e,a,d;let m=(0,r.useSearchParams)(),x=null==m?void 0:m.get("session_id"),[y,b]=t.default.useState(null);(0,t.useEffect)(()=>{let e=sessionStorage.getItem("paymentSuccessData");if(e)try{b(JSON.parse(e))}catch(e){console.error("Failed to parse payment data from sessionStorage:",e)}},[]);let{paymentIntent:j,customerInfo:N,items:v,shippingCost:w=0,vatAmount:S=0,totalWithShipping:I,subtotal:E}=y||{},{loading:_}=((e,s,a)=>{let l=(0,r.useSearchParams)(),[c,d]=(0,t.useState)(!1),[m,u]=(0,t.useState)(!1),[x,g]=(0,t.useState)(null),p=null==l?void 0:l.get("session_id"),f=(0,t.useRef)(!1),h=(0,t.useRef)({paymentIntent:e,customerInfo:s,items:a}),y=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{if(e&&s&&a){h.current={paymentIntent:e,customerInfo:s,items:a};try{sessionStorage.setItem(o,JSON.stringify({paymentIntent:e,customerInfo:s,items:a,timestamp:Date.now()}))}catch(e){console.warn("âš ï¸ Could not save to sessionStorage:",e)}x&&g(null),y.current=!1}},[e,s,a,x]),(0,t.useEffect)(()=>{if((!e||!s||!a)&&p&&!x&&!y.current){y.current=!0;try{let e=sessionStorage.getItem(o);if(e){let s=JSON.parse(e);Date.now()-s.timestamp<36e5&&(console.log("ðŸ“¦ Recovering order data from sessionStorage"),g(s),h.current=s)}}catch(e){console.warn("âš ï¸ Could not recover from sessionStorage:",e)}}},[e,s,a,p,x]),(0,t.useEffect)(()=>{let t=e||(null==x?void 0:x.paymentIntent)||h.current.paymentIntent,r=s||(null==x?void 0:x.customerInfo)||h.current.customerInfo,o=a||(null==x?void 0:x.items)||h.current.items;t&&(null==r?void 0:r.email)&&o&&o.length>0&&!m&&!f.current&&(f.current=!0,(async()=>{try{var e,s,a,l;let c,d=null,m=localStorage.getItem("userId");if(m)d=m,console.log("âœ… User ID retrieved from localStorage:",d);else if(i)try{let{data:s,error:t}=await i.auth.getUser();!t&&(null==s||null==(e=s.user)?void 0:e.id)?(d=s.user.id,localStorage.setItem("userId",d),console.log("âœ… User ID retrieved from Supabase auth:",d)):(console.log("â„¹ï¸ No authenticated user found, order will be saved without user_id"),t&&console.log("   Auth error:",t.message))}catch(e){console.warn("âš ï¸ Error getting user ID from Supabase:",e)}d||console.log("â„¹ï¸ No user ID available - order will be saved without user_id"),console.log("ðŸ’¾ Attempting to save order to Supabase..."),console.log("  - Payment Intent:",null==t?void 0:t.id),console.log("  - Customer Email:",null==r?void 0:r.email),console.log("  - User ID:",d||"N/A"),console.log("  - Items:",(null==o?void 0:o.length)||0);let x=await fetch((0,n.getApiUrl)("/api/save-order"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntent:t,customerInfo:r,items:o,userId:d})});console.log("ðŸ“¤ Order save response status:",x.status);let g=await x.text();if(g&&""!==g.trim())try{c=JSON.parse(g),console.log("ðŸ“¥ Order save response:",c)}catch(e){console.error("âŒ Failed to parse JSON response:",e),console.error("   Response text:",g.substring(0,200)),c={success:!1,error:"Invalid JSON response from server",rawResponse:g.substring(0,200),status:x.status}}else console.error("âŒ Empty response from server"),c={success:!1,error:"Empty response from server",status:x.status};x.ok&&c.success||c.alreadyExists?(c.alreadyExists?console.log("âœ… Order already exists (idempotent):",c.order_id):console.log("âœ… Order saved to Supabase successfully:",c.order_id),u(!0)):(console.error("âŒ Failed to save order:",{status:x.status,success:c.success,error:c.error||c.message,details:c.details}),c.success&&((null==(s=c.message)?void 0:s.includes("already exists"))||c.warning)&&(console.log("âš ï¸ Duplicate order detected, marking as saved to prevent retries"),u(!0))),console.log("ðŸ“§ Attempting to send order confirmation email...");try{let e=await fetch((0,n.getApiUrl)("/api/send-order-confirmation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntent:t,customerInfo:r,items:o})});if(console.log("ðŸ“¤ Email response status:",e.status),e.ok){let s=await e.json();console.log("ðŸ“¥ Email response:",s),s.success?(console.log("âœ… Order confirmation email sent successfully"),s.emailId&&console.log("   Email ID:",s.emailId)):(null==(a=s.message)?void 0:a.includes("Resend API key not configured"))||(null==(l=s.warning)?void 0:l.includes("RESEND_API_KEY"))?(console.warn("âš ï¸ Email not sent (configuration):",s.message||s.warning),console.warn("   This is expected if RESEND_API_KEY is not configured in .env"),console.warn("   Order was saved successfully, but email requires API key configuration")):(console.error("âŒ Failed to send email:",s.error||s.message),s.warning&&console.warn("   Warning:",s.warning))}else{let s=await e.text();console.error("âŒ Email endpoint returned error:",e.status),console.error("   Error response:",s);try{let e=JSON.parse(s);console.error("   Parsed error:",e)}catch(e){}}}catch(e){console.error("âŒ Exception sending email:",e),console.error("   Error message:",e.message),console.error("   Error stack:",e.stack)}}catch(e){console.error("âŒ Error processing order:",e)}finally{f.current=!1}})())},[e,s,a,m,p,x]),(0,t.useEffect)(()=>{!p||e||m||f.current?p&&!e&&d(!1):(d(!0),f.current=!0,fetch((0,n.getApiUrl)("/session-status?session_id=".concat(p))).then(e=>e.json()).then(async e=>{if("complete"===e.status&&e.payment_intent){console.log("âœ… Session complete, payment_intent:",e.payment_intent);try{let s=await fetch((0,n.getApiUrl)("/api/orders?payment_intent_id=".concat(e.payment_intent)));if(s.ok){let e=await s.json();if(e&&e.success&&e.order){console.log("âœ… Order already exists in Supabase:",e.order.order_id),u(!0),d(!1),f.current=!1;return}}}catch(e){console.warn("âš ï¸ Could not check existing order:",e)}if(e.customer_email){console.log("â„¹ï¸ Session complete but order not found in Supabase. Checking sessionStorage..."),f.current=!1,d(!1);return}d(!1)}else d(!1);f.current=!1}).catch(e=>{console.error("Error fetching session:",e),d(!1),f.current=!1}))},[p,e,m]),{loading:c,orderSaved:m}})(j,N,v);if((0,t.useEffect)(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),_)return(0,s.jsx)(l,{});if(!j&&!x)return(0,s.jsx)(c,{});let A=void 0!==E?E:v&&0!==v.length?v.reduce((e,s)=>e+(s.totalPrice||s.price||0)*(s.quantity||1),0):0,C=w||0;!w&&(null==N||null==(e=N.address)?void 0:e.country)&&(null==v?void 0:v.length)>0&&(C=null!=(d=({GB:3,US:16,FR:7})[N.address.country.toUpperCase()])?d:12);let D=S||0;if(!S&&(null==N||null==(a=N.address)?void 0:a.country)){let e=new Set(["FR","DE","ES","IT"]),s=N.address.country.toUpperCase();e.has(s)&&(D=.2*A)}let O=void 0!==I?I:A+D+C,F=(null==j?void 0:j.id)||x||"N/A",P=(null==j?void 0:j.created)||Date.now()/1e3,k=(null==j?void 0:j.status)||"succeeded";return(0,s.jsx)("div",{className:"min-h-screen bg-white py-8 md:py-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsx)(u,{}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8",children:[(0,s.jsx)(g,{orderId:F,orderDate:P,subtotal:A,shippingCost:C,vatAmount:D,totalAmount:O,orderStatus:k,items:v}),(0,s.jsx)(p,{customerInfo:N})]}),(0,s.jsx)(f,{}),(0,s.jsx)(h,{})]})})}],67510)}]);