module.exports=[81528,a=>{"use strict";let b,c,d,e;var f,g,h,i,j,k,l,m,n,o,p=a.i(87924),q=a.i(72131),r=a.i(32313);let s=()=>(0,p.jsxs)("div",{className:"text-center flex-shrink-0 mt-4 md:mt-6",children:[(0,p.jsx)("h1",{className:"text-title text-gray-900 tracking-title mb-1 md:mb-2",children:"CREATE YOURS"}),(0,p.jsx)("div",{className:"w-16 sm:w-20 md:w-24 h-px bg-gray-200 mx-auto mb-2 md:mb-4"}),(0,p.jsx)("p",{className:"md:block hidden text-sm text-gray-500 max-w-2xl mx-auto font-light",style:{fontFamily:"'Poppins', sans-serif"},children:"Design your perfect passport case with our interactive creator"})]}),t=({onClose:a})=>(0,p.jsx)("button",{onClick:a,className:"absolute right-2 xs:right-3 sm:right-4 z-50 w-7 h-7 xs:w-8 xs:h-8 flex items-center justify-center transition-colors","aria-label":"Close and go back to home",children:(0,p.jsx)("svg",{className:"w-12 h-12 xs:w-5 xs:h-5 mt-4 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})});var u=a.i(18772);function v(a,b,c){var d;return(b="symbol"==typeof(d=function(a,b){if("object"!=typeof a||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(b,"string"))?d:d+"")in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function w(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function x(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?w(Object(c),!0).forEach(function(b){v(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):w(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function y(a,b){if(null==a)return{};var c,d,e=function(a,b){if(null==a)return{};var c={};for(var d in a)if(({}).hasOwnProperty.call(a,d)){if(b.indexOf(d)>=0)continue;c[d]=a[d]}return c}(a,b);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(a);for(d=0;d<f.length;d++)c=f[d],b.indexOf(c)>=0||({}).propertyIsEnumerable.call(a,c)&&(e[c]=a[c])}return e}function z(a,b){return b||(b=a.slice(0)),Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}class A{constructor(){v(this,"browserShadowBlurConstant",1),v(this,"DPI",96),v(this,"devicePixelRatio",1),v(this,"perfLimitSizeTotal",2097152),v(this,"maxCacheSideLimit",4096),v(this,"minCacheSideLimit",256),v(this,"disableStyleCopyPaste",!1),v(this,"enableGLFiltering",!0),v(this,"textureSize",4096),v(this,"forceGLPutImageData",!1),v(this,"cachesBoundsOfCurve",!1),v(this,"fontPaths",{}),v(this,"NUM_FRACTION_DIGITS",4)}}let B=new class extends A{constructor(a){super(),this.configure(a)}configure(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,a)}addFonts(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=x(x({},this.fontPaths),a)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(a=>{delete this.fontPaths[a]})}clearFonts(){this.fontPaths={}}restoreDefaults(a){let b=new A,c=(null==a?void 0:a.reduce((a,c)=>(a[c]=b[c],a),{}))||b;this.configure(c)}},C=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return console[a]("fabric",...c)};class D extends Error{constructor(a,b){super("fabric: ".concat(a),b)}}class E extends D{constructor(a){super("".concat(a," 'options.signal' is in 'aborted' state"))}}class F{}class G extends F{testPrecision(a,b){let c=a.createShader(a.FRAGMENT_SHADER);return!!c&&(a.shaderSource(c,"precision ".concat(b," float;\nvoid main(){}")),a.compileShader(c),!!a.getShaderParameter(c,a.COMPILE_STATUS))}queryWebGL(a){let b=a.getContext("webgl");b&&(this.maxTextureSize=b.getParameter(b.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(a=>this.testPrecision(b,a)),b.getExtension("WEBGL_lose_context").loseContext(),C("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(a){return!!this.maxTextureSize&&this.maxTextureSize>=a}}let H={},I=()=>b||(b={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new G,dispose(){},copyPasteData:H}),J=()=>{var a;return Math.max(null!=(a=B.devicePixelRatio)?a:I().window.devicePixelRatio,1)},K=new class{constructor(){v(this,"boundsOfCurveCache",{}),this.charWidthsCache=new Map}getFontCache(a){let{fontFamily:b,fontStyle:c,fontWeight:d}=a;b=b.toLowerCase();let e=this.charWidthsCache;e.has(b)||e.set(b,new Map);let f=e.get(b),g="".concat(c.toLowerCase(),"_").concat((d+"").toLowerCase());return f.has(g)||f.set(g,new Map),f.get(g)}clearFontCache(a){a?this.charWidthsCache.delete((a||"").toLowerCase()):this.charWidthsCache=new Map}limitDimsByArea(a){let{perfLimitSizeTotal:b}=B,c=Math.sqrt(b*a);return[Math.floor(c),Math.floor(b/c)]}},L="6.9.1";function M(){}let N=Math.PI/2,O=2*Math.PI,P=Math.PI/180,Q=Object.freeze([1,0,0,1,0,0]),R="center",S="left",T="bottom",U="right",V="none",W=/\r?\n/,X="moving",Y="scaling",Z="rotating",$="rotate",_="skewing",aa="resizing",ab="modifyPoly",ac="changed",ad="scale",ae="scaleX",af="scaleY",ag="skewX",ah="skewY",ai="fill",aj="stroke",ak="modified",al="json",am=new class{constructor(){this[al]=new Map,this.svg=new Map}has(a){return this[al].has(a)}getClass(a){let b=this[al].get(a);if(!b)throw new D("No class registered for ".concat(a));return b}setClass(a,b){b?this[al].set(b,a):(this[al].set(a.type,a),this[al].set(a.type.toLowerCase(),a))}getSVGClass(a){return this.svg.get(a)}setSVGClass(a,b){this.svg.set(null!=b?b:a.type.toLowerCase(),a)}},an=new class extends Array{remove(a){let b=this.indexOf(a);b>-1&&this.splice(b,1)}cancelAll(){let a=this.splice(0);return a.forEach(a=>a.abort()),a}cancelByCanvas(a){if(!a)return[];let b=this.filter(b=>{var c;return b.target===a||"object"==typeof b.target&&(null==(c=b.target)?void 0:c.canvas)===a});return b.forEach(a=>a.abort()),b}cancelByTarget(a){if(!a)return[];let b=this.filter(b=>b.target===a);return b.forEach(a=>a.abort()),b}};class ao{constructor(){v(this,"__eventListeners",{})}on(a,b){return(this.__eventListeners||(this.__eventListeners={}),"object"==typeof a)?(Object.entries(a).forEach(a=>{let[b,c]=a;this.on(b,c)}),()=>this.off(a)):b?(this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b),()=>this.off(a,b)):()=>!1}once(a,b){if("object"==typeof a){let b=[];return Object.entries(a).forEach(a=>{let[c,d]=a;b.push(this.once(c,d))}),()=>b.forEach(a=>a())}if(b){let c=this.on(a,function(){for(var a=arguments.length,d=Array(a),e=0;e<a;e++)d[e]=arguments[e];b.call(this,...d),c()});return c}return()=>!1}_removeEventListener(a,b){if(this.__eventListeners[a])if(b){let c=this.__eventListeners[a],d=c.indexOf(b);d>-1&&c.splice(d,1)}else this.__eventListeners[a]=[]}off(a,b){if(this.__eventListeners)if(void 0===a)for(let a in this.__eventListeners)this._removeEventListener(a);else"object"==typeof a?Object.entries(a).forEach(a=>{let[b,c]=a;this._removeEventListener(b,c)}):this._removeEventListener(a,b)}fire(a,b){var c;if(!this.__eventListeners)return;let d=null==(c=this.__eventListeners[a])?void 0:c.concat();if(d)for(let a=0;a<d.length;a++)d[a].call(this,b||{})}}let ap=(a,b)=>{let c=a.indexOf(b);return -1!==c&&a.splice(c,1),a},aq=a=>{if(0===a)return 1;switch(Math.abs(a)/N){case 1:case 3:return 0;case 2:return -1}return Math.cos(a)},ar=a=>{if(0===a)return 0;let b=Math.sign(a);switch(a/N){case 1:return b;case 2:return 0;case 3:return-b}return Math.sin(a)};class as{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof a?(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)}add(a){return new as(this.x+a.x,this.y+a.y)}addEquals(a){return this.x+=a.x,this.y+=a.y,this}scalarAdd(a){return new as(this.x+a,this.y+a)}scalarAddEquals(a){return this.x+=a,this.y+=a,this}subtract(a){return new as(this.x-a.x,this.y-a.y)}subtractEquals(a){return this.x-=a.x,this.y-=a.y,this}scalarSubtract(a){return new as(this.x-a,this.y-a)}scalarSubtractEquals(a){return this.x-=a,this.y-=a,this}multiply(a){return new as(this.x*a.x,this.y*a.y)}scalarMultiply(a){return new as(this.x*a,this.y*a)}scalarMultiplyEquals(a){return this.x*=a,this.y*=a,this}divide(a){return new as(this.x/a.x,this.y/a.y)}scalarDivide(a){return new as(this.x/a,this.y/a)}scalarDivideEquals(a){return this.x/=a,this.y/=a,this}eq(a){return this.x===a.x&&this.y===a.y}lt(a){return this.x<a.x&&this.y<a.y}lte(a){return this.x<=a.x&&this.y<=a.y}gt(a){return this.x>a.x&&this.y>a.y}gte(a){return this.x>=a.x&&this.y>=a.y}lerp(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return b=Math.max(Math.min(1,b),0),new as(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)}distanceFrom(a){let b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)}midPointFrom(a){return this.lerp(a)}min(a){return new as(Math.min(this.x,a.x),Math.min(this.y,a.y))}max(a){return new as(Math.max(this.x,a.x),Math.max(this.y,a.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(a,b){return this.x=a,this.y=b,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setFromPoint(a){return this.x=a.x,this.y=a.y,this}swap(a){let b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c}clone(){return new as(this.x,this.y)}rotate(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:at,c=ar(a),d=aq(a),e=this.subtract(b);return new as(e.x*d-e.y*c,e.x*c+e.y*d).add(b)}transform(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new as(a[0]*this.x+a[2]*this.y+(b?0:a[4]),a[1]*this.x+a[3]*this.y+(b?0:a[5]))}}let at=new as(0,0),au=a=>!!a&&Array.isArray(a._objects);function av(a){class b extends a{constructor(){super(...arguments),v(this,"_objects",[])}_onObjectAdded(a){}_onObjectRemoved(a){}_onStackOrderChanged(a){}add(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];let d=this._objects.push(...b);return b.forEach(a=>this._onObjectAdded(a)),d}insertAt(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return this._objects.splice(a,0,...c),c.forEach(a=>this._onObjectAdded(a)),this._objects.length}remove(){let a=this._objects,b=[];for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return d.forEach(c=>{let d=a.indexOf(c);-1!==d&&(a.splice(d,1),b.push(c),this._onObjectRemoved(c))}),b}forEachObject(a){this.getObjects().forEach((b,c,d)=>a(b,c,d))}getObjects(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return 0===b.length?[...this._objects]:this._objects.filter(a=>a.isType(...b))}item(a){return this._objects[a]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(a,c){return!!this._objects.includes(a)||!!c&&this._objects.some(c=>c instanceof b&&c.contains(a,!0))}complexity(){return this._objects.reduce((a,b)=>a+=b.complexity?b.complexity():0,0)}sendObjectToBack(a){return!(!a||a===this._objects[0])&&(ap(this._objects,a),this._objects.unshift(a),this._onStackOrderChanged(a),!0)}bringObjectToFront(a){return!(!a||a===this._objects[this._objects.length-1])&&(ap(this._objects,a),this._objects.push(a),this._onStackOrderChanged(a),!0)}sendObjectBackwards(a,b){if(!a)return!1;let c=this._objects.indexOf(a);if(0!==c){let d=this.findNewLowerIndex(a,c,b);return ap(this._objects,a),this._objects.splice(d,0,a),this._onStackOrderChanged(a),!0}return!1}bringObjectForward(a,b){if(!a)return!1;let c=this._objects.indexOf(a);if(c!==this._objects.length-1){let d=this.findNewUpperIndex(a,c,b);return ap(this._objects,a),this._objects.splice(d,0,a),this._onStackOrderChanged(a),!0}return!1}moveObjectTo(a,b){return a!==this._objects[b]&&(ap(this._objects,a),this._objects.splice(b,0,a),this._onStackOrderChanged(a),!0)}findNewLowerIndex(a,b,c){let d;if(c){d=b;for(let c=b-1;c>=0;--c)if(a.isOverlapping(this._objects[c])){d=c;break}}else d=b-1;return d}findNewUpperIndex(a,b,c){let d;if(c){d=b;for(let c=b+1;c<this._objects.length;++c)if(a.isOverlapping(this._objects[c])){d=c;break}}else d=b+1;return d}collectObjects(a){let{left:b,top:c,width:d,height:e}=a,{includeIntersecting:f=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=[],h=new as(b,c),i=h.add(new as(d,e));for(let a=this._objects.length-1;a>=0;a--){let b=this._objects[a];b.selectable&&b.visible&&(f&&b.intersectsWithRect(h,i)||b.isContainedWithinRect(h,i)||f&&b.containsPoint(h)||f&&b.containsPoint(i))&&g.push(b)}return g}}return b}class aw extends ao{_setOptions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let b in a)this.set(b,a[b])}_setObject(a){for(let b in a)this._set(b,a[b])}set(a,b){return"object"==typeof a?this._setObject(a):this._set(a,b),this}_set(a,b){this[a]=b}toggle(a){let b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this}get(a){return this[a]}}function ax(a){return I().window.requestAnimationFrame(a)}function ay(a){return I().window.cancelAnimationFrame(a)}let az=0,aA=()=>az++,aB=()=>{let a=I().document.createElement("canvas");if(!a||void 0===a.getContext)throw new D("Failed to create `canvas` element");return a},aC=()=>I().document.createElement("img"),aD=a=>{let b=aB();return b.width=a.width,b.height=a.height,b},aE=(a,b,c)=>a.toDataURL("image/".concat(b),c),aF=(a,b,c)=>new Promise((d,e)=>{a.toBlob(d,"image/".concat(b),c)}),aG=a=>a*P,aH=a=>a/P,aI=a=>a.every((a,b)=>a===Q[b]),aJ=(a,b,c)=>new as(a).transform(b,c),aK=a=>{let b=1/(a[0]*a[3]-a[1]*a[2]),c=[b*a[3],-b*a[1],-b*a[2],b*a[0],0,0],{x:d,y:e}=new as(a[4],a[5]).transform(c,!0);return c[4]=-d,c[5]=-e,c},aL=(a,b,c)=>[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],c?0:a[0]*b[4]+a[2]*b[5]+a[4],c?0:a[1]*b[4]+a[3]*b[5]+a[5]],aM=(a,b)=>a.reduceRight((a,c)=>c&&a?aL(c,a,b):c||a,void 0)||Q.concat(),aN=a=>{let[b,c]=a;return Math.atan2(c,b)},aO=a=>{let b=aN(a),c=Math.pow(a[0],2)+Math.pow(a[1],2),d=Math.sqrt(c),e=(a[0]*a[3]-a[2]*a[1])/d,f=Math.atan2(a[0]*a[2]+a[1]*a[3],c);return{angle:aH(b),scaleX:d,scaleY:e,skewX:aH(f),skewY:0,translateX:a[4]||0,translateY:a[5]||0}},aP=function(a){return[1,0,0,1,a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function aQ(){let{angle:a=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:b=0,y:c=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=aG(a),e=aq(d),f=ar(d);return[e,f,-f,e,b?b-(e*b-f*c):0,c?c-(f*b+e*c):0]}let aR=function(a){return[a,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,0,0]},aS=a=>Math.tan(aG(a)),aT=a=>[1,0,aS(a),1,0,0],aU=a=>[1,aS(a),0,1,0,0],aV=a=>{let{scaleX:b=1,scaleY:c=1,flipX:d=!1,flipY:e=!1,skewX:f=0,skewY:g=0}=a,h=aR(d?-b:b,e?-c:c);return f&&(h=aL(h,aT(f),!0)),g&&(h=aL(h,aU(g),!0)),h},aW=a=>{let{translateX:b=0,translateY:c=0,angle:d=0}=a,e=aP(b,c);d&&(e=aL(e,aQ({angle:d})));let f=aV(a);return aI(f)||(e=aL(e,f)),e},aX=function(a){let{signal:b,crossOrigin:c=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(d,e){let f;if(b&&b.aborted)return e(new E("loadImage"));let g=aC();b&&(f=function(a){g.src="",e(a)},b.addEventListener("abort",f,{once:!0}));let h=function(){g.onload=g.onerror=null,f&&(null==b||b.removeEventListener("abort",f)),d(g)};a?(g.onload=h,g.onerror=function(){f&&(null==b||b.removeEventListener("abort",f)),e(new D("Error loading ".concat(g.src)))},c&&(g.crossOrigin=c),g.src=a):h()})},aY=function(a){let{signal:b,reviver:c=M}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((d,e)=>{let f=[];b&&b.addEventListener("abort",e,{once:!0}),Promise.all(a.map(a=>am.getClass(a.type).fromObject(a,{signal:b}).then(b=>(c(a,b),f.push(b),b)))).then(d).catch(a=>{f.forEach(a=>{a.dispose&&a.dispose()}),e(a)}).finally(()=>{b&&b.removeEventListener("abort",e)})})},aZ=function(a){let{signal:b}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((c,d)=>{let e=[];b&&b.addEventListener("abort",d,{once:!0});let f=Object.values(a).map(a=>a&&a.type&&am.has(a.type)?aY([a],{signal:b}).then(a=>{let[b]=a;return e.push(b),b}):a),g=Object.keys(a);Promise.all(f).then(a=>a.reduce((a,b,c)=>(a[g[c]]=b,a),{})).then(c).catch(a=>{e.forEach(a=>{a.dispose&&a.dispose()}),d(a)}).finally(()=>{b&&b.removeEventListener("abort",d)})})},a$=function(a){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((b,c)=>(c in a&&(b[c]=a[c]),b),{})},a_=(a,b)=>Object.keys(a).reduce((c,d)=>(b(a[d],d,a)&&(c[d]=a[d]),c),{}),a0=(a,b)=>parseFloat(Number(a).toFixed(b)),a1=a=>"matrix("+a.map(a=>a0(a,B.NUM_FRACTION_DIGITS)).join(" ")+")",a2=a=>!!a&&void 0!==a.toLive,a3=a=>!!a&&"function"==typeof a.toObject,a4=a=>!!a&&void 0!==a.offsetX&&"source"in a,a5=a=>!!a&&"multiSelectionStacking"in a;function a6(a){let b=a&&a7(a),c=0,d=0;if(!a||!b)return{left:c,top:d};let e=a,f=b.documentElement,g=b.body||{scrollLeft:0,scrollTop:0};for(;e&&(e.parentNode||e.host)&&((e=e.parentNode||e.host)===b?(c=g.scrollLeft||f.scrollLeft||0,d=g.scrollTop||f.scrollTop||0):(c+=e.scrollLeft||0,d+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:c,top:d}}let a7=a=>a.ownerDocument||null,a8=a=>{var b;return(null==(b=a.ownerDocument)?void 0:b.defaultView)||null},a9=function(a,b,c){let{width:d,height:e}=c,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;a.width=d,a.height=e,f>1&&(a.setAttribute("width",(d*f).toString()),a.setAttribute("height",(e*f).toString()),b.scale(f,f))},ba=(a,b)=>{let{width:c,height:d}=b;c&&(a.style.width="number"==typeof c?"".concat(c,"px"):c),d&&(a.style.height="number"==typeof d?"".concat(d,"px"):d)};function bb(a){return void 0!==a.onselectstart&&(a.onselectstart=()=>!1),a.style.userSelect=V,a}class bc{constructor(a){v(this,"_originalCanvasStyle",void 0),v(this,"lower",void 0);const b=this.createLowerCanvas(a);this.lower={el:b,ctx:b.getContext("2d")}}createLowerCanvas(a){let b=a&&void 0!==a.getContext?a:a&&I().document.getElementById(a)||aB();if(b.hasAttribute("data-fabric"))throw new D("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=b.style.cssText,b.setAttribute("data-fabric","main"),b.classList.add("lower-canvas"),b}cleanupDOM(a){let{width:b,height:c}=a,{el:d}=this.lower;d.classList.remove("lower-canvas"),d.removeAttribute("data-fabric"),d.setAttribute("width","".concat(b)),d.setAttribute("height","".concat(c)),d.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(a,b){let{el:c,ctx:d}=this.lower;a9(c,d,a,b)}setCSSDimensions(a){ba(this.lower.el,a)}calcOffset(){return function(a){var b;let c=a&&a7(a),d={left:0,top:0};if(!c)return d;let e=(null==(b=a8(a))?void 0:b.getComputedStyle(a,null))||{};d.left+=parseInt(e.borderLeftWidth,10)||0,d.top+=parseInt(e.borderTopWidth,10)||0,d.left+=parseInt(e.paddingLeft,10)||0,d.top+=parseInt(e.paddingTop,10)||0;let f={left:0,top:0},g=c.documentElement;void 0!==a.getBoundingClientRect&&(f=a.getBoundingClientRect());let h=a6(a);return{left:f.left+h.left-(g.clientLeft||0)+d.left,top:f.top+h.top-(g.clientTop||0)+d.top}}(this.lower.el)}dispose(){I().dispose(this.lower.el),delete this.lower}}let bd={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...Q]},be=["objects"];class bf extends av(aw){get lowerCanvasEl(){var a;return null==(a=this.elements.lower)?void 0:a.el}get contextContainer(){var a;return null==(a=this.elements.lower)?void 0:a.ctx}static getDefaults(){return bf.ownDefaults}constructor(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(b),this.initElements(a),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(a){this.elements=new bc(a)}add(){let a=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),a}insertAt(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];let e=super.insertAt(a,...c);return c.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}remove(){let a=super.remove(...arguments);return a.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),a}_onObjectAdded(a){a.canvas&&a.canvas!==this&&(C("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),a.canvas.remove(a)),a._set("canvas",this),a.setCoords(),this.fire("object:added",{target:a}),a.fire("added",{target:this})}_onObjectRemoved(a){a._set("canvas",void 0),this.fire("object:removed",{target:a}),a.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?J():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(a,b){return this.setDimensions({width:a},b)}setHeight(a,b){return this.setDimensions({height:a},b)}_setDimensionsImpl(a){let{cssOnly:b=!1,backstoreOnly:c=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!b){let b=x({width:this.width,height:this.height},a);this.elements.setDimensions(b,this.getRetinaScaling()),this.hasLostContext=!0,this.width=b.width,this.height=b.height}c||this.elements.setCSSDimensions(a),this.calcOffset()}setDimensions(a,b){this._setDimensionsImpl(a,b),b&&b.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(a){this.viewportTransform=a,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(a,b){let c=[...this.viewportTransform],d=aJ(a,aK(c));c[0]=b,c[3]=b;let e=aJ(d,c);c[4]+=a.x-e.x,c[5]+=a.y-e.y,this.setViewportTransform(c)}setZoom(a){this.zoomToPoint(new as(0,0),a)}absolutePan(a){let b=[...this.viewportTransform];return b[4]=-a.x,b[5]=-a.y,this.setViewportTransform(b)}relativePan(a){return this.absolutePan(new as(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(a){a.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=ax(()=>this.renderAndReset()))}calcViewportBoundaries(){let a=this.width,b=this.height,c=aK(this.viewportTransform),d=aJ({x:0,y:0},c),e=aJ({x:a,y:b},c),f=d.min(e),g=d.max(e);return this.vptCoords={tl:f,tr:new as(g.x,f.y),bl:new as(f.x,g.y),br:g}}cancelRequestedRender(){this.nextRenderHandle&&(ay(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(a){}renderCanvas(a,b){if(this.destroyed)return;let c=this.viewportTransform,d=this.clipPath;this.calcViewportBoundaries(),this.clearContext(a),a.imageSmoothingEnabled=this.imageSmoothingEnabled,a.patternQuality="best",this.fire("before:render",{ctx:a}),this._renderBackground(a),a.save(),a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._renderObjects(a,b),a.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(a),d&&(d._set("canvas",this),d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(a,d)),this._renderOverlay(a),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(a),this.fire("after:render",{ctx:a}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(a,b){let c=this.viewportTransform;a.save(),a.transform(...c),a.globalCompositeOperation="destination-in",b.transform(a),a.scale(1/b.zoomX,1/b.zoomY),a.drawImage(b._cacheCanvas,-b.cacheTranslationX,-b.cacheTranslationY),a.restore()}_renderObjects(a,b){for(let c=0,d=b.length;c<d;++c)b[c]&&b[c].render(a)}_renderBackgroundOrOverlay(a,b){let c=this["".concat(b,"Color")],d=this["".concat(b,"Image")],e=this.viewportTransform,f=this["".concat(b,"Vpt")];if(!c&&!d)return;let g=a2(c);if(c){if(a.save(),a.beginPath(),a.moveTo(0,0),a.lineTo(this.width,0),a.lineTo(this.width,this.height),a.lineTo(0,this.height),a.closePath(),a.fillStyle=g?c.toLive(a):c,f&&a.transform(...e),g){a.transform(1,0,0,1,c.offsetX||0,c.offsetY||0);let b=c.gradientTransform||c.patternTransform;b&&a.transform(...b)}a.fill(),a.restore()}if(d){a.save();let{skipOffscreen:b}=this;this.skipOffscreen=f,f&&a.transform(...e),d.render(a),this.skipOffscreen=b,a.restore()}}_renderBackground(a){this._renderBackgroundOrOverlay(a,"background")}_renderOverlay(a){this._renderBackgroundOrOverlay(a,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new as(this.width/2,this.height/2)}centerObjectH(a){return this._centerObject(a,new as(this.getCenterPoint().x,a.getCenterPoint().y))}centerObjectV(a){return this._centerObject(a,new as(a.getCenterPoint().x,this.getCenterPoint().y))}centerObject(a){return this._centerObject(a,this.getCenterPoint())}viewportCenterObject(a){return this._centerObject(a,this.getVpCenter())}viewportCenterObjectH(a){return this._centerObject(a,new as(this.getVpCenter().x,a.getCenterPoint().y))}viewportCenterObjectV(a){return this._centerObject(a,new as(a.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return aJ(this.getCenterPoint(),aK(this.viewportTransform))}_centerObject(a,b){a.setXY(b,R,R),a.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(a){return this.toDatalessObject(a)}toObject(a){return this._toObjectMethod("toObject",a)}toJSON(){return this.toObject()}toDatalessObject(a){return this._toObjectMethod("toDatalessObject",a)}_toObjectMethod(a,b){let c=this.clipPath,d=c&&!c.excludeFromExport?this._toObject(c,a,b):null;return x(x(x({version:L},a$(this,b)),{},{objects:this._objects.filter(a=>!a.excludeFromExport).map(c=>this._toObject(c,a,b))},this.__serializeBgOverlay(a,b)),d?{clipPath:d}:null)}_toObject(a,b,c){let d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);let e=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=!!d),e}__serializeBgOverlay(a,b){let c={},d=this.backgroundImage,e=this.overlayImage,f=this.backgroundColor,g=this.overlayColor;return a2(f)?f.excludeFromExport||(c.background=f.toObject(b)):f&&(c.background=f),a2(g)?g.excludeFromExport||(c.overlay=g.toObject(b)):g&&(c.overlay=g),d&&!d.excludeFromExport&&(c.backgroundImage=this._toObject(d,a,b)),e&&!e.excludeFromExport&&(c.overlayImage=this._toObject(e,a,b)),c}toSVG(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;a.reviver=b;let c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this.clipPath&&c.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(c,"background"),this._setSVGBgOverlayImage(c,"backgroundImage",b),this._setSVGObjects(c,b),this.clipPath&&c.push("</g>\n"),this._setSVGBgOverlayColor(c,"overlay"),this._setSVGBgOverlayImage(c,"overlayImage",b),c.push("</svg>"),c.join("")}_setSVGPreamble(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(a,b){let c,d=b.width||"".concat(this.width),e=b.height||"".concat(this.height),f=B.NUM_FRACTION_DIGITS,g=b.viewBox;if(g)c='viewBox="'.concat(g.x," ").concat(g.y," ").concat(g.width," ").concat(g.height,'" ');else if(this.svgViewportTransformation){let a=this.viewportTransform;c='viewBox="'.concat(a0(-a[4]/a[0],f)," ").concat(a0(-a[5]/a[3],f)," ").concat(a0(this.width/a[0],f)," ").concat(a0(this.height/a[3],f),'" ')}else c='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',d,'" ','height="',e,'" ',c,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",L,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(b),"</defs>\n")}createSVGClipPathMarkup(a){let b=this.clipPath;return b?(b.clipPathId="CLIPPATH_".concat(aA()),'<clipPath id="'.concat(b.clipPathId,'" >\n').concat(b.toClipPathSVG(a.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map(a=>{let b=this["".concat(a,"Color")];if(a2(b)){let c=this["".concat(a,"Vpt")],d=this.viewportTransform,e={isType:()=>!1,width:this.width/(c?d[0]:1),height:this.height/(c?d[3]:1)};return b.toSVG(e,{additionalTransform:c?a1(d):""})}}).join("")}createSVGFontFacesMarkup(){let a=[],b={},c=B.fontPaths;this._objects.forEach(function b(c){a.push(c),au(c)&&c._objects.forEach(b)}),a.forEach(a=>{if(!a||"function"!=typeof a._renderText)return;let{styles:d,fontFamily:e}=a;!b[e]&&c[e]&&(b[e]=!0,d&&Object.values(d).forEach(a=>{Object.values(a).forEach(a=>{let{fontFamily:d=""}=a;!b[d]&&c[d]&&(b[d]=!0)})}))});let d=Object.keys(b).map(a=>"		@font-face {\n			font-family: '".concat(a,"';\n			src: url('").concat(c[a],"');\n		}\n")).join("");return d?'	<style type="text/css"><![CDATA[\n'.concat(d,"]]></style>\n"):""}_setSVGObjects(a,b){this.forEachObject(c=>{c.excludeFromExport||this._setSVGObject(a,c,b)})}_setSVGObject(a,b,c){a.push(b.toSVG(c))}_setSVGBgOverlayImage(a,b,c){let d=this[b];d&&!d.excludeFromExport&&d.toSVG&&a.push(d.toSVG(c))}_setSVGBgOverlayColor(a,b){let c=this["".concat(b,"Color")];if(c)if(a2(c)){let d=c.repeat||"",e=this.width,f=this.height,g=this["".concat(b,"Vpt")]?a1(aK(this.viewportTransform)):"";a.push('<rect transform="'.concat(g," translate(").concat(e/2,",").concat(f/2,')" x="').concat(c.offsetX-e/2,'" y="').concat(c.offsetY-f/2,'" width="').concat("repeat-y"!==d&&"no-repeat"!==d||!a4(c)?e:c.source.width,'" height="').concat("repeat-x"!==d&&"no-repeat"!==d||!a4(c)?f:c.source.height,'" fill="url(#SVGID_').concat(c.id,')"></rect>\n'))}else a.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',c,'"',"></rect>\n")}loadFromJSON(a,b){let{signal:c}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!a)return Promise.reject(new D("`json` is undefined"));let d="string"==typeof a?JSON.parse(a):a,{objects:e=[]}=d,f=y(d,be),{backgroundImage:g,background:h,overlayImage:i,overlay:j,clipPath:k}=f,l=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([aY(e,{reviver:b,signal:c}),aZ({backgroundImage:g,backgroundColor:h,overlayImage:i,overlayColor:j,clipPath:k},{signal:c})]).then(a=>{let[b,c]=a;return this.clear(),this.add(...b),this.set(f),this.set(c),this.renderOnAddRemove=l,this})}clone(a){let b=this.toObject(a);return this.cloneWithoutData().loadFromJSON(b)}cloneWithoutData(){let a=aD(this);return new this.constructor(a)}toDataURL(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{format:b="png",quality:c=1,multiplier:d=1,enableRetinaScaling:e=!1}=a,f=d*(e?this.getRetinaScaling():1);return aE(this.toCanvasElement(f,a),b,c)}toBlob(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{format:b="png",quality:c=1,multiplier:d=1,enableRetinaScaling:e=!1}=a,f=d*(e?this.getRetinaScaling():1);return aF(this.toCanvasElement(f,a),b,c)}toCanvasElement(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:b,height:c,left:d,top:e,filter:f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=(b||this.width)*a,h=(c||this.height)*a,i=this.getZoom(),j=this.width,k=this.height,l=this.skipControlsDrawing,m=i*a,n=this.viewportTransform,o=[m,0,0,m,(n[4]-(d||0))*a,(n[5]-(e||0))*a],p=this.enableRetinaScaling,q=aD({width:g,height:h}),r=f?this._objects.filter(a=>f(a)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=o,this.width=g,this.height=h,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(q.getContext("2d"),r),this.viewportTransform=n,this.width=j,this.height=k,this.calcViewportBoundaries(),this.enableRetinaScaling=p,this.skipControlsDrawing=l,q}dispose(){return this.disposed||this.elements.cleanupDOM({width:this.width,height:this.height}),an.cancelByCanvas(this),this.disposed=!0,new Promise((a,b)=>{let c=()=>{this.destroy(),a(!0)};c.kill=b,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?a(!1):this.nextRenderHandle?this.__cleanupTask=c:c()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(a=>a.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}v(bf,"ownDefaults",bd);let bg=["touchstart","touchmove","touchend"],bh=a=>{let b,c=a6(a.target),d=(b=a.changedTouches)&&b[0]?b[0]:a;return new as(d.clientX+c.left,d.clientY+c.top)},bi=a=>bg.includes(a.type)||"touch"===a.pointerType,bj=a=>{a.preventDefault(),a.stopPropagation()},bk=a=>{let b=0,c=0,d=0,e=0;for(let f=0,g=a.length;f<g;f++){let{x:g,y:h}=a[f];(g>d||!f)&&(d=g),(g<b||!f)&&(b=g),(h>e||!f)&&(e=h),(h<c||!f)&&(c=h)}return{left:b,top:c,width:d-b,height:e-c}},bl=["translateX","translateY","scaleX","scaleY"],bm=(a,b)=>bn(a,aL(b,a.calcOwnMatrix())),bn=(a,b)=>{let c=aO(b),{translateX:d,translateY:e,scaleX:f,scaleY:g}=c,h=y(c,bl),i=new as(d,e);a.flipX=!1,a.flipY=!1,Object.assign(a,h),a.set({scaleX:f,scaleY:g}),a.setPositionByOrigin(i,R,R)},bo=a=>{a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},bp=a=>({scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}),bq=(a,b,c)=>{let d=a/2,e=b/2,f=bk([new as(-d,-e),new as(d,-e),new as(-d,e),new as(d,e)].map(a=>a.transform(c)));return new as(f.width,f.height)},br=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q;return aL(aK(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q),a)},bs=function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q;return a.transform(br(b,c))},bt=function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q;return a.transform(br(b,c),!0)},bu=(a,b,c)=>{let d=br(b,c);return bn(a,aL(d,a.calcOwnMatrix())),d},bv=(a,b)=>{var c;let{transform:{target:d}}=b;null==(c=d.canvas)||c.fire("object:".concat(a),x(x({},b),{},{target:d})),d.fire(a,b)},bw={left:-.5,top:-.5,center:0,bottom:.5,right:.5},bx=a=>"string"==typeof a?bw[a]:a-.5,by="not-allowed";function bz(a){return bx(a.originX)===bx(R)&&bx(a.originY)===bx(R)}let bA=(a,b)=>a[b],bB=(a,b,c,d)=>({e:a,transform:b,pointer:new as(c,d)});function bC(a,b){return Math.round((a.getTotalAngle()+aH(Math.atan2(b.y,b.x))+360)%360/45)}function bD(a,b,c,d,e){var f,g;let h,i,{target:j,corner:k}=a,l=j.controls[k],m=(null==(f=j.canvas)?void 0:f.getZoom())||1,n=j.padding/m,o=(g=new as(d,e),h=j.getRelativeCenterPoint(),i=void 0!==b&&void 0!==c?j.translateToGivenOrigin(h,R,R,b,c):new as(j.left,j.top),(j.angle?g.rotate(-aG(j.angle),h):g).subtract(i));return o.x>=n&&(o.x-=n),o.x<=-n&&(o.x+=n),o.y>=n&&(o.y-=n),o.y<=n&&(o.y+=n),o.x-=l.offsetX,o.y-=l.offsetY,o}let bE=(a,b,c,d)=>{let{target:e,offsetX:f,offsetY:g}=b,h=c-f,i=d-g,j=!bA(e,"lockMovementX")&&e.left!==h,k=!bA(e,"lockMovementY")&&e.top!==i;return j&&e.set(S,h),k&&e.set("top",i),(j||k)&&bv(X,bB(a,b,c,d)),j||k},bF={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},bG=(a,b,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a),bH=(a,b,c,d)=>{let e,f;a/=255;let g=Math.max(a,b/=255,c/=255),h=Math.min(a,b,c),i=(g+h)/2;if(g===h)e=f=0;else{let d=g-h;switch(f=i>.5?d/(2-g-h):d/(g+h),g){case a:e=(b-c)/d+6*(b<c);break;case b:e=(c-a)/d+2;break;case c:e=(a-b)/d+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*i),d]},bI=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(a)/(a.endsWith("%")?100:1)},bJ=a=>Math.min(Math.round(a),255).toString(16).toUpperCase().padStart(2,"0"),bK=a=>{let[b,c,d,e=1]=a,f=Math.round(.3*b+.59*c+.11*d);return[f,f,f,e]};class bL{constructor(a){if(v(this,"isUnrecognised",!1),a)if(a instanceof bL)this.setSource([...a._source]);else if(Array.isArray(a)){const[b,c,d,e=1]=a;this.setSource([b,c,d,e])}else this.setSource(this._tryParsingColor(a));else this.setSource([0,0,0,1])}_tryParsingColor(a){return(a=a.toLowerCase())in bF&&(a=bF[a]),"transparent"===a?[255,255,255,0]:bL.sourceFromHex(a)||bL.sourceFromRgb(a)||bL.sourceFromHsl(a)||(this.isUnrecognised=!0,[0,0,0,1])}getSource(){return this._source}setSource(a){this._source=a}toRgb(){let[a,b,c]=this.getSource();return"rgb(".concat(a,",").concat(b,",").concat(c,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){let[a,b,c]=bH(...this.getSource());return"hsl(".concat(a,",").concat(b,"%,").concat(c,"%)")}toHsla(){let[a,b,c,d]=bH(...this.getSource());return"hsla(".concat(a,",").concat(b,"%,").concat(c,"%,").concat(d,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){let[a,b,c,d]=this.getSource();return"".concat(bJ(a)).concat(bJ(b)).concat(bJ(c)).concat(bJ(Math.round(255*d)))}getAlpha(){return this.getSource()[3]}setAlpha(a){return this._source[3]=a,this}toGrayscale(){return this.setSource(bK(this.getSource())),this}toBlackWhite(a){let[b,,,c]=bK(this.getSource()),d=b<(a||127)?0:255;return this.setSource([d,d,d,c]),this}overlayWith(a){a instanceof bL||(a=new bL(a));let b=this.getSource(),c=a.getSource(),[d,e,f]=b.map((a,b)=>Math.round(.5*a+.5*c[b]));return this.setSource([d,e,f,b[3]]),this}static fromRgb(a){return bL.fromRgba(a)}static fromRgba(a){return new bL(bL.sourceFromRgb(a))}static sourceFromRgb(a){let b=a.replace(/\s+/g," ").match(/^rgba?\(\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d{0,3}(?:\.\d+)?%?)\s?)?\)$/i);if(b){let[a,c,d]=b.slice(1,4).map(a=>{let b=parseFloat(a);return a.endsWith("%")?Math.round(2.55*b):b});return[a,c,d,bI(b[4])]}}static fromHsl(a){return bL.fromHsla(a)}static fromHsla(a){return new bL(bL.sourceFromHsl(a))}static sourceFromHsl(a){let b,c,d,e=a.replace(/\s+/g," ").match(/^hsla?\(\s?([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d*(?:\.\d+)?%?)\s?)?\)$/i);if(!e)return;let f=(bL.parseAngletoDegrees(e[1])%360+360)%360/360,g=parseFloat(e[2])/100,h=parseFloat(e[3])/100;if(0===g)b=c=d=h;else{let a=h<=.5?h*(g+1):h+g-h*g,e=2*h-a;b=bG(e,a,f+1/3),c=bG(e,a,f),d=bG(e,a,f-1/3)}return[Math.round(255*b),Math.round(255*c),Math.round(255*d),bI(e[4])]}static fromHex(a){return new bL(bL.sourceFromHex(a))}static sourceFromHex(a){if(a.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){let b=a.slice(a.indexOf("#")+1),[c,d,e,f=255]=(b.length<=4?b.split("").map(a=>a+a):b.match(/.{2}/g)).map(a=>parseInt(a,16));return[c,d,e,f/255]}}static parseAngletoDegrees(a){let b=a.toLowerCase(),c=parseFloat(b);return b.includes("rad")?aH(c):b.includes("turn")?360*c:c}}let bM=function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,c=/\D{0,2}$/.exec(a),d=parseFloat(a),e=B.DPI;switch(null==c?void 0:c[0]){case"mm":return d*e/25.4;case"cm":return d*e/2.54;case"in":return d*e;case"pt":return d*e/72;case"pc":return d*e/72*12;case"em":return d*b;default:return d}},bN=a=>{let[b,c]=a.trim().split(" "),[d,e]=b&&b!==V?[b.slice(1,4),b.slice(5,8)]:b===V?[b,b]:["Mid","Mid"];return{meetOrSlice:c||"meet",alignX:d,alignY:e}},bO=function(a,b){let c,d,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(b)if(b.toLive)c="url(#SVGID_".concat(b.id,")");else{let a=new bL(b),e=a.getAlpha();c=a.toRgb(),1!==e&&(d=e.toString())}else c="none";return e?"".concat(a,": ").concat(c,"; ").concat(d?"".concat(a,"-opacity: ").concat(d,"; "):""):"".concat(a,'="').concat(c,'" ').concat(d?"".concat(a,'-opacity="').concat(d,'" '):"")};class bP{getSvgStyles(a){let b=this.fillRule?this.fillRule:"nonzero",c=this.strokeWidth?this.strokeWidth:"0",d=this.strokeDashArray?this.strokeDashArray.join(" "):V,e=this.strokeDashOffset?this.strokeDashOffset:"0",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i=void 0!==this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=a?"":this.getSvgFilter(),l=bO(ai,this.fill);return bO(aj,this.stroke)+"stroke-width: "+c+"; stroke-dasharray: "+d+"; stroke-linecap: "+f+"; stroke-dashoffset: "+e+"; stroke-linejoin: "+g+"; stroke-miterlimit: "+h+"; "+l+"fill-rule: "+b+"; opacity: "+i+";"+k+j}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=a?this.calcTransformMatrix():this.calcOwnMatrix(),d='transform="'.concat(a1(c));return"".concat(d).concat(b,'" ')}_toSVG(a){return[""]}toSVG(a){return this._createBaseSVGMarkup(this._toSVG(a),{reviver:a})}toClipPathSVG(a){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(a),{reviver:a})}_createBaseClipPathSVGMarkup(a){let{reviver:b,additionalTransform:c=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=[this.getSvgTransform(!0,c),this.getSvgCommons()].join(""),e=a.indexOf("COMMON_PARTS");return a[e]=d,b?b(a.join("")):a.join("")}_createBaseSVGMarkup(a){let b,{noStyle:c,reviver:d,withShadow:e,additionalTransform:f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=c?"":'style="'.concat(this.getSvgStyles(),'" '),h=e?'style="'.concat(this.getSvgFilter(),'" '):"",i=this.clipPath,j=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",k=i&&i.absolutePositioned,l=this.stroke,m=this.fill,n=this.shadow,o=[],p=a.indexOf("COMMON_PARTS");i&&(i.clipPathId="CLIPPATH_".concat(aA()),b='<clipPath id="'.concat(i.clipPathId,'" >\n').concat(i.toClipPathSVG(d),"</clipPath>\n")),k&&o.push("<g ",h,this.getSvgCommons()," >\n"),o.push("<g ",this.getSvgTransform(!1),k?"":h+this.getSvgCommons()," >\n");let q=""+g+j+(c?"":this.addPaintOrder())+" "+(f?'transform="'.concat(f,'" '):"");return a[p]=q,a2(m)&&o.push(m.toSVG(this)),a2(l)&&o.push(l.toSVG(this)),n&&o.push(n.toSVG(this)),i&&o.push(b),o.push(a.join("")),o.push("</g>\n"),k&&o.push("</g>\n"),d?d(o.join("")):o.join("")}addPaintOrder(){return this.paintFirst!==ai?' paint-order="'.concat(this.paintFirst,'" '):""}}function bQ(a){return RegExp("^("+a.join("|")+")\\b","i")}let bR="textDecorationThickness",bS=["fontSize","fontWeight","fontFamily","fontStyle"],bT=["underline","overline","linethrough"],bU=[...bS,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],bV=[...bU,...bT,"textBackgroundColor","direction",bR],bW=[...bS,...bT,aj,"strokeWidth",ai,"deltaY","textBackgroundColor",bR],bX="justify",bY="justify-left",bZ="justify-right",b$="justify-center",b_=String.raw(f||(f=z(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),b0=String.raw(g||(g=z(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),b1=RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+b_+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+b_+"))?\\s+(.*)"),b2={cx:S,x:S,r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":bR},b3="font-size",b4="clip-path",b5=(bQ(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),bQ(["symbol","image","marker","pattern","view","svg"]),bQ(["symbol","g","a","svg","clipPath","defs"])),b6=(new RegExp(String.raw(h||(h=z(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),b_,b0,b_,b0,b_,b0,b_)),new as(1,0)),b7=new as,b8=(a,b)=>a.rotate(b),b9=(a,b)=>new as(b).subtract(a),ca=a=>a.distanceFrom(b7),cb=(a,b)=>Math.atan2(cf(a,b),cg(a,b)),cc=a=>cb(b6,a),cd=a=>a.eq(b7)?a:a.scalarDivide(ca(a)),ce=function(a){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return cd(new as(-a.y,a.x).scalarMultiply(b?1:-1))},cf=(a,b)=>a.x*b.y-a.y*b.x,cg=(a,b)=>a.x*b.x+a.y*b.y,ch=(a,b,c)=>{if(a.eq(b)||a.eq(c))return!0;let d=cf(b,c),e=cf(b,a),f=cf(c,a);return d>=0?e>=0&&f<=0:!(e<=0&&f>=0)},ci="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",cj=RegExp("(?:\\s|^)"+ci+ci+"("+b_+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class ck{constructor(a){const b="string"==typeof a?ck.parseShadow(a):a;Object.assign(this,ck.ownDefaults,b),this.id=aA()}static parseShadow(a){let b=a.trim(),[,c=0,d=0,e=0]=(cj.exec(b)||[]).map(a=>parseFloat(a)||0);return{color:(b.replace(cj,"")||"rgb(0,0,0)").trim(),offsetX:c,offsetY:d,blur:e}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(a){let b=b8(new as(this.offsetX,this.offsetY),aG(-a.angle)),c=new bL(this.color),d=40,e=40;return a.width&&a.height&&(d=100*a0((Math.abs(b.x)+this.blur)/a.width,B.NUM_FRACTION_DIGITS)+20,e=100*a0((Math.abs(b.y)+this.blur)/a.height,B.NUM_FRACTION_DIGITS)+20),a.flipX&&(b.x*=-1),a.flipY&&(b.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(e,'%" height="').concat(100+2*e,'%" x="-').concat(d,'%" width="').concat(100+2*d,'%" >\n	<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(a0(this.blur?this.blur/2:0,B.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n	<feOffset dx="').concat(a0(b.x,B.NUM_FRACTION_DIGITS),'" dy="').concat(a0(b.y,B.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n	<feFlood flood-color="').concat(c.toRgb(),'" flood-opacity="').concat(c.getAlpha(),'"/>\n	<feComposite in2="oBlur" operator="in" />\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n')}toObject(){let a={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},b=ck.ownDefaults;return this.includeDefaultValues?a:a_(a,(a,c)=>a!==b[c])}static async fromObject(a){return new this(a)}}v(ck,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),v(ck,"type","shadow"),am.setClass(ck,"shadow");let cl=(a,b,c)=>Math.max(a,Math.min(b,c)),cm=["top",S,ae,af,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",ag,ah],cn=[ai,aj,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],co=(a,b,c,d)=>(a<Math.abs(b)?(a=b,d=c/4):d=0===b&&0===a?c/O*Math.asin(1):c/O*Math.asin(b/a),{a:a,c:b,p:c,s:d}),cp=(a,b,c,d,e)=>a*Math.pow(2,10*(d-=1))*Math.sin((d*e-b)*O/c),cq=(a,b,c,d)=>-c*Math.cos(a/d*N)+c+b,cr=(a,b,c,d)=>(a/=d)<1/2.75?7.5625*a*a*c+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b,cs=(a,b,c,d)=>c-cr(d-a,0,c,d)+b;var ct=Object.freeze({__proto__:null,defaultEasing:cq,easeInBack:function(a,b,c,d){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},easeInBounce:cs,easeInCirc:(a,b,c,d)=>-c*(Math.sqrt(1-(a/=d)*a)-1)+b,easeInCubic:(a,b,c,d)=>c*(a/d)**3+b,easeInElastic:(a,b,c,d)=>{let e=0;if(0===a)return b;if(1==(a/=d))return b+c;e||(e=.3*d);let{a:f,s:g,p:h}=co(c,c,e,1.70158);return-cp(f,g,h,a,d)+b},easeInExpo:(a,b,c,d)=>0===a?b:c*2**(10*(a/d-1))+b,easeInOutBack:function(a,b,c,d){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(a/=d/2)<1?c/2*(a*a*((1+(e*=1.525))*a-e))+b:c/2*((a-=2)*a*((1+(e*=1.525))*a+e)+2)+b},easeInOutBounce:(a,b,c,d)=>a<d/2?.5*cs(2*a,0,c,d)+b:.5*cr(2*a-d,0,c,d)+.5*c+b,easeInOutCirc:(a,b,c,d)=>(a/=d/2)<1?-c/2*(Math.sqrt(1-a**2)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b,easeInOutCubic:(a,b,c,d)=>(a/=d/2)<1?c/2*a**3+b:c/2*((a-2)**3+2)+b,easeInOutElastic:(a,b,c,d)=>{let e=0;if(0===a)return b;if(2==(a/=d/2))return b+c;e||(e=.3*1.5*d);let{a:f,s:g,p:h,c:i}=co(c,c,e,1.70158);return a<1?-.5*cp(f,g,h,a,d)+b:f*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*O/h)*.5+i+b},easeInOutExpo:(a,b,c,d)=>0===a?b:a===d?b+c:(a/=d/2)<1?c/2*2**(10*(a-1))+b:-(c/2*(2**(-10*--a)+2))+b,easeInOutQuad:(a,b,c,d)=>(a/=d/2)<1?c/2*a**2+b:-c/2*(--a*(a-2)-1)+b,easeInOutQuart:(a,b,c,d)=>(a/=d/2)<1?c/2*a**4+b:-c/2*((a-=2)*a**3-2)+b,easeInOutQuint:(a,b,c,d)=>(a/=d/2)<1?c/2*a**5+b:c/2*((a-2)**5+2)+b,easeInOutSine:(a,b,c,d)=>-c/2*(Math.cos(Math.PI*a/d)-1)+b,easeInQuad:(a,b,c,d)=>c*(a/=d)*a+b,easeInQuart:(a,b,c,d)=>c*(a/=d)*a**3+b,easeInQuint:(a,b,c,d)=>c*(a/d)**5+b,easeInSine:(a,b,c,d)=>-c*Math.cos(a/d*N)+c+b,easeOutBack:function(a,b,c,d){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeOutBounce:cr,easeOutCirc:(a,b,c,d)=>c*Math.sqrt(1-(a=a/d-1)*a)+b,easeOutCubic:(a,b,c,d)=>c*((a/d-1)**3+1)+b,easeOutElastic:(a,b,c,d)=>{let e=0;if(0===a)return b;if(1==(a/=d))return b+c;e||(e=.3*d);let{a:f,s:g,p:h,c:i}=co(c,c,e,1.70158);return f*2**(-10*a)*Math.sin((a*d-g)*O/h)+i+b},easeOutExpo:(a,b,c,d)=>a===d?b+c:-(c*(2**(-10*a/d)+1))+b,easeOutQuad:(a,b,c,d)=>-c*(a/=d)*(a-2)+b,easeOutQuart:(a,b,c,d)=>-c*((a=a/d-1)*a**3-1)+b,easeOutQuint:(a,b,c,d)=>c*((a/d-1)**5+1)+b,easeOutSine:(a,b,c,d)=>c*Math.sin(a/d*N)+b});let cu=()=>!1;class cv{constructor(a){let{startValue:b,byValue:c,duration:d=500,delay:e=0,easing:f=cq,onStart:g=M,onChange:h=M,onComplete:i=M,abort:j=cu,target:k}=a;v(this,"_state","pending"),v(this,"durationProgress",0),v(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=d,this.delay=e,this.easing=f,this._onStart=g,this._onChange=h,this._onComplete=i,this._abort=j,this.target=k,this.startValue=b,this.byValue=c,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){let a=a=>{"pending"===this._state&&(this.startTime=a||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>ax(a),this.delay):ax(a)}tick(a){let b=(a||+new Date)-this.startTime,c=Math.min(b,this.duration);this.durationProgress=c/this.duration;let{value:d,valueProgress:e}=this.calculate(c);this.value=Object.freeze(d),this.valueProgress=e,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):b>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),ax(this.tick)))}register(){an.push(this)}unregister(){an.remove(this)}abort(){this._state="aborted",this.unregister()}}let cw=["startValue","endValue"];class cx extends cv{constructor(a){let{startValue:b=0,endValue:c=100}=a;super(x(x({},y(a,cw)),{},{startValue:b,byValue:c-b}))}calculate(a){let b=this.easing(a,this.startValue,this.byValue,this.duration);return{value:b,valueProgress:Math.abs((b-this.startValue)/this.byValue)}}}let cy=["startValue","endValue"];class cz extends cv{constructor(a){let{startValue:b=[0],endValue:c=[100]}=a;super(x(x({},y(a,cy)),{},{startValue:b,byValue:c.map((a,c)=>a-b[c])}))}calculate(a){let b=this.startValue.map((b,c)=>this.easing(a,b,this.byValue[c],this.duration,c));return{value:b,valueProgress:Math.abs((b[0]-this.startValue[0])/this.byValue[0])}}}let cA=["startValue","endValue","easing","onChange","onComplete","abort"],cB=(a,b,c,d)=>b+c*(1-Math.cos(a/d*N)),cC=a=>a&&((b,c,d)=>a(new bL(b).toRgba(),c,d));class cD extends cv{constructor(a){let{startValue:b,endValue:c,easing:d=cB,onChange:e,onComplete:f,abort:g}=a,h=y(a,cA);const i=new bL(b).getSource(),j=new bL(c).getSource();super(x(x({},h),{},{startValue:i,byValue:j.map((a,b)=>a-i[b]),easing:d,onChange:cC(e),onComplete:cC(f),abort:cC(g)}))}calculate(a){let[b,c,d,e]=this.startValue.map((b,c)=>this.easing(a,b,this.byValue[c],this.duration,c)),f=[...[b,c,d].map(Math.round),cl(0,e,1)];return{value:f,valueProgress:f.map((a,b)=>0!==this.byValue[b]?Math.abs((a-this.startValue[b])/this.byValue[b]):0).find(a=>0!==a)||0}}}function cE(a){let b=Array.isArray(a.startValue)||Array.isArray(a.endValue)?new cz(a):new cx(a);return b.start(),b}function cF(a){let b=new cD(a);return b.start(),b}class cG{constructor(a){this.status=a,this.points=[]}includes(a){return this.points.some(b=>b.eq(a))}append(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return this.points=this.points.concat(b.filter(a=>!this.includes(a))),this}static isPointContained(a,b,c){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(b.eq(c))return a.eq(b);if(b.x===c.x)return a.x===b.x&&(d||a.y>=Math.min(b.y,c.y)&&a.y<=Math.max(b.y,c.y));if(b.y===c.y)return a.y===b.y&&(d||a.x>=Math.min(b.x,c.x)&&a.x<=Math.max(b.x,c.x));{let e=b9(b,c),f=b9(b,a).divide(e);return d?Math.abs(f.x)===Math.abs(f.y):f.x===f.y&&f.x>=0&&f.x<=1}}static isPointInPolygon(a,b){let c=new as(a).setX(Math.min(a.x-1,...b.map(a=>a.x))),d=0;for(let e=0;e<b.length;e++){let f=this.intersectSegmentSegment(b[e],b[(e+1)%b.length],a,c);if(f.includes(a))return!0;d+=Number("Intersection"===f.status)}return d%2==1}static intersectLineLine(a,b,c,d){let e=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=b.x-a.x,h=b.y-a.y,i=d.x-c.x,j=d.y-c.y,k=a.x-c.x,l=a.y-c.y,m=i*l-j*k,n=g*l-h*k,o=j*g-i*h;if(0!==o){let b=m/o,c=n/o;return(e||0<=b&&b<=1)&&(f||0<=c&&c<=1)?new cG("Intersection").append(new as(a.x+b*g,a.y+b*h)):new cG}if(0===m||0===n){let g=e||f||cG.isPointContained(a,c,d)||cG.isPointContained(b,c,d)||cG.isPointContained(c,a,b)||cG.isPointContained(d,a,b);return new cG(g?"Coincident":void 0)}return new cG("Parallel")}static intersectSegmentLine(a,b,c,d){return cG.intersectLineLine(a,b,c,d,!1,!0)}static intersectSegmentSegment(a,b,c,d){return cG.intersectLineLine(a,b,c,d,!1,!1)}static intersectLinePolygon(a,b,c){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],e=new cG,f=c.length;for(let g,h,i,j=0;j<f;j++){if(g=c[j],h=c[(j+1)%f],"Coincident"===(i=cG.intersectLineLine(a,b,g,h,d,!1)).status)return i;e.append(...i.points)}return e.points.length>0&&(e.status="Intersection"),e}static intersectSegmentPolygon(a,b,c){return cG.intersectLinePolygon(a,b,c,!1)}static intersectPolygonPolygon(a,b){let c=new cG,d=a.length,e=[];for(let f=0;f<d;f++){let g=a[f],h=a[(f+1)%d],i=cG.intersectSegmentPolygon(g,h,b);"Coincident"===i.status?(e.push(i),c.append(g,h)):c.append(...i.points)}return e.length>0&&e.length===a.length?new cG("Coincident"):(c.points.length>0&&(c.status="Intersection"),c)}static intersectPolygonRectangle(a,b,c){let d=b.min(c),e=b.max(c),f=new as(e.x,d.y),g=new as(d.x,e.y);return cG.intersectPolygonPolygon(a,[d,f,e,g])}}class cH extends aw{getX(){return this.getXY().x}setX(a){this.setXY(this.getXY().setX(a))}getY(){return this.getXY().y}setY(a){this.setXY(this.getXY().setY(a))}getRelativeX(){return this.left}setRelativeX(a){this.left=a}getRelativeY(){return this.top}setRelativeY(a){this.top=a}getXY(){let a=this.getRelativeXY();return this.group?aJ(a,this.group.calcTransformMatrix()):a}setXY(a,b,c){this.group&&(a=aJ(a,aK(this.group.calcTransformMatrix()))),this.setRelativeXY(a,b,c)}getRelativeXY(){return new as(this.left,this.top)}setRelativeXY(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(a,b,c)}isStrokeAccountedForInDimensions(){return!1}getCoords(){let{tl:a,tr:b,br:c,bl:d}=this.aCoords||(this.aCoords=this.calcACoords()),e=[a,b,c,d];if(this.group){let a=this.group.calcTransformMatrix();return e.map(b=>aJ(b,a))}return e}intersectsWithRect(a,b){return"Intersection"===cG.intersectPolygonRectangle(this.getCoords(),a,b).status}intersectsWithObject(a){let b=cG.intersectPolygonPolygon(this.getCoords(),a.getCoords());return"Intersection"===b.status||"Coincident"===b.status||a.isContainedWithinObject(this)||this.isContainedWithinObject(a)}isContainedWithinObject(a){return this.getCoords().every(b=>a.containsPoint(b))}isContainedWithinRect(a,b){let{left:c,top:d,width:e,height:f}=this.getBoundingRect();return c>=a.x&&c+e<=b.x&&d>=a.y&&d+f<=b.y}isOverlapping(a){return this.intersectsWithObject(a)||this.isContainedWithinObject(a)||a.isContainedWithinObject(this)}containsPoint(a){return cG.isPointInPolygon(a,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;let{tl:a,br:b}=this.canvas.vptCoords;return!!this.getCoords().some(c=>c.x<=b.x&&c.x>=a.x&&c.y<=b.y&&c.y>=a.y)||!!this.intersectsWithRect(a,b)||this.containsPoint(a.midPointFrom(b))}isPartiallyOnScreen(){if(!this.canvas)return!1;let{tl:a,br:b}=this.canvas.vptCoords;return!!this.intersectsWithRect(a,b)||this.getCoords().every(c=>(c.x>=b.x||c.x<=a.x)&&(c.y>=b.y||c.y<=a.y))&&this.containsPoint(a.midPointFrom(b))}getBoundingRect(){return bk(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(a){this._set(ae,a),this._set(af,a),this.setCoords()}scaleToWidth(a){let b=this.getBoundingRect().width/this.getScaledWidth();return this.scale(a/this.width/b)}scaleToHeight(a){let b=this.getBoundingRect().height/this.getScaledHeight();return this.scale(a/this.height/b)}getCanvasRetinaScaling(){var a;return(null==(a=this.canvas)?void 0:a.getRetinaScaling())||1}getTotalAngle(){return this.group?aH(aN(this.calcTransformMatrix())):this.angle}getViewportTransform(){var a;return(null==(a=this.canvas)?void 0:a.viewportTransform)||Q.concat()}calcACoords(){let a=aQ({angle:this.angle}),{x:b,y:c}=this.getRelativeCenterPoint(),d=aL(aP(b,c),a),e=this._getTransformedDimensions(),f=e.x/2,g=e.y/2;return{tl:aJ({x:-f,y:-g},d),tr:aJ({x:f,y:-g},d),bl:aJ({x:-f,y:g},d),br:aJ({x:f,y:g},d)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=[];return!a&&this.group&&(b=this.group.transformMatrixKey(a)),b.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,bx(this.originX),bx(this.originY)),b}calcTransformMatrix(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=this.calcOwnMatrix();if(a||!this.group)return b;let c=this.transformMatrixKey(a),d=this.matrixCache;return d&&d.key.every((a,b)=>a===c[b])?d.value:(this.group&&(b=aL(this.group.calcTransformMatrix(!1),b)),this.matrixCache={key:c,value:b},b)}calcOwnMatrix(){let a=this.transformMatrixKey(!0),b=this.ownMatrixCache;if(b&&b.key===a)return b.value;let c=this.getRelativeCenterPoint(),d=aW({angle:this.angle,translateX:c.x,translateY:c.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY});return this.ownMatrixCache={key:a,value:d},d}_getNonTransformedDimensions(){return new as(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(a){return this._getTransformedDimensions(a).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=x({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},a),c=b.strokeWidth,d=c,e=0;this.strokeUniform&&(d=0,e=c);let f=b.width+d,g=b.height+d;return(0===b.skewX&&0===b.skewY?new as(f*b.scaleX,g*b.scaleY):bq(f,g,aV(b))).scalarAdd(e)}translateToGivenOrigin(a,b,c,d,e){let f=a.x,g=a.y,h=bx(d)-bx(b),i=bx(e)-bx(c);if(h||i){let a=this._getTransformedDimensions();f+=h*a.x,g+=i*a.y}return new as(f,g)}translateToCenterPoint(a,b,c){if(b===R&&c===R)return a;let d=this.translateToGivenOrigin(a,b,c,R,R);return this.angle?d.rotate(aG(this.angle),a):d}translateToOriginPoint(a,b,c){let d=this.translateToGivenOrigin(a,R,R,b,c);return this.angle?d.rotate(aG(this.angle),a):d}getCenterPoint(){let a=this.getRelativeCenterPoint();return this.group?aJ(a,this.group.calcTransformMatrix()):a}getRelativeCenterPoint(){return this.translateToCenterPoint(new as(this.left,this.top),this.originX,this.originY)}getPointByOrigin(a,b){return this.translateToOriginPoint(this.getRelativeCenterPoint(),a,b)}setPositionByOrigin(a,b,c){let d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set({left:e.x,top:e.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),S,"top")}}let cI=["type"],cJ=["extraParam"],cK=class a extends cH{static getDefaults(){return a.ownDefaults}get type(){let a=this.constructor.type;return"FabricObject"===a?"object":a.toLowerCase()}set type(a){C("warn","Setting type has no effect",a)}constructor(b){super(),v(this,"_cacheContext",null),Object.assign(this,a.ownDefaults),this.setOptions(b)}_createCacheCanvas(){this._cacheCanvas=aB(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(a){let b=a.width,c=a.height,d=B.maxCacheSideLimit,e=B.minCacheSideLimit;if(b<=d&&c<=d&&b*c<=B.perfLimitSizeTotal)return b<e&&(a.width=e),c<e&&(a.height=e),a;let[f,g]=K.limitDimsByArea(b/c),h=cl(e,f,d),i=cl(e,g,d);return b>h&&(a.zoomX/=b/h,a.width=h,a.capped=!0),c>i&&(a.zoomY/=c/i,a.height=i,a.capped=!0),a}_getCacheCanvasDimensions(){let a=this.getTotalObjectScaling(),b=this._getTransformedDimensions({skewX:0,skewY:0}),c=b.x*a.x/this.scaleX,d=b.y*a.y/this.scaleY;return{width:Math.ceil(c+2),height:Math.ceil(d+2),zoomX:a.x,zoomY:a.y,x:c,y:d}}_updateCacheCanvas(){let a=this._cacheCanvas,b=this._cacheContext,{width:c,height:d,zoomX:e,zoomY:f,x:g,y:h}=this._limitCacheSize(this._getCacheCanvasDimensions()),i=c!==a.width||d!==a.height,j=this.zoomX!==e||this.zoomY!==f;if(!a||!b)return!1;if(i||j){c!==a.width||d!==a.height?(a.width=c,a.height=d):(b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,a.width,a.height));let i=g/2,j=h/2;return this.cacheTranslationX=Math.round(a.width/2-i)+i,this.cacheTranslationY=Math.round(a.height/2-j)+j,b.translate(this.cacheTranslationX,this.cacheTranslationY),b.scale(e,f),this.zoomX=e,this.zoomY=f,!0}return!1}setOptions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(a)}transform(a){let b=this.group&&!this.group._transformDone||this.group&&this.canvas&&a===this.canvas.contextTop,c=this.calcTransformMatrix(!b);a.transform(c[0],c[1],c[2],c[3],c[4],c[5])}getObjectScaling(){if(!this.group)return new as(Math.abs(this.scaleX),Math.abs(this.scaleY));let a=aO(this.calcTransformMatrix());return new as(Math.abs(a.scaleX),Math.abs(a.scaleY))}getTotalObjectScaling(){let a=this.getObjectScaling();if(this.canvas){let b=this.canvas.getZoom(),c=this.getCanvasRetinaScaling();return a.scalarMultiply(b*c)}return a}getObjectOpacity(){let a=this.opacity;return this.group&&(a*=this.group.getObjectOpacity()),a}_constrainScale(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:0===a?1e-4:a}_set(a,b){a!==ae&&a!==af||(b=this._constrainScale(b)),a===ae&&b<0?(this.flipX=!this.flipX,b*=-1):"scaleY"===a&&b<0?(this.flipY=!this.flipY,b*=-1):"shadow"!==a||!b||b instanceof ck||(b=new ck(b));let c=this[a]!==b;return this[a]=b,c&&this.constructor.cacheProperties.includes(a)&&(this.dirty=!0),this.parent&&(this.dirty||c&&this.constructor.stateProperties.includes(a))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(a){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),this.transform(a),this._setOpacity(a),this._setShadow(a),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(a)):(this._removeCacheCanvas(),this.drawObject(a,!1,{}),this.dirty=!1),a.restore())}drawSelectionBackground(a){}renderCache(a){if(a=a||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){let{zoomX:b,zoomY:c,cacheTranslationX:d,cacheTranslationY:e}=this,{width:f,height:g}=this._cacheCanvas;this.drawObject(this._cacheContext,a.forClipping,{zoomX:b,zoomY:c,cacheTranslationX:d,cacheTranslationY:e,width:f,height:g,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===aj&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(a,b,c){a.save(),b.inverted?a.globalCompositeOperation="destination-out":a.globalCompositeOperation="destination-in",a.setTransform(1,0,0,1,0,0),a.drawImage(c,0,0),a.restore()}drawObject(a,b,c){let d=this.fill,e=this.stroke;b?(this.fill="black",this.stroke="",this._setClippingProperties(a)):this._renderBackground(a),this._render(a),this._drawClipPath(a,this.clipPath,c),this.fill=d,this.stroke=e}createClipPathLayer(a,b){let c=aD(b),d=c.getContext("2d");if(d.translate(b.cacheTranslationX,b.cacheTranslationY),d.scale(b.zoomX,b.zoomY),a._cacheCanvas=c,b.parentClipPaths.forEach(a=>{a.transform(d)}),b.parentClipPaths.push(a),a.absolutePositioned){let a=aK(this.calcTransformMatrix());d.transform(a[0],a[1],a[2],a[3],a[4],a[5])}return a.transform(d),a.drawObject(d,!0,b),c}_drawClipPath(a,b,c){if(!b)return;b._transformDone=!0;let d=this.createClipPathLayer(b,c);this.drawClipPathOnCache(a,b,d)}drawCacheOnCanvas(a){a.scale(1/this.zoomX,1/this.zoomY),a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;let b=this._cacheCanvas,c=this._cacheContext;return!(!b||!c||a||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(b&&c&&!a&&(c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,b.width,b.height),c.restore()),!0)}_renderBackground(a){if(!this.backgroundColor)return;let b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor,a.fillRect(-b.x/2,-b.y/2,b.x,b.y),this._removeShadow(a)}_setOpacity(a){this.group&&!this.group._transformDone?a.globalAlpha=this.getObjectOpacity():a.globalAlpha*=this.opacity}_setStrokeStyles(a,b){let c=b.stroke;c&&(a.lineWidth=b.strokeWidth,a.lineCap=b.strokeLineCap,a.lineDashOffset=b.strokeDashOffset,a.lineJoin=b.strokeLineJoin,a.miterLimit=b.strokeMiterLimit,a2(c)?"percentage"===c.gradientUnits||c.gradientTransform||c.patternTransform?this._applyPatternForTransformedGradient(a,c):(a.strokeStyle=c.toLive(a),this._applyPatternGradientTransform(a,c)):a.strokeStyle=b.stroke)}_setFillStyles(a,b){let{fill:c}=b;c&&(a2(c)?(a.fillStyle=c.toLive(a),this._applyPatternGradientTransform(a,c)):a.fillStyle=c)}_setClippingProperties(a){a.globalAlpha=1,a.strokeStyle="transparent",a.fillStyle="#000000"}_setLineDash(a,b){b&&0!==b.length&&a.setLineDash(b)}_setShadow(a){if(!this.shadow)return;let b=this.shadow,c=this.canvas,d=this.getCanvasRetinaScaling(),[e,,,f]=(null==c?void 0:c.viewportTransform)||Q,g=e*d,h=f*d,i=b.nonScaling?new as(1,1):this.getObjectScaling();a.shadowColor=b.color,a.shadowBlur=b.blur*B.browserShadowBlurConstant*(g+h)*(i.x+i.y)/4,a.shadowOffsetX=b.offsetX*g*i.x,a.shadowOffsetY=b.offsetY*h*i.y}_removeShadow(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)}_applyPatternGradientTransform(a,b){if(!a2(b))return{offsetX:0,offsetY:0};let c=b.gradientTransform||b.patternTransform,d=-this.width/2+b.offsetX||0,e=-this.height/2+b.offsetY||0;return"percentage"===b.gradientUnits?a.transform(this.width,0,0,this.height,d,e):a.transform(1,0,0,1,d,e),c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),{offsetX:d,offsetY:e}}_renderPaintInOrder(a){this.paintFirst===aj?(this._renderStroke(a),this._renderFill(a)):(this._renderFill(a),this._renderStroke(a))}_render(a){}_renderFill(a){this.fill&&(a.save(),this._setFillStyles(a,this),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())}_renderStroke(a){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this.strokeUniform){let b=this.getObjectScaling();a.scale(1/b.x,1/b.y)}this._setLineDash(a,this.strokeDashArray),this._setStrokeStyles(a,this),a.stroke(),a.restore()}}_applyPatternForTransformedGradient(a,b){var c;let d=this._limitCacheSize(this._getCacheCanvasDimensions()),e=this.getCanvasRetinaScaling(),f=d.x/this.scaleX/e,g=d.y/this.scaleY/e,h=aD({width:Math.ceil(f),height:Math.ceil(g)}),i=h.getContext("2d");i&&(i.beginPath(),i.moveTo(0,0),i.lineTo(f,0),i.lineTo(f,g),i.lineTo(0,g),i.closePath(),i.translate(f/2,g/2),i.scale(d.zoomX/this.scaleX/e,d.zoomY/this.scaleY/e),this._applyPatternGradientTransform(i,b),i.fillStyle=b.toLive(a),i.fill(),a.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),a.scale(e*this.scaleX/d.zoomX,e*this.scaleY/d.zoomY),a.strokeStyle=null!=(c=i.createPattern(h,"no-repeat"))?c:"")}_findCenterFromElement(){return new as(this.left+this.width/2,this.top+this.height/2)}clone(a){let b=this.toObject(a);return this.constructor.fromObject(b)}cloneAsImage(a){let b=this.toCanvasElement(a);return new(am.getClass("image"))(b)}toCanvasElement(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=bp(this),c=this.group,d=this.shadow,e=Math.abs,f=a.enableRetinaScaling?J():1,g=(a.multiplier||1)*f,h=a.canvasProvider||(a=>new bf(a,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,a.withoutTransform&&bo(this),a.withoutShadow&&(this.shadow=null),a.viewportTransform&&bu(this,this.getViewportTransform()),this.setCoords();let i=aB(),j=this.getBoundingRect(),k=this.shadow,l=new as;if(k){let a=k.blur,b=k.nonScaling?new as(1,1):this.getObjectScaling();l.x=2*Math.round(e(k.offsetX)+a)*e(b.x),l.y=2*Math.round(e(k.offsetY)+a)*e(b.y)}let m=j.width+l.x,n=j.height+l.y;i.width=Math.ceil(m),i.height=Math.ceil(n);let o=h(i);"jpeg"===a.format&&(o.backgroundColor="#fff"),this.setPositionByOrigin(new as(o.width/2,o.height/2),R,R);let p=this.canvas;o._objects=[this],this.set("canvas",o),this.setCoords();let q=o.toCanvasElement(g||1,a);return this.set("canvas",p),this.shadow=d,c&&(this.group=c),this.set(b),this.setCoords(),o._objects=[],o.destroy(),q}toDataURL(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return aE(this.toCanvasElement(a),a.format||"png",a.quality||1)}toBlob(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return aF(this.toCanvasElement(a),a.format||"png",a.quality||1)}isType(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return b.includes(this.constructor.type)||b.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(a){let{centeredRotation:b,originX:c,originY:d}=this;if(b){let{x:a,y:b}=this.getRelativeCenterPoint();this.originX=R,this.originY=R,this.left=a,this.top=b}if(this.set("angle",a),b){let{x:a,y:b}=this.translateToOriginPoint(this.getRelativeCenterPoint(),c,d);this.left=a,this.top=b,this.originX=c,this.originY=d}}setOnGroup(){}_setupCompositeOperation(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}dispose(){an.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&I().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(a,b){return Object.entries(a).reduce((a,c)=>{let[d,e]=c;return a[d]=this._animate(d,e,b),a},{})}_animate(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=a.split("."),e=this.constructor.colorProperties.includes(d[d.length-1]),{abort:f,startValue:g,onChange:h,onComplete:i}=c,j=x(x({},c),{},{target:this,startValue:null!=g?g:d.reduce((a,b)=>a[b],this),endValue:b,abort:null==f?void 0:f.bind(this),onChange:(a,b,c)=>{d.reduce((b,c,e)=>(e===d.length-1&&(b[c]=a),b[c]),this),h&&h(a,b,c)},onComplete:(a,b,c)=>{this.setCoords(),i&&i(a,b,c)}});return e?cF(j):cE(j)}isDescendantOf(a){let{parent:b,group:c}=this;return b===a||c===a||!!b&&b.isDescendantOf(a)||!!c&&c!==b&&c.isDescendantOf(a)}getAncestors(){let a=[],b=this;do(b=b.parent)&&a.push(b);while(b)return a}findCommonAncestors(a){if(this===a)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};let b=this.getAncestors(),c=a.getAncestors();if(0===b.length&&c.length>0&&this===c[c.length-1])return{fork:[],otherFork:[a,...c.slice(0,c.length-1)],common:[this]};for(let d,e=0;e<b.length;e++){if((d=b[e])===a)return{fork:[this,...b.slice(0,e)],otherFork:[],common:b.slice(e)};for(let f=0;f<c.length;f++){if(this===c[f])return{fork:[],otherFork:[a,...c.slice(0,f)],common:[this,...b]};if(d===c[f])return{fork:[this,...b.slice(0,e)],otherFork:[a,...c.slice(0,f)],common:b.slice(e)}}}return{fork:[this,...b],otherFork:[a,...c],common:[]}}hasCommonAncestors(a){let b=this.findCommonAncestors(a);return b&&!!b.common.length}isInFrontOf(a){if(this===a)return;let b=this.findCommonAncestors(a);if(b.fork.includes(a))return!0;if(b.otherFork.includes(this))return!1;let c=b.common[0]||this.canvas;if(!c)return;let d=b.fork.pop(),e=b.otherFork.pop(),f=c._objects.indexOf(d),g=c._objects.indexOf(e);return f>-1&&f>g}toObject(){let b,c=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(a.customProperties,this.constructor.customProperties||[]),d=B.NUM_FRACTION_DIGITS,{clipPath:e,fill:f,stroke:g,shadow:h,strokeDashArray:i,left:j,top:k,originX:l,originY:m,width:n,height:o,strokeWidth:p,strokeLineCap:q,strokeDashOffset:r,strokeLineJoin:s,strokeUniform:t,strokeMiterLimit:u,scaleX:v,scaleY:w,angle:y,flipX:z,flipY:A,opacity:C,visible:D,backgroundColor:E,fillRule:F,paintFirst:G,globalCompositeOperation:H,skewX:I,skewY:J}=this;e&&!e.excludeFromExport&&(b=e.toObject(c.concat("inverted","absolutePositioned")));let K=x(x({},a$(this,c)),{},{type:this.constructor.type,version:L,originX:l,originY:m,left:a0(j,d),top:a0(k,d),width:a0(n,d),height:a0(o,d),fill:a3(f)?f.toObject():f,stroke:a3(g)?g.toObject():g,strokeWidth:a0(p,d),strokeDashArray:i?i.concat():i,strokeLineCap:q,strokeDashOffset:r,strokeLineJoin:s,strokeUniform:t,strokeMiterLimit:a0(u,d),scaleX:a0(v,d),scaleY:a0(w,d),angle:a0(y,d),flipX:z,flipY:A,opacity:a0(C,d),shadow:h?h.toObject():h,visible:D,backgroundColor:E,fillRule:F,paintFirst:G,globalCompositeOperation:H,skewX:a0(I,d),skewY:a0(J,d)},b?{clipPath:b}:null);return this.includeDefaultValues?K:this._removeDefaultValues(K)}toDatalessObject(a){return this.toObject(a)}_removeDefaultValues(a){let b=this.constructor.getDefaults(),c=Object.keys(b).length>0?b:Object.getPrototypeOf(this);return a_(a,(a,b)=>{if(b===S||"top"===b||"type"===b)return!0;let d=c[b];return a!==d&&!(Array.isArray(a)&&Array.isArray(d)&&0===a.length&&0===d.length)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(a){let b=y(a,cI),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:d}=c;return aZ(b,y(c,cJ)).then(a=>d?(delete a[d],new this(b[d],a)):new this(a))}static fromObject(a,b){return this._fromObject(a,b)}};v(cK,"stateProperties",cm),v(cK,"cacheProperties",cn),v(cK,"ownDefaults",{top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:S,originY:"top",strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:ai,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0}),v(cK,"type","FabricObject"),v(cK,"colorProperties",[ai,aj,"backgroundColor"]),v(cK,"customProperties",[]),am.setClass(cK),am.setClass(cK,"object");let cL=(a,b,c)=>(d,e,f,g)=>{let h=b(d,e,f,g);return h&&bv(a,x(x({},bB(d,e,f,g)),c)),h};function cM(a){return(b,c,d,e)=>{let{target:f,originX:g,originY:h}=c,i=f.getRelativeCenterPoint(),j=f.translateToOriginPoint(i,g,h),k=a(b,c,d,e);return f.setPositionByOrigin(j,c.originX,c.originY),k}}let cN=cL(aa,cM((a,b,c,d)=>{let e=bD(b,b.originX,b.originY,c,d);if(bx(b.originX)===bx(R)||bx(b.originX)===bx(U)&&e.x<0||bx(b.originX)===bx(S)&&e.x>0){let{target:a}=b,c=a.strokeWidth/(a.strokeUniform?a.scaleX:1),d=bz(b)?2:1,f=a.width,g=Math.abs(e.x*d/a.scaleX)-c;return a.set("width",Math.max(g,1)),f!==a.width}return!1}));function cO(a,b,c,d,e){d=d||{};let f=this.sizeX||d.cornerSize||e.cornerSize,g=this.sizeY||d.cornerSize||e.cornerSize,h=void 0!==d.transparentCorners?d.transparentCorners:e.transparentCorners,i=h?aj:ai,j=!h&&(d.cornerStrokeColor||e.cornerStrokeColor),k,l=b,m=c;a.save(),a.fillStyle=d.cornerColor||e.cornerColor||"",a.strokeStyle=d.cornerStrokeColor||e.cornerStrokeColor||"",f>g?(k=f,a.scale(1,g/f),m=c*f/g):g>f?(k=g,a.scale(f/g,1),l=b*g/f):k=f,a.beginPath(),a.arc(l,m,k/2,0,O,!1),a[i](),j&&a.stroke(),a.restore()}function cP(a,b,c,d,e){d=d||{};let f=this.sizeX||d.cornerSize||e.cornerSize,g=this.sizeY||d.cornerSize||e.cornerSize,h=void 0!==d.transparentCorners?d.transparentCorners:e.transparentCorners,i=h?aj:ai,j=!h&&(d.cornerStrokeColor||e.cornerStrokeColor),k=f/2,l=g/2;a.save(),a.fillStyle=d.cornerColor||e.cornerColor||"",a.strokeStyle=d.cornerStrokeColor||e.cornerStrokeColor||"",a.translate(b,c);let m=e.getTotalAngle();a.rotate(aG(m)),a["".concat(i,"Rect")](-k,-l,f,g),j&&a.strokeRect(-k,-l,f,g),a.restore()}class cQ{constructor(a){v(this,"visible",!0),v(this,"actionName",ad),v(this,"angle",0),v(this,"x",0),v(this,"y",0),v(this,"offsetX",0),v(this,"offsetY",0),v(this,"sizeX",0),v(this,"sizeY",0),v(this,"touchSizeX",0),v(this,"touchSizeY",0),v(this,"cursorStyle","crosshair"),v(this,"withConnection",!1),Object.assign(this,a)}shouldActivate(a,b,c,d){var e;let{tl:f,tr:g,br:h,bl:i}=d;return(null==(e=b.canvas)?void 0:e.getActiveObject())===b&&b.isControlVisible(a)&&cG.isPointInPolygon(c,[f,g,h,i])}getActionHandler(a,b,c){return this.actionHandler}getMouseDownHandler(a,b,c){return this.mouseDownHandler}getMouseUpHandler(a,b,c){return this.mouseUpHandler}cursorStyleHandler(a,b,c){return b.cursorStyle}getActionName(a,b,c){return b.actionName}getVisibility(a,b){var c,d;return null!=(c=null==(d=a._controlsVisibility)?void 0:d[b])?c:this.visible}setVisibility(a,b,c){this.visible=a}positionHandler(a,b,c,d){return new as(this.x*a.x+this.offsetX,this.y*a.y+this.offsetY).transform(b)}calcCornerCoords(a,b,c,d,e,f){let g=aM([aP(c,d),aQ({angle:a}),aR((e?this.touchSizeX:this.sizeX)||b,(e?this.touchSizeY:this.sizeY)||b)]);return{tl:new as(-.5,-.5).transform(g),tr:new as(.5,-.5).transform(g),br:new as(.5,.5).transform(g),bl:new as(-.5,.5).transform(g)}}render(a,b,c,d,e){"circle"===((d=d||{}).cornerStyle||e.cornerStyle)?cO.call(this,a,b,c,d,e):cP.call(this,a,b,c,d,e)}}let cR=(a,b,c)=>c.lockRotation?by:b.cursorStyle,cS=cL(Z,cM((a,b,c,d)=>{let{target:e,ex:f,ey:g,theta:h,originX:i,originY:j}=b,k=e.translateToOriginPoint(e.getRelativeCenterPoint(),i,j);if(bA(e,"lockRotation"))return!1;let l=Math.atan2(g-k.y,f-k.x),m=aH(Math.atan2(d-k.y,c-k.x)-l+h);if(e.snapAngle&&e.snapAngle>0){let a=e.snapAngle,b=e.snapThreshold||a,c=Math.ceil(m/a)*a,d=Math.floor(m/a)*a;Math.abs(m-d)<b?m=d:Math.abs(m-c)<b&&(m=c)}m<0&&(m=360+m),m%=360;let n=e.angle!==m;return e.angle=m,n}));function cT(a,b){let c=b.canvas,d=a[c.uniScaleKey];return c.uniformScaling&&!d||!c.uniformScaling&&d}function cU(a,b,c){let d=bA(a,"lockScalingX"),e=bA(a,"lockScalingY");if(d&&e||!b&&(d||e)&&c||d&&"x"===b||e&&"y"===b)return!0;let{width:f,height:g,strokeWidth:h}=a;return 0===f&&0===h&&"y"!==b||0===g&&0===h&&"x"!==b}let cV=["e","se","s","sw","w","nw","n","ne","e"],cW=(a,b,c)=>{let d=cT(a,c);if(cU(c,0!==b.x&&0===b.y?"x":0===b.x&&0!==b.y?"y":"",d))return by;let e=bC(c,b);return"".concat(cV[e],"-resize")};function cX(a,b,c,d){let e,f,g,h,i,j,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=b.target,m=k.by,n=cT(a,l);if(cU(l,m,n))return!1;if(b.gestureScale)f=b.scaleX*b.gestureScale,g=b.scaleY*b.gestureScale;else{if(e=bD(b,b.originX,b.originY,c,d),i="y"!==m?Math.sign(e.x||b.signX||1):1,j="x"!==m?Math.sign(e.y||b.signY||1):1,b.signX||(b.signX=i),b.signY||(b.signY=j),bA(l,"lockScalingFlip")&&(b.signX!==i||b.signY!==j))return!1;if(h=l._getTransformedDimensions(),n&&!m){let a=Math.abs(e.x)+Math.abs(e.y),{original:c}=b,d=a/(Math.abs(h.x*c.scaleX/l.scaleX)+Math.abs(h.y*c.scaleY/l.scaleY));f=c.scaleX*d,g=c.scaleY*d}else f=Math.abs(e.x*l.scaleX/h.x),g=Math.abs(e.y*l.scaleY/h.y);bz(b)&&(f*=2,g*=2),b.signX!==i&&"y"!==m&&(b.originX=.5-bx(b.originX),f*=-1,b.signX=i),b.signY!==j&&"x"!==m&&(b.originY=.5-bx(b.originY),g*=-1,b.signY=j)}let o=l.scaleX,p=l.scaleY;return m?("x"===m&&l.set(ae,f),"y"===m&&l.set(af,g)):(bA(l,"lockScalingX")||l.set(ae,f),bA(l,"lockScalingY")||l.set(af,g)),o!==l.scaleX||p!==l.scaleY}let cY=cL(Y,cM((a,b,c,d)=>cX(a,b,c,d))),cZ=cL(Y,cM((a,b,c,d)=>cX(a,b,c,d,{by:"x"}))),c$=cL(Y,cM((a,b,c,d)=>cX(a,b,c,d,{by:"y"}))),c_=["target","ex","ey","skewingSide"],c0={x:{counterAxis:"y",scale:ae,skew:ag,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:af,skew:ah,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},c1=["ns","nesw","ew","nwse"],c2=(a,b,c)=>{if(0!==b.x&&bA(c,"lockSkewingY")||0!==b.y&&bA(c,"lockSkewingX"))return by;let d=bC(c,b)%4;return"".concat(c1[d],"-resize")};function c3(a,b,c,d,e){let{target:f}=c,{counterAxis:g,origin:h,lockSkewing:i,skew:j,flip:k}=c0[a];if(bA(f,i))return!1;let{origin:l,flip:m}=c0[g],n=-Math.sign(bx(c[l])*(f[m]?-1:1))*(f[k]?-1:1),o=-(.5*((0===f[j]&&bD(c,R,R,d,e)[a]>0||f[j]>0?1:-1)*n))+.5;return cL(_,cM((b,c,d,e)=>(function(a,b,c){let{target:d,ex:e,ey:f,skewingSide:g}=b,h=y(b,c_),{skew:i}=c0[a],j=c.subtract(new as(e,f)).divide(new as(d.scaleX,d.scaleY))[a],k=d[i],l=Math.tan(aG(h[i])),m=aH(Math.atan(2*j*g/Math.max("y"===a?d._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:d._getTransformedDimensions({scaleX:1,scaleY:1}).y,1)+l));d.set(i,m);let n=k!==d[i];if(n&&"y"===a){let{skewX:a,scaleX:b}=d,c=d._getTransformedDimensions({skewY:k}),e=d._getTransformedDimensions(),f=0!==a?c.x/e.x:1;1!==f&&d.set(ae,f*b)}return n})(a,c,new as(d,e))))(b,x(x({},c),{},{[h]:o,skewingSide:n}),d,e)}let c4=(a,b,c,d)=>c3("x",a,b,c,d),c5=(a,b,c,d)=>c3("y",a,b,c,d);function c6(a,b){return a[b.canvas.altActionKey]}let c7=(a,b,c)=>{let d=c6(a,c);return 0===b.x?d?ag:af:0===b.y?d?ah:ae:""},c8=(a,b,c)=>c6(a,c)?c2(0,b,c):cW(a,b,c),c9=(a,b,c,d)=>c6(a,b.target)?c5(a,b,c,d):cZ(a,b,c,d),da=(a,b,c,d)=>c6(a,b.target)?c4(a,b,c,d):c$(a,b,c,d),db=()=>({ml:new cQ({x:-.5,y:0,cursorStyleHandler:c8,actionHandler:c9,getActionName:c7}),mr:new cQ({x:.5,y:0,cursorStyleHandler:c8,actionHandler:c9,getActionName:c7}),mb:new cQ({x:0,y:.5,cursorStyleHandler:c8,actionHandler:da,getActionName:c7}),mt:new cQ({x:0,y:-.5,cursorStyleHandler:c8,actionHandler:da,getActionName:c7}),tl:new cQ({x:-.5,y:-.5,cursorStyleHandler:cW,actionHandler:cY}),tr:new cQ({x:.5,y:-.5,cursorStyleHandler:cW,actionHandler:cY}),bl:new cQ({x:-.5,y:.5,cursorStyleHandler:cW,actionHandler:cY}),br:new cQ({x:.5,y:.5,cursorStyleHandler:cW,actionHandler:cY}),mtr:new cQ({x:0,y:-.5,actionHandler:cS,cursorStyleHandler:cR,offsetY:-40,withConnection:!0,actionName:$})}),dc=()=>({mr:new cQ({x:.5,y:0,actionHandler:cN,cursorStyleHandler:c8,actionName:aa}),ml:new cQ({x:-.5,y:0,actionHandler:cN,cursorStyleHandler:c8,actionName:aa})}),dd=()=>x(x({},db()),dc());class de extends cK{static getDefaults(){return x(x({},super.getDefaults()),de.ownDefaults)}constructor(a){super(),Object.assign(this,this.constructor.createControls(),de.ownDefaults),this.setOptions(a)}static createControls(){return{controls:db()}}_updateCacheCanvas(){let a=this.canvas;if(this.noScaleCache&&a&&a._currentTransform){let b=a._currentTransform,c=b.target,d=b.action;if(this===c&&d&&d.startsWith(ad))return!1}return super._updateCacheCanvas()}getActiveControl(){let a=this.__corner;return a?{key:a,control:this.controls[a],coord:this.oCoords[a]}:void 0}findControl(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;let c=Object.entries(this.oCoords);for(let d=c.length-1;d>=0;d--){let[e,f]=c[d],g=this.controls[e];if(g.shouldActivate(e,this,a,b?f.touchCorner:f.corner))return this.__corner=e,{key:e,control:g,coord:this.oCoords[e]}}}calcOCoords(){let a=this.getViewportTransform(),b=this.getCenterPoint(),c=aL(aP(b.x,b.y),aQ({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)})),d=aL(a,c),e=aL(d,[1/a[0],0,0,1/a[3],0,0]),f=this.group?aO(this.calcTransformMatrix()):void 0;f&&(f.scaleX=Math.abs(f.scaleX),f.scaleY=Math.abs(f.scaleY));let g=this._calculateCurrentDimensions(f),h={};return this.forEachControl((a,b)=>{let c=a.positionHandler(g,e,this,a);h[b]=Object.assign(c,this._calcCornerCoords(a,c))}),h}_calcCornerCoords(a,b){let c=this.getTotalAngle();return{corner:a.calcCornerCoords(c,this.cornerSize,b.x,b.y,!1,this),touchCorner:a.calcCornerCoords(c,this.touchCornerSize,b.x,b.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(a){for(let b in this.controls)a(this.controls[b],b,this)}drawSelectionBackground(a){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;a.save();let b=this.getRelativeCenterPoint(),c=this._calculateCurrentDimensions(),d=this.getViewportTransform();a.translate(b.x,b.y),a.scale(1/d[0],1/d[3]),a.rotate(aG(this.angle)),a.fillStyle=this.selectionBackgroundColor,a.fillRect(-c.x/2,-c.y/2,c.x,c.y),a.restore()}strokeBorders(a,b){a.strokeRect(-b.x/2,-b.y/2,b.x,b.y)}_drawBorders(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=x({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},c);a.save(),a.strokeStyle=d.borderColor,this._setLineDash(a,d.borderDashArray),this.strokeBorders(a,b),d.hasControls&&this.drawControlsConnectingLines(a,b),a.restore()}_renderControls(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{hasBorders:c,hasControls:d}=this,e=x({hasBorders:c,hasControls:d},b),f=this.getViewportTransform(),g=e.hasBorders,h=e.hasControls,i=aO(aL(f,this.calcTransformMatrix()));a.save(),a.translate(i.translateX,i.translateY),a.lineWidth=this.borderScaleFactor,this.group===this.parent&&(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(i.angle-=180),a.rotate(aG(this.group?i.angle:this.angle)),g&&this.drawBorders(a,i,b),h&&this.drawControls(a,b),a.restore()}drawBorders(a,b,c){let d;if(c&&c.forActiveSelection||this.group){let a=bq(this.width,this.height,aV(b)),c=this.isStrokeAccountedForInDimensions()?at:(this.strokeUniform?(new as).scalarAdd(this.canvas?this.canvas.getZoom():1):new as(b.scaleX,b.scaleY)).scalarMultiply(this.strokeWidth);d=a.add(c).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else d=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(a,d,c)}drawControlsConnectingLines(a,b){let c=!1;a.beginPath(),this.forEachControl((d,e)=>{d.withConnection&&d.getVisibility(this,e)&&(c=!0,a.moveTo(d.x*b.x,d.y*b.y),a.lineTo(d.x*b.x+d.offsetX,d.y*b.y+d.offsetY))}),c&&a.stroke()}drawControls(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.save();let c=this.getCanvasRetinaScaling(),{cornerStrokeColor:d,cornerDashArray:e,cornerColor:f}=this,g=x({cornerStrokeColor:d,cornerDashArray:e,cornerColor:f},b);a.setTransform(c,0,0,c,0,0),a.strokeStyle=a.fillStyle=g.cornerColor,this.transparentCorners||(a.strokeStyle=g.cornerStrokeColor),this._setLineDash(a,g.cornerDashArray),this.forEachControl((b,c)=>{if(b.getVisibility(this,c)){let d=this.oCoords[c];b.render(a,d.x,d.y,g,this)}}),a.restore()}isControlVisible(a){return this.controls[a]&&this.controls[a].getVisibility(this,a)}setControlVisible(a,b){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[a]=b}setControlsVisibility(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(a).forEach(a=>{let[b,c]=a;return this.setControlVisible(b,c)})}clearContextTop(a){if(!this.canvas)return;let b=this.canvas.contextTop;if(!b)return;let c=this.canvas.viewportTransform;b.save(),b.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this.transform(b);let d=this.width+4,e=this.height+4;return b.clearRect(-d/2,-e/2,d,e),a||b.restore(),b}onDeselect(a){return!1}onSelect(a){return!1}shouldStartDragging(a){return!1}onDragStart(a){return!1}canDrop(a){return!1}renderDragSourceEffect(a){}renderDropTargetEffect(a){}}function df(a,b){return b.forEach(b=>{Object.getOwnPropertyNames(b.prototype).forEach(c=>{"constructor"!==c&&Object.defineProperty(a.prototype,c,Object.getOwnPropertyDescriptor(b.prototype,c)||Object.create(null))})}),a}v(de,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class dg extends de{}df(dg,[bP]),am.setClass(dg),am.setClass(dg,"object");let dh=(a,b,c,d)=>{let e=2*(d=Math.round(d))+1,{data:f}=a.getImageData(b-d,c-d,e,e);for(let a=3;a<f.length;a+=4)if(f[a]>0)return!1;return!0};class di{constructor(a){this.options=a,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new as(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new as(1/this.options.scaleX,1/this.options.scaleY):new as(1,1)}createSideVector(a,b){let c=b9(a,b);return this.options.strokeUniform?c.multiply(this.scale):c}projectOrthogonally(a,b,c){return this.applySkew(a.add(this.calcOrthogonalProjection(a,b,c)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(a){let b=new as(a);return b.y+=b.x*Math.tan(aG(this.options.skewY)),b.x+=b.y*Math.tan(aG(this.options.skewX)),b}scaleUnitVector(a,b){return a.multiply(this.strokeUniformScalar).scalarMultiply(b)}}let dj=new as;class dk extends di{static getOrthogonalRotationFactor(a,b){return Math.abs(b?cb(a,b):cc(a))<N?-1:1}constructor(a,b,c,d){super(d),v(this,"AB",void 0),v(this,"AC",void 0),v(this,"alpha",void 0),v(this,"bisector",void 0),this.A=new as(a),this.B=new as(b),this.C=new as(c),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=cb(this.AB,this.AC),this.bisector=cd(b8(this.AB.eq(dj)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,d=ce(this.createSideVector(a,b)),e=dk.getOrthogonalRotationFactor(d,this.bisector);return this.scaleUnitVector(d,c*e)}projectBevel(){let a=[];return(this.alpha%O==0?[this.B]:[this.B,this.C]).forEach(b=>{a.push(this.projectOrthogonally(this.A,b)),a.push(this.projectOrthogonally(this.A,b,-this.strokeProjectionMagnitude))}),a}projectMiter(){let a=[],b=1/Math.sin(Math.abs(this.alpha)/2),c=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*b),d=this.options.strokeUniform?ca(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return ca(c)/this.strokeProjectionMagnitude<=d&&a.push(this.applySkew(this.A.add(c))),a.push(...this.projectBevel()),a}projectRoundNoSkew(a,b){let c=[],d=new as(dk.getOrthogonalRotationFactor(this.bisector),dk.getOrthogonalRotationFactor(new as(this.bisector.y,this.bisector.x)));return[new as(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(d),new as(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(d)].forEach(d=>{ch(d,a,b)&&c.push(this.A.add(d))}),c}projectRoundWithSkew(a,b){let c=[],{skewX:d,skewY:e,scaleX:f,scaleY:g,strokeUniform:h}=this.options,i=new as(Math.tan(aG(d)),Math.tan(aG(e))),j=this.strokeProjectionMagnitude,k=h?j/g/Math.sqrt(1/g**2+1/f**2*i.y**2):j/Math.sqrt(1+i.y**2),l=new as(Math.sqrt(Math.max(j**2-k**2,0)),k),m=h?j/Math.sqrt(1+i.x**2*(1/g)**2/(1/f+1/f*i.x*i.y)**2):j/Math.sqrt(1+i.x**2/(1+i.x*i.y)**2),n=new as(m,Math.sqrt(Math.max(j**2-m**2,0)));return[n,n.scalarMultiply(-1),l,l.scalarMultiply(-1)].map(a=>this.applySkew(h?a.multiply(this.strokeUniformScalar):a)).forEach(d=>{ch(d,a,b)&&c.push(this.applySkew(this.A).add(d))}),c}projectRound(){let a=[];a.push(...this.projectBevel());let b=this.alpha%O==0,c=this.applySkew(this.A),d=a[2*!b].subtract(c),e=a[+!!b].subtract(c),f=cf(d,b?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)))>0,g=f?d:e,h=f?e:d;return this.isSkewed()?a.push(...this.projectRoundWithSkew(g,h)):a.push(...this.projectRoundNoSkew(g,h)),a}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(a=>({originPoint:this.A,projectedPoint:a,angle:this.alpha,bisector:this.bisector}))}}class dl extends di{constructor(a,b,c){super(c),this.A=new as(a),this.T=new as(b)}calcOrthogonalProjection(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,d=this.createSideVector(a,b);return this.scaleUnitVector(ce(d),c)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){let a=[];if(!this.isSkewed()&&this.A.eq(this.T)){let b=new as(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);a.push(this.applySkew(this.A.add(b)),this.applySkew(this.A.subtract(b)))}else a.push(...new dk(this.A,this.T,this.T,this.options).projectRound());return a}projectSquare(){let a=[];if(this.A.eq(this.T)){let b=new as(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);a.push(this.A.add(b),this.A.subtract(b))}else{let b=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),c=this.scaleUnitVector(cd(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),d=this.A.add(c);a.push(d.add(b),d.subtract(b))}return a.map(a=>this.applySkew(a))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(a=>({originPoint:this.A,projectedPoint:a}))}}let dm=function(a,b){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=[];if(0===a.length)return d;let e=a.reduce((a,b)=>(a[a.length-1].eq(b)||a.push(new as(b)),a),[new as(a[0])]);if(1===e.length)c=!0;else if(!c){let a=e[0],b=((a,b)=>{for(let c=a.length-1;c>=0;c--)if(b(a[c],c,a))return c;return -1})(e,b=>!b.eq(a));e.splice(b+1)}return e.forEach((a,e,f)=>{let g,h;0===e?(h=f[1],g=c?a:f[f.length-1]):e===f.length-1?(g=f[e-1],h=c?a:f[0]):(g=f[e-1],h=f[e+1]),c&&1===f.length?d.push(...new dl(a,a,b).project()):c&&(0===e||e===f.length-1)?d.push(...new dl(a,0===e?h:g,b).project()):d.push(...new dk(a,g,h,b).project())}),d},dn=a=>{let b={};return Object.keys(a).forEach(c=>{b[c]={},Object.keys(a[c]).forEach(d=>{b[c][d]=x({},a[c][d])})}),b},dp=a=>a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),dq=a=>(c||c||(c="Intl"in I().window&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),c)?Array.from(c.segment(a)).map(a=>{let{segment:b}=a;return b}):dr(a),dr=a=>{let b=[];for(let c,d=0;d<a.length;d++)!1!==(c=ds(a,d))&&b.push(c);return b},ds=(a,b)=>{let c=a.charCodeAt(b);if(isNaN(c))return"";if(c<55296||c>57343)return a.charAt(b);if(55296<=c&&c<=56319){if(a.length<=b+1)throw"High surrogate without following low surrogate";let c=a.charCodeAt(b+1);if(56320>c||c>57343)throw"High surrogate without following low surrogate";return a.charAt(b)+a.charAt(b+1)}if(0===b)throw"Low surrogate without preceding high surrogate";let d=a.charCodeAt(b-1);if(55296>d||d>56319)throw"Low surrogate without preceding high surrogate";return!1};var dt=Object.freeze({__proto__:null,capitalize:function(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(a.charAt(0).toUpperCase()).concat(b?a.slice(1):a.slice(1).toLowerCase())},escapeXml:dp,graphemeSplit:dq});let du=function(a,b){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a.fill!==b.fill||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth||a.fontSize!==b.fontSize||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.textDecorationThickness!==b.textDecorationThickness||a.textBackgroundColor!==b.textBackgroundColor||a.deltaY!==b.deltaY||c&&(a.overline!==b.overline||a.underline!==b.underline||a.linethrough!==b.linethrough)},dv=(a,b)=>{let c=b.split("\n"),d=[],e=-1,f={};a=dn(a);for(let b=0;b<c.length;b++){let g=dq(c[b]);if(a[b])for(let c=0;c<g.length;c++){e++;let g=a[b][c];g&&Object.keys(g).length>0&&(du(f,g,!0)?d.push({start:e,end:e+1,style:g}):d[d.length-1].end++),f=g||{}}else e+=g.length,f={}}return d},dw=(a,b)=>{if(!Array.isArray(a))return dn(a);let c=b.split(W),d={},e=-1,f=0;for(let b=0;b<c.length;b++){let g=dq(c[b]);for(let c=0;c<g.length;c++)e++,a[f]&&a[f].start<=e&&e<a[f].end&&(d[b]=d[b]||{},d[b][c]=x({},a[f].style),e===a[f].end-1&&f++)}return d},dx=["display","transform",ai,"fill-opacity","fill-rule","opacity",aj,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function dy(a,b){let c,d=a.nodeName,e=a.getAttribute("class"),f=a.getAttribute("id"),g="(?![a-zA-Z\\-]+)";if(c=RegExp("^"+d,"i"),b=b.replace(c,""),f&&b.length&&(c=RegExp("#"+f+g,"i"),b=b.replace(c,"")),e&&b.length){let a=e.split(" ");for(let d=a.length;d--;)c=RegExp("\\."+a[d]+g,"i"),b=b.replace(c,"")}return 0===b.length}let dz=a=>{var b;return null!=(b=b2[a])?b:a},dA=RegExp("(".concat(b_,")"),"gi"),dB="(".concat(b_,")"),dC=String.raw(i||(i=z(["(skewX)(",")"],["(skewX)\\(","\\)"])),dB),dD=String.raw(j||(j=z(["(skewY)(",")"],["(skewY)\\(","\\)"])),dB),dE=String.raw(k||(k=z(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),dB,dB,dB),dF=String.raw(l||(l=z(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),dB,dB),dG=String.raw(m||(m=z(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),dB,dB),dH=String.raw(n||(n=z(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),dB,dB,dB,dB,dB,dB),dI="(?:".concat(dH,"|").concat(dG,"|").concat(dE,"|").concat(dF,"|").concat(dC,"|").concat(dD,")"),dJ=new RegExp(String.raw(o||(o=z(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),"(?:".concat(dI,"*)"))),dK=new RegExp(dI),dL=RegExp(dI,"g");function dM(a){let b=[];if(!(a=a.replace(dA," $1 ").replace(/,/gi," ").replace(/\s+/g," ").replace(/\s*([()])\s*/gi,"$1"))||a&&!dJ.test(a))return[...Q];for(let c of a.matchAll(dL)){let a=dK.exec(c[0]);if(!a)continue;let d=Q,[,e,...f]=a.filter(a=>!!a),[g,h,i,j,k,l]=f.map(a=>parseFloat(a));switch(e){case"translate":d=aP(g,h);break;case $:d=aQ({angle:g},{x:h,y:i});break;case ad:d=aR(g,h);break;case ag:d=aT(g);break;case ah:d=aU(g);break;case"matrix":d=[g,h,i,j,k,l]}b.push(d)}return aM(b)}let dN={stroke:"strokeOpacity",fill:"fillOpacity"};function dO(a,b,c){let d,e,f;if(!a)return{};let g,h={},i=16;a.parentNode&&b5.test(a.parentNode.nodeName)&&(h=dO(a.parentElement,b,c)).fontSize&&(g=i=bM(h.fontSize));let j=x(x(x({},b.reduce((b,c)=>{let d=a.getAttribute(c);return d&&(b[c]=d),b},{})),function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c={};for(let d in b)(function(a,b){let c=!0,d=dy(a,b.pop());return d&&b.length&&(c=function(a,b){let c,d=!0;for(;a.parentElement&&1===a.parentElement.nodeType&&b.length;)d&&(c=b.pop()),d=dy(a=a.parentElement,c);return 0===b.length}(a,b)),d&&c&&0===b.length})(a,d.split(" "))&&(c=x(x({},c),b[d]));return c}(a,c)),(d={},(e=a.getAttribute("style"))&&("string"==typeof e?e.replace(/;\s*$/,"").split(";").forEach(a=>{if(!a)return;let[b,c]=a.split(":");d[b.trim().toLowerCase()]=c.trim()}):Object.entries(e).forEach(a=>{let[b,c]=a;void 0!==c&&(d[b.toLowerCase()]=c)})),d));j[b4]&&a.setAttribute(b4,j[b4]),j[b3]&&(g=bM(j[b3],i),j[b3]="".concat(g));let k={};for(let a in j){let b=dz(a),c=function(a,b,c,d){let e=Array.isArray(b),f,g=b;if(a!==ai&&a!==aj||b!==V){if("strokeUniform"===a)return"non-scaling-stroke"===b;if("strokeDashArray"===a)g=b===V?null:b.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===a)g=c&&c.transformMatrix?aL(c.transformMatrix,dM(b)):dM(b);else if("visible"===a)g=b!==V&&"hidden"!==b,c&&!1===c.visible&&(g=!1);else if("opacity"===a)g=parseFloat(b),c&&void 0!==c.opacity&&(g*=c.opacity);else if("textAnchor"===a)g="start"===b?S:"end"===b?U:R;else if("charSpacing"===a||a===bR)f=bM(b,d)/d*1e3;else if("paintFirst"===a){let a=b.indexOf(ai),c=b.indexOf(aj);g=ai,(a>-1&&c>-1&&c<a||-1===a&&c>-1)&&(g=aj)}else{if("href"===a||"xlink:href"===a||"font"===a||"id"===a)return b;if("imageSmoothing"===a)return"optimizeQuality"===b;f=e?b.map(bM):bM(b,d)}}else g="";return!e&&isNaN(f)?g:f}(b,j[a],h,g);k[b]=c}k&&k.font&&function(a,b){let c=a.match(b1);if(!c)return;let d=c[1],e=c[3],f=c[4],g=c[5],h=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),f&&(b.fontSize=bM(f)),h&&(b.fontFamily=h),g&&(b.lineHeight="normal"===g?1:g)}(k.font,k);let l=x(x({},h),k);return b5.test(a.nodeName)||(f=dg.getDefaults(),Object.entries(dN).forEach(a=>{let[b,c]=a;if(void 0===l[c]||""===l[b])return;if(void 0===l[b]){if(!f[b])return;l[b]=f[b]}if(0===l[b].indexOf("url("))return;let d=new bL(l[b]);l[b]=d.setAlpha(a0(d.getAlpha()*l[c],2)).toRgba()})),l}let dP=["left","top","width","height","visible"],dQ=["rx","ry"];class dR extends dg{static getDefaults(){return x(x({},super.getDefaults()),dR.ownDefaults)}constructor(a){super(),Object.assign(this,dR.ownDefaults),this.setOptions(a),this._initRxRy()}_initRxRy(){let{rx:a,ry:b}=this;a&&!b?this.ry=a:b&&!a&&(this.rx=b)}_render(a){let{width:b,height:c}=this,d=-b/2,e=-c/2,f=this.rx?Math.min(this.rx,b/2):0,g=this.ry?Math.min(this.ry,c/2):0,h=0!==f||0!==g;a.beginPath(),a.moveTo(d+f,e),a.lineTo(d+b-f,e),h&&a.bezierCurveTo(d+b-.4477152502*f,e,d+b,e+.4477152502*g,d+b,e+g),a.lineTo(d+b,e+c-g),h&&a.bezierCurveTo(d+b,e+c-.4477152502*g,d+b-.4477152502*f,e+c,d+b-f,e+c),a.lineTo(d+f,e+c),h&&a.bezierCurveTo(d+.4477152502*f,e+c,d,e+c-.4477152502*g,d,e+c-g),a.lineTo(d,e+g),h&&a.bezierCurveTo(d,e+.4477152502*g,d+.4477152502*f,e,d+f,e),a.closePath(),this._renderPaintInOrder(a)}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...dQ,...a])}_toSVG(){let{width:a,height:b,rx:c,ry:d}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-a/2,'" y="').concat(-b/2,'" rx="').concat(c,'" ry="').concat(d,'" width="').concat(a,'" height="').concat(b,'" />\n')]}static async fromElement(a,b,c){let d=dO(a,this.ATTRIBUTE_NAMES,c),{left:e=0,top:f=0,width:g=0,height:h=0,visible:i=!0}=d,j=y(d,dP);return new this(x(x(x({},b),j),{},{left:e,top:f,width:g,height:h,visible:!!(i&&g&&h)}))}}v(dR,"type","Rect"),v(dR,"cacheProperties",[...cn,...dQ]),v(dR,"ownDefaults",{rx:0,ry:0}),v(dR,"ATTRIBUTE_NAMES",[...dx,"x","y","rx","ry","width","height"]),am.setClass(dR),am.setSVGClass(dR);let dS="initialization",dT="added",dU="removed",dV="imperative",dW=(a,b)=>{let{strokeUniform:c,strokeWidth:d,width:e,height:f,group:g}=b,h=g&&g!==a?br(g.calcTransformMatrix(),a.calcTransformMatrix()):null,i=h?b.getRelativeCenterPoint().transform(h):b.getRelativeCenterPoint(),j=!b.isStrokeAccountedForInDimensions(),k=c&&j?bt(new as(d,d),void 0,a.calcTransformMatrix()):at,l=!c&&j?d:0,m=bq(e+l,f+l,aM([h,b.calcOwnMatrix()],!0)).add(k).scalarDivide(2);return[i.subtract(m),i.add(m)]};class dX{calcLayoutResult(a,b){if(this.shouldPerformLayout(a))return this.calcBoundingBox(b,a)}shouldPerformLayout(a){let{type:b,prevStrategy:c,strategy:d}=a;return b===dS||b===dV||!!c&&d!==c}shouldLayoutClipPath(a){let{type:b,target:{clipPath:c}}=a;return b!==dS&&c&&!c.absolutePositioned}getInitialSize(a,b){return b.size}calcBoundingBox(a,b){let{type:c,target:d}=b;if(c===dV&&b.overrides)return b.overrides;if(0===a.length)return;let{left:e,top:f,width:g,height:h}=bk(a.map(a=>dW(d,a)).reduce((a,b)=>a.concat(b),[])),i=new as(g,h),j=new as(e,f).add(i.scalarDivide(2));if(c===dS){let a=this.getInitialSize(b,{size:i,center:j});return{center:j,relativeCorrection:new as(0,0),size:a}}return{center:j.transform(d.calcOwnMatrix()),size:i}}}v(dX,"type","strategy");class dY extends dX{shouldPerformLayout(a){return!0}}v(dY,"type","fit-content"),am.setClass(dY);let dZ=["strategy"],d$=["target","strategy","bubbles","prevStrategy"],d_="layoutManager";class d0{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dY;v(this,"strategy",void 0),this.strategy=a,this._subscriptions=new Map}performLayout(a){let b=x(x({bubbles:!0,strategy:this.strategy},a),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(b);let c=this.getLayoutResult(b);c&&this.commitLayout(b,c),this.onAfterLayout(b,c),this._prevLayoutStrategy=b.strategy}attachHandlers(a,b){let{target:c}=b;return[ak,X,aa,Z,Y,_,ac,ab,"modifyPath"].map(b=>a.on(b,a=>this.performLayout(b===ak?{type:"object_modified",trigger:b,e:a,target:c}:{type:"object_modifying",trigger:b,e:a,target:c})))}subscribe(a,b){this.unsubscribe(a,b);let c=this.attachHandlers(a,b);this._subscriptions.set(a,c)}unsubscribe(a,b){(this._subscriptions.get(a)||[]).forEach(a=>a()),this._subscriptions.delete(a)}unsubscribeTargets(a){a.targets.forEach(b=>this.unsubscribe(b,a))}subscribeTargets(a){a.targets.forEach(b=>this.subscribe(b,a))}onBeforeLayout(a){let{target:b,type:c}=a,{canvas:d}=b;if(c===dS||c===dT?this.subscribeTargets(a):c===dU&&this.unsubscribeTargets(a),b.fire("layout:before",{context:a}),d&&d.fire("object:layout:before",{target:b,context:a}),c===dV&&a.deep){let c=y(a,dZ);b.forEachObject(a=>a.layoutManager&&a.layoutManager.performLayout(x(x({},c),{},{bubbles:!1,target:a})))}}getLayoutResult(a){let{target:b,strategy:c,type:d}=a,e=c.calcLayoutResult(a,b.getObjects());if(!e)return;let f=d===dS?new as:b.getRelativeCenterPoint(),{center:g,correction:h=new as,relativeCorrection:i=new as}=e,j=f.subtract(g).add(h).transform(d===dS?Q:aK(b.calcOwnMatrix()),!0).add(i);return{result:e,prevCenter:f,nextCenter:g,offset:j}}commitLayout(a,b){var c,d;let{target:e}=a,{result:{size:f},nextCenter:g}=b;(e.set({width:f.x,height:f.y}),this.layoutObjects(a,b),a.type===dS)?e.set({left:null!=(c=a.x)?c:g.x+f.x*bx(e.originX),top:null!=(d=a.y)?d:g.y+f.y*bx(e.originY)}):(e.setPositionByOrigin(g,R,R),e.setCoords(),e.set("dirty",!0))}layoutObjects(a,b){let{target:c}=a;c.forEachObject(d=>{d.group===c&&this.layoutObject(a,b,d)}),a.strategy.shouldLayoutClipPath(a)&&this.layoutObject(a,b,c.clipPath)}layoutObject(a,b,c){let{offset:d}=b;c.set({left:c.left+d.x,top:c.top+d.y})}onAfterLayout(a,b){let{target:c,strategy:d,bubbles:e,prevStrategy:f}=a,g=y(a,d$),{canvas:h}=c;c.fire("layout:after",{context:a,result:b}),h&&h.fire("object:layout:after",{context:a,result:b,target:c});let i=c.parent;e&&null!=i&&i.layoutManager&&((g.path||(g.path=[])).push(c),i.layoutManager.performLayout(x(x({},g),{},{target:i}))),c.set("dirty",!0)}dispose(){let{_subscriptions:a}=this;a.forEach(a=>a.forEach(a=>a())),a.clear()}toObject(){return{type:d_,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}am.setClass(d0,d_);let d1=["type","objects","layoutManager"];class d2 extends d0{performLayout(){}}class d3 extends av(dg){static getDefaults(){return x(x({},super.getDefaults()),d3.ownDefaults)}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),v(this,"_activeObjects",[]),v(this,"__objectSelectionTracker",void 0),v(this,"__objectSelectionDisposer",void 0),Object.assign(this,d3.ownDefaults),this.setOptions(b),this.groupInit(a,b)}groupInit(a,b){var c;this._objects=[...a],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(a=>{this.enterGroup(a,!1)}),this.layoutManager=null!=(c=b.layoutManager)?c:new d0,this.layoutManager.performLayout({type:dS,target:this,targets:[...a],x:b.left,y:b.top})}canEnterGroup(a){return a===this||this.isDescendantOf(a)?(C("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(a)||(C("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(a){return a.filter((a,b,c)=>this.canEnterGroup(a)&&c.indexOf(a)===b)}add(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];let d=this._filterObjectsBeforeEnteringGroup(b),e=super.add(...d);return this._onAfterObjectsChange(dT,d),e}insertAt(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];let e=this._filterObjectsBeforeEnteringGroup(c),f=super.insertAt(a,...e);return this._onAfterObjectsChange(dT,e),f}remove(){let a=super.remove(...arguments);return this._onAfterObjectsChange(dU,a),a}_onObjectAdded(a){this.enterGroup(a,!0),this.fire("object:added",{target:a}),a.fire("added",{target:this})}_onObjectRemoved(a,b){this.exitGroup(a,b),this.fire("object:removed",{target:a}),a.fire("removed",{target:this})}_onAfterObjectsChange(a,b){this.layoutManager.performLayout({type:a,targets:b,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(a,b){let c=this[a];return super._set(a,b),"canvas"===a&&c!==b&&(this._objects||[]).forEach(c=>{c._set(a,b)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(a,b){let{target:c}=b,d=this._activeObjects;if(a)d.push(c),this._set("dirty",!0);else if(d.length>0){let a=d.indexOf(c);a>-1&&(d.splice(a,1),this._set("dirty",!0))}}_watchObject(a,b){a&&this._watchObject(!1,b),a?(b.on("selected",this.__objectSelectionTracker),b.on("deselected",this.__objectSelectionDisposer)):(b.off("selected",this.__objectSelectionTracker),b.off("deselected",this.__objectSelectionDisposer))}enterGroup(a,b){a.group&&a.group.remove(a),a._set("parent",this),this._enterGroup(a,b)}_enterGroup(a,b){b&&bn(a,aL(aK(this.calcTransformMatrix()),a.calcTransformMatrix())),this._shouldSetNestedCoords()&&a.setCoords(),a._set("group",this),a._set("canvas",this.canvas),this._watchObject(!0,a);let c=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();c&&(c===a||a.isDescendantOf(c))&&this._activeObjects.push(a)}exitGroup(a,b){this._exitGroup(a,b),a._set("parent",void 0),a._set("canvas",void 0)}_exitGroup(a,b){a._set("group",void 0),b||(bn(a,aL(this.calcTransformMatrix(),a.calcTransformMatrix())),a.setCoords()),this._watchObject(!1,a);let c=this._activeObjects.length>0?this._activeObjects.indexOf(a):-1;c>-1&&this._activeObjects.splice(c,1)}shouldCache(){let a=dg.prototype.shouldCache.call(this);if(a){for(let a=0;a<this._objects.length;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return a}willDrawShadow(){if(super.willDrawShadow())return!0;for(let a=0;a<this._objects.length;a++)if(this._objects[a].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(a,b,c){this._renderBackground(a);for(let b=0;b<this._objects.length;b++){var d;let c=this._objects[b];null!=(d=this.canvas)&&d.preserveObjectStacking&&c.group!==this?(a.save(),a.transform(...aK(this.calcTransformMatrix())),c.render(a),a.restore()):c.group===this&&c.render(a)}this._drawClipPath(a,this.clipPath,c)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(a=>a.setCoords())}triggerLayout(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(x({target:this,type:dV},a))}render(a){this._transformDone=!0,super.render(a),this._transformDone=!1}__serializeObjects(a,b){let c=this.includeDefaultValues;return this._objects.filter(function(a){return!a.excludeFromExport}).map(function(d){let e=d.includeDefaultValues;d.includeDefaultValues=c;let f=d[a||"toObject"](b);return d.includeDefaultValues=e,f})}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=this.layoutManager.toObject();return x(x(x({},super.toObject(["subTargetCheck","interactive",...a])),"fit-content"!==b.strategy||this.includeDefaultValues?{layoutManager:b}:{}),{},{objects:this.__serializeObjects("toObject",a)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(a=>{this._watchObject(!1,a),a.dispose()}),super.dispose()}_createSVGBgRect(a){if(!this.backgroundColor)return"";let b=dR.prototype._toSVG.call(this),c=b.indexOf("COMMON_PARTS");b[c]='for="group" ';let d=b.join("");return a?a(d):d}_toSVG(a){let b=["<g ","COMMON_PARTS"," >\n"],c=this._createSVGBgRect(a);c&&b.push("		",c);for(let c=0;c<this._objects.length;c++)b.push("		",this._objects[c].toSVG(a));return b.push("</g>\n"),b}getSvgStyles(){let a=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",b=this.visible?"":" visibility: hidden;";return[a,this.getSvgFilter(),b].join("")}toClipPathSVG(a){let b=[],c=this._createSVGBgRect(a);c&&b.push("	",c);for(let c=0;c<this._objects.length;c++)b.push("	",this._objects[c].toClipPathSVG(a));return this._createBaseClipPathSVGMarkup(b,{reviver:a})}static fromObject(a,b){let{type:c,objects:d=[],layoutManager:e}=a,f=y(a,d1);return Promise.all([aY(d,b),aZ(f,b)]).then(a=>{let[b,c]=a,d=new this(b,x(x(x({},f),c),{},{layoutManager:new d2}));return e?d.layoutManager=new(am.getClass(e.type))(new(am.getClass(e.strategy))):d.layoutManager=new d0,d.layoutManager.subscribeTargets({type:dS,target:d,targets:d.getObjects()}),d.setCoords(),d})}}v(d3,"type","Group"),v(d3,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),am.setClass(d3);let d4=(a,b)=>Math.min(b.width/a.width,b.height/a.height),d5=(a,b)=>Math.max(b.width/a.width,b.height/a.height),d6="\\s*,?\\s*",d7="".concat(d6,"(").concat(b_,")"),d8="".concat(d7).concat(d7).concat(d7).concat(d6,"([01])").concat(d6,"([01])").concat(d7).concat(d7),d9={m:"l",M:"L"},ea=(a,b,c,d,e,f,g,h,i,j,k)=>{let l=aq(a),m=ar(a),n=aq(b),o=ar(b),p=c*e*n-d*f*o+g,q=d*e*n+c*f*o+h;return["C",j+i*(-c*e*m-d*f*l),k+i*(-d*e*m+c*f*l),p+i*(c*e*o+d*f*n),q+i*(d*e*o-c*f*n),p,q]},eb=(a,b,c,d)=>{let e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)};function ec(a,b,c,d,e,f,g,h){let i;if(B.cachesBoundsOfCurve&&(i=[...arguments].join(),K.boundsOfCurveCache[i]))return K.boundsOfCurveCache[i];let j=Math.sqrt,k=Math.abs,l=[],m=[[0,0],[0,0]],n=6*a-12*c+6*e,o=-3*a+9*c-9*e+3*g,p=3*c-3*a;for(let a=0;a<2;++a){if(a>0&&(n=6*b-12*d+6*f,o=-3*b+9*d-9*f+3*h,p=3*d-3*b),1e-12>k(o)){if(1e-12>k(n))continue;let a=-p/n;0<a&&a<1&&l.push(a);continue}let c=n*n-4*p*o;if(c<0)continue;let e=j(c),g=(-n+e)/(2*o);0<g&&g<1&&l.push(g);let i=(-n-e)/(2*o);0<i&&i<1&&l.push(i)}let q=l.length,r=q,s=eg(a,b,c,d,e,f,g,h);for(;q--;){let{x:a,y:b}=s(l[q]);m[0][q]=a,m[1][q]=b}m[0][r]=a,m[1][r]=b,m[0][r+1]=g,m[1][r+1]=h;let t=[new as(Math.min(...m[0]),Math.min(...m[1])),new as(Math.max(...m[0]),Math.max(...m[1]))];return B.cachesBoundsOfCurve&&(K.boundsOfCurveCache[i]=t),t}let ed=(a,b,c)=>{let[d,e,f,g,h,i,j,k]=c,l=((a,b,c,d,e,f,g)=>{if(0===c||0===d)return[];let h=0,i=0,j=0,k=Math.PI,l=g*P,m=ar(l),n=aq(l),o=.5*(-n*a-m*b),p=.5*(-n*b+m*a),q=c**2,r=d**2,s=p**2,t=o**2,u=q*r-q*s-r*t,v=Math.abs(c),w=Math.abs(d);if(u<0){let a=Math.sqrt(1-u/(q*r));v*=a,w*=a}else j=(e===f?-1:1)*Math.sqrt(u/(q*s+r*t));let x=j*v*p/w,y=-j*w*o/v,z=n*x-m*y+.5*a,A=m*x+n*y+.5*b,B=eb(1,0,(o-x)/v,(p-y)/w),C=eb((o-x)/v,(p-y)/w,(-o-x)/v,(-p-y)/w);0===f&&C>0?C-=2*k:1===f&&C<0&&(C+=2*k);let D=Math.ceil(Math.abs(C/k*2)),E=[],F=C/D,G=8/3*Math.sin(F/4)*Math.sin(F/4)/Math.sin(F/2),H=B+F;for(let a=0;a<D;a++)E[a]=ea(B,H,n,m,v,w,z,A,G,h,i),h=E[a][5],i=E[a][6],B=H,H+=F;return E})(j-a,k-b,e,f,h,i,g);for(let c=0,d=l.length;c<d;c++)l[c][1]+=a,l[c][2]+=b,l[c][3]+=a,l[c][4]+=b,l[c][5]+=a,l[c][6]+=b;return l},ee=a=>{let b=0,c=0,d=0,e=0,f=[],g,h=0,i=0;for(let j of a){let a,k=[...j];switch(k[0]){case"l":k[1]+=b,k[2]+=c;case"L":a=["L",b=k[1],c=k[2]];break;case"h":k[1]+=b;case"H":a=["L",b=k[1],c];break;case"v":k[1]+=c;case"V":a=["L",b,c=k[1]];break;case"m":k[1]+=b,k[2]+=c;case"M":b=k[1],c=k[2],d=k[1],e=k[2],a=["M",b,c];break;case"c":k[1]+=b,k[2]+=c,k[3]+=b,k[4]+=c,k[5]+=b,k[6]+=c;case"C":h=k[3],i=k[4],b=k[5],c=k[6],a=["C",k[1],k[2],h,i,b,c];break;case"s":k[1]+=b,k[2]+=c,k[3]+=b,k[4]+=c;case"S":"C"===g?(h=2*b-h,i=2*c-i):(h=b,i=c),b=k[3],c=k[4],h=(a=["C",h,i,k[1],k[2],b,c])[3],i=a[4];break;case"q":k[1]+=b,k[2]+=c,k[3]+=b,k[4]+=c;case"Q":h=k[1],i=k[2],a=["Q",h,i,b=k[3],c=k[4]];break;case"t":k[1]+=b,k[2]+=c;case"T":"Q"===g?(h=2*b-h,i=2*c-i):(h=b,i=c),a=["Q",h,i,b=k[1],c=k[2]];break;case"a":k[6]+=b,k[7]+=c;case"A":ed(b,c,k).forEach(a=>f.push(a)),b=k[6],c=k[7];break;case"z":case"Z":b=d,c=e,a=["Z"]}a?(f.push(a),g=a[0]):g=""}return f},ef=(a,b,c,d)=>Math.sqrt((c-a)**2+(d-b)**2),eg=(a,b,c,d,e,f,g,h)=>i=>{let j=i**3,k=3*i**2*(1-i),l=3*i*(1-i)**2,m=(1-i)**3;return new as(g*j+e*k+c*l+a*m,h*j+f*k+d*l+b*m)},eh=a=>2*a*(1-a),ei=(a,b,c,d,e,f,g,h)=>i=>{let j=i**2,k=eh(i),l=(1-i)**2;return Math.atan2(3*(l*(d-b)+k*(f-d)+j*(h-f)),3*(l*(c-a)+k*(e-c)+j*(g-e)))},ej=(a,b,c,d,e,f)=>g=>{let h=g**2,i=eh(g),j=(1-g)**2;return new as(e*h+c*i+a*j,f*h+d*i+b*j)},ek=(a,b,c,d,e,f)=>g=>{let h=1-g;return Math.atan2(2*(h*(d-b)+g*(f-d)),2*(h*(c-a)+g*(e-c)))},el=(a,b,c)=>{let d=new as(b,c),e=0;for(let b=1;b<=100;b+=1){let c=a(b/100);e+=ef(d.x,d.y,c.x,c.y),d=c}return e},em=a=>{let b,c,d=0,e=0,f=0,g=0,h=0,i=[];for(let j of a){let a={x:e,y:f,command:j[0],length:0};switch(j[0]){case"M":(c=a).x=g=e=j[1],c.y=h=f=j[2];break;case"L":(c=a).length=ef(e,f,j[1],j[2]),e=j[1],f=j[2];break;case"C":b=eg(e,f,j[1],j[2],j[3],j[4],j[5],j[6]),(c=a).iterator=b,c.angleFinder=ei(e,f,j[1],j[2],j[3],j[4],j[5],j[6]),c.length=el(b,e,f),e=j[5],f=j[6];break;case"Q":b=ej(e,f,j[1],j[2],j[3],j[4]),(c=a).iterator=b,c.angleFinder=ek(e,f,j[1],j[2],j[3],j[4]),c.length=el(b,e,f),e=j[3],f=j[4];break;case"Z":(c=a).destX=g,c.destY=h,c.length=ef(e,f,g,h),e=g,f=h}d+=c.length,i.push(c)}return i.push({length:d,x:e,y:f}),i},en=function(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:em(a),d=0;for(;b-c[d].length>0&&d<c.length-2;)b-=c[d].length,d++;let e=c[d],f=b/e.length,g=a[d];switch(e.command){case"M":return{x:e.x,y:e.y,angle:0};case"Z":return x(x({},new as(e.x,e.y).lerp(new as(e.destX,e.destY),f)),{},{angle:Math.atan2(e.destY-e.y,e.destX-e.x)});case"L":return x(x({},new as(e.x,e.y).lerp(new as(g[1],g[2]),f)),{},{angle:Math.atan2(g[2]-e.y,g[1]-e.x)});case"C":case"Q":return((a,b)=>{let c,d=0,e=0,f={x:a.x,y:a.y},g=x({},f),h=.01,i=0,j=a.iterator,k=a.angleFinder;for(;e<b&&h>1e-4;)g=j(d),i=d,(c=ef(f.x,f.y,g.x,g.y))+e>b?(d-=h,h/=2):(f=g,d+=h,e+=c);return x(x({},g),{},{angle:k(i)})})(e,b)}},eo=RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),ep=RegExp(d8,"g"),eq=RegExp(b_,"gi"),er={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},es=a=>{var b;let c=[];for(let d of null!=(b=a.match(eo))?b:[]){let a=d[0];if("z"===a||"Z"===a){c.push([a]);continue}let b=er[a.toLowerCase()],e=[];if("a"===a||"A"===a){ep.lastIndex=0;for(let a=null;a=ep.exec(d);)e.push(...a.slice(1))}else e=d.match(eq)||[];for(let d=0;d<e.length;d+=b){let f=Array(b),g=d9[a];f[0]=d>0&&g?g:a;for(let a=0;a<b;a++)f[a+1]=parseFloat(e[d+a]);c.push(f)}}return c},et=(a,b)=>a.map(a=>a.map((a,c)=>0===c||void 0===b?a:a0(a,b)).join(" ")).join(" ");function eu(a,b){let c=a.style;c&&b&&("string"==typeof b?c.cssText+=";"+b:Object.entries(b).forEach(a=>{let[b,d]=a;return c.setProperty(b,d)}))}Object.freeze({__proto__:null,addTransformToObject:bm,animate:cE,animateColor:cF,applyTransformToObject:bn,calcAngleBetweenVectors:cb,calcDimensionsMatrix:aV,calcPlaneChangeMatrix:br,calcVectorRotation:cc,cancelAnimFrame:ay,capValue:cl,composeMatrix:aW,copyCanvasElement:a=>{var b;let c=aD(a);return null==(b=c.getContext("2d"))||b.drawImage(a,0,0),c},cos:aq,createCanvasElement:aB,createImage:aC,createRotateMatrix:aQ,createScaleMatrix:aR,createSkewXMatrix:aT,createSkewYMatrix:aU,createTranslateMatrix:aP,createVector:b9,crossProduct:cf,degreesToRadians:aG,dotProduct:cg,ease:ct,enlivenObjectEnlivables:aZ,enlivenObjects:aY,findScaleToCover:d5,findScaleToFit:d4,getBoundsOfCurve:ec,getOrthonormalVector:ce,getPathSegmentsInfo:em,getPointOnPath:en,getPointer:bh,getRandomInt:(a,b)=>Math.floor(Math.random()*(b-a+1))+a,getRegularPolygonPath:(a,b)=>{let c=2*Math.PI/a,d=-N;a%2==0&&(d+=c/2);let e=Array(a+1);for(let f=0;f<a;f++){let a=f*c+d,{x:g,y:h}=new as(aq(a),ar(a)).scalarMultiply(b);e[f]=[0===f?"M":"L",g,h]}return e[a]=["Z"],e},getSmoothPathFromPoints:function(a){let b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=new as(a[0]),e=new as(a[1]),f=1,g=0,h=[],i=a.length,j=i>2;for(j&&(f=a[2].x<e.x?-1:+(a[2].x!==e.x),g=a[2].y<e.y?-1:+(a[2].y!==e.y)),h.push(["M",d.x-f*c,d.y-g*c]),b=1;b<i;b++){if(!d.eq(e)){let a=d.midPointFrom(e);h.push(["Q",d.x,d.y,a.x,a.y])}d=a[b],b+1<a.length&&(e=a[b+1])}return j&&(f=d.x>a[b-2].x?1:d.x===a[b-2].x?0:-1,g=d.y>a[b-2].y?1:d.y===a[b-2].y?0:-1),h.push(["L",d.x+f*c,d.y+g*c]),h},getSvgAttributes:a=>{let b=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":return b.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return b.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return b.concat(["offset","stop-color","stop-opacity"])}return b},getUnitVector:cd,groupSVGElements:(a,b)=>a&&1===a.length?a[0]:new d3(a,b),hasStyleChanged:du,invertTransform:aK,isBetweenVectors:ch,isIdentityMatrix:aI,isTouchEvent:bi,isTransparent:dh,joinPath:et,loadImage:aX,magnitude:ca,makeBoundingBoxFromPoints:bk,makePathSimpler:ee,matrixToSVG:a1,mergeClipPaths:(a,b)=>{var c;let d=a,e=b;d.inverted&&!e.inverted&&(d=b,e=a),bu(e,null==(c=e.group)?void 0:c.calcTransformMatrix(),d.calcTransformMatrix());let f=d.inverted&&e.inverted;return f&&(d.inverted=e.inverted=!1),new d3([d],{clipPath:e,inverted:f})},multiplyTransformMatrices:aL,multiplyTransformMatrixArray:aM,parsePath:es,parsePreserveAspectRatioAttribute:bN,parseUnit:bM,pick:a$,projectStrokeOnPoints:dm,qrDecompose:aO,radiansToDegrees:aH,removeFromArray:ap,removeTransformFromObject:(a,b)=>{let c=aL(aK(b),a.calcOwnMatrix());bn(a,c)},removeTransformMatrixForSvgParsing:(a,b)=>{let c=a._findCenterFromElement();a.transformMatrix&&((a=>{if(a.transformMatrix){let{scaleX:b,scaleY:c,angle:d,skewX:e}=aO(a.transformMatrix);a.flipX=!1,a.flipY=!1,a.set(ae,b),a.set(af,c),a.angle=d,a.skewX=e,a.skewY=0}})(a),c=c.transform(a.transformMatrix)),delete a.transformMatrix,b&&(a.scaleX*=b.scaleX,a.scaleY*=b.scaleY,a.cropX=b.cropX,a.cropY=b.cropY,c.x+=b.offsetLeft,c.y+=b.offsetTop,a.width=b.width,a.height=b.height),a.setPositionByOrigin(c,R,R)},request:function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.onComplete||M,d=new(I()).window.XMLHttpRequest,e=b.signal,f=function(){d.abort()},g=function(){e&&e.removeEventListener("abort",f),d.onerror=d.ontimeout=M};if(e&&e.aborted)throw new E("request");return e&&e.addEventListener("abort",f,{once:!0}),d.onreadystatechange=function(){4===d.readyState&&(g(),c(d),d.onreadystatechange=M)},d.onerror=d.ontimeout=g,d.open("get",a,!0),d.send(),d},requestAnimFrame:ax,resetObjectTransform:bo,rotatePoint:(a,b,c)=>a.rotate(c,b),rotateVector:b8,saveObjectTransform:bp,sendObjectToPlane:bu,sendPointToPlane:bs,sendVectorToPlane:bt,setStyle:eu,sin:ar,sizeAfterTransform:bq,string:dt,stylesFromArray:dw,stylesToArray:dv,toBlob:aF,toDataURL:aE,toFixed:a0,transformPath:(a,b,c)=>(c&&(b=aL(b,[1,0,0,1,-c.x,-c.y])),a.map(a=>{let c=[...a];for(let d=1;d<a.length-1;d+=2){let{x:e,y:f}=aJ({x:a[d],y:a[d+1]},b);c[d]=e,c[d+1]=f}return c})),transformPoint:aJ});class ev extends bc{constructor(a){let{allowTouchScrolling:b=!1,containerClass:c=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(a),v(this,"upper",void 0),v(this,"container",void 0);const{el:d}=this.lower,e=this.createUpperCanvas();this.upper={el:e,ctx:e.getContext("2d")},this.applyCanvasStyle(d,{allowTouchScrolling:b}),this.applyCanvasStyle(e,{allowTouchScrolling:b,styles:{position:"absolute",left:"0",top:"0"}});const f=this.createContainerElement();f.classList.add(c),d.parentNode&&d.parentNode.replaceChild(f,d),f.append(d,e),this.container=f}createUpperCanvas(){let{el:a}=this.lower,b=aB();return b.className=a.className,b.classList.remove("lower-canvas"),b.classList.add("upper-canvas"),b.setAttribute("data-fabric","top"),b.style.cssText=a.style.cssText,b.setAttribute("draggable","true"),b}createContainerElement(){let a=I().document.createElement("div");return a.setAttribute("data-fabric","wrapper"),eu(a,{position:"relative"}),bb(a),a}applyCanvasStyle(a,b){let{styles:c,allowTouchScrolling:d}=b;eu(a,x(x({},c),{},{"touch-action":d?"manipulation":V})),bb(a)}setDimensions(a,b){super.setDimensions(a,b);let{el:c,ctx:d}=this.upper;a9(c,d,a,b)}setCSSDimensions(a){super.setCSSDimensions(a),ba(this.upper.el,a),ba(this.container,a)}cleanupDOM(a){let b=this.container,{el:c}=this.lower,{el:d}=this.upper;super.cleanupDOM(a),b.removeChild(d),b.removeChild(c),b.parentNode&&b.parentNode.replaceChild(c,b)}dispose(){super.dispose(),I().dispose(this.upper.el),delete this.upper,delete this.container}}class ew extends bf{constructor(){super(...arguments),v(this,"targets",[]),v(this,"_hoveredTargets",[]),v(this,"_currentTransform",null),v(this,"_groupSelector",null),v(this,"contextTopDirty",!1)}static getDefaults(){return x(x({},super.getDefaults()),ew.ownDefaults)}get upperCanvasEl(){var a;return null==(a=this.elements.upper)?void 0:a.el}get contextTop(){var a;return null==(a=this.elements.upper)?void 0:a.ctx}get wrapperEl(){return this.elements.container}initElements(a){this.elements=new ev(a,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(a){this._objectsToRender=void 0,super._onObjectAdded(a)}_onObjectRemoved(a){this._objectsToRender=void 0,a===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[a]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[a]}),a.fire("deselected",{target:a})),a===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(a)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){let a=this._activeObject;return!this.preserveObjectStacking&&a?this._objects.filter(b=>!b.group&&b!==a).concat(a):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this._objectsToRender||(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(a){a.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0),a.restore()}renderTop(){let a=this.contextTop;this.clearContext(a),this.renderTopLayer(a),this.fire("after:render",{ctx:a})}setTargetFindTolerance(a){a=Math.round(a),this.targetFindTolerance=a;let b=this.getRetinaScaling(),c=Math.ceil((2*a+1)*b);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=c,this.pixelFindContext.scale(b,b)}isTargetTransparent(a,b,c){let d=this.targetFindTolerance,e=this.pixelFindContext;this.clearContext(e),e.save(),e.translate(-b+d,-c+d),e.transform(...this.viewportTransform);let f=a.selectionBackgroundColor;a.selectionBackgroundColor="",a.render(e),a.selectionBackgroundColor=f,e.restore();let g=Math.round(d*this.getRetinaScaling());return dh(e,g,g,g)}_isSelectionKeyPressed(a){let b=this.selectionKey;return!!b&&(Array.isArray(b)?!!b.find(b=>!!b&&!0===a[b]):a[b])}_shouldClearSelection(a,b){let c=this.getActiveObjects(),d=this._activeObject;return!!(!b||b&&d&&c.length>1&&-1===c.indexOf(b)&&d!==b&&!this._isSelectionKeyPressed(a)||b&&!b.evented||b&&!b.selectable&&d&&d!==b)}_shouldCenterTransform(a,b,c){let d;if(a)return b===ad||b===ae||b===af||b===aa?d=this.centeredScaling||a.centeredScaling:b===$&&(d=this.centeredRotation||a.centeredRotation),d?!c:c}_getOriginFromCorner(a,b){let c={x:a.originX,y:a.originY};return b&&(["ml","tl","bl"].includes(b)?c.x=U:["mr","tr","br"].includes(b)&&(c.x=S),["tl","mt","tr"].includes(b)?c.y=T:["bl","mb","br"].includes(b)&&(c.y="top")),c}_setupCurrentTransform(a,b,c){var d;let e=b.group?bs(this.getScenePoint(a),void 0,b.group.calcTransformMatrix()):this.getScenePoint(a),{key:f="",control:g}=b.getActiveControl()||{},h=c&&g?null==(d=g.getActionHandler(a,b,g))?void 0:d.bind(g):bE,i=((a,b,c,d)=>{if(!b||!a)return"drag";let e=d.controls[b];return e.getActionName(c,e,d)})(c,f,a,b),j=a[this.centeredKey],k=this._shouldCenterTransform(b,i,j)?{x:R,y:R}:this._getOriginFromCorner(b,f),l={target:b,action:i,actionHandler:h,actionPerformed:!1,corner:f,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,offsetX:e.x-b.left,offsetY:e.y-b.top,originX:k.x,originY:k.y,ex:e.x,ey:e.y,lastX:e.x,lastY:e.y,theta:aG(b.angle),width:b.width,height:b.height,shiftKey:a.shiftKey,altKey:j,original:x(x({},bp(b)),{},{originX:k.x,originY:k.y})};this._currentTransform=l,this.fire("before:transform",{e:a,transform:l})}setCursor(a){this.upperCanvasEl.style.cursor=a}_drawSelection(a){let{x:b,y:c,deltaX:d,deltaY:e}=this._groupSelector,f=new as(b,c).transform(this.viewportTransform),g=new as(b+d,c+e).transform(this.viewportTransform),h=this.selectionLineWidth/2,i=Math.min(f.x,g.x),j=Math.min(f.y,g.y),k=Math.max(f.x,g.x),l=Math.max(f.y,g.y);this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(i,j,k-i,l-j)),this.selectionLineWidth&&this.selectionBorderColor&&(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,i+=h,j+=h,k-=h,l-=h,dg.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(i,j,k-i,l-j))}findTarget(a){if(this.skipTargetFind)return;let b=this.getViewportPoint(a),c=this._activeObject,d=this.getActiveObjects();if(this.targets=[],c&&d.length>=1){if(c.findControl(b,bi(a))||d.length>1&&this.searchPossibleTargets([c],b))return c;if(c===this.searchPossibleTargets([c],b)){if(this.preserveObjectStacking){let d=this.targets;this.targets=[];let e=this.searchPossibleTargets(this._objects,b);return a[this.altSelectionKey]&&e&&e!==c?(this.targets=d,c):e}return c}}return this.searchPossibleTargets(this._objects,b)}_pointIsInObjectSelectionArea(a,b){let c=a.getCoords(),d=this.getZoom(),e=a.padding/d;if(e){let[a,b,d,f]=c,g=Math.atan2(b.y-a.y,b.x-a.x),h=aq(g)*e,i=ar(g)*e,j=h+i,k=h-i;c=[new as(a.x-k,a.y-j),new as(b.x+j,b.y-k),new as(d.x+k,d.y+j),new as(f.x-j,f.y+k)]}return cG.isPointInPolygon(b,c)}_checkTarget(a,b){return!(!(a&&a.visible&&a.evented&&this._pointIsInObjectSelectionArea(a,bs(b,void 0,this.viewportTransform)))||(this.perPixelTargetFind||a.perPixelTargetFind)&&!a.isEditing&&this.isTargetTransparent(a,b.x,b.y))||!1}_searchPossibleTargets(a,b){let c=a.length;for(;c--;){let d=a[c];if(this._checkTarget(d,b)){if(au(d)&&d.subTargetCheck){let a=this._searchPossibleTargets(d._objects,b);a&&this.targets.push(a)}return d}}}searchPossibleTargets(a,b){let c=this._searchPossibleTargets(a,b);if(c&&au(c)&&c.interactive&&this.targets[0]){let a=this.targets;for(let b=a.length-1;b>0;b--){let c=a[b];if(!au(c)||!c.interactive)return c}return a[0]}return c}getViewportPoint(a){return this._pointer?this._pointer:this.getPointer(a,!0)}getScenePoint(a){return this._absolutePointer?this._absolutePointer:this.getPointer(a)}getPointer(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=this.upperCanvasEl,d=c.getBoundingClientRect(),e=bh(a),f=d.width||0,g=d.height||0;f&&g||("top"in d&&T in d&&(g=Math.abs(d.top-d.bottom)),U in d&&S in d&&(f=Math.abs(d.right-d.left))),this.calcOffset(),e.x=e.x-this._offset.left,e.y=e.y-this._offset.top,b||(e=bs(e,void 0,this.viewportTransform));let h=this.getRetinaScaling();1!==h&&(e.x/=h,e.y/=h);let i=0===f||0===g?new as(1,1):new as(c.width/f,c.height/g);return e.multiply(i)}_setDimensionsImpl(a,b){this._resetTransformEventData(),super._setDimensionsImpl(a,b),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=aB(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){let a=this._activeObject;return a5(a)?a.getObjects():a?[a]:[]}_fireSelectionEvents(a,b){let c=!1,d=!1,e=this.getActiveObjects(),f=[],g=[];a.forEach(a=>{e.includes(a)||(c=!0,a.fire("deselected",{e:b,target:a}),g.push(a))}),e.forEach(d=>{a.includes(d)||(c=!0,d.fire("selected",{e:b,target:d}),f.push(d))}),a.length>0&&e.length>0?(d=!0,c&&this.fire("selection:updated",{e:b,selected:f,deselected:g})):e.length>0?(d=!0,this.fire("selection:created",{e:b,selected:f})):a.length>0&&(d=!0,this.fire("selection:cleared",{e:b,deselected:g})),d&&(this._objectsToRender=void 0)}setActiveObject(a,b){let c=this.getActiveObjects(),d=this._setActiveObject(a,b);return this._fireSelectionEvents(c,b),d}_setActiveObject(a,b){let c=this._activeObject;return c!==a&&!(!this._discardActiveObject(b,a)&&this._activeObject)&&!a.onSelect({e:b})&&(this._activeObject=a,a5(a)&&c!==a&&a.set("canvas",this),a.setCoords(),!0)}_discardActiveObject(a,b){let c=this._activeObject;return!!c&&!c.onDeselect({e:a,object:b})&&(this._currentTransform&&this._currentTransform.target===c&&this.endCurrentTransform(a),a5(c)&&c===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(a){let b=this.getActiveObjects(),c=this.getActiveObject();b.length&&this.fire("before:selection:cleared",{e:a,deselected:[c]});let d=this._discardActiveObject(a);return this._fireSelectionEvents(b,a),d}endCurrentTransform(a){let b=this._currentTransform;this._finalizeCurrentTransform(a),b&&b.target&&(b.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(a){let b=this._currentTransform,c=b.target,d={e:a,target:c,transform:b,action:b.action};c._scaling&&(c._scaling=!1),c.setCoords(),b.actionPerformed&&(this.fire("object:modified",d),c.fire(ak,d))}setViewportTransform(a){super.setViewportTransform(a);let b=this._activeObject;b&&b.setCoords()}destroy(){let a=this._activeObject;a5(a)&&(a.removeAll(),a.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(a){let b=this._activeObject;b&&b._renderControls(a)}_toObject(a,b,c){let d=this._realizeGroupTransformOnObject(a),e=super._toObject(a,b,c);return a.set(d),e}_realizeGroupTransformOnObject(a){let{group:b}=a;if(b&&a5(b)&&this._activeObject===b){let c=a$(a,["angle","flipX","flipY",S,ae,af,ag,ah,"top"]);return bm(a,b.calcOwnMatrix()),c}return{}}_setSVGObject(a,b,c){let d=this._realizeGroupTransformOnObject(b);super._setSVGObject(a,b,c),b.set(d)}}v(ew,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class ex{constructor(a){v(this,"targets",[]),v(this,"__disposer",void 0);const b=()=>{let{hiddenTextarea:b}=a.getActiveObject()||{};b&&b.focus()},c=a.upperCanvasEl;c.addEventListener("click",b),this.__disposer=()=>c.removeEventListener("click",b)}exitTextEditing(){this.target=void 0,this.targets.forEach(a=>{a.isEditing&&a.exitEditing()})}add(a){this.targets.push(a)}remove(a){this.unregister(a),ap(this.targets,a)}register(a){this.target=a}unregister(a){a===this.target&&(this.target=void 0)}onMouseMove(a){var b;(null==(b=this.target)?void 0:b.isEditing)&&this.target.updateSelectionOnMouseMove(a)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}let ey=["target","oldTarget","fireCanvas","e"],ez={passive:!1},eA=(a,b)=>{let c=a.getViewportPoint(b),d=a.getScenePoint(b);return{viewportPoint:c,scenePoint:d,pointer:c,absolutePointer:d}},eB=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return a.addEventListener(...c)},eC=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return a.removeEventListener(...c)},eD={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class eE extends ew{constructor(a){super(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),v(this,"_isClick",void 0),v(this,"textEditingManager",new ex(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(a=>{this[a]=this[a].bind(this)}),this.addOrRemove(eB,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(a,b){let c=this.upperCanvasEl,d=this._getEventPrefix();a(a8(c),"resize",this._onResize),a(c,d+"down",this._onMouseDown),a(c,"".concat(d,"move"),this._onMouseMove,ez),a(c,"".concat(d,"out"),this._onMouseOut),a(c,"".concat(d,"enter"),this._onMouseEnter),a(c,"wheel",this._onMouseWheel,{passive:!1}),a(c,"contextmenu",this._onContextMenu),a(c,"click",this._onClick),a(c,"dblclick",this._onClick),a(c,"dragstart",this._onDragStart),a(c,"dragend",this._onDragEnd),a(c,"dragover",this._onDragOver),a(c,"dragenter",this._onDragEnter),a(c,"dragleave",this._onDragLeave),a(c,"drop",this._onDrop),this.enablePointerEvents||a(c,"touchstart",this._onTouchStart,ez)}removeListeners(){this.addOrRemove(eC,"remove");let a=this._getEventPrefix(),b=a7(this.upperCanvasEl);eC(b,"".concat(a,"up"),this._onMouseUp),eC(b,"touchend",this._onTouchEnd,ez),eC(b,"".concat(a,"move"),this._onMouseMove,ez),eC(b,"touchmove",this._onMouseMove,ez),clearTimeout(this._willAddMouseDown)}_onMouseWheel(a){this.__onMouseWheel(a)}_onMouseOut(a){let b=this._hoveredTarget,c=x({e:a},eA(this,a));this.fire("mouse:out",x(x({},c),{},{target:b})),this._hoveredTarget=void 0,b&&b.fire("mouseout",x({},c)),this._hoveredTargets.forEach(a=>{this.fire("mouse:out",x(x({},c),{},{target:a})),a&&a.fire("mouseout",x({},c))}),this._hoveredTargets=[]}_onMouseEnter(a){this._currentTransform||this.findTarget(a)||(this.fire("mouse:over",x({e:a},eA(this,a))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(a){this._isClick=!1;let b=this.getActiveObject();if(b&&b.onDragStart(a)){this._dragSource=b;let c={e:a,target:b};return this.fire("dragstart",c),b.fire("dragstart",c),void eB(this.upperCanvasEl,"drag",this._onDragProgress)}bj(a)}_renderDragEffects(a,b,c){let d=!1,e=this._dropTarget;e&&e!==b&&e!==c&&(e.clearContextTop(),d=!0),null==b||b.clearContextTop(),c!==b&&(null==c||c.clearContextTop());let f=this.contextTop;f.save(),f.transform(...this.viewportTransform),b&&(f.save(),b.transform(f),b.renderDragSourceEffect(a),f.restore(),d=!0),c&&(f.save(),c.transform(f),c.renderDropTargetEffect(a),f.restore(),d=!0),f.restore(),d&&(this.contextTopDirty=!0)}_onDragEnd(a){let b=!!a.dataTransfer&&a.dataTransfer.dropEffect!==V,c=b?this._activeObject:void 0,d={e:a,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:b,dropTarget:c};eC(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",d),this._dragSource&&this._dragSource.fire("dragend",d),delete this._dragSource,this._onMouseUp(a)}_onDragProgress(a){let b={e:a,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",b),this._dragSource&&this._dragSource.fire("drag",b)}findDragTargets(a){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(a)),targets:[...this.targets]}}_onDragOver(a){let b,c="dragover",{target:d,targets:e}=this.findDragTargets(a),f=this._dragSource,g={e:a,target:d,subTargets:e,dragSource:f,canDrop:!1,dropTarget:void 0};this.fire(c,g),this._fireEnterLeaveEvents(d,g),d&&(d.canDrop(a)&&(b=d),d.fire(c,g));for(let d=0;d<e.length;d++){let f=e[d];f.canDrop(a)&&(b=f),f.fire(c,g)}this._renderDragEffects(a,f,b),this._dropTarget=b}_onDragEnter(a){let{target:b,targets:c}=this.findDragTargets(a),d={e:a,target:b,subTargets:c,dragSource:this._dragSource};this.fire("dragenter",d),this._fireEnterLeaveEvents(b,d)}_onDragLeave(a){let b={e:a,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",b),this._fireEnterLeaveEvents(void 0,b),this._renderDragEffects(a,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(a){let{target:b,targets:c}=this.findDragTargets(a),d=this._basicEventHandler("drop:before",x({e:a,target:b,subTargets:c,dragSource:this._dragSource},eA(this,a)));d.didDrop=!1,d.dropTarget=void 0,this._basicEventHandler("drop",d),this.fire("drop:after",d)}_onContextMenu(a){let b=this.findTarget(a),c=this.targets||[],d=this._basicEventHandler("contextmenu:before",{e:a,target:b,subTargets:c});return this.stopContextMenu&&bj(a),this._basicEventHandler("contextmenu",d),!1}_onClick(a){let b=a.detail;b>3||b<2||(this._cacheTransformEventData(a),2==b&&"dblclick"===a.type&&this._handleEvent(a,"dblclick"),3==b&&this._handleEvent(a,"tripleclick"),this._resetTransformEventData())}getPointerId(a){let b=a.changedTouches;return b?b[0]&&b[0].identifier:this.enablePointerEvents?a.pointerId:-1}_isMainEvent(a){return!0===a.isPrimary||!1!==a.isPrimary&&("touchend"===a.type&&0===a.touches.length||!a.changedTouches||a.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(a){let b=!this.allowTouchScrolling,c=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),(this.isDrawingMode||c&&this._target===c)&&(b=!0),b&&a.preventDefault(),this._resetTransformEventData();let d=this.upperCanvasEl,e=this._getEventPrefix(),f=a7(d);eB(f,"touchend",this._onTouchEnd,ez),b&&eB(f,"touchmove",this._onMouseMove,ez),eC(d,"".concat(e,"down"),this._onMouseDown)}_onMouseDown(a){this.__onMouseDown(a),this._resetTransformEventData();let b=this.upperCanvasEl,c=this._getEventPrefix();eC(b,"".concat(c,"move"),this._onMouseMove,ez);let d=a7(b);eB(d,"".concat(c,"up"),this._onMouseUp),eB(d,"".concat(c,"move"),this._onMouseMove,ez)}_onTouchEnd(a){if(a.touches.length>0)return;this.__onMouseUp(a),this._resetTransformEventData(),delete this.mainTouchId;let b=this._getEventPrefix(),c=a7(this.upperCanvasEl);eC(c,"touchend",this._onTouchEnd,ez),eC(c,"touchmove",this._onMouseMove,ez),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{eB(this.upperCanvasEl,"".concat(b,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(a){this.__onMouseUp(a),this._resetTransformEventData();let b=this.upperCanvasEl,c=this._getEventPrefix();if(this._isMainEvent(a)){let a=a7(this.upperCanvasEl);eC(a,"".concat(c,"up"),this._onMouseUp),eC(a,"".concat(c,"move"),this._onMouseMove,ez),eB(b,"".concat(c,"move"),this._onMouseMove,ez)}}_onMouseMove(a){let b=this.getActiveObject();this.allowTouchScrolling||b&&b.shouldStartDragging(a)||!a.preventDefault||a.preventDefault(),this.__onMouseMove(a)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(a){let b=this.getActiveObject();return!!b!=!!a||b&&a&&b!==a}__onMouseUp(a){var b;this._cacheTransformEventData(a),this._handleEvent(a,"up:before");let c=this._currentTransform,d=this._isClick,e=this._target,{button:f}=a;if(f)return(this.fireMiddleClick&&1===f||this.fireRightClick&&2===f)&&this._handleEvent(a,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);if(!this._isMainEvent(a))return;let g,h,i=!1;if(c&&(this._finalizeCurrentTransform(a),i=c.actionPerformed),!d){let b=e===this._activeObject;this.handleSelection(a),i||(i=this._shouldRender(e)||!b&&e===this._activeObject)}if(e){let{key:b,control:d}=e.findControl(this.getViewportPoint(a),bi(a))||{};if(h=b,e.selectable&&e!==this._activeObject&&"up"===e.activeOn)this.setActiveObject(e,a),i=!0;else if(d){let b=d.getMouseUpHandler(a,e,d);b&&(g=this.getScenePoint(a),b.call(d,a,c,g.x,g.y))}e.isMoving=!1}if(c&&(c.target!==e||c.corner!==h)){let b=c.target&&c.target.controls[c.corner],d=b&&b.getMouseUpHandler(a,c.target,b);g=g||this.getScenePoint(a),d&&d.call(b,a,c,g.x,g.y)}this._setCursorFromEvent(a,e),this._handleEvent(a,"up"),this._groupSelector=null,this._currentTransform=null,e&&(e.__corner=void 0),i?this.requestRenderAll():d||null!=(b=this._activeObject)&&b.isEditing||this.renderTop()}_basicEventHandler(a,b){let{target:c,subTargets:d=[]}=b;this.fire(a,b),c&&c.fire(a,b);for(let e=0;e<d.length;e++)d[e]!==c&&d[e].fire(a,b);return b}_handleEvent(a,b,c){let d=this._target,e=this.targets||[],f=x(x(x({e:a,target:d,subTargets:e},eA(this,a)),{},{transform:this._currentTransform},"up:before"===b||"up"===b?{isClick:this._isClick,currentTarget:this.findTarget(a),currentSubTargets:this.targets}:{}),"down:before"===b||"down"===b?c:{});this.fire("mouse:".concat(b),f),d&&d.fire("mouse".concat(b),f);for(let a=0;a<e.length;a++)e[a]!==d&&e[a].fire("mouse".concat(b),f)}_onMouseDownInDrawingMode(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(a),this.requestRenderAll());let b=this.getScenePoint(a);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(b,{e:a,pointer:b}),this._handleEvent(a,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(a){if(this._isCurrentlyDrawing){let b=this.getScenePoint(a);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(b,{e:a,pointer:b})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")}_onMouseUpInDrawingMode(a){let b=this.getScenePoint(a);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:a,pointer:b}):this._isCurrentlyDrawing=!1,this._handleEvent(a,"up")}__onMouseDown(a){this._isClick=!0,this._cacheTransformEventData(a),this._handleEvent(a,"down:before");let b=this._target,c=!!b&&b===this._activeObject,{button:d}=a;if(d)return(this.fireMiddleClick&&1===d||this.fireRightClick&&2===d)&&this._handleEvent(a,"down",{alreadySelected:c}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);if(!this._isMainEvent(a)||this._currentTransform)return;let e=this._shouldRender(b),f=!1;if(this.handleMultiSelection(a,b)?(b=this._activeObject,f=!0,e=!0):this._shouldClearSelection(a,b)&&this.discardActiveObject(a),this.selection&&(!b||!b.selectable&&!b.isEditing&&b!==this._activeObject)){let b=this.getScenePoint(a);this._groupSelector={x:b.x,y:b.y,deltaY:0,deltaX:0}}if(c=!!b&&b===this._activeObject,b){b.selectable&&"down"===b.activeOn&&this.setActiveObject(b,a);let d=b.findControl(this.getViewportPoint(a),bi(a));if(b===this._activeObject&&(d||!f)){this._setupCurrentTransform(a,b,c);let e=d?d.control:void 0,f=this.getScenePoint(a),g=e&&e.getMouseDownHandler(a,b,e);g&&g.call(e,a,this._currentTransform,f.x,f.y)}}e&&(this._objectsToRender=void 0),this._handleEvent(a,"down",{alreadySelected:c}),e&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(a){this._resetTransformEventData(),this._pointer=this.getViewportPoint(a),this._absolutePointer=bs(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)}__onMouseMove(a){if(this._isClick=!1,this._cacheTransformEventData(a),this._handleEvent(a,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);if(!this._isMainEvent(a))return;let b=this._groupSelector;if(b){let c=this.getScenePoint(a);b.deltaX=c.x-b.x,b.deltaY=c.y-b.y,this.renderTop()}else if(this._currentTransform)this._transformObject(a);else{let b=this.findTarget(a);this._setCursorFromEvent(a,b),this._fireOverOutEvents(a,b)}this.textEditingManager.onMouseMove(a),this._handleEvent(a,"move"),this._resetTransformEventData()}_fireOverOutEvents(a,b){let c=this._hoveredTarget,d=this._hoveredTargets,e=this.targets,f=Math.max(d.length,e.length);this.fireSyntheticInOutEvents("mouse",{e:a,target:b,oldTarget:c,fireCanvas:!0});for(let g=0;g<f;g++)e[g]===b||d[g]&&d[g]===c||this.fireSyntheticInOutEvents("mouse",{e:a,target:e[g],oldTarget:d[g]});this._hoveredTarget=b,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(a,b){let c=this._draggedoverTarget,d=this._hoveredTargets,e=this.targets,f=Math.max(d.length,e.length);this.fireSyntheticInOutEvents("drag",x(x({},b),{},{target:a,oldTarget:c,fireCanvas:!0}));for(let a=0;a<f;a++)this.fireSyntheticInOutEvents("drag",x(x({},b),{},{target:e[a],oldTarget:d[a]}));this._draggedoverTarget=a}fireSyntheticInOutEvents(a,b){let{target:c,oldTarget:d,fireCanvas:e,e:f}=b,g=y(b,ey),{targetIn:h,targetOut:i,canvasIn:j,canvasOut:k}=eD[a],l=d!==c;if(d&&l){let a=x(x({},g),{},{e:f,target:d,nextTarget:c},eA(this,f));e&&this.fire(k,a),d.fire(i,a)}if(c&&l){let a=x(x({},g),{},{e:f,target:c,previousTarget:d},eA(this,f));e&&this.fire(j,a),c.fire(h,a)}}__onMouseWheel(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()}_transformObject(a){let b=this.getScenePoint(a),c=this._currentTransform,d=c.target,e=d.group?bs(b,void 0,d.group.calcTransformMatrix()):b;c.shiftKey=a.shiftKey,c.altKey=!!this.centeredKey&&a[this.centeredKey],this._performTransformAction(a,c,e),c.actionPerformed&&this.requestRenderAll()}_performTransformAction(a,b,c){let{action:d,actionHandler:e,target:f}=b,g=!!e&&e(a,b,c.x,c.y);g&&f.setCoords(),"drag"===d&&g&&(b.target.isMoving=!0,this.setCursor(b.target.moveCursor||this.moveCursor)),b.actionPerformed=b.actionPerformed||g}_setCursorFromEvent(a,b){if(!b)return void this.setCursor(this.defaultCursor);let c=b.hoverCursor||this.hoverCursor,d=a5(this._activeObject)?this._activeObject:null,e=(!d||b.group!==d)&&b.findControl(this.getViewportPoint(a));if(e){let c=e.control;this.setCursor(c.cursorStyleHandler(a,c,b))}else b.subTargetCheck&&this.targets.concat().reverse().map(a=>{c=a.hoverCursor||c}),this.setCursor(c)}handleMultiSelection(a,b){let c=this._activeObject,d=a5(c);if(c&&this._isSelectionKeyPressed(a)&&this.selection&&b&&b.selectable&&(c!==b||d)&&(d||!b.isDescendantOf(c)&&!c.isDescendantOf(b))&&!b.onSelect({e:a})&&!c.getActiveControl()){if(d){let d=c.getObjects();if(b===c){let c=this.getViewportPoint(a);if(!(b=this.searchPossibleTargets(d,c)||this.searchPossibleTargets(this._objects,c))||!b.selectable)return!1}b.group===c?(c.remove(b),this._hoveredTarget=b,this._hoveredTargets=[...this.targets],1===c.size()&&this._setActiveObject(c.item(0),a)):(c.multiSelectAdd(b),this._hoveredTarget=c,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(d,a)}else{c.isEditing&&c.exitEditing();let d=new(am.getClass("ActiveSelection"))([],{canvas:this});d.multiSelectAdd(c,b),this._hoveredTarget=d,this._setActiveObject(d,a),this._fireSelectionEvents([c],a)}return!0}return!1}handleSelection(a){if(!this.selection||!this._groupSelector)return!1;let{x:b,y:c,deltaX:d,deltaY:e}=this._groupSelector,f=new as(b,c),g=f.add(new as(d,e)),h=f.min(g),i=f.max(g).subtract(h),j=this.collectObjects({left:h.x,top:h.y,width:i.x,height:i.y},{includeIntersecting:!this.selectionFullyContained}),k=f.eq(g)?j[0]?[j[0]]:[]:j.length>1?j.filter(b=>!b.onSelect({e:a})).reverse():j;if(1===k.length)this.setActiveObject(k[0],a);else if(k.length>1){let b=am.getClass("ActiveSelection");this.setActiveObject(new b(k,{canvas:this}),a)}return this._groupSelector=null,!0}toCanvasElement(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,{upper:c}=this.elements;c.ctx=void 0;let d=super.toCanvasElement(a,b);return c.ctx=c.el.getContext("2d"),d}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}let eF={x1:0,y1:0,x2:0,y2:0},eG=x(x({},eF),{},{r1:0,r2:0}),eH=(a,b)=>isNaN(a)&&"number"==typeof b?b:a;function eI(a){return a&&/%$/.test(a)&&Number.isFinite(parseFloat(a))}function eJ(a,b){return cl(0,eH("number"==typeof a?a:"string"==typeof a?parseFloat(a)/(eI(a)?100:1):NaN,b),1)}let eK=/\s*;\s*/,eL=/\s*:\s*/;function eM(a){return"linearGradient"===a.nodeName||"LINEARGRADIENT"===a.nodeName?"linear":"radial"}function eN(a){return"userSpaceOnUse"===a.getAttribute("gradientUnits")?"pixels":"percentage"}function eO(a,b){return a.getAttribute(b)}class eP{constructor(a){const{type:b="linear",gradientUnits:c="pixels",coords:d={},colorStops:e=[],offsetX:f=0,offsetY:g=0,gradientTransform:h,id:i}=a||{};Object.assign(this,{type:b,gradientUnits:c,coords:x(x({},"radial"===b?eG:eF),d),colorStops:e,offsetX:f,offsetY:g,gradientTransform:h,id:i?"".concat(i,"_").concat(aA()):aA()})}addColorStop(a){for(let b in a){let c=new bL(a[b]);this.colorStops.push({offset:parseFloat(b),color:c.toRgb(),opacity:c.getAlpha()})}return this}toObject(a){return x(x({},a$(this,a)),{},{type:this.type,coords:x({},this.coords),colorStops:this.colorStops.map(a=>x({},a)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(a){let{additionalTransform:b}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=[],d=this.gradientTransform?this.gradientTransform.concat():Q.concat(),e="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",f=this.colorStops.map(a=>x({},a)).sort((a,b)=>a.offset-b.offset),g=-this.offsetX,h=-this.offsetY;"objectBoundingBox"===e?(g/=a.width,h/=a.height):(g+=a.width/2,h+=a.height/2),a&&"function"==typeof a._renderPathCommands&&"percentage"!==this.gradientUnits&&(g-=a.pathOffset.x,h-=a.pathOffset.y),d[4]-=g,d[5]-=h;let i=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(e,'"'),'gradientTransform="'.concat(b?b+" ":"").concat(a1(d),'"'),""].join(" ");if("linear"===this.type){let{x1:a,y1:b,x2:d,y2:e}=this.coords;c.push("<linearGradient ",i,' x1="',a,'" y1="',b,'" x2="',d,'" y2="',e,'">\n')}else if("radial"===this.type){let{x1:a,y1:b,x2:d,y2:e,r1:g,r2:h}=this.coords,j=g>h;c.push("<radialGradient ",i,' cx="',j?a:d,'" cy="',j?b:e,'" r="',j?g:h,'" fx="',j?d:a,'" fy="',j?e:b,'">\n'),j&&(f.reverse(),f.forEach(a=>{a.offset=1-a.offset}));let k=Math.min(g,h);if(k>0){let a=k/Math.max(g,h);f.forEach(b=>{b.offset+=a*(1-b.offset)})}}return f.forEach(a=>{let{color:b,offset:d,opacity:e}=a;c.push("<stop ",'offset="',100*d+"%",'" style="stop-color:',b,void 0!==e?";stop-opacity: "+e:";",'"/>\n')}),c.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),c.join("")}toLive(a){let{x1:b,y1:c,x2:d,y2:e,r1:f,r2:g}=this.coords,h="linear"===this.type?a.createLinearGradient(b,c,d,e):a.createRadialGradient(b,c,f,d,e,g);return this.colorStops.forEach(a=>{let{color:b,opacity:c,offset:d}=a;h.addColorStop(d,void 0!==c?new bL(b).setAlpha(c).toRgba():b)}),h}static async fromObject(a){let{colorStops:b,gradientTransform:c}=a;return new this(x(x({},a),{},{colorStops:b?b.map(a=>x({},a)):void 0,gradientTransform:c?[...c]:void 0}))}static fromElement(a,b,c){var d;let e=eN(a),f=b._findCenterFromElement();return new this(x({id:a.getAttribute("id")||void 0,type:eM(a),coords:(d={width:c.viewBoxWidth||c.width,height:c.viewBoxHeight||c.height},function(a,b){let c,{width:d,height:e,gradientUnits:f}=b;return Object.entries(a).reduce((a,b)=>{let[g,h]=b;if("Infinity"===h)c=1;else if("-Infinity"===h)c=0;else{let a="string"==typeof h;c=a?parseFloat(h):h,a&&eI(h)&&(c*=.01,"pixels"===f&&("x1"!==g&&"x2"!==g&&"r2"!==g||(c*=d),"y1"!==g&&"y2"!==g||(c*=e)))}return a[g]=c,a},{})}("linear"===eM(a)?{x1:eO(a,"x1")||0,y1:eO(a,"y1")||0,x2:eO(a,"x2")||"100%",y2:eO(a,"y2")||0}:{x1:eO(a,"fx")||eO(a,"cx")||"50%",y1:eO(a,"fy")||eO(a,"cy")||"50%",r1:0,x2:eO(a,"cx")||"50%",y2:eO(a,"cy")||"50%",r2:eO(a,"r")||"50%"},x(x({},d),{},{gradientUnits:eN(a)}))),colorStops:function(a,b){let c=[],d=a.getElementsByTagName("stop"),e=eJ(b,1);for(let a=d.length;a--;)c.push(function(a,b){let c,d,e=a.getAttribute("style");if(e){let a=e.split(eK);""===a[a.length-1]&&a.pop();for(let b=a.length;b--;){let[e,f]=a[b].split(eL).map(a=>a.trim());"stop-color"===e?c=f:"stop-opacity"===e&&(d=f)}}let f=new bL(c||a.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:eJ(a.getAttribute("offset"),0),color:f.toRgb(),opacity:eH(parseFloat(d||a.getAttribute("stop-opacity")||""),1)*f.getAlpha()*b}}(d[a],e));return c}(a,c.opacity),gradientUnits:e,gradientTransform:dM(a.getAttribute("gradientTransform")||"")},"pixels"===e?{offsetX:b.width/2-f.x,offsetY:b.height/2-f.y}:{offsetX:0,offsetY:0}))}}v(eP,"type","Gradient"),am.setClass(eP,"gradient"),am.setClass(eP,"linear"),am.setClass(eP,"radial");let eQ=["type","source","patternTransform"];class eR{get type(){return"pattern"}set type(a){C("warn","Setting type has no effect",a)}constructor(a){v(this,"repeat","repeat"),v(this,"offsetX",0),v(this,"offsetY",0),v(this,"crossOrigin",""),this.id=aA(),Object.assign(this,a)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(a){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?a.createPattern(this.source,this.repeat):null}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{repeat:b,crossOrigin:c}=this;return x(x({},a$(this,a)),{},{type:"pattern",source:this.sourceToString(),repeat:b,crossOrigin:c,offsetX:a0(this.offsetX,B.NUM_FRACTION_DIGITS),offsetY:a0(this.offsetY,B.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(a){let{width:b,height:c}=a,{source:d,repeat:e,id:f}=this,g=eH(this.offsetX/b,0),h=eH(this.offsetY/c,0),i="repeat-y"===e||"no-repeat"===e?1+Math.abs(g||0):eH(d.width/b,0),j="repeat-x"===e||"no-repeat"===e?1+Math.abs(h||0):eH(d.height/c,0);return['<pattern id="SVGID_'.concat(f,'" x="').concat(g,'" y="').concat(h,'" width="').concat(i,'" height="').concat(j,'">'),'<image x="0" y="0" width="'.concat(d.width,'" height="').concat(d.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>\n"].join("\n")}static async fromObject(a,b){let{type:c,source:d,patternTransform:e}=a,f=y(a,eQ),g=await aX(d,x(x({},b),{},{crossOrigin:f.crossOrigin}));return new this(x(x({},f),{},{patternTransform:e&&e.slice(0),source:g}))}}v(eR,"type","Pattern"),am.setClass(eR),am.setClass(eR,"pattern");let eS=["path","left","top"],eT=["d"];class eU extends dg{constructor(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:c,left:d,top:e}=b,f=y(b,eS);super(),Object.assign(this,eU.ownDefaults),this.setOptions(f),this._setPath(a||[],!0),"number"==typeof d&&this.set(S,d),"number"==typeof e&&this.set("top",e)}_setPath(a,b){this.path=ee(Array.isArray(a)?a:es(a)),this.setBoundingBox(b)}_findCenterFromElement(){let a=this._calcBoundsFromPath();return new as(a.left+a.width/2,a.top+a.height/2)}_renderPathCommands(a){let b=-this.pathOffset.x,c=-this.pathOffset.y;for(let d of(a.beginPath(),this.path))switch(d[0]){case"L":a.lineTo(d[1]+b,d[2]+c);break;case"M":a.moveTo(d[1]+b,d[2]+c);break;case"C":a.bezierCurveTo(d[1]+b,d[2]+c,d[3]+b,d[4]+c,d[5]+b,d[6]+c);break;case"Q":a.quadraticCurveTo(d[1]+b,d[2]+c,d[3]+b,d[4]+c);break;case"Z":a.closePath()}}_render(a){this._renderPathCommands(a),this._renderPaintInOrder(a)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return x(x({},super.toObject(a)),{},{path:this.path.map(a=>a.slice())})}toDatalessObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=this.toObject(a);return this.sourcePath&&(delete b.path,b.sourcePath=this.sourcePath),b}_toSVG(){let a=et(this.path,B.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(a,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){let a=B.NUM_FRACTION_DIGITS;return" translate(".concat(a0(-this.pathOffset.x,a),", ").concat(a0(-this.pathOffset.y,a),")")}toClipPathSVG(a){let b=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:b})}toSVG(a){let b=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:b})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(a){let{width:b,height:c,pathOffset:d}=this._calcDimensions();this.set({width:b,height:c,pathOffset:d}),a&&this.setPositionByOrigin(d,R,R)}_calcBoundsFromPath(){let a=[],b=0,c=0,d=0,e=0;for(let f of this.path)switch(f[0]){case"L":d=f[1],e=f[2],a.push({x:b,y:c},{x:d,y:e});break;case"M":d=f[1],e=f[2],b=d,c=e;break;case"C":a.push(...ec(d,e,f[1],f[2],f[3],f[4],f[5],f[6])),d=f[5],e=f[6];break;case"Q":a.push(...ec(d,e,f[1],f[2],f[1],f[2],f[3],f[4])),d=f[3],e=f[4];break;case"Z":d=b,e=c}return bk(a)}_calcDimensions(){let a=this._calcBoundsFromPath();return x(x({},a),{},{pathOffset:new as(a.left+a.width/2,a.top+a.height/2)})}static fromObject(a){return this._fromObject(a,{extraParam:"path"})}static async fromElement(a,b,c){let d=dO(a,this.ATTRIBUTE_NAMES,c),{d:e}=d;return new this(e,x(x(x({},y(d,eT)),b),{},{left:void 0,top:void 0}))}}v(eU,"type","Path"),v(eU,"cacheProperties",[...cn,"path","fillRule"]),v(eU,"ATTRIBUTE_NAMES",[...dx,"d"]),am.setClass(eU),am.setSVGClass(eU);let eV=["left","top","radius"],eW=["radius","startAngle","endAngle","counterClockwise"];class eX extends dg{static getDefaults(){return x(x({},super.getDefaults()),eX.ownDefaults)}constructor(a){super(),Object.assign(this,eX.ownDefaults),this.setOptions(a)}_set(a,b){return super._set(a,b),"radius"===a&&this.setRadius(b),this}_render(a){a.beginPath(),a.arc(0,0,this.radius,aG(this.startAngle),aG(this.endAngle),this.counterClockwise),this._renderPaintInOrder(a)}getRadiusX(){return this.get("radius")*this.get(ae)}getRadiusY(){return this.get("radius")*this.get(af)}setRadius(a){this.radius=a,this.set({width:2*a,height:2*a})}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...eW,...a])}_toSVG(){let a=(this.endAngle-this.startAngle)%360;if(0===a)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{let{radius:b}=this,c=aG(this.startAngle),d=aG(this.endAngle),e=aq(c)*b,f=ar(c)*b,g=aq(d)*b,h=ar(d)*b,i=+!this.counterClockwise;return['<path d="M '.concat(e," ").concat(f," A ").concat(b," ").concat(b," 0 ").concat(+(a>180)," ").concat(i," ").concat(g," ").concat(h,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(a,b,c){let d=dO(a,this.ATTRIBUTE_NAMES,c),{left:e=0,top:f=0,radius:g=0}=d;return new this(x(x({},y(d,eV)),{},{radius:g,left:e-g,top:f-g}))}static fromObject(a){return super._fromObject(a)}}v(eX,"type","Circle"),v(eX,"cacheProperties",[...cn,...eW]),v(eX,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),v(eX,"ATTRIBUTE_NAMES",["cx","cy","r",...dx]),am.setClass(eX),am.setSVGClass(eX);let eY=["x1","y1","x2","y2"],eZ=["x1","y1","x2","y2"],e$=["x1","x2","y1","y2"];class e_ extends dg{constructor(){let[a,b,c,d]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,e_.ownDefaults),this.setOptions(e),this.x1=a,this.x2=c,this.y1=b,this.y2=d,this._setWidthHeight();const{left:f,top:g}=e;"number"==typeof f&&this.set(S,f),"number"==typeof g&&this.set("top",g)}_setWidthHeight(){let{x1:a,y1:b,x2:c,y2:d}=this;this.width=Math.abs(c-a),this.height=Math.abs(d-b);let{left:e,top:f,width:g,height:h}=bk([{x:a,y:b},{x:c,y:d}]),i=new as(e+g/2,f+h/2);this.setPositionByOrigin(i,R,R)}_set(a,b){return super._set(a,b),e$.includes(a)&&this._setWidthHeight(),this}_render(a){var b;a.beginPath();let c=this.calcLinePoints();a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2),a.lineWidth=this.strokeWidth;let d=a.strokeStyle;a2(this.stroke)?a.strokeStyle=this.stroke.toLive(a):a.strokeStyle=null!=(b=this.stroke)?b:a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=d}_findCenterFromElement(){return new as((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return x(x({},super.toObject(a)),this.calcLinePoints())}_getNonTransformedDimensions(){let a=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(a.y-=this.strokeWidth),0===this.height&&(a.x-=this.strokeWidth)),a}calcLinePoints(){let{x1:a,x2:b,y1:c,y2:d,width:e,height:f}=this,g=a<=b?-1:1,h=c<=d?-1:1;return{x1:g*e/2,x2:-(g*e)/2,y1:h*f/2,y2:-(h*f)/2}}_toSVG(){let{x1:a,x2:b,y1:c,y2:d}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(a,'" y1="').concat(c,'" x2="').concat(b,'" y2="').concat(d,'" />\n')]}static async fromElement(a,b,c){let d=dO(a,this.ATTRIBUTE_NAMES,c),{x1:e=0,y1:f=0,x2:g=0,y2:h=0}=d;return new this([e,f,g,h],y(d,eY))}static fromObject(a){let{x1:b,y1:c,x2:d,y2:e}=a,f=y(a,eZ);return this._fromObject(x(x({},f),{},{points:[b,c,d,e]}),{extraParam:"points"})}}v(e_,"type","Line"),v(e_,"cacheProperties",[...cn,...e$]),v(e_,"ATTRIBUTE_NAMES",dx.concat(e$)),am.setClass(e_),am.setSVGClass(e_);class e0 extends dg{static getDefaults(){return x(x({},super.getDefaults()),e0.ownDefaults)}constructor(a){super(),Object.assign(this,e0.ownDefaults),this.setOptions(a)}_render(a){let b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderPaintInOrder(a)}_toSVG(){let a=this.width/2,b=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-a," ").concat(b,",0 ").concat(-b,",").concat(a," ").concat(b),'" />']}}v(e0,"type","Triangle"),v(e0,"ownDefaults",{width:100,height:100}),am.setClass(e0),am.setSVGClass(e0);let e1=["rx","ry"];class e2 extends dg{static getDefaults(){return x(x({},super.getDefaults()),e2.ownDefaults)}constructor(a){super(),Object.assign(this,e2.ownDefaults),this.setOptions(a)}_set(a,b){switch(super._set(a,b),a){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this}getRx(){return this.get("rx")*this.get(ae)}getRy(){return this.get("ry")*this.get(af)}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...e1,...a])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(a){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(0,0,this.rx,0,O,!1),a.restore(),this._renderPaintInOrder(a)}static async fromElement(a,b,c){let d=dO(a,this.ATTRIBUTE_NAMES,c);return d.left=(d.left||0)-d.rx,d.top=(d.top||0)-d.ry,new this(d)}}v(e2,"type","Ellipse"),v(e2,"cacheProperties",[...cn,...e1]),v(e2,"ownDefaults",{rx:0,ry:0}),v(e2,"ATTRIBUTE_NAMES",[...dx,"cx","cy","rx","ry"]),am.setClass(e2),am.setSVGClass(e2);let e3=["left","top"],e4={exactBoundingBox:!1};class e5 extends dg{static getDefaults(){return x(x({},super.getDefaults()),e5.ownDefaults)}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),v(this,"strokeDiff",void 0),Object.assign(this,e5.ownDefaults),this.setOptions(b),this.points=a;const{left:c,top:d}=b;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof c&&this.set(S,c),"number"==typeof d&&this.set("top",d)}isOpen(){return!0}_projectStrokeOnPoints(a){return dm(this.points,a,this.isOpen())}_calcDimensions(a){a=x({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},a||{});let b=this.exactBoundingBox?this._projectStrokeOnPoints(a).map(a=>a.projectedPoint):this.points;if(0===b.length)return{left:0,top:0,width:0,height:0,pathOffset:new as,strokeOffset:new as,strokeDiff:new as};let c=bk(b),d=aV(x(x({},a),{},{scaleX:1,scaleY:1})),e=bk(this.points.map(a=>aJ(a,d,!0))),f=new as(this.scaleX,this.scaleY),g=c.left+c.width/2,h=c.top+c.height/2;return this.exactBoundingBox&&(g-=h*Math.tan(aG(this.skewX)),h-=g*Math.tan(aG(this.skewY))),x(x({},c),{},{pathOffset:new as(g,h),strokeOffset:new as(e.left,e.top).subtract(new as(c.left,c.top)).multiply(f),strokeDiff:new as(c.width,c.height).subtract(new as(e.width,e.height)).multiply(f)})}_findCenterFromElement(){let a=bk(this.points);return new as(a.left+a.width/2,a.top+a.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(a){let{left:b,top:c,width:d,height:e,pathOffset:f,strokeOffset:g,strokeDiff:h}=this._calcDimensions();this.set({width:d,height:e,pathOffset:f,strokeOffset:g,strokeDiff:h}),a&&this.setPositionByOrigin(new as(b+d/2,c+e/2),R,R)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new as(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){var b,c,d,e;let f;if(Object.keys(a).some(a=>this.strokeUniform||this.constructor.layoutProperties.includes(a))){let{width:d,height:e}=this._calcDimensions(a);f=new as(null!=(b=a.width)?b:d,null!=(c=a.height)?c:e)}else f=new as(null!=(d=a.width)?d:this.width,null!=(e=a.height)?e:this.height);return f.multiply(new as(a.scaleX||this.scaleX,a.scaleY||this.scaleY))}return super._getTransformedDimensions(a)}_set(a,b){let c=this.initialized&&this[a]!==b,d=super._set(a,b);return this.exactBoundingBox&&c&&((a===ae||a===af)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(a))&&this.setDimensions(),d}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return x(x({},super.toObject(a)),{},{points:this.points.map(a=>{let{x:b,y:c}=a;return{x:b,y:c}})})}_toSVG(){let a=[],b=this.pathOffset.x,c=this.pathOffset.y,d=B.NUM_FRACTION_DIGITS;for(let e=0,f=this.points.length;e<f;e++)a.push(a0(this.points[e].x-b,d),",",a0(this.points[e].y-c,d)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(a.join(""),'" />\n')]}_render(a){let b=this.points.length,c=this.pathOffset.x,d=this.pathOffset.y;if(b&&!isNaN(this.points[b-1].y)){a.beginPath(),a.moveTo(this.points[0].x-c,this.points[0].y-d);for(let e=0;e<b;e++){let b=this.points[e];a.lineTo(b.x-c,b.y-d)}this.isOpen()||a.closePath(),this._renderPaintInOrder(a)}}complexity(){return this.points.length}static async fromElement(a,b,c){return new this(function(a){if(!a)return[];let b=a.replace(/,/g," ").trim().split(/\s+/),c=[];for(let a=0;a<b.length;a+=2)c.push({x:parseFloat(b[a]),y:parseFloat(b[a+1])});return c}(a.getAttribute("points")),x(x({},y(dO(a,this.ATTRIBUTE_NAMES,c),e3)),b))}static fromObject(a){return this._fromObject(a,{extraParam:"points"})}}v(e5,"ownDefaults",e4),v(e5,"type","Polyline"),v(e5,"layoutProperties",[ag,ah,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),v(e5,"cacheProperties",[...cn,"points"]),v(e5,"ATTRIBUTE_NAMES",[...dx]),am.setClass(e5),am.setSVGClass(e5);class e6 extends e5{isOpen(){return!1}}v(e6,"ownDefaults",e4),v(e6,"type","Polygon"),am.setClass(e6),am.setSVGClass(e6);class e7 extends dg{isEmptyStyles(a){if(!this.styles||void 0!==a&&!this.styles[a])return!0;let b=void 0===a?this.styles:{line:this.styles[a]};for(let a in b)for(let c in b[a])for(let d in b[a][c])return!1;return!0}styleHas(a,b){if(!this.styles||void 0!==b&&!this.styles[b])return!1;let c=void 0===b?this.styles:{0:this.styles[b]};for(let b in c)for(let d in c[b])if(void 0!==c[b][d][a])return!0;return!1}cleanStyle(a){if(!this.styles)return!1;let b=this.styles,c,d,e=0,f=!0,g=0;for(let g in b){for(let h in c=0,b[g]){let i=b[g][h]||{};e++,void 0!==i[a]?(d?i[a]!==d&&(f=!1):d=i[a],i[a]===this[a]&&delete i[a]):f=!1,0!==Object.keys(i).length?c++:delete b[g][h]}0===c&&delete b[g]}for(let a=0;a<this._textLines.length;a++)g+=this._textLines[a].length;f&&e===g&&(this[a]=d,this.removeStyle(a))}removeStyle(a){let b,c,d;if(!this.styles)return;let e=this.styles;for(c in e){for(d in b=e[c])delete b[d][a],0===Object.keys(b[d]).length&&delete b[d];0===Object.keys(b).length&&delete e[c]}}_extendStyles(a,b){let{lineIndex:c,charIndex:d}=this.get2DCursorLocation(a);this._getLineStyle(c)||this._setLineStyle(c);let e=a_(x(x({},this._getStyleDeclaration(c,d)),b),a=>void 0!==a);this._setStyleDeclaration(c,d,e)}getSelectionStyles(a,b,c){let d=[];for(let e=a;e<(b||a);e++)d.push(this.getStyleAtPosition(e,c));return d}getStyleAtPosition(a,b){let{lineIndex:c,charIndex:d}=this.get2DCursorLocation(a);return b?this.getCompleteStyleDeclaration(c,d):this._getStyleDeclaration(c,d)}setSelectionStyles(a,b,c){for(let d=b;d<(c||b);d++)this._extendStyles(d,a);this._forceClearCache=!0}_getStyleDeclaration(a,b){var c;let d=this.styles&&this.styles[a];return d&&null!=(c=d[b])?c:{}}getCompleteStyleDeclaration(a,b){return x(x({},a$(this,this.constructor._styleProperties)),this._getStyleDeclaration(a,b))}_setStyleDeclaration(a,b,c){this.styles[a][b]=c}_deleteStyleDeclaration(a,b){delete this.styles[a][b]}_getLineStyle(a){return!!this.styles[a]}_setLineStyle(a){this.styles[a]={}}_deleteLineStyle(a){delete this.styles[a]}}v(e7,"_styleProperties",bW);let e8=/  +/g,e9=/"/g;function fa(a,b,c,d,e){return"		".concat(function(a,b){let{left:c,top:d,width:e,height:f}=b,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.NUM_FRACTION_DIGITS,h=bO(ai,a,!1),[i,j,k,l]=[c,d,e,f].map(a=>a0(a,g));return"<rect ".concat(h,' x="').concat(i,'" y="').concat(j,'" width="').concat(k,'" height="').concat(l,'"></rect>')}(a,{left:b,top:c,width:d,height:e}),"\n")}let fb=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];class fc extends e7{static getDefaults(){return x(x({},super.getDefaults()),fc.ownDefaults)}constructor(a,b){super(),v(this,"__charBounds",[]),Object.assign(this,fc.ownDefaults),this.setOptions(b),this.styles||(this.styles={}),this.text=a,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){let a=this.path;a&&(a.segmentsInfo=em(a.path))}_splitText(){let a=this._splitTextIntoLines(this.text);return this.textLines=a.lines,this._textLines=a.graphemeLines,this._unwrappedTextLines=a._unwrappedLines,this._text=a.graphemeText,a}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(bX)&&this.enlargeSpaces()}enlargeSpaces(){let a,b,c,d,e,f,g;for(let h=0,i=this._textLines.length;h<i;h++)if((this.textAlign===bX||h!==i-1&&!this.isEndOfWrapping(h))&&(d=0,e=this._textLines[h],(b=this.getLineWidth(h))<this.width&&(g=this.textLines[h].match(this._reSpacesAndTabs)))){c=g.length,a=(this.width-b)/c;for(let b=0;b<=e.length;b++)f=this.__charBounds[h][b],this._reSpaceAndTab.test(e[b])?(f.width+=a,f.kernedWidth+=a,f.left+=d,d+=a):f.left+=d}}isEndOfWrapping(a){return a===this._textLines.length-1}missingNewlineOffset(a){return 1}get2DCursorLocation(a,b){let c,d=b?this._unwrappedTextLines:this._textLines;for(c=0;c<d.length;c++){if(a<=d[c].length)return{lineIndex:c,charIndex:a};a-=d[c].length+this.missingNewlineOffset(c,b)}return{lineIndex:c-1,charIndex:d[c-1].length<a?d[c-1].length:a}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){let a=super._getCacheCanvasDimensions(),b=this.fontSize;return a.width+=b*a.zoomX,a.height+=b*a.zoomY,a}_render(a){let b=this.path;b&&!b.isNotVisible()&&b._render(a),this._setTextStyles(a),this._renderTextLinesBackground(a),this._renderTextDecoration(a,"underline"),this._renderText(a),this._renderTextDecoration(a,"overline"),this._renderTextDecoration(a,"linethrough")}_renderText(a){this.paintFirst===aj?(this._renderTextStroke(a),this._renderTextFill(a)):(this._renderTextFill(a),this._renderTextStroke(a))}_setTextStyles(a,b,c){if(a.textBaseline="alphabetic",this.path)switch(this.pathAlign){case R:a.textBaseline="middle";break;case"ascender":a.textBaseline="top";break;case"descender":a.textBaseline=T}a.font=this._getFontDeclaration(b,c)}calcTextWidth(){let a=this.getLineWidth(0);for(let b=1,c=this._textLines.length;b<c;b++){let c=this.getLineWidth(b);c>a&&(a=c)}return a}_renderTextLine(a,b,c,d,e,f){this._renderChars(a,b,c,d,e,f)}_renderTextLinesBackground(a){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;let b=a.fillStyle,c=this._getLeftOffset(),d=this._getTopOffset();for(let b=0,e=this._textLines.length;b<e;b++){let e=this.getHeightOfLine(b);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",b)){d+=e;continue}let f=this._textLines[b].length,g=this._getLineLeftOffset(b),h,i,j=0,k=0,l=this.getValueOfPropertyAt(b,0,"textBackgroundColor"),m=this.getHeightOfLineImpl(b);for(let e=0;e<f;e++){let f=this.__charBounds[b][e];i=this.getValueOfPropertyAt(b,e,"textBackgroundColor"),this.path?(a.save(),a.translate(f.renderLeft,f.renderTop),a.rotate(f.angle),a.fillStyle=i,i&&a.fillRect(-f.width/2,-m*(1-this._fontSizeFraction),f.width,m),a.restore()):i!==l?(h=c+g+k,"rtl"===this.direction&&(h=this.width-h-j),a.fillStyle=l,l&&a.fillRect(h,d,j,m),k=f.left,j=f.width,l=i):j+=f.kernedWidth}i&&!this.path&&(h=c+g+k,"rtl"===this.direction&&(h=this.width-h-j),a.fillStyle=i,a.fillRect(h,d,j,m)),d+=e}a.fillStyle=b,this._removeShadow(a)}_measureChar(a,b,c,e){let f,g,h,i,j=K.getFontCache(b),k=this._getFontDeclaration(b),l=c?c+a:a,m=c&&k===this._getFontDeclaration(e),n=b.fontSize/this.CACHE_FONT_SIZE;if(c&&j.has(c)&&(h=j.get(c)),j.has(a)&&(i=f=j.get(a)),m&&j.has(l)&&(i=(g=j.get(l))-h),void 0===f||void 0===h||void 0===g){let e=(d||(d=aD({width:0,height:0}).getContext("2d")),d);this._setTextStyles(e,b,!0),void 0===f&&(i=f=e.measureText(a).width,j.set(a,f)),void 0===h&&m&&c&&(h=e.measureText(c).width,j.set(c,h)),m&&void 0===g&&(g=e.measureText(l).width,j.set(l,g),i=g-h)}return{width:f*n,kernedWidth:i*n}}getHeightOfChar(a,b){return this.getValueOfPropertyAt(a,b,"fontSize")}measureLine(a){let b=this._measureLine(a);return 0!==this.charSpacing&&(b.width-=this._getWidthOfCharSpacing()),b.width<0&&(b.width=0),b}_measureLine(a){let b,c,d=0,e=this.pathSide===U,f=this.path,g=this._textLines[a],h=g.length,i=Array(h);this.__charBounds[a]=i;for(let e=0;e<h;e++){let f=g[e];c=this._getGraphemeBox(f,a,e,b),i[e]=c,d+=c.kernedWidth,b=f}if(i[h]={left:c?c.left+c.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},f&&f.segmentsInfo){let a=0,b=f.segmentsInfo[f.segmentsInfo.length-1].length;switch(this.textAlign){case S:a=e?b-d:0;break;case R:a=(b-d)/2;break;case U:a=e?0:b-d}a+=this.pathStartOffset*(e?-1:1);for(let d=e?h-1:0;e?d>=0:d<h;e?d--:d++)c=i[d],a>b?a%=b:a<0&&(a+=b),this._setGraphemeOnPath(a,c),a+=c.kernedWidth}return{width:d,numOfSpaces:0}}_setGraphemeOnPath(a,b){let c=a+b.kernedWidth/2,d=this.path,e=en(d.path,c,d.segmentsInfo);b.renderLeft=e.x-d.pathOffset.x,b.renderTop=e.y-d.pathOffset.y,b.angle=e.angle+(this.pathSide===U?Math.PI:0)}_getGraphemeBox(a,b,c,d,e){let f=this.getCompleteStyleDeclaration(b,c),g=d?this.getCompleteStyleDeclaration(b,c-1):{},h=this._measureChar(a,f,d,g),i,j=h.kernedWidth,k=h.width;0!==this.charSpacing&&(k+=i=this._getWidthOfCharSpacing(),j+=i);let l={width:k,left:0,height:f.fontSize,kernedWidth:j,deltaY:f.deltaY};if(c>0&&!e){let a=this.__charBounds[b][c-1];l.left=a.left+a.width+h.kernedWidth-h.width}return l}getHeightOfLineImpl(a){let b=this.__lineHeights;if(b[a])return b[a];let c=this.getHeightOfChar(a,0);for(let b=1,d=this._textLines[a].length;b<d;b++)c=Math.max(this.getHeightOfChar(a,b),c);return b[a]=c*this._fontSizeMult}getHeightOfLine(a){return this.getHeightOfLineImpl(a)*this.lineHeight}calcTextHeight(){let a=0;for(let b=0,c=this._textLines.length;b<c;b++)a+=b===c-1?this.getHeightOfLineImpl(b):this.getHeightOfLine(b);return a}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(a,b){a.save();let c=0,d=this._getLeftOffset(),e=this._getTopOffset();for(let f=0,g=this._textLines.length;f<g;f++)this._renderTextLine(b,a,this._textLines[f],d+this._getLineLeftOffset(f),e+c+this.getHeightOfLineImpl(f),f),c+=this.getHeightOfLine(f);a.restore()}_renderTextFill(a){(this.fill||this.styleHas(ai))&&this._renderTextCommon(a,"fillText")}_renderTextStroke(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())}_renderChars(a,b,c,d,e,f){let g=this.textAlign.includes(bX),h=this.path,i=!g&&0===this.charSpacing&&this.isEmptyStyles(f)&&!h,j="ltr"===this.direction,k="ltr"===this.direction?1:-1,l=b.direction,m,n,o,p,q,r="",s=0;if(b.save(),l!==this.direction&&(b.canvas.setAttribute("dir",j?"ltr":"rtl"),b.direction=j?"ltr":"rtl",b.textAlign=j?S:U),e-=this.getHeightOfLineImpl(f)*this._fontSizeFraction,i)return this._renderChar(a,b,f,0,c.join(""),d,e),void b.restore();for(let i=0,j=c.length-1;i<=j;i++)p=i===j||this.charSpacing||h,r+=c[i],o=this.__charBounds[f][i],0===s?(d+=k*(o.kernedWidth-o.width),s+=o.width):s+=o.kernedWidth,g&&!p&&this._reSpaceAndTab.test(c[i])&&(p=!0),p||(p=du(m=m||this.getCompleteStyleDeclaration(f,i),n=this.getCompleteStyleDeclaration(f,i+1),!1)),p&&(h?(b.save(),b.translate(o.renderLeft,o.renderTop),b.rotate(o.angle),this._renderChar(a,b,f,i,r,-s/2,0),b.restore()):(q=d,this._renderChar(a,b,f,i,r,q,e)),r="",m=n,d+=k*s,s=0);b.restore()}_applyPatternGradientTransformText(a){let b=this.width+this.strokeWidth,c=this.height+this.strokeWidth,d=aD({width:b,height:c}),e=d.getContext("2d");return d.width=b,d.height=c,e.beginPath(),e.moveTo(0,0),e.lineTo(b,0),e.lineTo(b,c),e.lineTo(0,c),e.closePath(),e.translate(b/2,c/2),e.fillStyle=a.toLive(e),this._applyPatternGradientTransform(e,a),e.fill(),e.createPattern(d,"no-repeat")}handleFiller(a,b,c){let d,e;return a2(c)?"percentage"===c.gradientUnits||c.gradientTransform||c.patternTransform?(d=-this.width/2,e=-this.height/2,a.translate(d,e),a[b]=this._applyPatternGradientTransformText(c),{offsetX:d,offsetY:e}):(a[b]=c.toLive(a),this._applyPatternGradientTransform(a,c)):(a[b]=c,{offsetX:0,offsetY:0})}_setStrokeStyles(a,b){let{stroke:c,strokeWidth:d}=b;return a.lineWidth=d,a.lineCap=this.strokeLineCap,a.lineDashOffset=this.strokeDashOffset,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,this.handleFiller(a,"strokeStyle",c)}_setFillStyles(a,b){let{fill:c}=b;return this.handleFiller(a,"fillStyle",c)}_renderChar(a,b,c,d,e,f,g){let h=this._getStyleDeclaration(c,d),i=this.getCompleteStyleDeclaration(c,d),j="fillText"===a&&i.fill,k="strokeText"===a&&i.stroke&&i.strokeWidth;if(k||j){if(b.save(),b.font=this._getFontDeclaration(i),h.textBackgroundColor&&this._removeShadow(b),h.deltaY&&(g+=h.deltaY),j){let a=this._setFillStyles(b,i);b.fillText(e,f-a.offsetX,g-a.offsetY)}if(k){let a=this._setStrokeStyles(b,i);b.strokeText(e,f-a.offsetX,g-a.offsetY)}b.restore()}}setSuperscript(a,b){this._setScript(a,b,this.superscript)}setSubscript(a,b){this._setScript(a,b,this.subscript)}_setScript(a,b,c){let d=this.get2DCursorLocation(a,!0),e=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),f=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),g={fontSize:e*c.size,deltaY:f+e*c.baseline};this.setSelectionStyles(g,a,b)}_getLineLeftOffset(a){let b=this.getLineWidth(a),c=this.width-b,d=this.textAlign,e=this.direction,f=this.isEndOfWrapping(a),g=0;return d!==bX&&(d!==b$||f)&&(d!==bZ||f)&&(d!==bY||f)?(d===R&&(g=c/2),d===U&&(g=c),d===b$&&(g=c/2),d===bZ&&(g=c),"rtl"===e&&(d===U||d===bX||d===bZ?g=0:d===S||d===bY?g=-c:d!==R&&d!==b$||(g=-c/2)),g):0}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(a){if(void 0!==this.__lineWidths[a])return this.__lineWidths[a];let{width:b}=this.measureLine(a);return this.__lineWidths[a]=b,b}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(a,b,c){var d;return null!=(d=this._getStyleDeclaration(a,b)[c])?d:this[c]}_renderTextDecoration(a,b){if(!this[b]&&!this.styleHas(b))return;let c=this._getTopOffset(),d=this._getLeftOffset(),e=this.path,f=this._getWidthOfCharSpacing(),g="linethrough"===b?.5:+("overline"===b),h=this.offsets[b];for(let i=0,j=this._textLines.length;i<j;i++){let j=this.getHeightOfLine(i);if(!this[b]&&!this.styleHas(b,i)){c+=j;continue}let k=this._textLines[i],l=j/this.lineHeight,m=this._getLineLeftOffset(i),n=0,o=0,p=this.getValueOfPropertyAt(i,0,b),q=this.getValueOfPropertyAt(i,0,ai),r=this.getValueOfPropertyAt(i,0,bR),s=p,t=q,u=r,v=c+l*(1-this._fontSizeFraction),w=this.getHeightOfChar(i,0),x=this.getValueOfPropertyAt(i,0,"deltaY");for(let c=0,f=k.length;c<f;c++){let f=this.__charBounds[i][c];s=this.getValueOfPropertyAt(i,c,b),t=this.getValueOfPropertyAt(i,c,ai),u=this.getValueOfPropertyAt(i,c,bR);let j=this.getHeightOfChar(i,c),k=this.getValueOfPropertyAt(i,c,"deltaY");if(e&&s&&t){let b=this.fontSize*u/1e3;a.save(),a.fillStyle=q,a.translate(f.renderLeft,f.renderTop),a.rotate(f.angle),a.fillRect(-f.kernedWidth/2,h*j+k-g*b,f.kernedWidth,b),a.restore()}else if((s!==p||t!==q||j!==w||u!==r||k!==x)&&o>0){let b=this.fontSize*r/1e3,c=d+m+n;"rtl"===this.direction&&(c=this.width-c-o),p&&q&&r&&(a.fillStyle=q,a.fillRect(c,v+h*w+x-g*b,o,b)),n=f.left,o=f.width,p=s,r=u,q=t,w=j,x=k}else o+=f.kernedWidth}let y=d+m+n;"rtl"===this.direction&&(y=this.width-y-o),a.fillStyle=t;let z=this.fontSize*u/1e3;s&&t&&u&&a.fillRect(y,v+h*w+x-g*z,o-f,z),c+=j}this._removeShadow(a)}_getFontDeclaration(){let{fontFamily:a=this.fontFamily,fontStyle:b=this.fontStyle,fontWeight:c=this.fontWeight,fontSize:d=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,f=a.includes("'")||a.includes('"')||a.includes(",")||fc.genericFonts.includes(a.toLowerCase())?a:'"'.concat(a,'"');return[b,c,"".concat(e?this.CACHE_FONT_SIZE:d,"px"),f].join(" ")}render(a){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(a)))}graphemeSplit(a){return dq(a)}_splitTextIntoLines(a){let b=a.split(this._reNewline),c=Array(b.length),d=["\n"],e=[];for(let a=0;a<b.length;a++)c[a]=this.graphemeSplit(b[a]),e=e.concat(c[a],d);return e.pop(),{_unwrappedLines:c,lines:b,graphemeText:e,graphemeLines:c}}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return x(x({},super.toObject([...bV,...a])),{},{styles:dv(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(a,b){let{textLayoutProperties:c}=this.constructor;super.set(a,b);let d=!1,e=!1;if("object"==typeof a)for(let b in a)"path"===b&&this.setPathInfo(),d=d||c.includes(b),e=e||"path"===b;else d=c.includes(a),e="path"===a;return e&&this.setPathInfo(),d&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(a,b,c){let d=dO(a,fc.ATTRIBUTE_NAMES,c),e=x(x({},b),d),{textAnchor:f=S,textDecoration:g="",dx:h=0,dy:i=0,top:j=0,left:k=0,fontSize:l=16,strokeWidth:m=1}=e,n=y(e,fb),o=new this((a.textContent||"").replace(/\s+/g," ").trim(),x({left:k+h,top:j+i,underline:g.includes("underline"),overline:g.includes("overline"),linethrough:g.includes("line-through"),strokeWidth:0,fontSize:l},n)),p=o.getScaledHeight()/o.height,q=((o.height+o.strokeWidth)*o.lineHeight-o.height)*p,r=o.getScaledHeight()+q,s=0;return f===R&&(s=o.getScaledWidth()/2),f===U&&(s=o.getScaledWidth()),o.set({left:o.left-s,top:o.top-(r-o.fontSize*(.07+o._fontSizeFraction))/o.lineHeight,strokeWidth:m}),o}static fromObject(a){return this._fromObject(x(x({},a),{},{styles:dw(a.styles||{},a.text)}),{extraParam:"text"})}}v(fc,"textLayoutProperties",bU),v(fc,"cacheProperties",[...cn,...bV]),v(fc,"ownDefaults",{_reNewline:W,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:S,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:S,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[bR]:66.667}),v(fc,"type","Text"),v(fc,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),v(fc,"ATTRIBUTE_NAMES",dx.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),df(fc,[class extends bP{_toSVG(){let a=this._getSVGLeftTopOffsets(),b=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(b)}toSVG(a){let b=this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0}),c=this.path;return c?b+c._createBaseSVGMarkup(c._toSVG(),{reviver:a,withShadow:!0,additionalTransform:a1(this.calcOwnMatrix())}):b}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(a){let{textBgRects:b,textSpans:c}=a,d=this.getSvgTextDecoration(this);return[b.join(""),'		<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(e9,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",d?'text-decoration="'.concat(d,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",c.join(""),"</text>\n"]}_getSVGTextAndBg(a,b){let c=[],d=[],e,f=a;this.backgroundColor&&d.push(...fa(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let a=0,g=this._textLines.length;a<g;a++)e=this._getLineLeftOffset(a),"rtl"===this.direction&&(e+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(d,a,b+e,f),this._setSVGTextLineText(c,a,b+e,f),f+=this.getHeightOfLine(a);return{textSpans:c,textBgRects:d}}_createTextCharSpan(a,b,c,d,e){let f=B.NUM_FRACTION_DIGITS,g=this.getSvgSpanStyles(b,a!==a.trim()||!!a.match(e8)),h=b.deltaY,i=h?' dy="'.concat(a0(h,f),'" '):"",{angle:j,renderLeft:k,renderTop:l,width:m}=e,n="";if(void 0!==k){j&&(n=' rotate="'.concat(a0(aH(j),f),'"'));let a=aQ({angle:aH(j)});a[4]=k,a[5]=l;let b=new as(-(m/2),0).transform(a);c=b.x,d=b.y}return'<tspan x="'.concat(a0(c,f),'" y="').concat(a0(d,f),'" ').concat(i).concat(n).concat(g?'style="'.concat(g,'"'):"",">").concat(dp(a),"</tspan>")}_setSVGTextLineText(a,b,c,d){let e=this.getHeightOfLine(b),f=this.textAlign.includes(bX),g=this._textLines[b],h,i,j,k,l,m="",n=0;d+=e*(1-this._fontSizeFraction)/this.lineHeight;for(let e=0,o=g.length-1;e<=o;e++)l=e===o||this.charSpacing||this.path,m+=g[e],j=this.__charBounds[b][e],0===n?(c+=j.kernedWidth-j.width,n+=j.width):n+=j.kernedWidth,f&&!l&&this._reSpaceAndTab.test(g[e])&&(l=!0),l||(l=du(h=h||this.getCompleteStyleDeclaration(b,e),i=this.getCompleteStyleDeclaration(b,e+1),!0)),l&&(k=this._getStyleDeclaration(b,e),a.push(this._createTextCharSpan(m,k,c,d,j)),m="",h=i,"rtl"===this.direction?c-=n:c+=n,n=0)}_setSVGTextLineBg(a,b,c,d){let e=this._textLines[b],f=this.getHeightOfLine(b)/this.lineHeight,g,h=0,i=0,j=this.getValueOfPropertyAt(b,0,"textBackgroundColor");for(let k=0;k<e.length;k++){let{left:e,width:l,kernedWidth:m}=this.__charBounds[b][k];(g=this.getValueOfPropertyAt(b,k,"textBackgroundColor"))!==j?(j&&a.push(...fa(j,c+i,d,h,f)),i=e,h=l,j=g):h+=m}g&&a.push(...fa(j,c+i,d,h,f))}_getSVGLineTopOffset(a){let b,c=0;for(b=0;b<a;b++)c+=this.getHeightOfLine(b);let d=this.getHeightOfLine(b);return{lineTop:c,offset:(this._fontSizeMult-this._fontSizeFraction)*d/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(a){return"".concat(super.getSvgStyles(a)," text-decoration-thickness: ").concat(a0(this.textDecorationThickness*this.getObjectScaling().y/10,B.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(a,b){let{fontFamily:c,strokeWidth:d,stroke:e,fill:f,fontSize:g,fontStyle:h,fontWeight:i,deltaY:j,textDecorationThickness:k,linethrough:l,overline:m,underline:n}=a,o=this.getSvgTextDecoration({underline:null!=n?n:this.underline,overline:null!=m?m:this.overline,linethrough:null!=l?l:this.linethrough}),p=k||this.textDecorationThickness;return[e?bO(aj,e):"",d?"stroke-width: ".concat(d,"; "):"",c?"font-family: ".concat(c.includes("'")||c.includes('"')?c:"'".concat(c,"'"),"; "):"",g?"font-size: ".concat(g,"px; "):"",h?"font-style: ".concat(h,"; "):"",i?"font-weight: ".concat(i,"; "):"",o?"text-decoration: ".concat(o,"; text-decoration-thickness: ").concat(a0(p*this.getObjectScaling().y/10,B.NUM_FRACTION_DIGITS),"%; "):"",f?bO(ai,f):"",j?"baseline-shift: ".concat(-j,"; "):"",b?"white-space: pre; ":""].join("")}getSvgTextDecoration(a){return["overline","underline","line-through"].filter(b=>a[b.replace("-","")]).join(" ")}}]),am.setClass(fc),am.setSVGClass(fc);class fd{constructor(a){v(this,"target",void 0),v(this,"__mouseDownInPlace",!1),v(this,"__dragStartFired",!1),v(this,"__isDraggingOver",!1),v(this,"__dragStartSelection",void 0),v(this,"__dragImageDisposer",void 0),v(this,"_dispose",void 0),this.target=a;const b=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{b.forEach(a=>a()),this._dispose=void 0}}isPointerOverSelection(a){let b=this.target,c=b.getSelectionStartFromPointer(a);return b.isEditing&&c>=b.selectionStart&&c<=b.selectionEnd&&b.selectionStart<b.selectionEnd}start(a){return this.__mouseDownInPlace=this.isPointerOverSelection(a)}isActive(){return this.__mouseDownInPlace}end(a){let b=this.isActive();return b&&!this.__dragStartFired&&(this.target.setCursorByClick(a),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,b}getDragStartSelection(){return this.__dragStartSelection}setDragImage(a,b){var c;let{selectionStart:d,selectionEnd:e}=b,f=this.target,g=f.canvas,h=new as(f.flipX?-1:1,f.flipY?-1:1),i=f._getCursorBoundaries(d),j=new as(i.left+i.leftOffset,i.top+i.topOffset).multiply(h).transform(f.calcTransformMatrix()),k=g.getScenePoint(a).subtract(j),l=f.getCanvasRetinaScaling(),m=f.getBoundingRect(),n=j.subtract(new as(m.left,m.top)),o=g.viewportTransform,p=n.add(k).transform(o,!0),q=f.backgroundColor,r=dn(f.styles);f.backgroundColor="";let s={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};f.setSelectionStyles(s,0,d),f.setSelectionStyles(s,e,f.text.length),f.dirty=!0;let t=f.toCanvasElement({enableRetinaScaling:g.enableRetinaScaling,viewportTransform:!0});f.backgroundColor=q,f.styles=r,f.dirty=!0,eu(t,{position:"fixed",left:"".concat(-t.width,"px"),border:V,width:"".concat(t.width/l,"px"),height:"".concat(t.height/l,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{t.remove()},a7(a.target||this.target.hiddenTextarea).body.appendChild(t),null==(c=a.dataTransfer)||c.setDragImage(t,p.x,p.y)}onDragStart(a){this.__dragStartFired=!0;let b=this.target,c=this.isActive();if(c&&a.dataTransfer){let c=this.__dragStartSelection={selectionStart:b.selectionStart,selectionEnd:b.selectionEnd},d=b._text.slice(c.selectionStart,c.selectionEnd).join(""),e=x({text:b.text,value:d},c);a.dataTransfer.setData("text/plain",d),a.dataTransfer.setData("application/fabric",JSON.stringify({value:d,styles:b.getSelectionStyles(c.selectionStart,c.selectionEnd,!0)})),a.dataTransfer.effectAllowed="copyMove",this.setDragImage(a,e)}return b.abortCursorAnimation(),c}canDrop(a){if(this.target.editable&&!this.target.getActiveControl()&&!a.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){let b=this.target.getSelectionStartFromPointer(a),c=this.__dragStartSelection;return b<c.selectionStart||b>c.selectionEnd}return!0}return!1}targetCanDrop(a){return this.target.canDrop(a)}dragEnterHandler(a){let{e:b}=a,c=this.targetCanDrop(b);!this.__isDraggingOver&&c&&(this.__isDraggingOver=!0)}dragOverHandler(a){let{e:b}=a,c=this.targetCanDrop(b);!this.__isDraggingOver&&c?this.__isDraggingOver=!0:this.__isDraggingOver&&!c&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(b.preventDefault(),a.canDrop=!0,a.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(a){var b;let{e:c}=a,d=c.defaultPrevented;this.__isDraggingOver=!1,c.preventDefault();let e=null==(b=c.dataTransfer)?void 0:b.getData("text/plain");if(e&&!d){let b=this.target,d=b.canvas,f=b.getSelectionStartFromPointer(c),{styles:g}=c.dataTransfer.types.includes("application/fabric")?JSON.parse(c.dataTransfer.getData("application/fabric")):{},h=e[Math.max(0,e.length-1)];if(this.__dragStartSelection){let a=this.__dragStartSelection.selectionStart,c=this.__dragStartSelection.selectionEnd;f>a&&f<=c?f=a:f>c&&(f-=c-a),b.removeChars(a,c),delete this.__dragStartSelection}b._reNewline.test(h)&&(b._reNewline.test(b._text[f])||f===b._text.length)&&(e=e.trimEnd()),a.didDrop=!0,a.dropTarget=b,b.insertChars(e,g,f),d.setActiveObject(b),b.enterEditing(c),b.selectionStart=Math.min(f+0,b._text.length),b.selectionEnd=Math.min(b.selectionStart+e.length,b._text.length),b.hiddenTextarea.value=b.text,b._updateTextarea(),b.hiddenTextarea.focus(),b.fire(ac,{index:f+0,action:"drop"}),d.fire("text:changed",{target:b}),d.contextTopDirty=!0,d.requestRenderAll()}}dragEndHandler(a){let{e:b}=a;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var c;let a=this.target,d=this.target.canvas,{selectionStart:e,selectionEnd:f}=this.__dragStartSelection,g=(null==(c=b.dataTransfer)?void 0:c.dropEffect)||V;g===V?(a.selectionStart=e,a.selectionEnd=f,a._updateTextarea(),a.hiddenTextarea.focus()):(a.clearContextTop(),"move"===g&&(a.removeChars(e,f),a.selectionStart=a.selectionEnd=e,a.hiddenTextarea&&(a.hiddenTextarea.value=a.text),a._updateTextarea(),a.fire(ac,{index:e,action:"dragend"}),d.fire("text:changed",{target:a}),d.requestRenderAll()),a.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}let fe=/[ \n\.,;!\?\-]/;class ff extends fc{constructor(){super(...arguments),v(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(a){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(a)}_animateCursor(a){let{toValue:b,duration:c,delay:d,onComplete:e}=a;return cE({startValue:this._currentCursorOpacity,endValue:b,duration:c,delay:d,onComplete:e,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:a=>{this._currentCursorOpacity=a,this.renderCursorOrSelection()}})}_tick(a){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(a||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var a;null==(a=this._currentTickCompleteState)||a.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(a){this.abortCursorAnimation(),this._tick(a?0:this.cursorDelay)}abortCursorAnimation(){let a=!1;[this._currentTickState,this._currentTickCompleteState].forEach(b=>{b&&!b.isDone()&&(a=!0,b.abort())}),this._currentCursorOpacity=1,a&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(a=>!a||a.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(a){let b=0,c=a-1;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)b++,c--;for(;/\S/.test(this._text[c])&&c>-1;)b++,c--;return a-b}findWordBoundaryRight(a){let b=0,c=a;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)b++,c++;for(;/\S/.test(this._text[c])&&c<this._text.length;)b++,c++;return a+b}findLineBoundaryLeft(a){let b=0,c=a-1;for(;!/\n/.test(this._text[c])&&c>-1;)b++,c--;return a-b}findLineBoundaryRight(a){let b=0,c=a;for(;!/\n/.test(this._text[c])&&c<this._text.length;)b++,c++;return a+b}searchWordBoundary(a,b){let c=this._text,d=a>0&&this._reSpace.test(c[a])&&(-1===b||!W.test(c[a-1]))?a-1:a,e=c[d];for(;d>0&&d<c.length&&!fe.test(e);)d+=b,e=c[d];return -1===b&&fe.test(e)&&d++,d}selectWord(a){var b;a=null!=(b=a)?b:this.selectionStart;let c=this.searchWordBoundary(a,-1),d=Math.max(c,this.searchWordBoundary(a,1));this.selectionStart=c,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(a){var b;a=null!=(b=a)?b:this.selectionStart;let c=this.findLineBoundaryLeft(a),d=this.findLineBoundaryRight(a);this.selectionStart=c,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(a){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",a?{e:a}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:a}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(a){if(this.getActiveControl())return;let b=this.hiddenTextarea;a7(b).activeElement!==b&&b.focus();let c=this.getSelectionStartFromPointer(a),d=this.selectionStart,e=this.selectionEnd;(c===this.__selectionStartOnMouseDown&&d!==e||d!==c&&e!==c)&&(c>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=c):(this.selectionStart=c,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===d&&this.selectionEnd===e||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(a,b,c){let d=c.slice(0,a),e=this.graphemeSplit(d).length;if(a===b)return{selectionStart:e,selectionEnd:e};let f=c.slice(a,b);return{selectionStart:e,selectionEnd:e+this.graphemeSplit(f).length}}fromGraphemeToStringSelection(a,b,c){let d=c.slice(0,a).join("").length;return a===b?{selectionStart:d,selectionEnd:d}:{selectionStart:d,selectionEnd:d+c.slice(a,b).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){let a=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=a.selectionStart,this.hiddenTextarea.selectionEnd=a.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};let a=this.hiddenTextarea;this.text=a.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();let b=this.fromStringToGraphemeSelection(a.selectionStart,a.selectionEnd,a.value);this.selectionEnd=this.selectionStart=b.selectionEnd,this.inCompositionMode||(this.selectionStart=b.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){let a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};let a=this.inCompositionMode?this.compositionStart:this.selectionStart,b=this._getCursorBoundaries(a),c=this.get2DCursorLocation(a),d=c.lineIndex,e=c.charIndex,f=this.getValueOfPropertyAt(d,e,"fontSize")*this.lineHeight,g=b.leftOffset,h=this.getCanvasRetinaScaling(),i=this.canvas.upperCanvasEl,j=i.width/h,k=i.height/h,l=j-f,m=k-f,n=new as(b.left+g,b.top+b.topOffset+f).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new as(i.clientWidth/j,i.clientHeight/k));return n.x<0&&(n.x=0),n.x>l&&(n.x=l),n.y<0&&(n.y=0),n.y>m&&(n.y=m),n.x+=this.canvas._offset.left,n.y+=this.canvas._offset.top,{left:"".concat(n.x,"px"),top:"".concat(n.y,"px"),fontSize:"".concat(f,"px"),charHeight:f}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){let a=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){let a=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),a&&this.fire(ak),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(let a in this.styles)this._textLines[a]||delete this.styles[a]}removeStyleFromTo(a,b){let{lineIndex:c,charIndex:d}=this.get2DCursorLocation(a,!0),{lineIndex:e,charIndex:f}=this.get2DCursorLocation(b,!0);if(c!==e){if(this.styles[c])for(let a=d;a<this._unwrappedTextLines[c].length;a++)delete this.styles[c][a];if(this.styles[e])for(let a=f;a<this._unwrappedTextLines[e].length;a++){let b=this.styles[e][a];b&&(this.styles[c]||(this.styles[c]={}),this.styles[c][d+a-f]=b)}for(let a=c+1;a<=e;a++)delete this.styles[a];this.shiftLineStyles(e,c-e)}else if(this.styles[c]){let a=this.styles[c],b=f-d;for(let b=d;b<f;b++)delete a[b];for(let d in this.styles[c]){let c=parseInt(d,10);c>=f&&(a[c-b]=a[d],delete a[d])}}}shiftLineStyles(a,b){let c=Object.assign({},this.styles);for(let d in this.styles){let e=parseInt(d,10);e>a&&(this.styles[e+b]=c[e],c[e-b]||delete this.styles[e])}}insertNewlineStyleObject(a,b,c,d){let e={},f=this._unwrappedTextLines[a].length,g=f===b,h=!1;c||(c=1),this.shiftLineStyles(a,c);let i=this.styles[a]?this.styles[a][0===b?b:b-1]:void 0;for(let c in this.styles[a]){let d=parseInt(c,10);d>=b&&(h=!0,e[d-b]=this.styles[a][c],g&&0===b||delete this.styles[a][c])}let j=!1;for(h&&!g&&(this.styles[a+c]=e,j=!0),(j||f>b)&&c--;c>0;)d&&d[c-1]?this.styles[a+c]={0:x({},d[c-1])}:i?this.styles[a+c]={0:x({},i)}:delete this.styles[a+c],c--;this._forceClearCache=!0}insertCharStyleObject(a,b,c,d){this.styles||(this.styles={});let e=this.styles[a],f=e?x({},e):{};for(let a in c||(c=1),f){let d=parseInt(a,10);d>=b&&(e[d+c]=f[d],f[d-c]||delete e[d])}if(this._forceClearCache=!0,d){for(;c--;)Object.keys(d[c]).length&&(this.styles[a]||(this.styles[a]={}),this.styles[a][b+c]=x({},d[c]));return}if(!e)return;let g=e[b?b-1:1];for(;g&&c--;)this.styles[a][b+c]=x({},g)}insertNewStyleBlock(a,b,c){let d=this.get2DCursorLocation(b,!0),e=[0],f,g=0;for(let b=0;b<a.length;b++)"\n"===a[b]?e[++g]=0:e[g]++;for(e[0]>0&&(this.insertCharStyleObject(d.lineIndex,d.charIndex,e[0],c),c=c&&c.slice(e[0]+1)),g&&this.insertNewlineStyleObject(d.lineIndex,d.charIndex+e[0],g),f=1;f<g;f++)e[f]>0?this.insertCharStyleObject(d.lineIndex+f,0,e[f],c):c&&this.styles[d.lineIndex+f]&&c[0]&&(this.styles[d.lineIndex+f][0]=c[0]),c=c&&c.slice(e[f]+1);e[f]>0&&this.insertCharStyleObject(d.lineIndex+f,0,e[f],c)}removeChars(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a+1;this.removeStyleFromTo(a,b),this._text.splice(a,b-a),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(a,b,c){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;d>c&&this.removeStyleFromTo(c,d);let e=this.graphemeSplit(a);this.insertNewStyleBlock(e,c,b),this._text=[...this._text.slice(0,c),...e,...this._text.slice(d)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(a,b,c){c<=a?(b===a?this._selectionDirection=S:this._selectionDirection===U&&(this._selectionDirection=S,this.selectionEnd=a),this.selectionStart=c):c>a&&c<b?this._selectionDirection===U?this.selectionEnd=c:this.selectionStart=c:(b===a?this._selectionDirection=U:this._selectionDirection===S&&(this._selectionDirection=U,this.selectionStart=b),this.selectionEnd=c)}}class fg extends ff{initHiddenTextarea(){let a=this.canvas&&a7(this.canvas.getElement())||I().document,b=a.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off",name:"fabricTextarea"}).map(a=>{let[c,d]=a;return b.setAttribute(c,d)});let{top:c,left:d,fontSize:e}=this._calcTextareaPosition();b.style.cssText="position: absolute; top: ".concat(c,"; left: ").concat(d,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(e,";"),(this.hiddenTextareaContainer||a.body).appendChild(b),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(a=>{let[c,d]=a;return b.addEventListener(c,this[d].bind(this))}),this.hiddenTextarea=b}blur(){this.abortCursorAnimation()}onKeyDown(a){if(!this.isEditing)return;let b="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(a.keyCode in b)this[b[a.keyCode]](a);else{if(!(a.keyCode in this.ctrlKeysMapDown)||!a.ctrlKey&&!a.metaKey)return;this[this.ctrlKeysMapDown[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(a){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey)&&(this[this.ctrlKeysMapUp[a.keyCode]](a),a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(a){let b=this.fromPaste,{value:c,selectionStart:d,selectionEnd:e}=this.hiddenTextarea;if(this.fromPaste=!1,a&&a.stopPropagation(),!this.isEditing)return;let f=()=>{this.updateFromTextArea(),this.fire(ac),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void f();let g=this._splitTextIntoLines(c).graphemeText,h=this._text.length,i=g.length,j=this.selectionStart,k=this.selectionEnd,l=j!==k,m,n,o,p,q=i-h,r=this.fromStringToGraphemeSelection(d,e,c),s=j>r.selectionStart;l?(n=this._text.slice(j,k),q+=k-j):i<h&&(n=s?this._text.slice(k+q,k):this._text.slice(j,j-q));let t=g.slice(r.selectionEnd-q,r.selectionEnd);if(n&&n.length&&(t.length&&(m=this.getSelectionStyles(j,j+1,!1),m=t.map(()=>m[0])),l?(o=j,p=k):s?(o=k-n.length,p=k):(o=k,p=k+n.length),this.removeStyleFromTo(o,p)),t.length){let{copyPasteData:a}=I();b&&t.join("")===a.copiedText&&!B.disableStyleCopyPaste&&(m=a.copiedTextStyle),this.insertNewStyleBlock(t,j,m)}f()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(a){let{target:b}=a,{selectionStart:c,selectionEnd:d}=b;this.compositionStart=c,this.compositionEnd=d,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;let{copyPasteData:a}=I();a.copiedText=this.getSelectedText(),B.disableStyleCopyPaste?a.copiedTextStyle=void 0:a.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(a,b){let c,d=this._getLineLeftOffset(a);return b>0&&(d+=(c=this.__charBounds[a][b-1]).left+c.width),d}getDownCursorOffset(a,b){let c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(e===this._textLines.length-1||a.metaKey||34===a.keyCode)return this._text.length-c;let f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e+1,g);return this._textLines[e].slice(f).length+h+1+this.missingNewlineOffset(e)}_getSelectionForOffset(a,b){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&b?this.selectionEnd:this.selectionStart}getUpCursorOffset(a,b){let c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(0===e||a.metaKey||33===a.keyCode)return-c;let f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e-1,g),i=this._textLines[e].slice(0,f),j=this.missingNewlineOffset(e-1);return-this._textLines[e-1].length+h-i.length+(1-j)}_getIndexOnLine(a,b){let c=this._textLines[a],d,e,f=this._getLineLeftOffset(a),g=0;for(let h=0,i=c.length;h<i;h++)if((f+=d=this.__charBounds[a][h].width)>b){e=!0;let a=Math.abs(f-d-b);g=Math.abs(f-b)<a?h:h-1;break}return e||(g=c.length-1),g}moveCursorDown(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)}moveCursorUp(a){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",a)}_moveCursorUpOrDown(a,b){let c=this["get".concat(a,"CursorOffset")](b,this._selectionDirection===U);if(b.shiftKey?this.moveCursorWithShift(c):this.moveCursorWithoutShift(c),0!==c){let a=this.text.length;this.selectionStart=cl(0,this.selectionStart,a),this.selectionEnd=cl(0,this.selectionEnd,a),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(a){let b=this._selectionDirection===S?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,b),0!==a}moveCursorWithoutShift(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),0!==a}moveCursorLeft(a){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",a)}_move(a,b,c){let d;if(a.altKey)d=this["findWordBoundary".concat(c)](this[b]);else{if(!a.metaKey&&35!==a.keyCode&&36!==a.keyCode)return this[b]+="Left"===c?-1:1,!0;d=this["findLineBoundary".concat(c)](this[b])}return void 0!==d&&this[b]!==d&&(this[b]=d,!0)}_moveLeft(a,b){return this._move(a,b,"Left")}_moveRight(a,b){return this._move(a,b,"Right")}moveCursorLeftWithoutShift(a){let b=!0;return this._selectionDirection=S,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(b=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,b}moveCursorLeftWithShift(a){return this._selectionDirection===U&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=S,this._moveLeft(a,"selectionStart")):void 0}moveCursorRight(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)}_moveCursorLeftOrRight(a,b){let c="moveCursor".concat(a).concat(b.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[c](b)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(a){return this._selectionDirection===S&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=U,this._moveRight(a,"selectionEnd")):void 0}moveCursorRightWithoutShift(a){let b=!0;return this._selectionDirection=U,this.selectionStart===this.selectionEnd?(b=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,b}}class fh extends fg{constructor(){super(...arguments),v(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new fd(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(a){return this.draggableTextDelegate.onDragStart(a)}canDrop(a){return this.draggableTextDelegate.canDrop(a)}doubleClickHandler(a){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(a.e)),this.renderCursorOrSelection())}tripleClickHandler(a){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(a.e)),this.renderCursorOrSelection())}_mouseDownHandler(a){let{e:b,alreadySelected:c}=a;this.canvas&&this.editable&&!b.button&&!this.getActiveControl()&&(this.draggableTextDelegate.start(b)||(this.canvas.textEditingManager.register(this),c&&(this.inCompositionMode=!1,this.setCursorByClick(b)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=c||this.isEditing)))}mouseUpHandler(a){let{e:b,transform:c}=a,d=this.draggableTextDelegate.end(b);if(this.canvas){this.canvas.textEditingManager.unregister(this);let a=this.canvas._activeObject;if(a&&a!==this)return}!this.editable||this.group&&!this.group.interactive||c&&c.actionPerformed||b.button||d||this.selected&&!this.getActiveControl()&&(this.enterEditing(b),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(a){let b=this.getSelectionStartFromPointer(a),c=this.selectionStart,d=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(c,d,b):(this.selectionStart=b,this.selectionEnd=b),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(a){let b=this.canvas.getScenePoint(a).transform(aK(this.calcTransformMatrix())).add(new as(-this._getLeftOffset(),-this._getTopOffset())),c=0,d=0,e=0;for(let a=0;a<this._textLines.length&&c<=b.y;a++)c+=this.getHeightOfLine(a),e=a,a>0&&(d+=this._textLines[a-1].length+this.missingNewlineOffset(a-1));let f=Math.abs(this._getLineLeftOffset(e)),g=this._textLines[e].length,h=this.__charBounds[e];for(let a=0;a<g;a++){let c=f+h[a].kernedWidth;if(b.x<=c){Math.abs(b.x-c)<=Math.abs(b.x-f)&&d++;break}f=c,d++}return Math.min(this.flipX?g-d:d,this._text.length)}}let fi="moveCursorUp",fj="moveCursorDown",fk="moveCursorLeft",fl="moveCursorRight",fm="exitEditing",fn=(a,b)=>{let c=b.getRetinaScaling();a.setTransform(c,0,0,c,0,0);let d=b.viewportTransform;a.transform(d[0],d[1],d[2],d[3],d[4],d[5])},fo=x({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:fm,27:fm,33:fi,34:fj,35:fl,36:fk,37:fk,38:fi,39:fl,40:fj},keysMapRtl:{9:fm,27:fm,33:fi,34:fj,35:fk,36:fl,37:fl,38:fi,39:fk,40:fj},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class fp extends fh{static getDefaults(){return x(x({},super.getDefaults()),fp.ownDefaults)}get type(){let a=super.type;return"itext"===a?"i-text":a}constructor(a,b){super(a,x(x({},fp.ownDefaults),b)),this.initBehavior()}_set(a,b){return this.isEditing&&this._savedProps&&a in this._savedProps?(this._savedProps[a]=b,this):("canvas"===a&&(this.canvas instanceof eE&&this.canvas.textEditingManager.remove(this),b instanceof eE&&b.textEditingManager.add(this)),super._set(a,b))}setSelectionStart(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)}setSelectionEnd(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)}_updateAndFire(a,b){this[a]!==b&&(this._fireSelectionChanged(),this[a]=b),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,c=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(a,b,c)}setSelectionStyles(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(a,b,c)}get2DCursorLocation(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,b=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(a,b)}render(a){super.render(a),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(a){let b=this.isEditing;this.isEditing=!1;let c=super.toCanvasElement(a);return this.isEditing=b,c}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;let a=this.clearContextTop(!0);if(!a)return;let b=this._getCursorBoundaries(),c=this.findAncestorsWithClipPath(),d=c.length>0,e,f=a;if(d){fn(f=(e=aD(a.canvas)).getContext("2d"),this.canvas);let b=this.calcTransformMatrix();f.transform(b[0],b[1],b[2],b[3],b[4],b[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(f,b):this.renderCursor(f,b),d)for(let b of c){let c=b.clipPath,d=aD(a.canvas),e=d.getContext("2d");if(fn(e,this.canvas),!c.absolutePositioned){let a=b.calcTransformMatrix();e.transform(a[0],a[1],a[2],a[3],a[4],a[5])}c.transform(e),c.drawObject(e,!0,{}),this.drawClipPathOnCache(f,c,d)}d&&(a.setTransform(1,0,0,1,0,0),a.drawImage(e,0,0)),this.canvas.contextTopDirty=!0,a.restore()}findAncestorsWithClipPath(){let a=[],b=this;for(;b;)b.clipPath&&a.push(b),b=b.parent;return a}_getCursorBoundaries(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,b=arguments.length>1?arguments[1]:void 0,c=this._getLeftOffset(),d=this._getTopOffset(),e=this._getCursorBoundariesOffsets(a,b);return{left:c,top:d,leftOffset:e.left,topOffset:e.top}}_getCursorBoundariesOffsets(a,b){return b?this.__getCursorBoundariesOffsets(a):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(a)}__getCursorBoundariesOffsets(a){let b=0,c=0,{charIndex:d,lineIndex:e}=this.get2DCursorLocation(a);for(let a=0;a<e;a++)b+=this.getHeightOfLine(a);let f=this._getLineLeftOffset(e),g=this.__charBounds[e][d];g&&(c=g.left),0!==this.charSpacing&&d===this._textLines[e].length&&(c-=this._getWidthOfCharSpacing());let h={top:b,left:f+(c>0?c:0)};return"rtl"===this.direction&&(this.textAlign===U||this.textAlign===bX||this.textAlign===bZ?h.left*=-1:this.textAlign===S||this.textAlign===bY?h.left=f-(c>0?c:0):this.textAlign!==R&&this.textAlign!==b$||(h.left=f-(c>0?c:0))),h}renderCursorAt(a){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(a,!0),a)}renderCursor(a,b){this._renderCursor(a,b,this.selectionStart)}getCursorRenderingData(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(a),c=this.get2DCursorLocation(a),d=c.lineIndex,e=c.charIndex>0?c.charIndex-1:0,f=this.getValueOfPropertyAt(d,e,"fontSize"),g=this.getObjectScaling().x*this.canvas.getZoom(),h=this.cursorWidth/g,i=this.getValueOfPropertyAt(d,e,"deltaY"),j=b.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(d)/this.lineHeight-f*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(d,e,"fill"),opacity:this._currentCursorOpacity,left:b.left+b.leftOffset-h/2,top:j+b.top+i,width:h,height:f}}_renderCursor(a,b,c){let{color:d,opacity:e,left:f,top:g,width:h,height:i}=this.getCursorRenderingData(c,b);a.fillStyle=d,a.globalAlpha=e,a.fillRect(f,g,h,i)}renderSelection(a,b){let c={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(a,c,b)}renderDragSourceEffect(){let a=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,a,this._getCursorBoundaries(a.selectionStart,!0))}renderDropTargetEffect(a){let b=this.getSelectionStartFromPointer(a);this.renderCursorAt(b)}_renderSelection(a,b,c){let d=b.selectionStart,e=b.selectionEnd,f=this.textAlign.includes(bX),g=this.get2DCursorLocation(d),h=this.get2DCursorLocation(e),i=g.lineIndex,j=h.lineIndex,k=g.charIndex<0?0:g.charIndex,l=h.charIndex<0?0:h.charIndex;for(let b=i;b<=j;b++){let d=this._getLineLeftOffset(b)||0,e=this.getHeightOfLine(b),g=0,h=0,m=0;if(b===i&&(h=this.__charBounds[i][k].left),b>=i&&b<j)m=f&&!this.isEndOfWrapping(b)?this.width:this.getLineWidth(b)||5;else if(b===j)if(0===l)m=this.__charBounds[j][l].left;else{let a=this._getWidthOfCharSpacing();m=this.__charBounds[j][l-1].left+this.__charBounds[j][l-1].width-a}g=e,(this.lineHeight<1||b===j&&this.lineHeight>1)&&(e/=this.lineHeight);let n=c.left+d+h,o=e,p=0,q=m-h;this.inCompositionMode?(a.fillStyle=this.compositionColor||"black",o=1,p=e):a.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===U||this.textAlign===bX||this.textAlign===bZ?n=this.width-n-q:this.textAlign===S||this.textAlign===bY?n=c.left+d-m:this.textAlign!==R&&this.textAlign!==b$||(n=c.left+d-m)),a.fillRect(n,c.top+c.topOffset+p,q,o),c.topOffset+=g}}getCurrentCharFontSize(){let a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")}getCurrentCharColor(){let a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,ai)}_getCurrentCharIndex(){let a=this.get2DCursorLocation(this.selectionStart,!0),b=a.charIndex>0?a.charIndex-1:0;return{l:a.lineIndex,c:b}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}v(fp,"ownDefaults",fo),v(fp,"type","IText"),am.setClass(fp),am.setClass(fp,"i-text");class fq extends fp{static getDefaults(){return x(x({},super.getDefaults()),fq.ownDefaults)}constructor(a,b){super(a,x(x({},fq.ownDefaults),b))}static createControls(){return{controls:dd()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(bX)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(a){let b=0,c=0,d=0,e={};for(let f=0;f<a.graphemeLines.length;f++)"\n"===a.graphemeText[d]&&f>0?(c=0,d++,b++):!this.splitByGrapheme&&this._reSpaceAndTab.test(a.graphemeText[d])&&f>0&&(c++,d++),e[f]={line:b,offset:c},d+=a.graphemeLines[f].length,c+=a.graphemeLines[f].length;return e}styleHas(a,b){if(this._styleMap&&!this.isWrapping){let a=this._styleMap[b];a&&(b=a.line)}return super.styleHas(a,b)}isEmptyStyles(a){if(!this.styles)return!0;let b,c=0,d=!1,e=this._styleMap[a],f=this._styleMap[a+1];e&&(a=e.line,c=e.offset),f&&(d=f.line===a,b=f.offset);let g=void 0===a?this.styles:{line:this.styles[a]};for(let a in g)for(let e in g[a]){let f=parseInt(e,10);if(f>=c&&(!d||f<b))for(let b in g[a][e])return!1}return!0}_getStyleDeclaration(a,b){if(this._styleMap&&!this.isWrapping){let c=this._styleMap[a];if(!c)return{};a=c.line,b=c.offset+b}return super._getStyleDeclaration(a,b)}_setStyleDeclaration(a,b,c){let d=this._styleMap[a];super._setStyleDeclaration(d.line,d.offset+b,c)}_deleteStyleDeclaration(a,b){let c=this._styleMap[a];super._deleteStyleDeclaration(c.line,c.offset+b)}_getLineStyle(a){let b=this._styleMap[a];return!!this.styles[b.line]}_setLineStyle(a){let b=this._styleMap[a];super._setLineStyle(b.line)}_wrapText(a,b){this.isWrapping=!0;let c=this.getGraphemeDataForRender(a),d=[];for(let a=0;a<c.wordsData.length;a++)d.push(...this._wrapLine(a,b,c));return this.isWrapping=!1,d}getGraphemeDataForRender(a){let b=this.splitByGrapheme,c=b?"":" ",d=0;return{wordsData:a.map((a,e)=>{let f=0,g=b?this.graphemeSplit(a):this.wordSplit(a);return 0===g.length?[{word:[],width:0}]:g.map(a=>{let g=b?[a]:this.graphemeSplit(a),h=this._measureWord(g,e,f);return d=Math.max(h,d),f+=g.length+c.length,{word:g,width:h}})}),largestWordWidth:d}}_measureWord(a,b){let c,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=0;for(let f=0,g=a.length;f<g;f++)e+=this._getGraphemeBox(a[f],b,f+d,c,!0).kernedWidth,c=a[f];return e}wordSplit(a){return a.split(this._wordJoiners)}_wrapLine(a,b,c){let d,{largestWordWidth:e,wordsData:f}=c,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=this._getWidthOfCharSpacing(),i=this.splitByGrapheme,j=[],k=i?"":" ",l=0,m=[],n=0,o=0,p=!0,q=Math.max(b-=g,e,this.dynamicMinWidth),r=f[a];for(n=0,d=0;d<r.length;d++){let{word:b,width:c}=r[d];n+=b.length,(l+=o+c-h)>q&&!p?(j.push(m),m=[],l=c,p=!0):l+=h,p||i||m.push(k),m=m.concat(b),o=i?0:this._measureWord([k],a,n),n++,p=!1}return d&&j.push(m),e+g>this.dynamicMinWidth&&(this.dynamicMinWidth=e-h+g),j}isEndOfWrapping(a){return!this._styleMap[a+1]||this._styleMap[a+1].line!==this._styleMap[a].line}missingNewlineOffset(a,b){return this.splitByGrapheme&&!b?+!!this.isEndOfWrapping(a):1}_splitTextIntoLines(a){let b=super._splitTextIntoLines(a),c=this._wrapText(b.lines,this.width),d=Array(c.length);for(let a=0;a<c.length;a++)d[a]=c[a].join("");return b.lines=d,b.graphemeLines=c,b}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){let a=new Map;for(let b in this._styleMap){let c=parseInt(b,10);if(this._textLines[c]){let c=this._styleMap[b].line;a.set("".concat(c),!0)}}for(let b in this.styles)a.has(b)||delete this.styles[b]}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...a])}}v(fq,"type","Textbox"),v(fq,"textLayoutProperties",[...fp.textLayoutProperties,"width"]),v(fq,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),am.setClass(fq);class fr extends dX{shouldPerformLayout(a){return!!a.target.clipPath&&super.shouldPerformLayout(a)}shouldLayoutClipPath(){return!1}calcLayoutResult(a,b){let{target:c}=a,{clipPath:d,group:e}=c;if(!d||!this.shouldPerformLayout(a))return;let{width:f,height:g}=bk(dW(c,d)),h=new as(f,g);if(d.absolutePositioned)return{center:bs(d.getRelativeCenterPoint(),void 0,e?e.calcTransformMatrix():void 0),size:h};{let e=d.getRelativeCenterPoint().transform(c.calcOwnMatrix(),!0);if(this.shouldPerformLayout(a)){let{center:c=new as,correction:d=new as}=this.calcBoundingBox(b,a)||{};return{center:c.add(e),correction:d.subtract(e),size:h}}return{center:c.getRelativeCenterPoint().add(e),size:h}}}}v(fr,"type","clip-path"),am.setClass(fr);class fs extends dX{getInitialSize(a,b){let{target:c}=a,{size:d}=b;return new as(c.width||d.x,c.height||d.y)}}v(fs,"type","fixed"),am.setClass(fs);class ft extends d0{subscribeTargets(a){let b=a.target;a.targets.reduce((a,b)=>(b.parent&&a.add(b.parent),a),new Set).forEach(a=>{a.layoutManager.subscribeTargets({target:a,targets:[b]})})}unsubscribeTargets(a){let b=a.target,c=b.getObjects();a.targets.reduce((a,b)=>(b.parent&&a.add(b.parent),a),new Set).forEach(a=>{c.some(b=>b.parent===a)||a.layoutManager.unsubscribeTargets({target:a,targets:[b]})})}}class fu extends d3{static getDefaults(){return x(x({},super.getDefaults()),fu.ownDefaults)}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,fu.ownDefaults),this.setOptions(b);const{left:c,top:d,layoutManager:e}=b;this.groupInit(a,{left:c,top:d,layoutManager:null!=e?e:new ft})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];"selection-order"===this.multiSelectionStacking?this.add(...b):b.forEach(a=>{let b=this._objects.findIndex(b=>b.isInFrontOf(a)),c=-1===b?this.size():b;this.insertAt(c,a)})}canEnterGroup(a){return this.getObjects().some(b=>b.isDescendantOf(a)||a.isDescendantOf(b))?(C("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(a)}enterGroup(a,b){a.parent&&a.parent===a.group?a.parent._exitGroup(a):a.group&&a.parent!==a.group&&a.group.remove(a),this._enterGroup(a,b)}exitGroup(a,b){this._exitGroup(a,b),a.parent&&a.parent._enterGroup(a,!0)}_onAfterObjectsChange(a,b){super._onAfterObjectsChange(a,b);let c=new Set;b.forEach(a=>{let{parent:b}=a;b&&c.add(b)}),a===dU?c.forEach(a=>{a._onAfterObjectsChange(dT,b)}):c.forEach(a=>{a._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(a,b,c){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;let d=x(x({hasControls:!1},c),{},{forActiveSelection:!0});for(let b=0;b<this._objects.length;b++)this._objects[b]._renderControls(a,d);super._renderControls(a,b),a.restore()}}v(fu,"type","ActiveSelection"),v(fu,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),am.setClass(fu),am.setClass(fu,"activeSelection");class fv{constructor(){v(this,"resources",{})}applyFilters(a,b,c,d,e){let f=e.getContext("2d");if(!f)return;f.drawImage(b,0,0,c,d);let g={sourceWidth:c,sourceHeight:d,imageData:f.getImageData(0,0,c,d),originalEl:b,originalImageData:f.getImageData(0,0,c,d),canvasEl:e,ctx:f,filterBackend:this};a.forEach(a=>{a.applyTo(g)});let{imageData:h}=g;return h.width===c&&h.height===d||(e.width=h.width,e.height=h.height),f.putImageData(h,0,0),g}}class fw{constructor(){let{tileSize:a=B.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),v(this,"resources",{}),this.tileSize=a,this.setupGLContext(a,a),this.captureGPUInfo()}setupGLContext(a,b){this.dispose(),this.createWebGLCanvas(a,b)}createWebGLCanvas(a,b){let c=aD({width:a,height:b}),d=c.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});d&&(d.clearColor(0,0,0,0),this.canvas=c,this.gl=d)}applyFilters(a,b,c,d,e,f){let g,h,i,j,k,l,m=this.gl,n=e.getContext("2d");if(!m||!n)return;f&&(g=this.getCachedTexture(f,b));let o={originalWidth:b.width||b.naturalWidth||0,originalHeight:b.height||b.naturalHeight||0,sourceWidth:c,sourceHeight:d,destinationWidth:c,destinationHeight:d,context:m,sourceTexture:this.createTexture(m,c,d,g?void 0:b),targetTexture:this.createTexture(m,c,d),originalTexture:g||this.createTexture(m,c,d,g?void 0:b),passes:a.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:e},p=m.createFramebuffer();return m.bindFramebuffer(m.FRAMEBUFFER,p),a.forEach(a=>{a&&a.applyTo(o)}),i=(h=o.targetCanvas).width,j=h.height,k=o.destinationWidth,l=o.destinationHeight,i===k&&j===l||(h.width=k,h.height=l),this.copyGLTo2D(m,o),m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(o.sourceTexture),m.deleteTexture(o.targetTexture),m.deleteFramebuffer(p),n.setTransform(1,0,0,1,0,0),o}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(a,b,c,d,e){let{NEAREST:f,TEXTURE_2D:g,RGBA:h,UNSIGNED_BYTE:i,CLAMP_TO_EDGE:j,TEXTURE_MAG_FILTER:k,TEXTURE_MIN_FILTER:l,TEXTURE_WRAP_S:m,TEXTURE_WRAP_T:n}=a,o=a.createTexture();return a.bindTexture(g,o),a.texParameteri(g,k,e||f),a.texParameteri(g,l,e||f),a.texParameteri(g,m,j),a.texParameteri(g,n,j),d?a.texImage2D(g,0,h,h,i,d):a.texImage2D(g,0,h,b,c,0,h,i,null),o}getCachedTexture(a,b,c){let{textureCache:d}=this;if(d[a])return d[a];{let e=this.createTexture(this.gl,b.width,b.height,b,c);return e&&(d[a]=e),e}}evictCachesForKey(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])}copyGLTo2D(a,b){let c=a.canvas,d=b.targetCanvas,e=d.getContext("2d");if(!e)return;e.translate(0,d.height),e.scale(1,-1);let f=c.height-d.height;e.drawImage(c,0,f,d.width,d.height,0,0,d.width,d.height)}copyGLTo2DPutImageData(a,b){let c=b.targetCanvas.getContext("2d"),d=b.destinationWidth,e=b.destinationHeight,f=d*e*4;if(!c)return;let g=new Uint8Array(this.imageBuffer,0,f),h=new Uint8ClampedArray(this.imageBuffer,0,f);a.readPixels(0,0,d,e,a.RGBA,a.UNSIGNED_BYTE,g);let i=new ImageData(h,d,e);c.putImageData(i,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;let a=this.gl,b={renderer:"",vendor:""};if(!a)return b;let c=a.getExtension("WEBGL_debug_renderer_info");if(c){let d=a.getParameter(c.UNMASKED_RENDERER_WEBGL),e=a.getParameter(c.UNMASKED_VENDOR_WEBGL);d&&(b.renderer=d.toLowerCase()),e&&(b.vendor=e.toLowerCase())}return this.gpuInfo=b,b}}function fx(){return e||arguments.length>0&&void 0!==arguments[0]&&!arguments[0]||(e=function(){let{WebGLProbe:a}=I();return a.queryWebGL(aB()),B.enableGLFiltering&&a.isSupported(B.textureSize)?new fw({tileSize:B.textureSize}):new fv}()),e}let fy=["filters","resizeFilter","src","crossOrigin","type"],fz=["cropX","cropY"];class fA extends dg{static getDefaults(){return x(x({},super.getDefaults()),fA.ownDefaults)}constructor(a,b){super(),v(this,"_lastScaleX",1),v(this,"_lastScaleY",1),v(this,"_filterScalingX",1),v(this,"_filterScalingY",1),this.filters=[],Object.assign(this,fA.ownDefaults),this.setOptions(b),this.cacheKey="texture".concat(aA()),this.setElement("string"==typeof a?(this.canvas&&a7(this.canvas.getElement())||I().document).getElementById(a):a,b)}getElement(){return this._element}setElement(a){var b;let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=a,this._originalElement=a,this._setWidthHeight(c),null==(b=a.classList)||b.add(fA.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(a){let b=fx(!1);b instanceof fw&&b.evictCachesForKey(a)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(a=>{let b=this[a];b&&I().dispose(b),this[a]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){let a=this.getElement();return a?{width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}:{width:0,height:0}}_stroke(a){if(!this.stroke||0===this.strokeWidth)return;let b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,-c),a.lineTo(b,-c),a.lineTo(b,c),a.lineTo(-b,c),a.lineTo(-b,-c),a.closePath()}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=[];return this.filters.forEach(a=>{a&&b.push(a.toObject())}),x(x({},super.toObject([...fz,...a])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:b},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){let a=[],b=this._element,c=-this.width/2,d=-this.height/2,e=[],f=[],g="",h="";if(!b)return[];if(this.hasCrop()){let a=aA();e.push('<clipPath id="imageCrop_'+a+'">\n','	<rect x="'+c+'" y="'+d+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),g=' clip-path="url(#imageCrop_'+a+')" '}if(this.imageSmoothing||(h=' image-rendering="optimizeSpeed"'),a.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(c-this.cropX,'" y="').concat(d-this.cropY,'" width="').concat(b.width||b.naturalWidth,'" height="').concat(b.height||b.naturalHeight,'"').concat(h).concat(g,"></image>\n")),this.stroke||this.strokeDashArray){let a=this.fill;this.fill=null,f=['	<rect x="'.concat(c,'" y="').concat(d,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=a}return this.paintFirst!==ai?e.concat(f,a):e.concat(a,f)}getSrc(a){let b=a?this._element:this._originalElement;return b?b.toDataURL?b.toDataURL():this.srcFromAttribute?b.getAttribute("src")||"":b.src:this.src||""}getSvgSrc(a){return this.getSrc(a)}setSrc(a){let{crossOrigin:b,signal:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return aX(a,{crossOrigin:b,signal:c}).then(a=>{void 0!==b&&this.set({crossOrigin:b}),this.setElement(a)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){let a=this.resizeFilter,b=this.minimumScaleTrigger,c=this.getTotalObjectScaling(),d=c.x,e=c.y,f=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!a||d>b&&e>b)return this._element=f,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=d,void(this._lastScaleY=e);let g=aD(f),{width:h,height:i}=f;this._element=g,this._lastScaleX=a.scaleX=d,this._lastScaleY=a.scaleY=e,fx().applyFilters([a],f,h,i,this._element),this._filterScalingX=g.width/this._originalElement.width,this._filterScalingY=g.height/this._originalElement.height}applyFilters(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(a=a.filter(a=>a&&!a.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===a.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);let b=this._originalElement,c=b.naturalWidth||b.width,d=b.naturalHeight||b.height;if(this._element===this._originalElement){let a=aD({width:c,height:d});this._element=a,this._filteredEl=a}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,c,d),this._lastScaleX=1,this._lastScaleY=1);fx().applyFilters(a,this._originalElement,c,d,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(a){a.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(a),this._renderPaintInOrder(a)}drawCacheOnCanvas(a){a.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(a)}shouldCache(){return this.needsItsOwnCache()}_renderFill(a){let b=this._element;if(!b)return;let c=this._filterScalingX,d=this._filterScalingY,e=this.width,f=this.height,g=Math.max(this.cropX,0),h=Math.max(this.cropY,0),i=b.naturalWidth||b.width,j=b.naturalHeight||b.height,k=g*c,l=h*d,m=Math.min(e*c,i-k),n=Math.min(f*d,j-l),o=Math.min(e,i/c-g),p=Math.min(f,j/d-h);b&&a.drawImage(b,k,l,m,n,-e/2,-f/2,o,p)}_needsResize(){let a=this.getTotalObjectScaling();return a.x!==this._lastScaleX||a.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:a,height:b}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=this.getOriginalSize();this.width=a||c.width,this.height=b||c.height}parsePreserveAspectRatioAttribute(){let a=bN(this.preserveAspectRatio||""),b=this.width,c=this.height,d={width:b,height:c},e,f=this._element.width,g=this._element.height,h=1,i=1,j=0,k=0,l=0,m=0;return a&&(a.alignX!==V||a.alignY!==V)?("meet"===a.meetOrSlice&&(e=(b-f*(h=i=d4(this._element,d)))/2,"Min"===a.alignX&&(j=-e),"Max"===a.alignX&&(j=e),e=(c-g*i)/2,"Min"===a.alignY&&(k=-e),"Max"===a.alignY&&(k=e)),"slice"===a.meetOrSlice&&(e=f-b/(h=i=d5(this._element,d)),"Mid"===a.alignX&&(l=e/2),"Max"===a.alignX&&(l=e),e=g-c/i,"Mid"===a.alignY&&(m=e/2),"Max"===a.alignY&&(m=e),f=b/h,g=c/i)):(h=b/f,i=c/g),{width:f,height:g,scaleX:h,scaleY:i,offsetLeft:j,offsetTop:k,cropX:l,cropY:m}}static fromObject(a,b){let{filters:c,resizeFilter:d,src:e,crossOrigin:f,type:g}=a,h=y(a,fy);return Promise.all([aX(e,x(x({},b),{},{crossOrigin:f})),c&&aY(c,b),d&&aY([d],b),aZ(h,b)]).then(a=>{let[b,c=[],[d]=[],f={}]=a;return new this(b,x(x({},h),{},{src:e,filters:c,resizeFilter:d},f))})}static fromURL(a){let{crossOrigin:b=null,signal:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return aX(a,{crossOrigin:b,signal:c}).then(a=>new this(a,d))}static async fromElement(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0,d=dO(a,this.ATTRIBUTE_NAMES,c);return this.fromURL(d["xlink:href"]||d.href,b,d).catch(a=>(C("log","Unable to parse Image",a),null))}}v(fA,"type","Image"),v(fA,"cacheProperties",[...cn,...fz]),v(fA,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),v(fA,"CSS_CANVAS","canvas-img"),v(fA,"ATTRIBUTE_NAMES",[...dx,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),am.setClass(fA),am.setSVGClass(fA),bQ(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);let fB=a=>function(b,c,d){let{points:e,pathOffset:f}=d;return new as(e[a]).subtract(f).transform(aL(d.getViewportTransform(),d.calcTransformMatrix()))},fC=(a,b,c,d)=>{let{target:e,pointIndex:f}=b,g=bs(new as(c,d),void 0,e.calcOwnMatrix());return e.points[f]=g.add(e.pathOffset),e.setDimensions(),e.set("dirty",!0),!0},fD=(a,b)=>function(c,d,e,f){let g=d.target,h=new as(g.points[(a>0?a:g.points.length)-1]),i=h.subtract(g.pathOffset).transform(g.calcOwnMatrix()),j=b(c,x(x({},d),{},{pointIndex:a}),e,f),k=h.subtract(g.pathOffset).transform(g.calcOwnMatrix()).subtract(i);return g.left-=k.x,g.top-=k.y,j},fE=a=>cL(ab,fD(a,fC)),fF=(a,b,c)=>{let{path:d,pathOffset:e}=a,f=d[b];return new as(f[c]-e.x,f[c+1]-e.y).transform(aL(a.getViewportTransform(),a.calcTransformMatrix()))};function fG(a,b,c){let{commandIndex:d,pointIndex:e}=this;return fF(c,d,e)}function fH(a,b,c,d){let{target:e}=b,{commandIndex:f,pointIndex:g}=this,h=((a,b,c,d,e)=>{let{path:f,pathOffset:g}=a,h=f[(d>0?d:f.length)-1],i=new as(h[e],h[e+1]),j=i.subtract(g).transform(a.calcOwnMatrix()),k=bs(new as(b,c),void 0,a.calcOwnMatrix());f[d][e]=k.x+g.x,f[d][e+1]=k.y+g.y,a.setDimensions();let l=i.subtract(a.pathOffset).transform(a.calcOwnMatrix()).subtract(j);return a.left-=l.x,a.top-=l.y,a.set("dirty",!0),!0})(e,c,d,f,g);return bv(this.actionName,x(x({},bB(a,b,c,d)),{},{commandIndex:f,pointIndex:g})),h}class fI extends cQ{constructor(a){super(a)}render(a,b,c,d,e){let f=x(x({},d),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(a,b,c,f,e)}}class fJ extends fI{constructor(a){super(a)}render(a,b,c,d,e){let{path:f}=e,{commandIndex:g,pointIndex:h,connectToCommandIndex:i,connectToPointIndex:j}=this;a.save(),a.strokeStyle=this.controlStroke,this.connectionDashArray&&a.setLineDash(this.connectionDashArray);let[k]=f[g],l=fF(e,i,j);if("Q"===k){let d=fF(e,g,h+2);a.moveTo(d.x,d.y),a.lineTo(b,c)}else a.moveTo(b,c);a.lineTo(l.x,l.y),a.stroke(),a.restore(),super.render(a,b,c,d,e)}}let fK=(a,b,c,d,e,f)=>new(c?fJ:fI)(x(x({commandIndex:a,pointIndex:b,actionName:"modifyPath",positionHandler:fG,actionHandler:fH,connectToCommandIndex:e,connectToPointIndex:f},d),c?d.controlPointStyle:d.pointStyle));Object.freeze({__proto__:null,changeWidth:cN,createObjectDefaultControls:db,createPathControls:function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c={},d="M";return a.path.forEach((a,e)=>{let f=a[0];switch("Z"!==f&&(c["c_".concat(e,"_").concat(f)]=fK(e,a.length-2,!1,b)),f){case"C":let g;c["c_".concat(e,"_C_CP_1")]=fK(e,1,!0,b,e-1,"C"===(g=d)?5:"Q"===g?3:1),c["c_".concat(e,"_C_CP_2")]=fK(e,3,!0,b,e,5);break;case"Q":c["c_".concat(e,"_Q_CP_1")]=fK(e,1,!0,b,e,3)}d=f}),c},createPolyActionHandler:fE,createPolyControls:function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c={};for(let d=0;d<("number"==typeof a?a:a.points.length);d++)c["p".concat(d)]=new cQ(x({actionName:ab,positionHandler:fB(d),actionHandler:fE(d)},b));return c},createPolyPositionHandler:fB,createResizeControls:dc,createTextboxDefaultControls:dd,dragHandler:bE,factoryPolyActionHandler:fD,getLocalPoint:bD,polyActionHandler:fC,renderCircleControl:cO,renderSquareControl:cP,rotationStyleHandler:cR,rotationWithSnapping:cS,scaleCursorStyleHandler:cW,scaleOrSkewActionName:c7,scaleSkewCursorStyleHandler:c8,scalingEqually:cY,scalingX:cZ,scalingXOrSkewingY:c9,scalingY:c$,scalingYOrSkewingX:da,skewCursorStyleHandler:c2,skewHandlerX:c4,skewHandlerY:c5,wrapWithFireEvent:cL,wrapWithFixedAnchor:cM});let fL="precision highp float",fM="\n    ".concat(fL,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),fN=["type"],fO=["type"],fP=RegExp(fL,"g");class fQ{get type(){return this.constructor.type}constructor(){let a=y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},fN);Object.assign(this,this.constructor.defaults,a)}getFragmentSource(){return fM}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource(),{WebGLProbe:{GLPrecision:d="highp"}}=I();"highp"!==d&&(b=b.replace(fP,fL.replace("highp",d)));let e=a.createShader(a.VERTEX_SHADER),f=a.createShader(a.FRAGMENT_SHADER),g=a.createProgram();if(!e||!f||!g)throw new D("Vertex, fragment shader or program creation error");if(a.shaderSource(e,c),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw new D("Vertex shader compile error for ".concat(this.type,": ").concat(a.getShaderInfoLog(e)));if(a.shaderSource(f,b),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))throw new D("Fragment shader compile error for ".concat(this.type,": ").concat(a.getShaderInfoLog(f)));if(a.attachShader(g,e),a.attachShader(g,f),a.linkProgram(g),!a.getProgramParameter(g,a.LINK_STATUS))throw new D('Shader link error for "'.concat(this.type,'" ').concat(a.getProgramInfoLog(g)));let h=this.getUniformLocations(a,g)||{};return h.uStepW=a.getUniformLocation(g,"uStepW"),h.uStepH=a.getUniformLocation(g,"uStepH"),{program:g,attributeLocations:this.getAttributeLocations(a,g),uniformLocations:h}}getAttributeLocations(a,b){return{aPosition:a.getAttribLocation(b,"aPosition")}}getUniformLocations(a,b){let c=this.constructor.uniformLocations,d={};for(let e=0;e<c.length;e++)d[c[e]]=a.getUniformLocation(b,c[e]);return d}sendAttributeData(a,b,c){let d=b.aPosition,e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e),a.enableVertexAttribArray(d),a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW)}_setupFrameBuffer(a){let b=a.context;if(a.passes>1){let c=a.destinationWidth,d=a.destinationHeight;a.sourceWidth===c&&a.sourceHeight===d||(b.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(b,c,d)),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a.targetTexture,0)}else b.bindFramebuffer(b.FRAMEBUFFER,null),b.finish()}_swapTextures(a){a.passes--,a.pass++;let b=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=b}isNeutralState(a){return!1}applyTo(a){void 0!==a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)}applyTo2d(a){}getCacheKey(){return this.type}retrieveShader(a){let b=this.getCacheKey();return a.programCache[b]||(a.programCache[b]=this.createProgram(a.context)),a.programCache[b]}applyToWebGL(a){let b=a.context,c=this.retrieveShader(a);0===a.pass&&a.originalTexture?b.bindTexture(b.TEXTURE_2D,a.originalTexture):b.bindTexture(b.TEXTURE_2D,a.sourceTexture),b.useProgram(c.program),this.sendAttributeData(b,c.attributeLocations,a.aPosition),b.uniform1f(c.uniformLocations.uStepW,1/a.sourceWidth),b.uniform1f(c.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(b,c.uniformLocations),b.viewport(0,0,a.destinationWidth,a.destinationHeight),b.drawArrays(b.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(a,b,c){a.activeTexture(c),a.bindTexture(a.TEXTURE_2D,b),a.activeTexture(a.TEXTURE0)}unbindAdditionalTexture(a,b){a.activeTexture(b),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)}sendUniformData(a,b){}createHelpLayer(a){if(!a.helpLayer){let{sourceWidth:b,sourceHeight:c}=a;a.helpLayer=aD({width:b,height:c})}}toObject(){let a=Object.keys(this.constructor.defaults||{});return x({type:this.type},a.reduce((a,b)=>(a[b]=this[b],a),{}))}toJSON(){return this.toObject()}static async fromObject(a,b){return new this(y(a,fO))}}v(fQ,"type","BaseFilter"),v(fQ,"uniformLocations",[]);let fR={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class fS extends fQ{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(fR[this.mode],"\n        }\n      }\n      ")}applyTo2d(a){let{imageData:{data:b}}=a,c=new bL(this.color).getSource(),d=this.alpha,e=c[0]*d,f=c[1]*d,g=c[2]*d,h=1-d;for(let a=0;a<b.length;a+=4){let c,d,i,j=b[a],k=b[a+1],l=b[a+2];switch(this.mode){case"multiply":c=j*e/255,d=k*f/255,i=l*g/255;break;case"screen":c=255-(255-j)*(255-e)/255,d=255-(255-k)*(255-f)/255,i=255-(255-l)*(255-g)/255;break;case"add":c=j+e,d=k+f,i=l+g;break;case"difference":c=Math.abs(j-e),d=Math.abs(k-f),i=Math.abs(l-g);break;case"subtract":c=j-e,d=k-f,i=l-g;break;case"darken":c=Math.min(j,e),d=Math.min(k,f),i=Math.min(l,g);break;case"lighten":c=Math.max(j,e),d=Math.max(k,f),i=Math.max(l,g);break;case"overlay":c=e<128?2*j*e/255:255-2*(255-j)*(255-e)/255,d=f<128?2*k*f/255:255-2*(255-k)*(255-f)/255,i=g<128?2*l*g/255:255-2*(255-l)*(255-g)/255;break;case"exclusion":c=e+j-2*e*j/255,d=f+k-2*f*k/255,i=g+l-2*g*l/255;break;case"tint":c=e+j*h,d=f+k*h,i=g+l*h}b[a]=c,b[a+1]=d,b[a+2]=i}}sendUniformData(a,b){let c=new bL(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,a.uniform4fv(b.uColor,c)}}v(fS,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),v(fS,"type","BlendColor"),v(fS,"uniformLocations",["uColor"]),am.setClass(fS);let fT={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},fU=["type","image"];class fV extends fQ{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return fT[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(a){let b=a.context,c=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(b,c,b.TEXTURE1),super.applyToWebGL(a),this.unbindAdditionalTexture(b,b.TEXTURE1)}createTexture(a,b){return a.getCachedTexture(b.cacheKey,b.getElement())}calculateMatrix(){let a=this.image,{width:b,height:c}=a.getElement();return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/b,-a.top/c,1]}applyTo2d(a){let{imageData:{data:b,width:c,height:d},filterBackend:{resources:e}}=a,f=this.image;e.blendImage||(e.blendImage=aB());let g=e.blendImage,h=g.getContext("2d");g.width!==c||g.height!==d?(g.width=c,g.height=d):h.clearRect(0,0,c,d),h.setTransform(f.scaleX,0,0,f.scaleY,f.left,f.top),h.drawImage(f.getElement(),0,0,c,d);let i=h.getImageData(0,0,c,d).data;for(let a=0;a<b.length;a+=4){let c=b[a],d=b[a+1],e=b[a+2],f=b[a+3],g=i[a],h=i[a+1],j=i[a+2],k=i[a+3];switch(this.mode){case"multiply":b[a]=c*g/255,b[a+1]=d*h/255,b[a+2]=e*j/255,b[a+3]=f*k/255;break;case"mask":b[a+3]=k}}}sendUniformData(a,b){let c=this.calculateMatrix();a.uniform1i(b.uImage,1),a.uniformMatrix3fv(b.uTransformMatrix,!1,c)}toObject(){return x(x({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(a,b){let{type:c,image:d}=a,e=y(a,fU);return fA.fromObject(d,b).then(a=>new this(x(x({},e),{},{image:a})))}}v(fV,"type","BlendImage"),v(fV,"defaults",{mode:"multiply",alpha:1}),v(fV,"uniformLocations",["uTransformMatrix","uImage"]),am.setClass(fV);class fW extends fQ{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float totalC = 0.0;\n      float totalA = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);\n        float weight = 1.0 - abs(percent);\n        float alpha = weight * sample.a;\n        color.rgb += sample.rgb * alpha;\n        color.a += alpha;\n        totalA += weight;\n        totalC += alpha;\n      }\n      gl_FragColor.rgb = color.rgb / totalC;\n      gl_FragColor.a = color.a / totalA;\n    }\n  "}applyTo(a){void 0!==a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)}applyTo2d(a){let{imageData:{data:b,width:c,height:d}}=a;this.aspectRatio=c/d,this.horizontal=!0;let e=this.getBlurValue()*c,f=new Uint8ClampedArray(b),g=4*c;for(let a=0;a<b.length;a+=4){let c=0,d=0,h=0,i=0,j=0,k=a-a%g,l=k+g;for(let f=-14;f<15;f++){let g=f/15,m=4*Math.floor(e*g),n=1-Math.abs(g),o=a+m;o<k?o=k:o>l&&(o=l);let p=b[o+3]*n;c+=b[o]*p,d+=b[o+1]*p,h+=b[o+2]*p,i+=p,j+=n}f[a]=c/i,f[a+1]=d/i,f[a+2]=h/i,f[a+3]=i/j}this.horizontal=!1,e=this.getBlurValue()*d;for(let a=0;a<f.length;a+=4){let c=0,d=0,h=0,i=0,j=0,k=a%g,l=f.length-g+k;for(let b=-14;b<15;b++){let m=b/15,n=Math.floor(e*m)*g,o=1-Math.abs(m),p=a+n;p<k?p=k:p>l&&(p=l);let q=f[p+3]*o;c+=f[p]*q,d+=f[p+1]*q,h+=f[p+2]*q,i+=q,j+=o}b[a]=c/i,b[a+1]=d/i,b[a+2]=h/i,b[a+3]=i/j}}sendUniformData(a,b){let c=this.chooseRightDelta();a.uniform2fv(b.uDelta,c)}isNeutralState(){return 0===this.blur}getBlurValue(){let a=1,{horizontal:b,aspectRatio:c}=this;return b?c>1&&(a=1/c):c<1&&(a=c),a*this.blur*.12}chooseRightDelta(){let a=this.getBlurValue();return this.horizontal?[a,0]:[0,a]}}v(fW,"type","Blur"),v(fW,"defaults",{blur:0}),v(fW,"uniformLocations",["uDelta"]),am.setClass(fW);class fX extends fQ{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=Math.round(255*this.brightness);for(let a=0;a<b.length;a+=4)b[a]+=c,b[a+1]+=c,b[a+2]+=c}isNeutralState(){return 0===this.brightness}sendUniformData(a,b){a.uniform1f(b.uBrightness,this.brightness)}}v(fX,"type","Brightness"),v(fX,"defaults",{brightness:0}),v(fX,"uniformLocations",["uBrightness"]),am.setClass(fX);let fY={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class fZ extends fQ{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(a){let b=a.imageData.data,c=this.matrix,d=this.colorsOnly;for(let a=0;a<b.length;a+=4){let e=b[a],f=b[a+1],g=b[a+2];if(b[a]=e*c[0]+f*c[1]+g*c[2]+255*c[4],b[a+1]=e*c[5]+f*c[6]+g*c[7]+255*c[9],b[a+2]=e*c[10]+f*c[11]+g*c[12]+255*c[14],!d){let d=b[a+3];b[a]+=d*c[3],b[a+1]+=d*c[8],b[a+2]+=d*c[13],b[a+3]=e*c[15]+f*c[16]+g*c[17]+d*c[18]+255*c[19]}}}sendUniformData(a,b){let c=this.matrix,d=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],e=[c[4],c[9],c[14],c[19]];a.uniformMatrix4fv(b.uColorMatrix,!1,d),a.uniform4fv(b.uConstants,e)}toObject(){return x(x({},super.toObject()),{},{matrix:[...this.matrix]})}}function f$(a,b){var c;let d=(v(c=class extends fZ{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",a),v(c,"defaults",{colorsOnly:!1,matrix:b}),c);return am.setClass(d,a),d}v(fZ,"type","ColorMatrix"),v(fZ,"defaults",fY),v(fZ,"uniformLocations",["uColorMatrix","uConstants"]),am.setClass(fZ);let f_=f$("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),f0=f$("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),f1=f$("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),f2=f$("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),f3=f$("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),f4=f$("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),f5=f$("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class f6 extends fQ{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(a),this.subFilters=a.subFilters||[]}applyTo(a){void 0!==a.webgl&&(a.passes+=this.subFilters.length-1),this.subFilters.forEach(b=>{b.applyTo(a)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(a=>a.toObject())}}isNeutralState(){return!this.subFilters.some(a=>!a.isNeutralState())}static fromObject(a,b){return Promise.all((a.subFilters||[]).map(a=>am.getClass(a.type).fromObject(a,b))).then(a=>new this({subFilters:a}))}}v(f6,"type","Composed"),am.setClass(f6);class f7 extends fQ{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(a){let{imageData:{data:b}}=a,c=Math.floor(255*this.contrast),d=259*(c+255)/(255*(259-c));for(let a=0;a<b.length;a+=4)b[a]=d*(b[a]-128)+128,b[a+1]=d*(b[a+1]-128)+128,b[a+2]=d*(b[a+2]-128)+128}sendUniformData(a,b){a.uniform1f(b.uContrast,this.contrast)}}v(f7,"type","Contrast"),v(f7,"defaults",{contrast:0}),v(f7,"uniformLocations",["uContrast"]),am.setClass(f7);let f8={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class f9 extends fQ{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(+!!this.opaque)}getFragmentSource(){return f8[this.getCacheKey()]}applyTo2d(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o=a.imageData,p=o.data,q=this.matrix,r=Math.round(Math.sqrt(q.length)),s=Math.floor(r/2),t=o.width,u=o.height,v=a.ctx.createImageData(t,u),w=v.data,x=+!!this.opaque;for(l=0;l<u;l++)for(k=0;k<t;k++){for(f=4*(l*t+k),b=0,c=0,d=0,e=0,n=0;n<r;n++)for(m=0;m<r;m++)h=l+n-s,g=k+m-s,h<0||h>=u||g<0||g>=t||(i=4*(h*t+g),j=q[n*r+m],b+=p[i]*j,c+=p[i+1]*j,d+=p[i+2]*j,x||(e+=p[i+3]*j));w[f]=b,w[f+1]=c,w[f+2]=d,w[f+3]=x?p[f+3]:e}a.imageData=v}sendUniformData(a,b){a.uniform1fv(b.uMatrix,this.matrix)}toObject(){return x(x({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}v(f9,"type","Convolute"),v(f9,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),v(f9,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),am.setClass(f9);let ga="Gamma";class gb extends fQ{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(a),this.gamma=a.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(a){let{imageData:{data:b}}=a,c=this.gamma,d=1/c[0],e=1/c[1],f=1/c[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});let g=this.rgbValues;for(let a=0;a<256;a++)g.r[a]=255*Math.pow(a/255,d),g.g[a]=255*Math.pow(a/255,e),g.b[a]=255*Math.pow(a/255,f);for(let a=0;a<b.length;a+=4)b[a]=g.r[b[a]],b[a+1]=g.g[b[a+1]],b[a+2]=g.b[b[a+2]]}sendUniformData(a,b){a.uniform3fv(b.uGamma,this.gamma)}isNeutralState(){let{gamma:a}=this;return 1===a[0]&&1===a[1]&&1===a[2]}toObject(){return{type:ga,gamma:this.gamma.concat()}}}v(gb,"type",ga),v(gb,"defaults",{gamma:[1,1,1]}),v(gb,"uniformLocations",["uGamma"]),am.setClass(gb);let gc={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class gd extends fQ{applyTo2d(a){let{imageData:{data:b}}=a;for(let a,c=0;c<b.length;c+=4){let d=b[c],e=b[c+1],f=b[c+2];switch(this.mode){case"average":a=(d+e+f)/3;break;case"lightness":a=(Math.min(d,e,f)+Math.max(d,e,f))/2;break;case"luminosity":a=.21*d+.72*e+.07*f}b[c+2]=b[c+1]=b[c]=a}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return gc[this.mode]}sendUniformData(a,b){a.uniform1i(b.uMode,1)}isNeutralState(){return!1}}v(gd,"type","Grayscale"),v(gd,"defaults",{mode:"average"}),v(gd,"uniformLocations",["uMode"]),am.setClass(gd);let ge=x(x({},fY),{},{rotation:0});class gf extends fZ{calculateMatrix(){let a=this.rotation*Math.PI,b=aq(a),c=ar(a),d=1/3,e=Math.sqrt(1/3)*c,f=1-b;this.matrix=[b+f/3,d*f-e,d*f+e,0,0,d*f+e,b+d*f,d*f-e,0,0,d*f-e,d*f+e,b+d*f,0,0,0,0,0,1,0]}isNeutralState(){return 0===this.rotation}applyTo(a){this.calculateMatrix(),super.applyTo(a)}toObject(){return{type:this.type,rotation:this.rotation}}}v(gf,"type","HueRotation"),v(gf,"defaults",ge),am.setClass(gf);class gg extends fQ{applyTo2d(a){let{imageData:{data:b}}=a;for(let a=0;a<b.length;a+=4)b[a]=255-b[a],b[a+1]=255-b[a+1],b[a+2]=255-b[a+2],this.alpha&&(b[a+3]=255-b[a+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(a,b){a.uniform1i(b.uInvert,Number(this.invert)),a.uniform1i(b.uAlpha,Number(this.alpha))}}v(gg,"type","Invert"),v(gg,"defaults",{alpha:!1,invert:!0}),v(gg,"uniformLocations",["uInvert","uAlpha"]),am.setClass(gg);class gh extends fQ{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=this.noise;for(let a=0;a<b.length;a+=4){let d=(.5-Math.random())*c;b[a]+=d,b[a+1]+=d,b[a+2]+=d}}sendUniformData(a,b){a.uniform1f(b.uNoise,this.noise/255),a.uniform1f(b.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}v(gh,"type","Noise"),v(gh,"defaults",{noise:0}),v(gh,"uniformLocations",["uNoise","uSeed"]),am.setClass(gh);class gi extends fQ{applyTo2d(a){let{imageData:{data:b,width:c,height:d}}=a;for(let a=0;a<d;a+=this.blocksize)for(let e=0;e<c;e+=this.blocksize){let f=4*a*c+4*e,g=b[f],h=b[f+1],i=b[f+2],j=b[f+3];for(let f=a;f<Math.min(a+this.blocksize,d);f++)for(let a=e;a<Math.min(e+this.blocksize,c);a++){let d=4*f*c+4*a;b[d]=g,b[d+1]=h,b[d+2]=i,b[d+3]=j}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(a,b){a.uniform1f(b.uBlocksize,this.blocksize)}}v(gi,"type","Pixelate"),v(gi,"defaults",{blocksize:4}),v(gi,"uniformLocations",["uBlocksize"]),am.setClass(gi);class gj extends fQ{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=255*this.distance,d=new bL(this.color).getSource(),e=[d[0]-c,d[1]-c,d[2]-c],f=[d[0]+c,d[1]+c,d[2]+c];for(let a=0;a<b.length;a+=4){let c=b[a],d=b[a+1],g=b[a+2];c>e[0]&&d>e[1]&&g>e[2]&&c<f[0]&&d<f[1]&&g<f[2]&&(b[a+3]=0)}}sendUniformData(a,b){let c=new bL(this.color).getSource(),d=this.distance,e=[0+c[0]/255-d,0+c[1]/255-d,0+c[2]/255-d,1],f=[c[0]/255+d,c[1]/255+d,c[2]/255+d,1];a.uniform4fv(b.uLow,e),a.uniform4fv(b.uHigh,f)}}v(gj,"type","RemoveColor"),v(gj,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),v(gj,"uniformLocations",["uLow","uHigh"]),am.setClass(gj);class gk extends fQ{sendUniformData(a,b){a.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),a.uniform1fv(b.uTaps,this.taps)}getFilterWindow(){let a=this.tempScale;return Math.ceil(this.lanczosLobes/a)}getCacheKey(){let a=this.getFilterWindow();return"".concat(this.type,"_").concat(a)}getFragmentSource(){let a=this.getFilterWindow();return this.generateShader(a)}getTaps(){let a=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,c=this.getFilterWindow(),d=Array(c);for(let e=1;e<=c;e++)d[e-1]=a(e*b);return d}generateShader(a){let b=Array(a);for(let c=1;c<=a;c++)b[c-1]="".concat(c,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(a,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(b.map((a,b)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(a,") * uTaps[").concat(b,"] + texture2D(uTexture, vTexCoord - ").concat(a,") * uTaps[").concat(b,"];\n              sum += 2.0 * uTaps[").concat(b,"];\n            ")).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(a){a.passes++,this.width=a.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=a.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),a.destinationWidth=this.dW,super.applyTo(a),a.sourceWidth=a.destinationWidth,this.height=a.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),a.destinationHeight=this.dH,super.applyTo(a),a.sourceHeight=a.destinationHeight}applyTo(a){void 0!==a.webgl?this.applyToForWebgl(a):this.applyTo2d(a)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(a){return b=>{if(b>=a||b<=-a)return 0;if(b<11920929e-14&&b>-11920929e-14)return 1;let c=(b*=Math.PI)/a;return Math.sin(b)/b*Math.sin(c)/c}}applyTo2d(a){let b,c=a.imageData,d=this.scaleX,e=this.scaleY;this.rcpScaleX=1/d,this.rcpScaleY=1/e;let f=c.width,g=c.height,h=Math.round(f*d),i=Math.round(g*e);b="sliceHack"===this.resizeType?this.sliceByTwo(a,f,g,h,i):"hermite"===this.resizeType?this.hermiteFastResize(a,f,g,h,i):"bilinear"===this.resizeType?this.bilinearFiltering(a,f,g,h,i):"lanczos"===this.resizeType?this.lanczosResize(a,f,g,h,i):new ImageData(h,i),a.imageData=b}sliceByTwo(a,b,c,d,e){let f=a.imageData,g=!1,h=!1,i=.5*b,j=.5*c,k=a.filterBackend.resources,l=0,m=0,n=b,o=0;k.sliceByTwo||(k.sliceByTwo=aB());let p=k.sliceByTwo;(p.width<1.5*b||p.height<c)&&(p.width=1.5*b,p.height=c);let q=p.getContext("2d");for(q.clearRect(0,0,1.5*b,c),q.putImageData(f,0,0),d=Math.floor(d),e=Math.floor(e);!g||!h;)b=i,c=j,d<Math.floor(.5*i)?i=Math.floor(.5*i):(i=d,g=!0),e<Math.floor(.5*j)?j=Math.floor(.5*j):(j=e,h=!0),q.drawImage(p,l,m,b,c,n,o,i,j),l=n,m=o,o+=j;return q.getImageData(l,m,d,e)}lanczosResize(a,b,c,d,e){let f=a.imageData.data,g=a.ctx.createImageData(d,e),h=g.data,i=this.lanczosCreate(this.lanczosLobes),j=this.rcpScaleX,k=this.rcpScaleY,l=2/this.rcpScaleX,m=2/this.rcpScaleY,n=Math.ceil(j*this.lanczosLobes/2),o=Math.ceil(k*this.lanczosLobes/2),p={},q={x:0,y:0},r={x:0,y:0};return function a(s){let t,u,v,w,x,y,z,A,B,C,D;for(q.x=(s+.5)*j,r.x=Math.floor(q.x),t=0;t<e;t++){for(q.y=(t+.5)*k,r.y=Math.floor(q.y),x=0,y=0,z=0,A=0,B=0,u=r.x-n;u<=r.x+n;u++)if(!(u<0||u>=b)){p[C=Math.floor(1e3*Math.abs(u-q.x))]||(p[C]={});for(let a=r.y-o;a<=r.y+o;a++)a<0||a>=c||(D=Math.floor(1e3*Math.abs(a-q.y)),p[C][D]||(p[C][D]=i(Math.sqrt(Math.pow(C*l,2)+Math.pow(D*m,2))/1e3)),(v=p[C][D])>0&&(w=4*(a*b+u),x+=v,y+=v*f[w],z+=v*f[w+1],A+=v*f[w+2],B+=v*f[w+3]))}h[w=4*(t*d+s)]=y/x,h[w+1]=z/x,h[w+2]=A/x,h[w+3]=B/x}return++s<d?a(s):g}(0)}bilinearFiltering(a,b,c,d,e){let f,g,h,i,j,k,l,m,n,o,p,q=0,r=this.rcpScaleX,s=this.rcpScaleY,t=4*(b-1),u=a.imageData.data,v=a.ctx.createImageData(d,e),w=v.data;for(j=0;j<e;j++)for(k=0;k<d;k++)for(h=Math.floor(r*k),i=Math.floor(s*j),l=r*k-h,m=s*j-i,p=4*(i*b+h),n=0;n<4;n++)f=u[p+n],g=u[p+4+n],o=f*(1-l)*(1-m)+g*l*(1-m)+u[p+t+n]*m*(1-l)+u[p+t+4+n]*l*m,w[q++]=o;return v}hermiteFastResize(a,b,c,d,e){let f=this.rcpScaleX,g=this.rcpScaleY,h=Math.ceil(f/2),i=Math.ceil(g/2),j=a.imageData.data,k=a.ctx.createImageData(d,e),l=k.data;for(let a=0;a<e;a++)for(let c=0;c<d;c++){let e=4*(c+a*d),k=0,m=0,n=0,o=0,p=0,q=0,r=0,s=(a+.5)*g;for(let d=Math.floor(a*g);d<(a+1)*g;d++){let a=Math.abs(s-(d+.5))/i,e=(c+.5)*f,g=a*a;for(let a=Math.floor(c*f);a<(c+1)*f;a++){let c=Math.abs(e-(a+.5))/h,f=Math.sqrt(g+c*c);f>1&&f<-1||(k=2*f*f*f-3*f*f+1)>0&&(r+=k*j[(c=4*(a+d*b))+3],n+=k,j[c+3]<255&&(k=k*j[c+3]/250),o+=k*j[c],p+=k*j[c+1],q+=k*j[c+2],m+=k)}}l[e]=o/m,l[e+1]=p/m,l[e+2]=q/m,l[e+3]=r/n}return k}}v(gk,"type","Resize"),v(gk,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),v(gk,"uniformLocations",["uDelta","uTaps"]),am.setClass(gk);class gl extends fQ{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=-this.saturation;for(let a=0;a<b.length;a+=4){let d=b[a],e=b[a+1],f=b[a+2],g=Math.max(d,e,f);b[a]+=g!==d?(g-d)*c:0,b[a+1]+=g!==e?(g-e)*c:0,b[a+2]+=g!==f?(g-f)*c:0}}sendUniformData(a,b){a.uniform1f(b.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}v(gl,"type","Saturation"),v(gl,"defaults",{saturation:0}),v(gl,"uniformLocations",["uSaturation"]),am.setClass(gl);class gm extends fQ{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=-this.vibrance;for(let a=0;a<b.length;a+=4){let d=b[a],e=b[a+1],f=b[a+2],g=Math.max(d,e,f),h=2*Math.abs(g-(d+e+f)/3)/255*c;b[a]+=g!==d?(g-d)*h:0,b[a+1]+=g!==e?(g-e)*h:0,b[a+2]+=g!==f?(g-f)*h:0}}sendUniformData(a,b){a.uniform1f(b.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}v(gm,"type","Vibrance"),v(gm,"defaults",{vibrance:0}),v(gm,"uniformLocations",["uVibrance"]),am.setClass(gm),Object.freeze({__proto__:null,BaseFilter:fQ,BlackWhite:f5,BlendColor:fS,BlendImage:fV,Blur:fW,Brightness:fX,Brownie:f_,ColorMatrix:fZ,Composed:f6,Contrast:f7,Convolute:f9,Gamma:gb,Grayscale:gd,HueRotation:gf,Invert:gg,Kodachrome:f1,Noise:gh,Pixelate:gi,Polaroid:f3,RemoveColor:gj,Resize:gk,Saturation:gl,Sepia:f4,Technicolor:f2,Vibrance:gm,Vintage:f0});let gn=({showControls:a,controlsPosition:b,onRotateLeft:c,onRotateRight:d,onDelete:e})=>a?(0,p.jsxs)("div",{className:"absolute flex items-center gap-0.5 bg-white bg-opacity-50 text-gray-800 rounded-sm px-1.5 py-0.5 z-[60] ",style:{left:`${b.x}px`,top:`${b.y}px`,position:"absolute",pointerEvents:"auto"},children:[(0,p.jsx)("button",{onClick:c,className:"w-5 h-5 flex items-center justify-center text-gray-800 hover:text-gray-900 rounded ","aria-label":"Rotate Left",title:"Rotate Left",style:{color:"#1f2937"},children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"16",height:"16",fill:"currentColor",style:{color:"#1f2937"},children:(0,p.jsx)("path",{d:"M24 192l144 0c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-46.7-46.7c75.3-58.6 184.3-53.3 253.5 15.9 75 75 75 196.5 0 271.5s-196.5 75-271.5 0c-10.2-10.2-19-21.3-26.4-33-9.5-14.9-29.3-19.3-44.2-9.8s-19.3 29.3-9.8 44.2C49.7 408.7 61.4 423.5 75 437 175 537 337 537 437 437S537 175 437 75C342.8-19.3 193.3-24.7 92.7 58.8L41 7C34.1 .2 23.8-1.9 14.8 1.8S0 14.3 0 24L0 168c0 13.3 10.7 24 24 24z"})})}),(0,p.jsx)("button",{onClick:d,className:"w-5 h-5 flex items-center justify-center text-gray-800 hover:text-gray-900 rounded transition-colors bg-transparent","aria-label":"Rotate Right",title:"Rotate Right",style:{color:"#1f2937"},children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"16",height:"16",fill:"currentColor",style:{color:"#1f2937"},children:(0,p.jsx)("path",{d:"M488 192l-144 0c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l46.7-46.7c-75.3-58.6-184.3-53.3-253.5 15.9-75 75-75 196.5 0 271.5s196.5 75 271.5 0c8.2-8.2 15.5-16.9 21.9-26.1 10.1-14.5 30.1-18 44.6-7.9s18 30.1 7.9 44.6c-8.5 12.2-18.2 23.8-29.1 34.7-100 100-262.1 100-362 0S-25 175 75 75c94.3-94.3 243.7-99.6 344.3-16.2L471 7c6.9-6.9 17.2-8.9 26.2-5.2S512 14.3 512 24l0 144c0 13.3-10.7 24-24 24z"})})}),(0,p.jsx)("button",{onClick:e,className:"w-6 h-6 flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors","aria-label":"Remove",title:"Delete",children:(0,p.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"24",height:"24",fill:"currentColor",style:{color:"#dc2626"},children:(0,p.jsx)("path",{d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"})})})]}):null,go=(a,b,c)=>{if(!a.current)return null;let d=!b.current||b.current.visible,e=!c.current||c.current.visible;b.current&&(b.current.visible=!1),c.current&&(c.current.visible=!1);let f=a.current.toDataURL({format:"png",quality:1,multiplier:2,backgroundColor:"white"});return b.current&&(b.current.visible=d),c.current&&(c.current.visible=e),(b.current||c.current)&&a.current.renderAll(),f},gp=({selectedCaseType:a,selectedColor:b,selectedPins:c,onPinSelect:d,onPinRemove:e,products:f,onSaveImage:g})=>{let h=(0,q.useRef)(null),i=(0,q.useRef)(null),j=(0,q.useRef)(null),k=(0,q.useRef)(null),l=(0,q.useRef)(null),m=(0,q.useRef)(new Map),n=(0,q.useRef)(null),[o,r]=(0,q.useState)(null),{controlsPosition:s,showControls:t,setShowControls:v,updateControls:w}=(()=>{let[a,b]=(0,q.useState)({x:0,y:0}),[c,d]=(0,q.useState)(!1);return{controlsPosition:a,showControls:c,setShowControls:d,updateControls:(0,q.useCallback)((a,c)=>{if(!a||!c.current)return;let d=a.getBoundingRect(!0),e=c.current.getElement(),f=e.parentElement;if(!f)return;let g=e.getBoundingClientRect(),h=f.getBoundingClientRect(),i=g.left-h.left,j=g.top-h.top,k=i+d.left+d.width/2,l=j+d.top+d.height+14;b({x:Math.max(6,Math.min(k-35,h.width-70-6)),y:Math.max(6,Math.min(l,h.height-32-6))})},[])}})(),{updateBorderRect:x,removeBorderRect:y}={updateBorderRect:(0,q.useCallback)(a=>{if(!a||!i.current||a.isCase)return;let b=m.current.get(a);b&&(i.current.remove(b),m.current.delete(a));let c=a.getBoundingRect(!0),d=new dR({left:c.left,top:c.top,width:c.width,height:c.height,originX:"left",originY:"top",fill:"transparent",stroke:"#111827",strokeWidth:1,strokeDashArray:[3,3],selectable:!1,evented:!1,excludeFromExport:!1});m.current.set(a,d),i.current.add(d);let e=j.current;e&&i.current.sendObjectToBack(e),k.current&&i.current.sendObjectToBack(k.current),l.current&&i.current.sendObjectToBack(l.current),i.current.bringObjectToFront(a),i.current.renderAll()},[i,j,k,l,m]),removeBorderRect:(0,q.useCallback)(a=>{if(!a||!i.current)return;let b=m.current.get(a);b&&(i.current.remove(b),m.current.delete(a),i.current.renderAll())},[i,m])},z=(0,q.useCallback)((b,c=!1,d=85,e=85)=>new Promise((f,g)=>{let h=new Image;h.crossOrigin="anonymous",h.src=b,h.onload=()=>{let b,g,m=i.current.getWidth(),o=i.current.getHeight();if(c){let a=Math.min(m/h.width,o/h.height);b=a,g=a}else{let a,c,f=Math.max(d,e),i=h.width/h.height;h.width>=h.height?(a=f,c=f/i):(c=f,a=f*i),b=a/h.width,g=c/h.height}let p=new fA(h,{left:m/2,top:o/2,originX:"center",originY:"center",scaleX:b,scaleY:g,selectable:!c,hasControls:c,lockScalingX:c,lockScalingY:c,borderColor:"transparent",cornerColor:c?"transparent":"blue",cornerSize:8*!c,transparentCorners:!1,hasBorders:!1,isCase:c});c?(n.current&&(clearTimeout(n.current),n.current=null),i.current.getObjects().forEach(a=>{a&&"rect"===a.type&&(!0===a.isBoundaryRect||Array.isArray(a.strokeDashArray)&&(4===a.strokeDashArray[0]&&4===a.strokeDashArray[1]||3===a.strokeDashArray[0]&&3===a.strokeDashArray[1])&&(!a.fill||"transparent"===a.fill)&&!1===a.selectable&&!1===a.evented)&&i.current.remove(a)}),k.current=null,l.current&&(i.current.remove(l.current),l.current=null),p.set("evented",!1),j.current=p,i.current.add(p),i.current.sendObjectToBack(p),n.current=setTimeout(()=>{if(j.current!==p)return;k.current&&i.current.remove(k.current);let b=p.getBoundingRect(),c="business"===a?140:120,d="business"===a?50:40,e=new dR({left:b.left+c,top:b.top+d,width:b.width-2*c,height:b.height-2*d,fill:"transparent",stroke:"rgba(239, 68, 68, 0.3)",strokeWidth:1,strokeDashArray:[4,4],selectable:!1,evented:!1,visible:!1,isBoundaryRect:!0});k.current=e,i.current.add(e),i.current.sendObjectToBack(e),l.current=null,i.current.sendObjectToBack(p),i.current.renderAll(),n.current=null},100)):i.current.add(p),i.current.renderAll(),f(p)},h.onerror=g}),[a]),A=(0,q.useCallback)(a=>{w(a,i)},[w]),B=(0,q.useCallback)(()=>{let a=i.current;if(!a||!h.current)return;let b=h.current.parentElement;if(!b)return;let c=b.clientWidth,d=b.clientHeight;a.setWidth(c),a.setHeight(d),a.renderAll()},[]);(0,q.useEffect)(()=>{if(!h.current)return;let a=h.current.parentElement;if(!a)return;let b=a.clientWidth,c=a.clientHeight;i.current=new eE(h.current,{width:b,height:c,backgroundColor:"transparent"}),i.current.on("object:moving",a=>{let b=a.target;if(!b||!b.getBoundingRect||b.isCase||b===k.current||b===l.current)return;let c=i.current.getWidth(),d=i.current.getHeight(),e=b.getBoundingRect(!0),f=e.width,g=e.height,h=f/2,j=g/2,n=b.left,o=b.top;e.left<5&&(n=5+h),e.left+f>c-5&&(n=c-5-h),e.top<5&&(o=5+j),e.top+g>d-5&&(o=d-5-j),(n!==b.left||o!==b.top)&&(b.set({left:n,top:o}),b.setCoords());let p=m.current.get(b);if(p){let a=b.getBoundingRect(!0),c=Math.max(2,.025*Math.min(a.width,a.height));p.set({left:a.left+c,top:a.top+c,width:a.width-2*c,height:a.height-2*c}),p.setCoords(),i.current.bringObjectToFront(b)}i.current.getActiveObject()===b&&A(b)}),i.current.on("object:modified",a=>{let b=a.target;if(k.current&&b&&!b.isCase&&b!==k.current&&k.current.set("visible",!1),l.current&&b&&!b.isCase&&b!==l.current&&l.current.set("visible",!1),b&&!b.isCase&&b!==k.current&&b!==l.current&&i.current.renderAll(),b&&!b.isCase){let a=i.current.getActiveObject()===b;"textbox"===b.type||"text"===b.type||"i-text"===b.type?b.set({lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1,borderColor:"transparent",cornerColor:"transparent",cornerSize:0,transparentCorners:!0}):"image"===b.type&&b.set({hasBorders:!1,borderColor:"transparent"}),a?x(b):y(b),i.current.getActiveObject()===b&&A(b)}}),i.current.on("selection:created",a=>{let b=a.selected[0];b&&!b.isCase&&(m.current.forEach((a,c)=>{c!==b&&(i.current.remove(a),m.current.delete(c))}),"textbox"===b.type||"text"===b.type||"i-text"===b.type?b.set({lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1,borderColor:"transparent",cornerColor:"transparent",cornerSize:0,transparentCorners:!0}):"image"===b.type&&b.set({hasBorders:!1,borderColor:"transparent"}),x(b),r(b),v(!0),A(b),i.current.renderAll())}),i.current.on("selection:updated",a=>{let b=a.selected[0];b&&!b.isCase&&(m.current.forEach((a,c)=>{c!==b&&(i.current.remove(a),m.current.delete(c))}),"textbox"===b.type||"text"===b.type||"i-text"===b.type?b.set({lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1,borderColor:"transparent",cornerColor:"transparent",cornerSize:0,transparentCorners:!0}):"image"===b.type&&b.set({hasBorders:!1,borderColor:"transparent"}),x(b),r(b),v(!0),A(b),i.current.renderAll())}),i.current.on("object:scaling",a=>{let b=a.target;b&&("textbox"===b.type||"text"===b.type||"i-text"===b.type)&&(b.set({scaleX:1,scaleY:1,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1,borderColor:"transparent",cornerColor:"transparent",cornerSize:0,transparentCorners:!0}),i.current.renderAll())}),i.current.on("selection:cleared",()=>{k.current&&k.current.set("visible",!1),l.current&&l.current.set("visible",!1),m.current.forEach((a,b)=>{i.current.remove(a),m.current.delete(b)}),i.current.renderAll(),r(null),v(!1),d&&d(null)}),i.current.on("text:changed",a=>{let b=a.target;if(b&&("textbox"===b.type||"text"===b.type||"i-text"===b.type)){let a=b.text||"",c=a.toUpperCase();a!==c&&(b.set("text",c),i.current.renderAll())}});let e=()=>{B()};window.addEventListener("resize",e);let f=m.current,g=i.current;return()=>{window.removeEventListener("resize",e),n.current&&(clearTimeout(n.current),n.current=null),g&&f&&(f.forEach(a=>{g.remove(a)}),f.clear()),g?.dispose()}},[d,A,x,y,B,v]),(0,q.useEffect)(()=>{o&&t&&requestAnimationFrame(()=>{A(o)})},[o,t,A,w]);let C=(0,q.useCallback)((a,b={})=>{if(!i.current)return;let c=(a||"").trim().toUpperCase();if(!c)return;let d=new fq(c,{left:i.current.getWidth()/2,top:i.current.getHeight()/2,originX:"center",originY:"center",fontSize:Number(b.fontSize)||28,fill:b.fill||"#1f2937",fontFamily:b.fontFamily||"'Poppins', sans-serif",textAlign:"center",lineHeight:1.2,borderColor:"transparent",cornerColor:"transparent",cornerSize:0,transparentCorners:!0,padding:6,editable:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});i.current.add(d),i.current.setActiveObject(d),x(d),i.current.renderAll(),r(d),v(!0),A(d)},[A,x,v]);(0,q.useEffect)(()=>{if(!i.current)return;n.current&&(clearTimeout(n.current),n.current=null);let a=i.current.getObjects(),b=a=>{if(!a||"rect"!==a.type)return!1;if(!0===a.isBoundaryRect)return!0;let b=a.strokeDashArray,c=Array.isArray(b)&&(4===b[0]&&4===b[1]||3===b[0]&&3===b[1]),d=!a.fill||"transparent"===a.fill,e=!1===a.selectable,f=!1===a.evented;return c&&d&&e&&f};a.forEach(a=>{a.isCase?i.current.remove(a):(b(a)||a===k.current||a===l.current)&&i.current.remove(a)}),m.current.forEach(a=>{i.current.remove(a)}),m.current.clear(),j.current=null,k.current=null,l.current=null,i.current.getObjects().forEach(a=>{a.isCase||b(a)||i.current.bringObjectToFront(a)}),i.current.renderAll()},[a,b]);let D=(0,q.useCallback)(async a=>{if(i.current)try{let b=void 0!==a.size?a.size:.5,c=100*b;console.log("Adding pin to canvas:",a.name,"Size factor:",b,"Calculated size:",c);let e=await z((0,u.normalizeImagePath)(a.src),!1,c,c),f=i.current.getWidth(),g=i.current.getHeight(),h=(e.width||c)*(e.scaleX||1),j=(e.height||c)*(e.scaleY||1),k=20+h/2,l=20+j/2,m=Math.random()*(f-20-h/2-k)+k,n=Math.random()*(g-20-j/2-l)+l;e.set({left:m,top:n}),e.pinData=a,e.set({hasBorders:!1,borderColor:"transparent"}),i.current.setActiveObject(e),x(e),i.current.renderAll(),d&&d(e)}catch(a){console.error("Error loading pin:",a)}},[d,x,z]),E=(0,q.useCallback)(()=>{((a,b,c)=>{let d=go(a,b,c);if(!d)return;let e=document.createElement("a");e.download=`passport-case-design-${Date.now()}.webp`,e.href=d,document.body.appendChild(e),e.click(),document.body.removeChild(e)})(i,k,l)},[]),F=(0,q.useCallback)(()=>go(i,k,l),[]);return(0,q.useEffect)(()=>(window.addPinToCanvas=D,window.addTextToCanvas=C,window.getDesignImageDataURL=F,g&&g(E),()=>{delete window.addPinToCanvas,delete window.addTextToCanvas,delete window.getDesignImageDataURL}),[C,D,g,F,E]),(0,p.jsx)("div",{className:"w-full h-full flex flex-col  sm:items-center ",children:(0,p.jsxs)("div",{className:"w-full h-full relative flex item-top justify-center  ",children:[(0,p.jsx)("canvas",{ref:h,className:"w-full h-screen ",style:{background:"transparent",width:"100%",height:"100%"}}),(0,p.jsx)(gn,{showControls:t,controlsPosition:s,onRotateLeft:()=>{if(o){let a=o.angle||0;o.set("angle",a-15),i.current.renderAll(),A(o)}},onRotateRight:()=>{if(o){let a=o.angle||0;o.set("angle",a+15),i.current.renderAll(),A(o)}},onDelete:()=>{o&&(y(o),i.current.remove(o),i.current.discardActiveObject(),i.current.renderAll(),r(null),v(!1),e&&e(o))}})]})})},gq=({caseImages:a,onOpenModal:b})=>a&&0!==a.length?(0,p.jsx)("div",{className:"flex-1 min-w-0 mt-12",children:(0,p.jsxs)("button",{onClick:b,className:"w-full px-3 md:px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-400 active:bg-gray-100 transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow-md",style:{fontFamily:"'Poppins', sans-serif"},children:[(0,p.jsx)("svg",{className:"w-4 h-4 text-gray-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,p.jsx)("span",{className:"whitespace-nowrap truncate",children:"IMAGES"}),a.length>0&&(0,p.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full flex-shrink-0",children:a.length})]})}):null,gr=({selectedCase:a,onOpenModal:b})=>a?(0,p.jsx)("div",{className:"flex-1 min-w-0 mt-12",children:(0,p.jsxs)("button",{onClick:b,className:"w-full px-3 md:px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-200 transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow-md hover:bg-gray-50 hover:border-gray-400 active:bg-gray-100",style:{fontFamily:"'Poppins', sans-serif"},children:[(0,p.jsx)("svg",{className:"w-4 h-4 text-gray-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,p.jsx)("span",{className:"whitespace-nowrap truncate",children:"DETAILS"})]})}):null,gs=({selectedCaseType:a,selectedColor:b,selectedCaseImage:c,selectedCase:d,caseImages:e,isCaseDropdownOpen:f,isCharmsDropdownOpen:g,isAddTextDropdownOpen:h,isMobile:i,onPinSelect:j,onPinRemove:k,onOpenImageModal:l,onOpenDescriptionModal:m,Products:n})=>(0,p.jsx)("div",{className:`flex flex-col flex-shrink-0 ${i?"justify-start sm:flex-1 sm:justify-center":"md:w-1/2 md:flex-1 md:overflow-hidden md:px-0 md:py-0"} px-2 xs:px-3 sm:px-4 py-0 xs:py-1 sm:py-2 ${f||g||h?"md:sticky md:top-0 md:self-start":""}`,children:(0,p.jsxs)("div",{className:"w-full h-full flex flex-col justify-start xs:justify-start sm:justify-center items-center md:justify-between",children:[(0,p.jsxs)("div",{className:"w-full max-w-[300px] aspect-[300/350] relative md:mt-2",style:{isolation:"isolate"},children:[c&&(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(c),alt:"",className:"absolute inset-0 w-full h-full object-contain pointer-events-none",style:{zIndex:0,objectFit:"contain",objectPosition:"center 45%",width:"270px",height:"auto",maxWidth:"100%",margin:"0 auto"},loading:"eager",fetchPriority:"high",decoding:"async",width:"270",height:"350","aria-hidden":"true"},`case-bg-${a}-${b}`),(0,p.jsx)("div",{className:"w-full h-full absolute inset-0",style:{zIndex:10,pointerEvents:"auto",width:"100%",height:"100%"},children:(0,p.jsx)(gp,{selectedCaseType:a,selectedColor:b,onPinSelect:j,onPinRemove:k,products:n})})]}),(0,p.jsxs)("div",{className:"mt-8 md:mt-8 mb-0 hidden md:flex flex-row gap-2 md:gap-2.5 lg:gap-3 flex-shrink-0 w-full max-w-full md:max-w-[480px] lg:max-w-[520px] relative z-0",children:[(0,p.jsx)(gq,{caseImages:e,onOpenModal:l}),(0,p.jsx)(gr,{selectedCase:d,onOpenModal:m})]})]})}),gt=[{value:"economy",label:"Economy - 8.00",image:"/images/SmartCase/economycaselightpink.webp"},{value:"business",label:"Business - 12.00",image:"/images/BusinessClassCase/businessclasscasegray.webp"},{value:"firstclass",label:"First Class - 12.00",image:"/images/FirstClassCase/firstclasscasebrown.webp"}],gu=[{value:"bronze",label:"Bronze - 1.00",image:"/images/BronzePins/airplane.webp"},{value:"colorful",label:"Colorful - 2.00",image:"/images/ColorfulPins/beagoodhuman.webp"},{value:"flags",label:"Flags - 2.00",image:"/images/Flags/albania.webp"}],gv=[{key:"all",label:"ALL"},{key:"europe",label:"EUROPE"},{key:"americas",label:"AMERICAS"},{key:"africa",label:"AFRICA"},{key:"asia",label:"ASIA"},{key:"special",label:"SPECIAL"}],gw=[{key:"all",label:"ALL"},{key:"travel",label:"TRAVEL"},{key:"disney",label:"DISNEY"},{key:"drinks",label:"DRINKS"},{key:"inspiration",label:"INSPIRATION"},{key:"hearts",label:"HEARTS"},{key:"nature",label:"NATURE"},{key:"camera",label:"CAMERA"}],gx=[{key:"all",label:"ALL"},{key:"travel",label:"TRAVEL"},{key:"animals",label:"ANIMALS"},{key:"love",label:"LOVE"},{key:"nature",label:"NATURE"},{key:"symbols",label:"SYMBOLS"}];var gy=a.i(1745);let gz=({selectedCaseType:a,onSelect:b,Products:c,onDropdownToggle:d,cart:e=[]})=>(0,p.jsx)("div",{className:"w-full",children:(0,p.jsx)("div",{className:"flex flex-nowrap gap-2 xs:gap-2.5 sm:gap-3 md:gap-4 lg:gap-5 xl:gap-6 justify-center items-start",children:gt.map(f=>{var g;let h,i=(a=>{if(c&&c.cases){let b=c.cases.find(b=>b.type===a);if(b&&b.colors&&b.colors.length>0)return b.colors[0].image}let b=gt.find(b=>b.value===a);return b&&b.image?b.image:null})(f.value),j=(g=f.value,!!(h=c&&c.cases?c.cases.find(a=>a.type===g):null)&&!!h.colors&&h.colors.length>0&&!h.colors.some(a=>{let b={caseType:g,color:a.color},c=(0,gy.getMaxAvailableQuantity)(b,e);return null===c||c>0})),k=a===f.value;return(0,p.jsxs)("div",{className:`transition-all duration-200 md:duration-300 lg:duration-500 flex flex-col items-center p-1.5 xs:p-2 sm:p-2.5 md:p-3 rounded-lg flex-1 max-w-[120px] xs:max-w-[140px] sm:max-w-[160px] md:max-w-[180px] lg:max-w-[200px] xl:max-w-[220px] ${k?"bg-gray-50":""} ${j?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>{!j&&(b(f.value),d&&d())},children:[(0,p.jsxs)("div",{className:"relative w-full",children:[i&&(0,p.jsx)("div",{className:`w-full aspect-square transition-all duration-200 md:duration-300 lg:duration-500 overflow-hidden flex items-center justify-center ${k?"  scale-110":""} ${j?"opacity-50":""}`,children:(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(i),alt:f.label,className:"w-full h-full object-contain p-1 xs:p-1.5 sm:p-2 md:p-2.5 lg:p-3 xl:p-4",loading:"lazy",onError:a=>{a.target.style.display="none"}})}),k&&!j&&(0,p.jsx)("div",{className:"absolute top-0 right-0 md:top-1 md:right-4 lg:top-2 lg:right-4 xl:top-2.5 xl:right-4.5 w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 xl:w-8 xl:h-8 bg-gray-900 rounded-full flex items-center justify-center shadow-md z-10",children:(0,p.jsx)("svg",{className:"w-3 h-3 md:w-3.5 md:h-3.5 lg:w-4 lg:h-4 xl:w-5 xl:h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,p.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),(0,p.jsxs)("div",{className:"flex flex-col items-center mt-2 md:mt-3 lg:mt-4 text-center",children:[(0,p.jsx)("span",{className:`text-xs md:text-sm font-medium tracking-wider ${k?"text-gray-700":"text-gray-500"}`,style:{fontFamily:"'Poppins', sans-serif"},children:f.label.split(" - ")[0]}),(0,p.jsx)("span",{className:`text-xs md:text-sm font-medium mt-0.5 ${k?"text-gray-500":"text-gray-400"}`,style:{fontFamily:"'Poppins', sans-serif"},children:f.label.split(" - ")[1]})]}),j&&(0,p.jsx)("span",{className:"text-[10px] md:text-xs lg:text-sm text-red-600 font-medium mt-1 md:mt-2",children:"Sold Out"})]},f.value)})})}),gA=({colors:a,selectedColor:b,onSelect:c,caseType:d,cart:e=[]})=>(0,p.jsx)("div",{className:"overflow-visible",children:(0,p.jsx)("div",{className:"flex flex-wrap gap-3 overflow-visible justify-center",children:a.map(({color:f,image:g,quantity:h})=>{let i=(a=>{if(!a)return"";let b=a.split("/").pop().replace(".webp","").replace(".png","").replace(".jpg","").toLowerCase().replace(/^economycase/i,"").replace(/^businessclasscase/i,"").replace(/^firstclasscase/i,"").replace(/^smartcase/i,"").replace(/^premiumcase/i,"").replace(/^firstclass/i,""),c={lightpink:"Light Pink",lightblue:"Light Blue",lightbrown:"Light Brown",darkbrown:"Dark Brown",darkblue:"Dark Blue",jeansblue:"Jeans Blue",brickred:"Brick Red",ligthpink:"Light Pink",navyblue:"Navy Blue",gray:"Gray",grey:"Gray",black:"Black",brown:"Brown",red:"Red",pink:"Pink",blue:"Blue",green:"Green",purple:"Purple",yellow:"Yellow",orange:"Orange"};return c[b]?c[b]:(b=b.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/(dark|light|navy|jeans|brick)([a-z]+)/g,"$1 $2").split(/(?=[A-Z])|(?=dark|light|navy|jeans|brick)/).filter(a=>a.length>0).join(" ").toLowerCase().split(" ").map(a=>c[a]?c[a]:a.charAt(0).toUpperCase()+a.slice(1)).join(" "))||"Color"})(g),j=b===f,k=(b=>{if(!d||!b){let c=a.find(a=>a.color===b);return c?.quantity!==void 0&&0===c.quantity}let c=(0,gy.getMaxAvailableQuantity)({caseType:d,color:b},e);return null!==c&&0===c})(f);return(0,p.jsxs)("div",{className:`transition-all duration-200 flex flex-col items-center overflow-visible ${k?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>!k&&c(f,g),children:[(0,p.jsxs)("div",{className:"relative overflow-visible",children:[(0,p.jsx)("div",{className:`w-10 h-10 rounded-full border-2 transition-all duration-200 ${j?"border-gray-900 ring-2 ring-gray-300 scale-110":"border-gray-200 hover:border-gray-400"} ${k?"opacity-50":""}`,style:{backgroundColor:f}}),j&&!k&&(0,p.jsx)("div",{className:"absolute top-0 right-0 w-4 h-4 bg-gray-900 rounded-full flex items-center justify-center z-10",children:(0,p.jsx)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,p.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),i&&(0,p.jsx)("span",{className:`text-xs font-medium mt-2 text-center font-inter ${j?"text-gray-900":"text-gray-700"} ${k?"text-white ":""}`,children:i}),k&&(0,p.jsx)("span",{className:"text-[10px] -mt-4 text-red-600 font-medium ",children:"Sold Out"})]},f)})})}),gB=({isOpen:a,onToggle:b,selectedCaseType:c,selectedColor:d,selectedCase:e,onCaseSelect:f,onColorSelect:g,setIsCaseDropdownOpen:h,Products:i,cart:j})=>(0,p.jsxs)("div",{className:"pb-6 border-b border-gray-100 flex-shrink-0 mt-6 overflow-visible hidden md:block",children:[(0,p.jsxs)("button",{onClick:b,className:"w-full flex items-center justify-between mb-4",children:[(0,p.jsx)("h3",{className:"text-sm uppercase tracking-wider text-gray-900 font-medium",style:{fontFamily:"'Poppins', sans-serif"},children:"1. Choose Case"}),(0,p.jsx)("svg",{className:`w-4 h-4 text-gray-500 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,p.jsxs)("div",{className:"space-y-6 overflow-visible",children:[(0,p.jsx)(gz,{selectedCaseType:c,onSelect:f,Products:i,isCaseDropdownOpen:a,setIsCaseDropdownOpen:h,cart:j}),d&&(0,p.jsx)("div",{className:"mt-10 overflow-visible",children:(0,p.jsx)(gA,{colors:e?.colors||[],selectedColor:d,onSelect:g,caseType:c,cart:j})})]})]}),gC=(a,b,c)=>c&&"all"!==c?a.filter(a=>"colorful"===b||"bronze"===b?a.subCategory===c:"flags"!==b||a.continent===c):a,gD=[{value:"bronze",label:"Bronze Charms",price:"1.50 each"},{value:"colorful",label:"Colorful Charms",price:"2.00 each"},{value:"flags",label:"Flags Collection",price:"2.00 each"}],gE={colorful:[{key:"all",label:"ALL"},{key:"travel",label:"TRAVEL"},{key:"disney",label:"DISNEY"},{key:"drinks",label:"DRINKS"},{key:"inspiration",label:"INSPIRATION"},{key:"hearts",label:"HEARTS"},{key:"nature",label:"NATURE"},{key:"camera",label:"CAMERA"}],bronze:[{key:"all",label:"ALL"},{key:"travel",label:"TRAVEL"},{key:"animals",label:"ANIMALS"},{key:"love",label:"LOVE"},{key:"nature",label:"NATURE"},{key:"symbols",label:"SYMBOLS"}],flags:[{key:"all",label:"ALL"},{key:"europe",label:"EUROPE"},{key:"americas",label:"AMERICAS"},{key:"africa",label:"AFRICA"},{key:"asia",label:"ASIA"},{key:"special",label:"SPECIAL"}]},gF=({selectedCategory:a,setSelectedCategory:b,onDropdownToggle:c,getPreviewImage:d})=>(0,p.jsx)("div",{className:"grid grid-cols-3 gap-2 mb-4",children:gD.map(e=>{let f=d(e.value),g=a===e.value;return(0,p.jsxs)("button",{type:"button",role:"option","aria-selected":g,className:`font-inter flex flex-col items-center p-2.5 rounded-lg transition-colors ${g?"bg-gray-50":"hover:bg-gray-50"}`,onClick:()=>{b(e.value),c&&c()},children:[f&&(0,p.jsxs)("div",{className:"relative mb-2 flex items-center justify-center rounded overflow-visible",style:{width:"4rem",height:"4rem"},children:[(0,p.jsx)("div",{className:"w-full h-full flex items-center justify-center rounded overflow-hidden",children:(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(f),alt:e.label,className:"max-w-full max-h-full object-contain p-1",loading:"lazy",decoding:"async"})}),g&&(0,p.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gray-900 rounded-full flex items-center justify-center z-20 shadow-sm ",children:(0,p.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,p.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),(0,p.jsx)("span",{className:`text-xs text-center font-light ${g?"text-gray-900":"text-gray-600"}`,children:e.label}),(0,p.jsx)("span",{className:"text-[10px] text-gray-500 mt-0.5",children:e.price})]},e.value)})}),gG=({selectedCategory:a,subCategory:b,setSubCategory:c,getSubCategoryCount:d})=>{if(!a)return null;let e=gE[a];return e?(0,p.jsx)("div",{className:"mb-4 flex flex-wrap gap-1 border-b border-gray-200 justify-center",children:e.map(({key:e,label:f})=>{let g=d(e),h=b===e;return(0,p.jsxs)("button",{onClick:()=>c(e),className:`px-3 py-2 text-caption uppercase tracking-wider transition-all duration-200 font-inter ${h?"flags"===a?"text-gray-900 font-medium":"border-b-2 border-gray-900 text-gray-900 font-medium":"flags"===a?"border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300":"border-b-2 border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300"}`,children:[f," ",(0,p.jsxs)("span",{className:"text-gray-400 font-normal",children:["(",g,")"]})]},e)})}):null},gH=({pin:a,isSelected:b,isSoldOut:c,onClick:d})=>{var e;let f=(e=a.size)?e<=.3?"XS":e<=.45?"S":e<=.6?"M":e<=.75?"L":"XL":"";return(0,p.jsxs)("div",{className:`flex flex-col items-center justify-center text-center space-y-1 sm:space-y-2 p-2 sm:p-3 h-full transition-colors group touch-manipulation ${c?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:d,children:[(0,p.jsxs)("div",{className:"relative",style:{overflow:"visible"},children:[(0,p.jsx)("div",{className:"w-16 h-16 sm:w-20 sm:h-20 aspect-square flex items-center justify-center bg-transparent",children:(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(a.src),alt:a.name,className:`w-full h-full object-contain transition-all duration-200 rounded ${c?"opacity-50":""}`,loading:"lazy"})}),b&&!c&&(0,p.jsx)("div",{className:"absolute -top-1 -right-1 bg-black text-white w-6 h-6 flex items-center justify-center text-xs rounded-full z-10 shadow-md",children:""}),f&&(0,p.jsx)("div",{className:"absolute -top-1 -left-1 bg-gray-100 text-gray-700 text-[8px] font-medium px-1.5 py-0.5 rounded-full z-10 border border-gray-300",children:f})]}),(0,p.jsx)("span",{className:"text-xs text-center text-gray-700 transition-colors line-clamp-2 font-inter",children:a.name}),c&&(0,p.jsx)("span",{className:"text-[9px] text-red-600 font-medium",children:"Sold Out"})]})},gI=({filteredPins:a,selectedPins:b,onSelect:c,onRemove:d,cart:e,selectedCategory:f})=>(0,p.jsx)("div",{className:"max-h-80 sm:max-h-96 overflow-y-auto p-2",children:(0,p.jsx)("div",{className:"grid grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-2 sm:gap-2 justify-items-center md:max-w-3xl mx-auto",children:a.map((a,g)=>{let h=b.find(b=>b.pin===a),i=!!h,j=(a=>{let c=a.category||f||"colorful",d=a.name||a.src||"",g=(0,gy.getMaxAvailableQuantity)({type:"charm",category:c,pin:a,name:d},e||[]);if(null===g)return!1;let h=0;(e||[]).forEach(b=>{if("charm"===b.type){let e=b.pin||b,f=e.name||e.src,g=e.category||b.category||c;(f===d||f===a.src)&&g===c&&(h+=b.quantity||1)}});let i=0;(e||[]).forEach(b=>{b.pins&&Array.isArray(b.pins)&&b.pins.forEach(e=>{let f=e.name||e.src,g=e.category||c;(f===d||f===a.src)&&g===c&&(i+=b.quantity||1)})});let j=b.filter(b=>{let e=b.pin||b,f=e.name||e.src,g=e.category||c;return(f===d||f===a.src)&&g===c}).length,k=g+h,l=h+i+j;return 0===g||l>=k})(a),k=a.src?`${a.src}-${g}`:`${a.name}-${g}`;return(0,p.jsx)(gH,{pin:a,isSelected:i,isSoldOut:j,onClick:()=>{j||(i&&d&&h?d(h.imgInstance):c(a))}},k)})})}),gJ=({pins:a,selectedCategory:b,setSelectedCategory:c,selectedPins:d,onSelect:e,onRemove:f,onDropdownToggle:g,Products:h,cart:i})=>{let[j,k]=(0,q.useState)("all");(0,q.useEffect)(()=>{k("all")},[b]);let l=(0,q.useMemo)(()=>gC(a,b,j),[a,b,j]);return(0,p.jsxs)("div",{children:[(0,p.jsx)(gF,{selectedCategory:b,setSelectedCategory:c,onDropdownToggle:g,getPreviewImage:a=>{if(h&&h.pins){if("bronze"===a&&h.pins.bronze&&h.pins.bronze.length>0)return h.pins.bronze[0].src;if("colorful"===a&&h.pins.colorful&&h.pins.colorful.length>0)return h.pins.colorful[0].src;if("flags"===a&&h.pins.flags&&h.pins.flags.length>0)return h.pins.flags[0].src}let b=gu.find(b=>b.value===a);return b&&b.image?b.image:null}}),b&&(0,p.jsxs)("div",{className:"mt-4 pb-4",children:[(0,p.jsx)(gG,{selectedCategory:b,subCategory:j,setSubCategory:k,getSubCategoryCount:c=>gC(a,b,c).length}),(0,p.jsx)(gI,{filteredPins:l,selectedPins:d,onSelect:e,onRemove:f,cart:i,selectedCategory:b})]})]})},gK=({isOpen:a,onToggle:b,pins:c,selectedCategory:d,setSelectedCategory:e,selectedPins:f,onPinSelect:g,Products:h,cart:i})=>(0,p.jsxs)("div",{className:"pb-6 border-b border-gray-100 mt-6 hidden md:block",children:[(0,p.jsxs)("button",{onClick:b,className:"w-full flex items-center justify-between mb-4",children:[(0,p.jsx)("h3",{className:"text-sm uppercase tracking-wider text-gray-900 font-medium",style:{fontFamily:"'Poppins', sans-serif"},children:"3. Choose Charms"}),(0,p.jsx)("svg",{className:`w-4 h-4 text-gray-500 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,p.jsx)("div",{className:"relative z-10",children:(0,p.jsx)(gJ,{pins:c,selectedCategory:d,setSelectedCategory:e,selectedPins:f,onSelect:g,Products:h,cart:i})})]}),gL=({customText:a,setCustomText:b,customTextError:c,setCustomTextError:d,customTextAdded:e,setCustomTextAdded:f,onTextAdded:g,onClose:h})=>(0,p.jsxs)("div",{className:"space-y-4 ",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("input",{type:"text",value:a||"",onChange:a=>{b(a.target.value),d(""),f(!1)},onFocus:a=>{let b=window.scrollY||window.pageYOffset,c=window.scrollX||window.pageXOffset;setTimeout(()=>{window.scrollTo({left:c,top:b,behavior:"instant"})},0),requestAnimationFrame(()=>{window.scrollTo({left:c,top:b,behavior:"instant"})})},placeholder:"e.g. Your name",className:"w-full px-3 py-2 border border-gray-200  focus:outline-none focus:border-gray-400 bg-white text-gray-900 placeholder-gray-400 font-thin text-sm font-inter",maxLength:40}),(0,p.jsxs)("p",{className:"mt-1 text-sm text-gray-500 font-inter",children:["Up to ",15," characters. Double-click the text on the case to edit or move it."]})]}),c&&(0,p.jsx)("div",{className:"text-sm text-gray-600 border border-gray-200 bg-gray-50 px-3 py-2",children:c}),e&&(0,p.jsx)("div",{className:"text-sm text-green-600 py-2",children:"Text added to your design! You can drag it to reposition it."}),(0,p.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,p.jsx)("button",{onClick:()=>{a.trim()?d("Canvas is still loading. Please try again in a moment."):d("Please enter the text you want to add.")},disabled:!a.trim(),className:"flex-1 px-3 py-1.5 text-xs font-medium uppercase tracking-wider active:bg-blue-200 disabled:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed active:scale-95 disabled:scale-100 font-inter bg-btn-light-blue hover:bg-btn-light-blue-hover text-btn-light-blue-text border hover:border-btn-light-blue-hover transition-all duration-200",children:"Add Text"}),(0,p.jsx)("button",{onClick:()=>{b(""),f(!1),d("")},disabled:!a.trim(),className:"px-3 py-1.5 text-xs font-medium uppercase tracking-wider active:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 disabled:border-gray-100 disabled:cursor-not-allowed active:scale-95 disabled:scale-100 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-1 font-inter bg-btn-light-gray hover:bg-btn-light-gray-hover text-btn-light-gray-text border border-btn-light-gray-border hover:border-btn-light-gray-hover transition-all duration-200",children:"Clear"})]})]}),gM=({isOpen:a,onToggle:b,customText:c,setCustomText:d,customTextError:e,setCustomTextError:f,customTextAdded:g,setCustomTextAdded:h})=>(0,p.jsxs)("div",{className:"pb-6 border-b border-gray-100 mt-6 hidden md:block",children:[(0,p.jsxs)("button",{onClick:b,className:"w-full flex items-center justify-between mb-4",children:[(0,p.jsx)("h3",{className:"text-sm uppercase tracking-wider text-gray-900 font-medium",style:{fontFamily:"'Poppins', sans-serif"},children:"4. Add Text"}),(0,p.jsx)("svg",{className:`w-4 h-4 text-gray-500 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,p.jsx)(gL,{customText:c,setCustomText:d,customTextError:e,setCustomTextError:f,customTextAdded:g,setCustomTextAdded:h})]});var gN=a.i(70588);let gO=({mobileCurrentStep:a,setMobileCurrentStep:b,selectedCaseType:c,selectedColor:d,selectedCategory:e,setSelectedCategory:f,mobileSubCategory:g,setMobileSubCategory:h,pins:i,selectedPins:j,handleCaseTypeSelection:k,handleColorSelection:l,handlePinSelection:m,Products:n,cart:o})=>{let[r,s]=(0,q.useState)(!1);if(!a)return null;let t=(0,gN.filterPinsByCategory)(i,e,g),v="flags"===e?gv:"colorful"===e?gw:"bronze"===e?gx:[],w=v.find(a=>a.key===g)?.label||"ALL";return(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 xs:p-3 sm:p-4 md:p-6",children:(0,p.jsxs)("div",{className:`bg-white rounded-sm p-3 xs:p-4 sm:p-5 md:p-6 lg:p-8 xl:p-10 w-full overflow-y-auto border border-gray-200 ${"charms"===a?"max-w-[calc(100vw-1rem)] xs:max-w-sm md:max-w-md lg:max-w-lg h-fit":"case"===a?"max-w-[calc(100vw-1rem)] xs:max-w-sm sm:max-w-md md:max-w-2xl lg:max-w-3xl xl:max-w-4xl max-h-[85vh] xs:max-h-[80vh] md:max-h-[75vh]":"max-w-[calc(100vw-1rem)] xs:max-w-sm md:max-w-md lg:max-w-lg max-h-[85vh] xs:max-h-[80vh] md:max-h-[75vh]"}`,children:[(0,p.jsxs)("div",{className:"flex justify-between items-center mb-4 xs:mb-5 sm:mb-6 md:mb-8 border-b border-gray-100 pb-3 xs:pb-4 md:pb-5",children:[(0,p.jsxs)("h2",{className:"text-xs xs:text-sm md:text-base lg:text-lg uppercase tracking-wider text-gray-900 font-medium",style:{fontFamily:"'Poppins', sans-serif"},children:["case"===a&&"Choose Case","color"===a&&"Choose Color","charms"===a&&"Choose Charms"]}),(0,p.jsx)("button",{onClick:()=>b(null),className:"p-0.5 xs:p-1 hover:bg-gray-50 transition-colors",children:(0,p.jsx)("svg",{className:"w-4 h-4 xs:w-5 xs:h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsxs)("div",{className:"space-y-3 xs:space-y-4 md:space-y-5",children:["case"===a&&(0,p.jsx)("div",{className:"w-full",children:(0,p.jsx)("div",{className:"grid grid-cols-3 gap-1.5 xs:gap-2 sm:gap-3 md:gap-5 lg:gap-6 xl:gap-8",children:gt.map(a=>{let b,d=(()=>{if(n&&n.cases){let b=n.cases.find(b=>b.type===a.value);if(b&&b.colors&&b.colors.length>0)return b.colors[0].image}return a.image||null})(),e=!!(b=n&&n.cases?n.cases.find(b=>b.type===a.value):null)&&!!b.colors&&b.colors.length>0&&!b.colors.some(b=>{let c={caseType:a.value,color:b.color},d=(0,gy.getMaxAvailableQuantity)(c,o||[]);return null===d||d>0}),f=c===a.value;return(0,p.jsxs)("button",{onClick:()=>{e||k(a.value)},disabled:e,className:`p-0.5 xs:p-1 sm:p-2.5 md:p-4 lg:p-5 xl:p-6 text-center transition-all duration-200 flex flex-col items-center gap-0.5 xs:gap-1 sm:gap-2 md:gap-3 lg:gap-4 ${c===a.value?" text-gray-900":" hover:border-gray-300"} ${e?"opacity-50 cursor-not-allowed":""}`,style:{fontFamily:"'Poppins', sans-serif"},children:[d&&(0,p.jsxs)("div",{className:"relative w-full aspect-square overflow-hidden ",children:[(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(d),alt:a.label,className:`w-full h-full object-contain p-0 xs:p-0.5 sm:p-1.5 md:p-3 lg:p-4 xl:p-5 ${e?"opacity-50":""}`,loading:"lazy",onError:a=>{a.target.style.display="none"}}),f&&!e&&(0,p.jsx)("div",{className:"absolute top-0.5 right-0.5 xs:top-1 xs:right-1 sm:top-1.5 sm:right-1.5 md:top-2 md:right-2 lg:top-3 lg:right-3 xl:top-4 xl:right-4 w-3 h-3 xs:w-4 xs:h-4 sm:w-5 sm:h-5 md:w-7 md:h-7 lg:w-8 lg:h-8 xl:w-10 xl:h-10 bg-gray-900 rounded-full flex items-center justify-center shadow-md",children:(0,p.jsx)("svg",{className:"w-2 h-2 xs:w-2.5 xs:h-2.5 sm:w-3 sm:h-3 md:w-4 md:h-4 lg:w-5 lg:h-5 xl:w-6 xl:h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,p.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),(0,p.jsx)("span",{className:`text-xs xs:text-sm sm:text-base md:text-base lg:text-lg xl:text-xl font-medium mt-0.5 xs:mt-1 md:mt-2 ${e?"text-gray-500":""}`,children:a.label}),e&&(0,p.jsx)("span",{className:"text-[8px] xs:text-[9px] sm:text-[10px] md:text-xs text-red-600 font-medium mt-0.5 xs:mt-1",children:"Sold Out"})]},a.value)})})}),"color"===a&&c&&(0,p.jsx)("div",{children:(0,p.jsx)(gA,{colors:n.cases.find(a=>a.type===c)?.colors||[],selectedColor:d,onSelect:l,caseType:c,cart:o})}),"charms"===a&&c&&d&&(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{className:"mb-3 xs:mb-4",children:(0,p.jsx)("div",{className:"grid grid-cols-3 gap-1.5 xs:gap-2",children:gu.map(a=>(0,p.jsxs)("button",{onClick:()=>f(a.value),className:"p-1.5 xs:p-2 text-[10px] xs:text-xs text-center transition-all duration-200 flex flex-col items-center gap-1.5 xs:gap-2 relative",style:{fontFamily:"'Poppins', sans-serif"},children:[a.image&&(0,p.jsxs)("div",{className:`w-16 h-16 xs:w-20 xs:h-20 flex-shrink-0 rounded flex items-center justify-center overflow-hidden relative ${e===a.value?"bg-gray-100":"bg-white"}`,children:[(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(a.image),alt:a.label,className:"w-full h-full object-contain"}),e===a.value&&(0,p.jsx)("div",{className:"absolute top-0 right-0 bg-gray-900 text-white w-4 h-4 xs:w-5 xs:h-5 flex items-center justify-center rounded-full shadow-md",children:(0,p.jsx)("svg",{className:"w-2.5 h-2.5 xs:w-3 xs:h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,p.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),(0,p.jsx)("span",{className:"font-medium text-xs xs:text-sm",children:a.label})]},a.value||"all"))})}),e&&v.length>0&&(0,p.jsxs)("div",{className:"mb-3 xs:mb-4 relative",children:[(0,p.jsxs)("button",{onClick:()=>s(!r),className:"w-full flex items-center justify-between px-3 xs:px-4 py-2 xs:py-2.5 bg-gray-100 border border-gray-300 text-left transition-all duration-200 hover:bg-gray-200 hover:border-gray-400",style:{fontFamily:"'Poppins', sans-serif"},children:[(0,p.jsx)("span",{className:"text-xs xs:text-sm font-medium text-gray-900 uppercase tracking-wider",children:w}),(0,p.jsx)("svg",{className:`w-4 h-4 xs:w-5 xs:h-5 text-gray-500 transition-transform duration-200 ${r?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 9l-7 7-7-7"})})]}),r&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>s(!1)}),(0,p.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 shadow-lg max-h-60 overflow-y-auto",children:v.map(({key:a,label:b})=>(0,p.jsx)("button",{onClick:()=>{h(a),s(!1)},className:`w-full text-left px-3 xs:px-4 py-2 xs:py-2.5 text-xs xs:text-sm uppercase tracking-wider transition-all duration-200 ${g===a?"bg-gray-100 text-gray-900 font-medium":"text-gray-700 hover:bg-gray-50"}`,style:{fontFamily:"'Poppins', sans-serif"},children:b},a))})]})]}),e&&(0,p.jsx)("div",{children:(0,p.jsx)("div",{className:"max-h-[60vh] xs:max-h-96 overflow-y-auto",children:(0,p.jsx)("div",{className:"grid grid-cols-3 gap-2 xs:gap-2.5 sm:gap-3",children:t.map(a=>{var b;let c=j.some(b=>b.pin===a),d=(b=a.size)?b<=.3?"XS":b<=.45?"S":b<=.6?"M":b<=.75?"L":"XL":"",f=(()=>{let b=a.category||e||"colorful",c=a.name||a.src||"",d=(0,gy.getMaxAvailableQuantity)({type:"charm",category:b,pin:a,name:c},o||[]);if(null===d)return!1;let f=0;(o||[]).forEach(d=>{if("charm"===d.type){let e=d.pin||d,g=e.name||e.src,h=e.category||d.category||b;(g===c||g===a.src)&&h===b&&(f+=d.quantity||1)}});let g=0;(o||[]).forEach(d=>{d.pins&&Array.isArray(d.pins)&&d.pins.forEach(e=>{let f=e.name||e.src,h=e.category||b;(f===c||f===a.src)&&h===b&&(g+=d.quantity||1)})});let h=j.filter(d=>{let e=d.pin||d,f=e.name||e.src,g=e.category||b;return(f===c||f===a.src)&&g===b}).length,i=d+f,k=f+g+h;return 0===d||k>=i})();return(0,p.jsxs)("button",{onClick:()=>!f&&m(a),disabled:f,className:`p-1.5 xs:p-2 transition-all duration-200 flex flex-col items-center ${f?"opacity-50 cursor-not-allowed":""}`,children:[(0,p.jsxs)("div",{className:`relative w-16 h-16 xs:w-20 xs:h-20 flex items-center justify-center transition-all duration-200 overflow-visible ${c?"rounded":""}`,children:[(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(a.src),alt:a.name,className:`max-w-full max-h-full object-contain ${f?"opacity-50":""}`}),c&&!f&&(0,p.jsx)("div",{className:"absolute top-0 right-0 bg-gray-900 text-white w-5 h-5 xs:w-6 xs:h-6 flex items-center justify-center text-[10px] xs:text-xs rounded-full shadow-md z-10",children:(0,p.jsx)("svg",{className:"w-3 h-3 xs:w-4 xs:h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,p.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),d&&(0,p.jsx)("div",{className:"absolute top-0 left-0 bg-gray-100 text-gray-700 text-[8px] xs:text-[9px] font-medium px-1 xs:px-1.5 py-0.5 rounded-full z-10 border border-gray-300",children:d})]}),(0,p.jsx)("span",{className:`text-xs xs:text-sm sm:text-base text-center line-clamp-2 mt-0.5 xs:mt-1 ${f?"text-gray-500":"text-gray-700"}`,style:{fontFamily:"'Poppins', sans-serif"},children:a.name}),f&&(0,p.jsx)("span",{className:"text-[8px] xs:text-[9px] text-red-600 font-medium mt-0.5",children:"Sold Out"})]},a.name)})})})})]})]})]})})};var gP=a.i(72856),gQ=a.i(21929);let gR=({selectedCaseType:a,selectedColor:b,onCaseClick:c,onColorClick:d,onCharmsClick:e,onTextClick:f,isAddTextDropdownOpen:g})=>(0,p.jsx)("div",{className:"mb-4 flex justify-center",children:(0,p.jsxs)("div",{className:"grid grid-cols-4 gap-1.5 xs:gap-2 sm:gap-2.5 max-w-fit",children:[(0,p.jsxs)("button",{onClick:c,className:"py-2.5 flex flex-col items-center justify-center gap-1 transition-all duration-200 touch-manipulation bg-btn-primary-blue text-btn-primary-blue-text border border-btn-primary-blue-border hover:bg-btn-primary-blue-hover px-3 xs:px-4",children:[(0,p.jsx)(gP.FontAwesomeIcon,{icon:gQ.faBriefcase,className:"w-4 h-4 text-btn-primary-blue-text"}),(0,p.jsx)("span",{className:"text-sm font-medium uppercase tracking-wide leading-tight text-btn-primary-blue-text",style:{fontFamily:"'Poppins', sans-serif"},children:"Case"})]}),(0,p.jsxs)("button",{onClick:d,disabled:!a,className:`py-2.5 flex flex-col items-center justify-center gap-1 transition-all duration-200 touch-manipulation px-3 xs:px-4 ${!a?"bg-gray-50 text-gray-400 border border-gray-200 cursor-not-allowed opacity-50":"bg-btn-primary-blue text-btn-primary-blue-text border border-btn-primary-blue-border hover:bg-btn-primary-blue-hover"}`,children:[(0,p.jsx)(gP.FontAwesomeIcon,{icon:gQ.faPalette,className:`w-4 h-4 ${!a?"text-gray-400":"text-btn-primary-blue-text"}`}),(0,p.jsx)("span",{className:`text-sm font-medium uppercase tracking-wide leading-tight ${!a?"text-gray-400":"text-btn-primary-blue-text"}`,style:{fontFamily:"'Poppins', sans-serif"},children:"Color"})]}),(0,p.jsxs)("button",{onClick:e,disabled:!a||!b,className:`py-2.5 flex flex-col items-center justify-center gap-1 transition-all duration-200 touch-manipulation px-3 xs:px-4 ${!a||!b?"bg-gray-50 text-gray-400 border border-gray-200 cursor-not-allowed opacity-50":"bg-btn-primary-blue text-btn-primary-blue-text border border-btn-primary-blue-border hover:bg-btn-primary-blue-hover"}`,children:[(0,p.jsx)(gP.FontAwesomeIcon,{icon:gQ.faPlane,className:`w-4 h-4 ${!a||!b?"text-gray-400":"text-btn-primary-blue-text"}`}),(0,p.jsx)("span",{className:`text-sm font-medium uppercase tracking-wide leading-tight ${!a||!b?"text-gray-400":"text-btn-primary-blue-text"}`,style:{fontFamily:"'Poppins', sans-serif"},children:"Charms"})]}),(0,p.jsxs)("button",{onClick:f,className:"py-2.5 flex flex-col items-center justify-center gap-1 transition-all duration-200 touch-manipulation bg-btn-primary-blue text-btn-primary-blue-text border border-btn-primary-blue-border hover:bg-btn-primary-blue-hover px-3 xs:px-4",children:[(0,p.jsx)(gP.FontAwesomeIcon,{icon:gQ.faFont,className:"w-4 h-4 text-btn-primary-blue-text"}),(0,p.jsx)("span",{className:"text-sm font-medium uppercase tracking-wide leading-tight text-btn-primary-blue-text",style:{fontFamily:"'Poppins', sans-serif"},children:"Text"})]})]})}),gS=({customText:a,setCustomText:b,customTextError:c,setCustomTextError:d,customTextAdded:e,setCustomTextAdded:f,onAddText:g})=>(0,p.jsxs)("div",{className:"px-2 xs:px-3 sm:px-4 space-y-2 pt-2",children:[(0,p.jsxs)("div",{className:"flex gap-2",children:[(0,p.jsx)("input",{type:"text",value:a||"",onChange:a=>{b(a.target.value),d(""),f(!1)},onKeyDown:b=>{"Enter"===b.key&&a.trim()&&g()},placeholder:"e.g. Your name",className:"flex-1 px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:border-gray-400 bg-white text-gray-900 placeholder-gray-400 font-thin text-sm font-inter",style:{fontSize:"16px"},maxLength:15}),(0,p.jsx)("button",{onClick:g,disabled:!a.trim(),className:"px-4 py-2 text-xs font-medium uppercase tracking-wider disabled:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed disabled:border-gray-100 rounded-sm active:scale-95 disabled:scale-100 focus:outline-none font-inter bg-btn-light-blue hover:bg-btn-light-blue-hover text-btn-light-blue-text border border-btn-light-blue-border hover:border-btn-light-blue-hover transition-all duration-200",children:"Add"})]}),(0,p.jsxs)("p",{className:"text-xs text-gray-500 font-inter",children:["Up to ",15," characters. Double-click the text on the case to edit or move it."]}),c&&(0,p.jsx)("div",{className:"text-xs text-gray-600 border border-gray-200 bg-gray-50 px-3 py-2 rounded",children:c}),e&&(0,p.jsx)("div",{className:"text-xs text-green-700 bg-green-50 px-1 py-2",children:"Text added to your design! You can drag it to reposition it."})]});var gT=a.i(80169),gU=a.i(356);let gV=({totalPrice:a,caseBasePrice:b,groupedPinsList:c,showPriceBreakdown:d,quantity:e,setQuantity:f,onIncrementQuantity:g,onDecrementQuantity:h,selectedCase:i,selectedCaseType:j,selectedColor:k,selectedPins:l,selectedCaseImage:m,pinsPrice:n,onAddToCart:o,onShowTerms:q,agreedToTerms:r,setAgreedToTerms:s,showTermsError:t,inventoryMessage:u,inventoryType:v,isMobile:w=!1})=>{let{formatPrice:x}=(0,gT.useCurrency)();return(0,p.jsxs)("div",{className:`${w?"pt-0 mt-0 bg-gray-100":"pt-14"} flex-shrink-0 relative z-0  ${w?"":"mt-auto flex flex-col justify-between"}`,children:[w?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"flex flex-row items-start justify-between mt-2 ",children:[(0,p.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,p.jsxs)("div",{className:"flex flex-row items-center gap-1.5 mb-1",children:[(0,p.jsx)("h3",{className:"text-[14px] xs:text-sm text-gray-400 font-light font-inter",children:"Total:"}),(0,p.jsx)("h3",{className:"text-md font-bold xs:text-base sm:text-lg text-gray-900  font-inter leading-none mb-1",children:x(a)})]}),(0,p.jsxs)("div",{children:[(0,p.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[(0,p.jsx)("input",{type:"checkbox",checked:r||!1,onChange:a=>s(a.target.checked),className:"w-3.5 h-3.5 xs:w-4 xs:h-4 text-gray-900 border-gray-300 rounded"}),(0,p.jsx)("span",{className:"text-xs xs:text-sm text-gray-700 leading-tight font-light font-inter",children:(0,p.jsx)("button",{type:"button",onClick:q,className:"text-gray-900 underline hover:text-gray-700 transition-colors font-light",children:"Terms of Use"})})]}),t&&(0,p.jsx)("div",{className:"mt-1 text-xs xs:text-sm text-red-600 font-light font-inter",children:"You must accept the terms to add items to cart."})]})]}),(0,p.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,p.jsxs)("div",{className:"flex items-center border border-gray-200 rounded-sm py-2.5 xs:py-2 px-0.5 flex-shrink-0 gap-0",children:[(0,p.jsx)("button",{onClick:h||(()=>f(Math.max(0,e-1))),className:"w-6 h-6 xs:w-7 xs:h-7 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Decrease quantity",children:""}),(0,p.jsx)("div",{className:"px-1 xs:px-1.5 py-0.5 text-sm xs:text-base text-gray-900 font-light font-inter min-w-[1.5rem] xs:min-w-[2rem] text-center",children:Math.max(e,1)}),(0,p.jsx)("button",{onClick:g||(()=>f(e+1)),className:"w-6 h-6 xs:w-7 xs:h-7 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Increase quantity",children:"+"})]}),(0,p.jsx)("div",{className:"flex-1 min-w-0 ",children:(0,p.jsx)(gU.default,{product:{id:`custom-${Date.now()}`,name:`${i?.name||"Custom Case"} with ${l.length} charms`,caseType:j,caseName:i?.name||"Custom Case",color:k,pins:l.map(({pin:a})=>a),pinsDetails:l.map(({pin:a})=>a),basePrice:b,casePrice:b,pinsPrice:n,totalPrice:parseFloat(a),price:parseFloat(a),image:m,caseImage:m,customDesign:!0,quantity:e},onAdd:o,className:"!w-full cursor-pointer bg-btn-success hover:bg-btn-success-hover text-btn-success-text border border-btn-success-border hover:border-btn-success-hover transition-all duration-200 py-2.5 px-8 text-sm font-light whitespace-nowrap",disabled:!1})})]})]}),u&&(0,p.jsx)("div",{className:`mt-1.5 text-xs xs:text-sm font-light font-inter ${"error"===v?"text-red-600":"text-orange-600"}`,children:u})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"flex items-end flex-row mb-4 gap-2",children:[(0,p.jsx)("h3",{className:"text-sm text-gray-400 font-light  ",children:"Total:"}),(0,p.jsx)("h3",{className:"text-md font-bold text-gray-900 font-inter ",children:x(a)})]}),(0,p.jsxs)("div",{className:"mb-4 ",children:[(0,p.jsxs)("label",{className:"flex items-start gap-2 cursor-pointer",children:[(0,p.jsx)("input",{type:"checkbox",checked:r||!1,onChange:a=>s(a.target.checked),className:"mt-0.5 w-4 h-4 text-gray-900 border-gray-300 rounded "}),(0,p.jsxs)("span",{className:"text-sm text-gray-700 leading-relaxed font-light font-inter",children:["I agree to the"," ",(0,p.jsx)("button",{type:"button",onClick:q,className:"text-gray-900 underline hover:text-gray-700 transition-colors text-sm font-light",children:"Terms of Use"})," ","and understand that it is my responsibility to create the passport case design, and that as items are handmade, they may vary."]})]}),t&&(0,p.jsx)("div",{className:"mt-2 text-sm text-red-600 font-light font-inter",children:"You must accept the terms to add items to cart."})]}),(0,p.jsxs)("div",{className:"mt-auto flex flex-row gap-1.5 xs:gap-2 items-center",children:[(0,p.jsxs)("div",{className:"flex items-center border border-gray-200 rounded-sm py-2.5 px-1",children:[(0,p.jsx)("button",{onClick:h||(()=>f(Math.max(0,e-1))),className:"w-6 h-6 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Decrease quantity",children:""}),(0,p.jsx)("div",{className:"px-3 py-0 text-sm text-gray-900 font-light font-inter min-w-[2rem] text-center",children:Math.max(e,1)}),(0,p.jsx)("button",{onClick:g||(()=>f(e+1)),className:"w-6 h-6 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Increase quantity",children:"+"})]}),(0,p.jsx)("div",{className:"flex-1",children:(0,p.jsx)(gU.default,{product:{id:`custom-${Date.now()}`,name:`${i?.name||"Custom Case"} with ${l.length} charms`,caseType:j,caseName:i?.name||"Custom Case",color:k,pins:l.map(({pin:a})=>a),pinsDetails:l.map(({pin:a})=>a),basePrice:b,casePrice:b,pinsPrice:n,totalPrice:parseFloat(a),price:parseFloat(a),image:m,caseImage:m,customDesign:!0,quantity:e},onAdd:o,className:"cursor-pointer bg-btn-success hover:bg-btn-success-hover text-btn-success-text border border-btn-success-border hover:border-btn-success-hover transition-all duration-200 py-2.5 text-sm font-light",disabled:!1})})]}),u&&(0,p.jsx)("div",{className:`mt-4 text-sm font-light font-inter ${"error"===v?"text-red-600":"text-orange-600"}`,children:u})]}),d&&(0,p.jsxs)("div",{className:`space-y-1 ${w?"text-xs xs:text-sm mb-1 pt-1":"text-xs mb-4 pt-4"} text-gray-600 border-t border-gray-100`,children:[(0,p.jsxs)("div",{className:"flex justify-between font-light font-inter",children:[(0,p.jsx)("span",{children:"Case:"}),(0,p.jsx)("span",{className:"font-light font-inter",children:x(b)})]}),c.map((a,b)=>(0,p.jsxs)("div",{className:"flex justify-between font-light font-inter",children:[(0,p.jsxs)("span",{children:[a.name,a.count>1?` (x${a.count})`:"",":"]}),(0,p.jsx)("span",{className:"font-light font-inter",children:x(a.price*a.count)})]},b))]})]})},gW=({show:a,selectedCase:b,selectedColorData:c,caseImages:d,selectedModalImage:e,setSelectedModalImage:f,onClose:g})=>a&&b&&d&&0!==d.length?(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:g,children:(0,p.jsxs)("div",{className:"bg-white rounded-sm max-w-4xl w-full h-[90vh] overflow-hidden flex flex-col",onClick:a=>a.stopPropagation(),children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-200 flex-shrink-0",children:[(0,p.jsx)("h3",{className:"text-xs sm:text-sm uppercase tracking-wider text-gray-900 font-medium font-inter",children:b.name}),(0,p.jsx)("button",{onClick:g,className:"p-2 hover:bg-gray-50 transition-colors","aria-label":"Close modal",children:(0,p.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden p-4 sm:p-6 min-h-0",children:[(0,p.jsx)("div",{className:"flex-1 flex items-center justify-center min-h-0 mb-4",children:(0,p.jsxs)("div",{className:"relative  p-4 sm:p-6 md:p-8 flex items-center justify-center w-full h-full",children:[(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(d[e]),alt:`${b.name} - View ${e+1}`,className:"max-w-full max-h-full object-contain",loading:"lazy",fetchPriority:"low",decoding:"async",onError:a=>{a.target.style.display="none",a.target.nextSibling&&(a.target.nextSibling.style.display="flex")}}),(0,p.jsx)("div",{className:"hidden w-full h-full items-center justify-center text-gray-400",children:(0,p.jsx)("p",{className:"text-gray-500 font-inter",children:"Image not available"})})]})}),d.length>1&&(0,p.jsx)("div",{className:"flex-shrink-0",children:(0,p.jsx)("div",{className:"grid grid-cols-6 sm:grid-cols-8 gap-1.5 sm:gap-2 mx-auto",children:d.map((a,c)=>(0,p.jsxs)("button",{onClick:()=>f(c),className:`aspect-square overflow-hidden border transition-all duration-200 ${e===c?"border-gray-900 ring-2 ring-gray-300":"border-gray-200 hover:border-gray-400"}`,children:[(0,p.jsx)("img",{src:(0,u.normalizeImagePath)(a),alt:`${b.name} - Detail ${c+1}`,className:"w-full h-full object-contain p-1",loading:"lazy",fetchPriority:"low",decoding:"async",width:"80",height:"80",onError:a=>{a.target.style.display="none",a.target.nextSibling&&(a.target.nextSibling.style.display="flex")}}),(0,p.jsx)("div",{className:"hidden w-full h-full items-center justify-center text-gray-300",children:(0,p.jsx)("span",{className:"text-sm",children:""})})]},c))})})]})]})}):null,gX=({show:a,onClose:b,selectedCase:c})=>{let[d,e]=(0,q.useState)(!0);if(!a||!c)return null;let f=c.specifications||{};return(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center  p-4",onClick:b,children:(0,p.jsxs)("div",{className:"bg-white rounded-sm max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",onClick:a=>a.stopPropagation(),children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-shrink-0",children:[(0,p.jsx)("h3",{className:"text-lg sm:text-xl font-medium text-gray-900 font-inter",children:c.name}),(0,p.jsx)("button",{onClick:b,className:"p-2 hover:bg-gray-50 rounded-full transition-colors","aria-label":"Close modal",children:(0,p.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsx)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:Object.keys(f).length>0&&(0,p.jsxs)("div",{className:"",children:[(0,p.jsx)("button",{onClick:()=>e(!d),className:"w-full flex items-center justify-between py-2 text-sm uppercase tracking-wider text-gray-900 font-medium hover:text-gray-700 transition-colors font-inter",children:(0,p.jsx)("span",{children:"Specifications"})}),d&&(0,p.jsxs)("div",{className:"flex flex-col gap-3 mt-4",children:[f.dimensions&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Dimensions"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.dimensions})]}),f.size&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Size"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.size})]}),f.weight&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Weight"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.weight})]}),f.material&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Material"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.material})]}),f.closure&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Closure"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.closure})]}),f.cardSlots&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Card Slots"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.cardSlots})]}),f.interior&&(0,p.jsxs)("div",{className:"flex justify-between items-start py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Interior"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 text-right font-inter",children:f.interior})]}),f.rfid&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"RFID Protection"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.rfid})]}),f.features&&(0,p.jsxs)("div",{className:"flex justify-between items-start py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Features"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 text-right font-inter",children:f.features})]}),f.passportCapacity&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Capacity"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.passportCapacity})]}),f.care&&(0,p.jsxs)("div",{className:"flex justify-between items-start py-2 border-b border-gray-50",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Care Instructions"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 text-right font-inter",children:f.care})]}),f.warranty&&(0,p.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,p.jsx)("span",{className:"text-sm text-gray-500 font-inter",children:"Warranty"}),(0,p.jsx)("span",{className:"text-sm text-gray-900 font-inter",children:f.warranty})]})]})]})})]})})},gY=({show:a,onClose:b,onAgree:c})=>a?(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:b,children:(0,p.jsxs)("div",{className:"bg-white rounded-sm max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-200 shadow-lg",onClick:a=>a.stopPropagation(),children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white",children:[(0,p.jsx)("h3",{className:"text-lg font-medium text-gray-900 font-inter",children:"Terms of Use - Create Yours"}),(0,p.jsx)("button",{onClick:b,className:"p-2 hover:bg-gray-50 transition-colors rounded","aria-label":"Close modal",children:(0,p.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsxs)("div",{className:"p-6 space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{className:"text-base font-semibold text-gray-900 mb-3 font-inter",children:"User Responsibility"}),(0,p.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed font-inter",children:"It is the user's responsibility to create and design the passport case using our interactive creator. Please ensure that your design meets your requirements and preferences before placing your order. We are not responsible for any design choices made by the user through the creator tool."})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{className:"text-base font-semibold text-gray-900 mb-3 font-inter",children:"Handmade Items - Natural Variations"}),(0,p.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed font-inter",children:"All our passport cases are handmade with care and attention to detail. As each item is individually crafted, there may be natural variations in color, texture, and appearance. These variations are not defects but rather characteristics of handmade products that make each piece unique. Please note that the final product may vary slightly from the digital preview shown in the creator."})]}),(0,p.jsx)("div",{className:"bg-gray-50 border-l-4 border-gray-400 p-4 rounded",children:(0,p.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed font-inter",children:'By using our "Create Yours" tool and placing an order, you acknowledge that you have read, understood, and agree to these terms of use.'})})]}),(0,p.jsxs)("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200",children:[(0,p.jsx)("button",{onClick:b,className:"px-6 py-2 text-sm uppercase tracking-wider font-inter bg-btn-secondary hover:bg-btn-secondary-hover text-btn-secondary-text border border-btn-secondary-border hover:border-btn-secondary-hover transition-all duration-200",children:"Close"}),(0,p.jsx)("button",{onClick:()=>{c?c():b()},className:"px-6 py-2 text-sm uppercase tracking-wider font-inter bg-btn-primary hover:bg-btn-primary-hover text-btn-primary-text border border-btn-primary-border hover:border-btn-primary-hover transition-all duration-200",children:"I Agree"})]})]})}):null,gZ=({show:a,onClose:b,customText:c,setCustomText:d,customTextError:e,setCustomTextError:f,customTextAdded:g,setCustomTextAdded:h})=>((0,q.useEffect)(()=>{if(a){let a=window.scrollY||window.pageYOffset,b=window.scrollX||window.pageXOffset,c=document.body.style.overflow,d=document.body.style.position,e=document.body.style.top,f=document.body.style.width,g=document.body.style.left,h=document.documentElement.style.overflow;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${a}px`,document.body.style.width="100%",document.body.style.left=`-${b}px`,document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow=c,document.body.style.position=d,document.body.style.top=e,document.body.style.width=f,document.body.style.left=g,document.documentElement.style.overflow=h,requestAnimationFrame(()=>{window.scrollTo(b,a)})}}},[a]),a)?(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 xs:p-3 sm:p-4 md:p-6",onClick:b,children:(0,p.jsxs)("div",{className:"bg-white  max-w-md w-full border border-gray-200 shadow-lg",onClick:a=>a.stopPropagation(),children:[(0,p.jsxs)("div",{className:"flex items-center justify-between p-3 xs:p-4 border-b border-gray-200",children:[(0,p.jsx)("h3",{className:"text-xs xs:text-sm font-medium text-gray-900 uppercase tracking-wider",style:{fontFamily:"'Poppins', sans-serif"},children:"Add Text"}),(0,p.jsx)("button",{onClick:b,className:"p-1 xs:p-2 hover:bg-gray-50 transition-colors ","aria-label":"Close modal",children:(0,p.jsx)("svg",{className:"w-4 h-4 xs:w-5 xs:h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsxs)("div",{className:"p-3 xs:p-4 space-y-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("input",{type:"text",value:c||"",onChange:a=>{d(a.target.value),f(""),h(!1)},onFocus:a=>{a.preventDefault(),setTimeout(()=>{a.target.scrollIntoView({behavior:"smooth",block:"center"})},100)},placeholder:"e.g. Your name",className:"w-full px-3 py-2 border border-gray-200 focus:outline-none focus:border-gray-400 bg-white text-gray-900 placeholder-gray-400 font-thin text-sm font-inter",style:{fontSize:"16px"},maxLength:40}),(0,p.jsxs)("p",{className:"mt-1 text-sm text-gray-500 font-inter",children:["Up to ",15," characters. Double-click the text on the case to edit or move it."]})]}),e&&(0,p.jsx)("div",{className:"text-sm text-gray-600 border border-gray-200 bg-gray-50 px-3 py-2 font-inter",children:e}),g&&(0,p.jsx)("div",{className:"text-sm text-gray-600  px-3 py-2 font-inter",children:"Text added to your design! You can drag it to reposition it."}),(0,p.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,p.jsx)("button",{onClick:()=>{c.trim()?f("Canvas is still loading. Please try again in a moment."):f("Please enter the text you want to add.")},disabled:!c.trim(),className:"flex-1 px-3 py-1.5 text-xs font-medium uppercase tracking-wider active:bg-blue-200 disabled:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed  active:scale-95 disabled:scale-100 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-offset-1 font-inter bg-btn-light-blue hover:bg-btn-light-blue-hover text-btn-light-blue-text border border-btn-light-blue-border hover:border-btn-light-blue-hover transition-all duration-200",children:"Add Text"}),(0,p.jsx)("button",{onClick:()=>{d(""),h(!1),f("")},disabled:!c.trim(),className:"px-3 py-1.5 text-xs font-medium uppercase tracking-wider active:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 disabled:border-gray-100 disabled:cursor-not-allowed active:scale-95 disabled:scale-100 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-1 font-inter bg-btn-light-gray hover:bg-btn-light-gray-hover text-btn-light-gray-text border border-btn-light-gray-border hover:border-btn-light-gray-hover transition-all duration-200",children:"Clear"})]})]})]})}):null;var g$=a.i(50944),g_=a.i(92250),g0=a.i(19997),g1=a.i(18776);let g2=(a,b={})=>{setTimeout(()=>{let c=document.querySelector(a);c&&c.scrollIntoView({behavior:"smooth",block:"center",...b})},100)},g3=async(a,b)=>{let c=a;if(a&&b)try{(c=await ((a,b,c=300,d=350)=>new Promise((e,f)=>{if(!a&&!b)return void e(null);let g=document.createElement("canvas");g.width=c,g.height=d;let h=g.getContext("2d");h.fillStyle="white",h.fillRect(0,0,c,d);let i=()=>{if(!b){console.log(" No canvas data URL, resolving with case image or white canvas"),e(g.toDataURL("image/png",1));return}let a=new Image,f=setTimeout(()=>{console.error(" Timeout loading canvas content"),e(g.toDataURL("image/png",1))},1e4);a.onload=()=>{let b,i,j,k;clearTimeout(f),console.log(" Canvas content loaded successfully:",{width:a.width,height:a.height});let l=a.width/a.height;l>c/d?(b=c,i=c/l):(i=d,b=d*l),j=(c-b)/2,k=(d-i)/2,h.drawImage(a,j,k,b,i);let m=g.toDataURL("image/png",1);console.log(" Composite image created:",{isDataURL:m.startsWith("data:image/"),length:m.length}),e(m)},a.onerror=a=>{clearTimeout(f),console.error(" Failed to load canvas content:",a),e(g.toDataURL("image/png",1))},console.log(" Loading canvas content..."),a.src=b};(()=>{if(!a){console.log(" No case image URL provided, using canvas content only"),i();return}let b=new Image;a.startsWith("data:")||a.startsWith("blob:")||(b.crossOrigin="anonymous");let e=setTimeout(()=>{console.error(" Timeout loading case image:",a),i()},1e4);b.onload=()=>{let f,g,j,k;clearTimeout(e),console.log(" Case image loaded successfully:",{width:b.width,height:b.height,src:a.substring(0,50)+"..."});let l=b.width/b.height,m=c/d;l>m?f=(g=270)*l:g=(f=270)/l,j=(c-f)/2,k=.45*d-g/2,h.drawImage(b,j,k,f,g),i()},b.onerror=b=>{clearTimeout(e),console.error(" Failed to load case image:",{url:a,error:b,message:"Will continue with canvas content only"}),i()},console.log(" Loading case image:",a),b.src=a})()}))(a,b,300,350))&&c.startsWith("data:image/")||(console.warn(" Composite image creation returned invalid result, using case image fallback"),c=a)}catch(b){console.error(" Error creating composite design image:",b),c=a}else b?c=b:a&&(c=a);return c&&("string"!=typeof c||0!==c.trim().length)||(console.error(" No valid design image available, using case image fallback"),c=a||""),c};a.s(["default",0,()=>{let{selectedCategory:a,setSelectedCategory:b,pins:c,mobileSubCategory:d,setMobileSubCategory:e,selectedCaseType:f,selectedColor:g,selectedCaseImage:h,selectedPins:i,showPriceBreakdown:j,setShowPriceBreakdown:k,isCaseDropdownOpen:l,setIsCaseDropdownOpen:m,isCharmsDropdownOpen:n,setIsCharmsDropdownOpen:o,isAddTextDropdownOpen:v,setIsAddTextDropdownOpen:w,isMobile:x,mobileCurrentStep:y,setMobileCurrentStep:z,quantity:A,setQuantity:B,customText:C,setCustomText:D,customTextError:E,setCustomTextError:F,customTextAdded:G,setCustomTextAdded:H,showImageModal:I,setShowImageModal:J,selectedModalImage:K,setSelectedModalImage:L,showDescriptionModal:M,setShowDescriptionModal:N,showTermsModal:O,setShowTermsModal:P,agreedToTerms:Q,setAgreedToTerms:R,pendingAddToCart:S,setPendingAddToCart:T,showTermsError:U,setShowTermsError:V,showAddTextModal:W,setShowAddTextModal:X,productsWithQuantities:Y,selectedCase:Z,caseBasePrice:$,selectedColorData:_,caseImages:aa,pinsPrice:ab,totalPrice:ac,groupedPinsList:ad,cart:ae,inventoryMessage:af,inventoryType:ag,quantityError:ah,charmInventoryError:ai,handleCaseTypeSelection:aj,handleColorSelection:ak,handlePinSelection:al,handleIncrementQuantity:am,handleDecrementQuantity:an,handleMobileAddText:ao,handleAddToCart:ap,executeAddToCart:aq,handlePinSelect:ar,handlePinRemove:as,router:at}=(()=>{let a,b,c,d=(0,g$.usePathname)(),e=(0,g$.useSearchParams)(),f=(0,g$.useRouter)(),{addToCart:g,cart:h}=(0,g_.useCart)(),[i,j]=(0,q.useState)(""),[k,l]=(0,q.useState)([]),[m,n]=(0,q.useState)("all"),o=(0,g0.getDefaultCaseAndColor)(e),[p,s]=(0,q.useState)(o.caseType),[t,v]=(0,q.useState)(o.color),[w,x]=(0,q.useState)(o.image),[y,z]=(0,q.useState)([]),[A,B]=(0,q.useState)(!1),[C,D]=(0,q.useState)(!1),[E,F]=(0,q.useState)(!1),[G,H]=(0,q.useState)(!1),[I,J]=(0,q.useState)(!1),[K,L]=(0,q.useState)(null),[M,N]=(0,q.useState)(0),[O,P]=(0,q.useState)(""),[Q,R]=(0,q.useState)(""),[S,T]=(0,q.useState)(!1),[U,V]=(0,q.useState)(!1),[W,X]=(0,q.useState)(0),[Y,Z]=(0,q.useState)(!1),[$,_]=(0,q.useState)(!1),[aa,ab]=(0,q.useState)(!1),[ac,ad]=(0,q.useState)(!1),[ae,af]=(0,q.useState)(!1),[ag,ah]=(0,q.useState)(!1),ai=(0,q.useRef)(null),aj=(0,g1.getProductsWithQuantities)(),ak=aj.cases.find(a=>a.type===p),{inventoryMessage:al,inventoryType:am,quantityError:an,charmInventoryError:ao,setInventoryMessage:ap,setInventoryType:aq,setQuantityError:ar,setCharmInventoryError:as,checkQuantityIncrement:at}=(({selectedCaseType:a,selectedColor:b,selectedPins:c,quantity:d,cart:e,selectedCategory:f,selectedCase:g})=>{let[h,i]=(0,q.useState)(""),[j,k]=(0,q.useState)("warning"),[l,m]=(0,q.useState)(""),[n,o]=(0,q.useState)("");return(0,q.useEffect)(()=>{if(h){let a=setTimeout(()=>{i("")},3e3);return()=>clearTimeout(a)}},[h]),(0,q.useEffect)(()=>{if(a&&b){let c=(0,gy.getMaxAvailableQuantity)({caseType:a,color:b},e);null!==c&&c>0&&i("")}if(c.length>0){let a=null;for(let{pin:b}of c){if(!b)continue;let g=b?.category||f||"colorful",h=b?.name||"charm",i=b?.src||"",j={type:"charm",category:g,pin:b,name:h},k=(0,gy.getMaxAvailableQuantity)(j,e);if(null===k)continue;let l=0;e.forEach(a=>{if("charm"===a.type){let b=a.pin||a,c=b.name||b.src,d=b.category||a.category||g;(c===h||c===i)&&d===g&&(l+=a.quantity||1)}});let m=0;e.forEach(a=>{a.pins&&Array.isArray(a.pins)&&a.pins.forEach(b=>{let c=b.name||b.src,d=b.category||g;(c===h||c===i)&&d===g&&(m+=a.quantity||1)})});let n=c.filter(a=>{let b=a.pin||a,c=b.name||b.src,d=b.category||g;return(c===h||c===i)&&d===g}).length,o=k+l,p=l+m+n*d;if(0===k||p>o){a=h;break}}a?(i(`Oops! We don't have any more ${a} in stock right now.`),k("warning")):i(a=>a&&a.includes("can't add more to your basket")||!a||a.includes("Passport Case")||a.includes("Case")?a:"")}else i(a=>a&&a.includes("can't add more to your basket")||!a||a.includes("Passport Case")||a.includes("Case")?a:"")},[a,b,c,d,e,f]),{inventoryMessage:h,inventoryType:j,quantityError:l,charmInventoryError:n,setInventoryMessage:i,setInventoryType:k,setQuantityError:m,setCharmInventoryError:o,checkQuantityIncrement:d=>{let h=(0,gy.getMaxAvailableQuantity)({caseType:a,color:b},e);if(null!==h&&(h<=0||d+1>h)){let a=g?.name||"Passport Case",c=g?.colors?.find(a=>a.color===b),d=c?.image?(0,g0.getColorName)(c.image):"",e=d?` in ${d}`:"",f=`Oops! We don't have any more ${a}${e} in stock right now, so you can't add more to your basket.`;return m(`We don't have any more ${a}${e} in stock to be added anymore.`),i(f),k("error"),!1}if(c.length>0)for(let{pin:a}of c){if(!a)continue;let b=a.category?a.category:f||"colorful",g=a.name||a.src||"",h=a.src||"",j={name:g,price:a.price||2,totalPrice:a.price||2,image:h,pin:a,category:b,type:"charm"},l=(0,gy.getMaxAvailableQuantity)(j,e);if(null===l)continue;let m=0;e.forEach(a=>{if("charm"===a.type){let c=a.pin||a,d=c.name||c.src,e=c.category||a.category||b;(d===g||d===h)&&e===b&&(m+=a.quantity||1)}});let n=0;e.forEach(a=>{a.pins&&Array.isArray(a.pins)&&a.pins.forEach(c=>{let d=c.name||c.src,e=c.category||b;(d===g||d===h)&&e===b&&(n+=a.quantity||1)})});let p=c.filter(a=>{let c=a.pin||a,d=c.name||c.src,e=c.category||b;return(d===g||d===h)&&e===b}).length,q=l+m,r=m+n+p*d+p;if(0===l||r>q){let b=`Oops! We don't have any more ${a.name||"this charm"} in stock right now, so you can't add more to your basket.`;return o(b),i(b),k("error"),!1}}return!0}}})({selectedCaseType:p,selectedColor:t,selectedPins:y,quantity:M,cart:h,selectedCategory:i,selectedCase:ak});(0,q.useEffect)(()=>{},[d]),(0,q.useEffect)(()=>{let a=e?.get("case"),b=e?.get("color");if(a){let c=r.default.cases.find(b=>b.type===a);if(c){if(s(c.type),b){let a=c.colors.find(a=>a.color===b);if(a){v(a.color),x(a.image);return}}if(c.colors&&c.colors.length>0){let a=c.colors[0];v(a.color),x(a.image)}}}},[e]);let au=(0,q.useCallback)(a=>{let{canAdd:b,errorMessage:c,pinWithCategory:d}=((a,b,c,d)=>{let e=a.category?a.category:d||"colorful",f=a.name||a.src||"",g=a.src||"",h={...a,category:e},i={name:f,price:a.price||2,totalPrice:a.price||2,image:g,pin:h,category:e,type:"charm"},j=(0,gy.getMaxAvailableQuantity)(i,b);if(null===j)return{canAdd:!0,errorMessage:"",pinWithCategory:h};let k=0;b.forEach(a=>{if("charm"===a.type){let b=a.pin||a,c=b.name||b.src,d=b.category||a.category||e;(c===f||c===g)&&d===e&&(k+=a.quantity||1)}});let l=0;b.forEach(a=>{a.pins&&Array.isArray(a.pins)&&a.pins.forEach(b=>{let c=b.name||b.src,d=b.category||e;(c===f||c===g)&&d===e&&(l+=a.quantity||1)})});let m=c.filter(a=>{let b=a.pin||a,c=b.name||b.src,d=b.category||e;return(c===f||c===g)&&d===e}).length,n=j+k,o=k+l+m+1;if(0===j||o>n){let b=a.name||a.src||"this charm";return{canAdd:!1,errorMessage:`Oops! We don't have any more ${b} in stock right now, so you can't add more to your basket.`,pinWithCategory:h}}return{canAdd:!0,errorMessage:"",pinWithCategory:h}})(a,h,y,i);if(!b){ap(c),aq("error"),as(c.replace("Oops! We don't have any more ","").replace(" in stock right now, so you can't add more to your basket.","")),g2('[class*="PriceSummary"]',{block:"center"});return}as(""),g2(".happy-card",{block:"center"})},[I,h,y,i,as,ap,aq]);(0,q.useEffect)(()=>{let a=e?.get("selectedPin");if(a)try{let b=JSON.parse(decodeURIComponent(a));b.category,setTimeout(()=>{},1e3);let c=new URLSearchParams(e?.toString()||"");c.delete("selectedPin");let g=`${d}${c.toString()?"?"+c.toString():""}`;f.replace(g)}catch(a){console.warn("Failed to parse selectedPin from query params:",a)}},[e,i,d,f]),(0,q.useEffect)(()=>{i&&("flags"===i?l(r.default.pins.flags||[]):l(r.default.pins[i]||[])),n("all")},[i]),(0,q.useEffect)(()=>{if(r.default.cases.length>0){let a=r.default.cases.find(a=>a.type===p)||r.default.cases[0];if(a&&a.colors.length>0){let b=a.colors[0];v(b.color),x(b.image)}}},[p]);let av=ak?.basePrice||0,aw=ak?.colors?.find(a=>a.color===t),ax=(a=aw?.image||ak?.images?.[0]||"",b=[],a&&b.push((0,u.normalizeImagePath)(a)),c=[],ak?.type==="economy"?c=["/images/SmartCase/economycaseinside.webp","/images/SmartCase/economycaseclosure.webp","/images/SmartCase/economycaseclosureinside.webp"]:ak?.type==="business"?c=["/images/BusinessClassCase/businessclass.webp","/images/BusinessClassCase/businessclass1.webp"]:ak?.type==="firstclass"&&(c=["/images/FirstClassCase/firstclass.webp","/images/FirstClassCase/firstclass1.webp","/images/FirstClassCase/firstclass2.webp"]),c.forEach(a=>{a&&b.push((0,u.normalizeImagePath)(a))}),b.length>0?b:a?[(0,u.normalizeImagePath)(a)]:[]),ay=y.reduce((a,{pin:b})=>a+(b?.price||0),0),az=((av+ay)*Math.max(M,1)).toFixed(2),aA=Object.values(y.reduce((a,{pin:b})=>{if(!b)return a;let c=`${b.src}|${b.name}|${b.price}`;return a[c]||(a[c]={...b,count:0}),a[c].count+=1,a},{})),aB=async()=>{let a=Math.max(M,1),b=((a,b,c,d,e)=>{let f=(0,gy.getMaxAvailableQuantity)({caseType:a,color:b},c),g=e?.name||"Passport Case",h=e?.colors?.find(a=>a.color===b),i=h?(0,g0.getColorName)(h.color,h.image):b?(0,g0.getColorName)(b):"";if(null!==f&&0===f){let a=i?` in ${i}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${g}${a} in stock right now, so you can't add more to your basket.`}}if(null!==f&&d>f){let a=i?` in ${i}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${g}${a} in stock right now, so you can't add more to your basket.`,maxAvailable:f}}return{valid:!0}})(p,t,h,a,ak);if(!b.valid){ap(b.errorMessage),aq("error"),void 0!==b.maxAvailable&&N(b.maxAvailable>0?b.maxAvailable:0);return}let c=((a,b,c,d)=>{for(let{pin:e}of a){let a=e?.category||d||"colorful",f=e?.name||"charm",g={type:"charm",category:a,pin:e,name:f},h=(0,gy.getMaxAvailableQuantity)(g,b);if(null!==h&&0===h||null!==h&&c>h)return{valid:!1,errorMessage:`Oops! We don't have any more ${f} in stock right now, so you can't add more to your basket.`}}return{valid:!0}})(y,h,a,i);if(!c.valid){ap(c.errorMessage),aq("error");return}let d=w||aw?.image||ak?.images?.[0]||"",e=d?(0,u.normalizeImagePath)(d):"",f=await g3(e,null),j=y.map(({pin:a})=>{let b=a?.category&&""!==a.category.trim()?a.category:i&&""!==i.trim()?i:"colorful";return{...a,name:a?.name||"Charm",src:a?.src||"",price:a?.price||0,category:b}}),{caseProduct:k,charmProducts:l}=(({selectedCase:a,selectedCaseType:b,selectedColor:c,selectedCaseImage:d,selectedPins:e,caseBasePrice:f,quantity:g,designImage:h,normalizedCaseImage:i,pinsDetails:j,selectedCategory:k})=>{let l=Math.max(g,1),m=Date.now(),n=a?.name||"Passport Case";return{caseProduct:{id:`case-${m}-${Math.random().toString(36).substr(2,9)}`,name:n,caseType:b,caseName:n,color:c,basePrice:f,casePrice:f,totalPrice:f,price:f,image:h,designImage:h,caseImage:i,customDesign:!0,quantity:l},charmProducts:j.map((a,b)=>{let c=a.category||k||"colorful",d=a.name||"Charm",e=a.price||2;return{id:`charm-${m}-${b}-${Math.random().toString(36).substr(2,9)}`,name:d,price:e,totalPrice:e,image:a.src||"",pin:a,category:c,type:"charm",quantity:l}})}})({selectedCase:ak,selectedCaseType:p,selectedColor:t,selectedCaseImage:w,selectedPins:y,caseBasePrice:av,quantity:a,designImage:f,normalizedCaseImage:e,pinsDetails:j,selectedCategory:i});g(k),l.forEach(a=>{g(a)}),z([]),N(0)},aC=(0,q.useCallback)(a=>{a&&a.pinData&&z(b=>[...b,{imgInstance:a,pin:a.pinData}])},[]),aD=(0,q.useCallback)(a=>{z(b=>b.filter(b=>b.imgInstance!==a)),as("")},[as]);return(0,q.useEffect)(()=>{},[]),(0,q.useEffect)(()=>{I&&null!==K&&H(!1)},[K,I]),(0,q.useEffect)(()=>{let a=a=>{ai.current&&!ai.current.contains(a.target)&&D(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),{selectedCategory:i,setSelectedCategory:j,pins:k,mobileSubCategory:m,setMobileSubCategory:n,selectedCaseType:p,selectedColor:t,selectedCaseImage:w,selectedPins:y,showPriceBreakdown:A,setShowPriceBreakdown:B,isCaseDropdownOpen:C,setIsCaseDropdownOpen:D,isCharmsDropdownOpen:E,setIsCharmsDropdownOpen:F,isAddTextDropdownOpen:G,setIsAddTextDropdownOpen:H,isMobile:I,mobileCurrentStep:K,setMobileCurrentStep:L,quantity:M,setQuantity:N,customText:O,setCustomText:P,customTextError:Q,setCustomTextError:R,customTextAdded:S,setCustomTextAdded:T,showImageModal:U,setShowImageModal:V,selectedModalImage:W,setSelectedModalImage:X,showDescriptionModal:Y,setShowDescriptionModal:Z,showTermsModal:$,setShowTermsModal:_,agreedToTerms:aa,setAgreedToTerms:ab,pendingAddToCart:ac,setPendingAddToCart:ad,showTermsError:ae,setShowTermsError:af,showAddTextModal:ag,setShowAddTextModal:ah,productsWithQuantities:aj,selectedCase:ak,caseBasePrice:av,selectedColorData:aw,caseImages:ax,pinsPrice:ay,totalPrice:az,groupedPinsList:aA,cart:h,inventoryMessage:al,inventoryType:am,quantityError:an,charmInventoryError:ao,handleCaseTypeSelection:a=>{s(a);let b=(0,g1.getProductsWithQuantities)().cases.find(b=>b.type===a);if(b&&b.colors.length>0){let a=b.colors.find(a=>void 0===a.quantity||a.quantity>0)||b.colors[0];v(a.color),x(a.image)}I&&L(null)},handleColorSelection:(a,b)=>{v(a),x(b),I&&L(null)},handlePinSelection:au,handleIncrementQuantity:()=>{at(M)&&(N(M+1),ar(""),as(""),ap(""))},handleDecrementQuantity:()=>{M>0&&(N(M-1),ar(""),as(""),ap(""))},handleMobileAddText:()=>{O.trim()?R("Canvas is still loading. Please try again in a moment."):R("Please enter the text you want to add.")},handleAddToCart:()=>{if(!aa){af(!0),ad(!0);return}af(!1),aB()},executeAddToCart:aB,handlePinSelect:aC,handlePinRemove:aD,router:f}})();return(0,p.jsx)("section",{className:`w-full pt-4 pb-1 md:pb-8 bg-white ${x?"h-screen fixed inset-0 overflow-hidden":"min-h-screen"}`,children:(0,p.jsxs)("div",{className:`max-w-7xl mx-auto px-2 xs:px-3 sm:px-4 md:px-8 relative z-10 ${x?"pb-40 xs:pb-44 sm:pb-48 h-full flex flex-col overflow-hidden":"pb-2 sm:pb-24 flex flex-col"}`,children:[x&&(0,p.jsx)(t,{onClose:()=>at.push("/")}),(0,p.jsx)(s,{}),(0,p.jsxs)("div",{className:`flex flex-col ${x?"":"md:flex-row md:gap-8 lg:gap-12"} flex-1 overflow-hidden mt-0 ${x?"":"md:mt-12"}`,children:[(0,p.jsx)(gs,{selectedCaseType:f,selectedColor:g,selectedCaseImage:h,selectedCase:Z,caseImages:aa,isCaseDropdownOpen:l,isCharmsDropdownOpen:n,isAddTextDropdownOpen:v,isMobile:x,onPinSelect:ar,onPinRemove:as,onOpenImageModal:()=>{J(!0),L(0)},onOpenDescriptionModal:()=>N(!0),Products:r.default}),(0,p.jsx)("div",{className:`flex flex-col ${x?"":"md:w-1/2 md:flex-1"} gap-2 xs:gap-3 sm:gap-4 overflow-hidden`,children:(0,p.jsxs)("div",{className:`w-full flex flex-col space-y-4 sm:space-y-6 hide-scrollbar ${l||n||v?"md:max-h-none md:overflow-visible":"md:max-h-[calc(100vh-200px)] md:overflow-y-auto"}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[x&&(0,p.jsx)(gO,{mobileCurrentStep:y,setMobileCurrentStep:z,selectedCaseType:f,selectedColor:g,selectedCategory:a,setSelectedCategory:b,mobileSubCategory:d,setMobileSubCategory:e,pins:c,selectedPins:i,handleCaseTypeSelection:aj,handleColorSelection:ak,handlePinSelection:al,Products:Y,cart:ae}),(0,p.jsx)(gB,{isOpen:l,onToggle:()=>{o(!1),w(!1),m(!l)},selectedCaseType:f,selectedColor:g,selectedCase:Z,onCaseSelect:aj,onColorSelect:ak,setIsCaseDropdownOpen:m,Products:r.default,cart:ae}),(0,p.jsx)(gK,{isOpen:n,onToggle:()=>{m(!1),w(!1),o(!n)},pins:c,selectedCategory:a,setSelectedCategory:b,selectedPins:i,onPinSelect:al,Products:r.default,cart:ae}),(0,p.jsx)(gM,{isOpen:v,onToggle:()=>{m(!1),o(!1),w(!v)},customText:C,setCustomText:D,customTextError:E,setCustomTextError:F,customTextAdded:G,setCustomTextAdded:H}),!x&&(0,p.jsx)(gV,{totalPrice:ac,caseBasePrice:$,groupedPinsList:ad,showPriceBreakdown:j,setShowPriceBreakdown:k,quantity:A,setQuantity:B,onIncrementQuantity:am,onDecrementQuantity:an,quantityError:ah,charmInventoryError:ai,selectedCase:Z,selectedCaseType:f,selectedColor:g,selectedPins:i,selectedCaseImage:h,pinsPrice:ab,onAddToCart:ap,onShowTerms:()=>P(!0),inventoryMessage:af,inventoryType:ag,agreedToTerms:Q,setAgreedToTerms:a=>{R(a),a&&V(!1)},showTermsError:U})]})})]}),x&&(0,p.jsx)("div",{className:"fixed left-0 right-0 z-0 bg-white md:hidden w-full",style:{bottom:"calc(80px + 0.75rem)"},children:(0,p.jsxs)("div",{className:"px-2 xs:px-3 sm:px-4 py-2 xs:py-2.5 sm:py-3 mb-0 pb-0",children:[(0,p.jsx)("p",{className:"text-[14px] text-gray-700 mb-2 xs:mb-2.5 text-center font-thin",style:{fontFamily:"'Poppins', sans-serif"},children:"Choose the options below:"}),(0,p.jsx)(gR,{selectedCaseType:f,selectedColor:g,onCaseClick:()=>z("case"),onColorClick:()=>z("color"),onCharmsClick:()=>{z("charms"),window.scrollTo({top:0,behavior:"smooth"})},onTextClick:()=>{m(!1),o(!1),w(!v)},isAddTextDropdownOpen:v}),v&&(0,p.jsx)(gS,{customText:C,setCustomText:D,customTextError:E,setCustomTextError:F,customTextAdded:G,setCustomTextAdded:H,onAddText:ao})]})}),x&&(0,p.jsx)("div",{className:"fixed left-0 right-0 z-40 bg-gray-100 border-t border-gray-200 shadow-lg md:hidden max-h-[50vh] xs:max-h-[45vh] overflow-y-auto w-full safe-area-inset-bottom",style:{bottom:"0",paddingBottom:"calc(env(safe-area-inset-bottom) + 0.75rem)"},children:(0,p.jsx)("div",{className:"px-2 xs:px-2.5 sm:px-3 py-1.5 xs:py-2 sm:py-2.5 ",children:(0,p.jsx)(gV,{totalPrice:ac,caseBasePrice:$,groupedPinsList:ad,showPriceBreakdown:j,setShowPriceBreakdown:k,quantity:A,setQuantity:B,onIncrementQuantity:am,onDecrementQuantity:an,quantityError:ah,charmInventoryError:ai,selectedCase:Z,selectedCaseType:f,selectedColor:g,selectedPins:i,selectedCaseImage:h,pinsPrice:ab,onAddToCart:ap,onShowTerms:()=>P(!0),agreedToTerms:Q,setAgreedToTerms:a=>{R(a),a&&V(!1)},showTermsError:U,inventoryMessage:af,inventoryType:ag,isMobile:!0})})}),(0,p.jsx)(gW,{show:I,selectedCase:Z,selectedColorData:_,caseImages:aa,selectedModalImage:K,setSelectedModalImage:L,onClose:()=>J(!1)}),(0,p.jsx)(gX,{show:M,onClose:()=>N(!1),selectedCase:Z}),(0,p.jsx)(gY,{show:O,onClose:()=>{P(!1),T(!1)},onAgree:()=>{R(!0),V(!1),P(!1),S&&(T(!1),aq())}}),x&&(0,p.jsx)(gZ,{show:W,onClose:()=>X(!1),customText:C,setCustomText:D,customTextError:E,setCustomTextError:F,customTextAdded:G,setCustomTextAdded:H})]})})}],81528)}];

//# sourceMappingURL=src_page-components_CreateYours_index_jsx_9b1e3ed3._.js.map