module.exports=[72286,a=>{"use strict";var b=a.i(90530);a.i(26895);var c=a.i(7612),d=a.i(22535);a.s(["default",0,({item:a})=>{let e=a.design_image||a.designImage||a.case_image||a.caseImage||a.image,f=a.caseName||a.name||"Custom Case",g=0;void 0!==a.total_price?g=parseFloat(a.total_price)||0:void 0!==a.totalPrice?g=(parseFloat(a.totalPrice)||0)*(a.quantity||1):void 0!==a.price&&(g=(parseFloat(a.price)||0)*(a.quantity||1));let h=a.color?(0,d.getColorName)(a.color,a.case_image||a.caseImage||a.image):null;return(0,b.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[e&&(0,b.jsx)("img",{src:(0,c.normalizeImagePath)(e),alt:f,className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded",loading:"lazy"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900 mb-1 font-inter",children:f}),h&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Color: ",(0,b.jsx)("span",{className:"font-medium",children:h})]}),(a.pinsDetails&&a.pinsDetails.length>0||a.pins&&Array.isArray(a.pins)&&a.pins.length>0)&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Charms: ",(0,b.jsx)("span",{className:"font-medium",children:(a.pinsDetails||a.pins||[]).length})]}),a.quantity>1&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Quantity: ",(0,b.jsx)("span",{className:"font-medium",children:a.quantity})]}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-2 font-inter",children:["Â£",g.toFixed(2)]})]})]})})}])},44728,a=>{"use strict";var b=a.i(90530),c=a.i(26895),d=a.i(32499),e=a.i(75846),f=a.i(34287),g=a.i(72286);let h=(0,e.getSupabaseClient)();a.s(["default",0,()=>{let a=(0,d.useRouter)(),e=(0,d.useSearchParams)(),i=e.get("email")||"",[j,k]=(0,c.useState)(i),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(i?"code":"email"),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(!1);(0,c.useEffect)(()=>{window.scrollTo({top:0,behavior:"smooth"});let a=localStorage.getItem("userEmail"),b="true"===localStorage.getItem("isLoggedIn");b&&a&&(C(!0),k(a),D(a)),i&&!b&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)&&E(i)},[a,e,i]);let D=async a=>{y(!0),A("");try{let b;if(!a)throw Error("Email is required to fetch orders");let c=(0,f.getApiUrl)(`/get-orders?email=${encodeURIComponent(a)}`);console.log("ðŸ“¡ Fetching orders by email:",a);let d=await fetch(c);if((d.headers.get("content-type")||"").includes("text/html"))throw Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");let e=await d.text();if(!e||""===e.trim())throw Error(`Server returned empty response (${d.status}). Check server logs for errors.`);try{b=JSON.parse(e)}catch(a){throw Error(`Server returned invalid JSON (${d.status}): ${a.message}`)}if(!d.ok){let a=b?.error||b?.message||`Server error: ${d.status} ${d.statusText}`;throw Error(a)}b.success&&void 0!==b.orders?w(b.orders||[]):b.error?A(b.error||"Failed to load orders"):w(Array.isArray(b)?b:b.orders||[])}catch(a){console.error("Error fetching orders:",a),A(a.message||"Failed to load your orders. Please try again later.")}finally{y(!1)}},E=async a=>{q(!0),s("");try{if(!h)throw Error("Supabase is not configured. Please check your environment variables.");let{data:b,error:c}=await h.auth.signInWithOtp({email:a,options:{emailRedirectTo:null}});if(c){console.error("âŒ Error sending OTP:",c),s(c.message||"Failed to send verification code. Please try again."),q(!1);return}console.log("âœ… OTP sent successfully:",b),q(!1),o("code"),u(!0),setTimeout(()=>u(!1),3e3)}catch(a){console.error("âŒ Exception sending OTP:",a),q(!1),s(a.message||"Failed to send verification code. Please try again.")}},F=async a=>{if(a.preventDefault(),!j)return void s("Please enter your email address");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j))return void s("Please enter a valid email address");q(!0),s(""),u(!1);try{if(!h)throw Error("Supabase is not configured. Please check your environment variables.");let{data:a,error:b}=await h.auth.signInWithOtp({email:j.trim(),options:{emailRedirectTo:null}});if(b){console.error("âŒ Error sending OTP:",b),s(b.message||"Failed to send verification code. Please try again."),q(!1);return}console.log("âœ… OTP sent successfully:",a),q(!1),o("code"),u(!0),setTimeout(()=>u(!1),3e3)}catch(a){console.error("âŒ Exception sending OTP:",a),q(!1),s(a.message||"Failed to send verification code. Please try again.")}},G=async a=>{if(a.preventDefault(),!l||6!==l.length)return void s("Please enter the 6-digit code");q(!0),s(""),u(!1);try{if(!h)throw Error("Supabase is not configured. Please check your environment variables.");let{data:a,error:b}=await h.auth.verifyOtp({email:j.trim(),token:l.trim(),type:"email"});if(b){console.error("âŒ Error verifying OTP:",b),s(b.message||"Invalid code. Please try again."),q(!1);return}console.log("âœ… OTP verified successfully:",a);let{data:{user:c},error:d}=await h.auth.getUser();if(d||!c){console.error("âŒ Error getting user:",d),s("Failed to get user information. Please try again."),q(!1);return}let e=c.email||j;localStorage.setItem("userEmail",e),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",c.id),console.log("âœ… User logged in:",e),console.log("âœ… User ID:",c.id),C(!0),o("orders"),await D(e)}catch(a){console.error("âŒ Exception verifying OTP:",a),s(a.message||"Invalid code. Please try again."),q(!1)}};return(0,b.jsx)("div",{className:"min-h-screen bg-white py-12 md:py-16",children:(0,b.jsxs)("div",{className:`${B?"max-w-6xl":"max-w-md"} mx-auto px-4 sm:px-6 lg:px-8`,children:[(0,b.jsxs)("div",{className:"text-center mb-8",children:[(0,b.jsx)("h1",{className:"text-title md:text-title-lg font-light text-gray-900 mb-2 font-inter tracking-title",children:B?"My Orders":"email"===n?"Log In":"Verify Code"}),(0,b.jsx)("div",{className:"w-16 h-px bg-gray-300 mx-auto mb-4"}),B&&(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("p",{className:"text-gray-600 font-inter",children:j}),(0,b.jsx)("button",{onClick:()=>{localStorage.removeItem("userEmail"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userId"),C(!1),w([]),o("email"),k(""),m("")},className:"mt-2 text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline",children:"Sign Out"})]})]}),t&&"code"===n&&(0,b.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,b.jsxs)("p",{className:"text-sm text-green-800 font-light font-inter",children:["Verification code sent to ",(0,b.jsx)("strong",{children:j})]})}),r&&(0,b.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,b.jsx)("p",{className:"text-sm text-red-800 font-light font-inter",children:r})}),"email"===n&&(0,b.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Email Address *"}),(0,b.jsx)("input",{type:"email",value:j,onChange:a=>{k(a.target.value),s("")},placeholder:"your.email@example.com",autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-base",required:!0})]}),(0,b.jsx)("button",{type:"submit",disabled:p,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Sending Code...":"Send Verification Code"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 text-center font-light font-inter",children:"By continuing, you agree to our Terms of Use and Privacy Policy."})]}),"code"===n&&(0,b.jsxs)("form",{onSubmit:G,className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-sm text-gray-600 font-light font-inter mb-4 text-center",children:["We've sent a 6-digit verification code to ",(0,b.jsx)("strong",{children:j}),". Please enter it below."]}),(0,b.jsx)("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Verification Code *"}),(0,b.jsx)("input",{type:"text",value:l,onChange:a=>{m(a.target.value.replace(/\D/g,"").slice(0,6)),s("")},placeholder:"000000",maxLength:6,autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-2xl text-center tracking-widest",required:!0})]}),(0,b.jsx)("button",{type:"submit",disabled:p||6!==l.length,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Verifying...":"Verify Code"}),(0,b.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{m(""),s(""),u(!1),F({preventDefault:()=>{}})},disabled:p,className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline disabled:opacity-50",children:"Resend Code"}),(0,b.jsx)("button",{type:"button",onClick:()=>{o("email"),m(""),s(""),u(!1),a.push("/login")},className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter",children:"â† Back to email"})]})]}),B&&(0,b.jsx)("div",{className:"mt-8",children:x?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600 font-inter",children:"Loading your orders..."})]}):z?(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-red-800 font-light font-inter",children:z}),(0,b.jsx)("button",{onClick:()=>D(j),className:"mt-4 px-6 py-2 text-sm bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Try Again"})]}):0===v.length?(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg shadow-sm p-8 md:p-12 text-center",children:[(0,b.jsx)("div",{className:"text-gray-400 mb-4",children:(0,b.jsx)("svg",{className:"mx-auto h-16 w-16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2 font-inter",children:"No Orders Yet"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6 font-inter",children:"You haven't placed any orders yet. Start shopping to see your orders here!"}),(0,b.jsx)("button",{onClick:()=>a.push("/"),className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Start Shopping"})]}):(0,b.jsx)("div",{className:"space-y-6",children:v.map(a=>(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-1 font-inter",children:["Order #",a.order_id.slice(-8).toUpperCase()]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 font-inter",children:["Placed on ",(a=>{let b;if(!a)return"N/A";if("string"==typeof a)b=new Date(a);else{if("number"!=typeof a)return"N/A";b=new Date(1e3*a)}return b.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})(a.order_date)]})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:items-end gap-2",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-semibold font-inter ${"succeeded"===a.status||"complete"===a.status?"bg-green-100 text-green-800":"processing"===a.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:a.status?.charAt(0).toUpperCase()+a.status?.slice(1)})}),(0,b.jsxs)("p",{className:"text-lg font-bold text-gray-900 font-inter",children:["Â£",parseFloat(a.total_amount).toFixed(2)]})]})]})}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:"space-y-4",children:a.items&&Array.isArray(a.items)&&a.items.length>0?a.items.map((a,c)=>(0,b.jsx)(g.default,{item:a},c)):(0,b.jsx)("p",{className:"text-gray-600 font-inter",children:"No items found in this order."})})})]},a.order_id))})})]})})}])}];

//# sourceMappingURL=Desktop_HappyCase_TheHappy_TheHappyCase_src_6a9d297b._.js.map