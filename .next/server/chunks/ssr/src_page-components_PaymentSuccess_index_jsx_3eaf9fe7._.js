module.exports=[88530,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(14772),f=a.i(8140);let g="thehappycase_order_data",h=(0,f.getSupabaseClient)(),i=()=>(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 font-inter",children:"Loading payment details..."})]})}),j=()=>{let a=(0,d.useRouter)();return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center max-w-md mx-auto px-4",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",style:{fontFamily:"'Poppins', sans-serif"},children:"Invalid Access"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6 font-inter",children:"This page can only be accessed after a successful payment."}),(0,b.jsx)("button",{onClick:()=>a.push("/"),className:"px-6 py-3 rounded-md bg-gray-900 hover:bg-gray-800 text-white transition-all duration-200 font-inter",children:"Go Home"})]})})};var k=a.i(72856),l=a.i(21929);let m=()=>(0,b.jsxs)("div",{className:"text-center mb-8 md:mb-12",children:[(0,b.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 md:w-24 md:h-24 rounded-full bg-green-100 mb-6",children:(0,b.jsx)(k.FontAwesomeIcon,{icon:l.faCheckCircle,className:"text-green-600 text-4xl md:text-5xl"})}),(0,b.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-3",style:{fontFamily:"'Poppins', sans-serif"},children:"Payment Successful!"}),(0,b.jsx)("p",{className:"text-base md:text-lg text-gray-600 max-w-2xl mx-auto font-inter",children:"Thank you for your order. We've received your payment and will process your items shortly."})]});var n=a.i(77585);let o=({orderId:a,orderDate:c,subtotal:d,shippingCost:e,vatAmount:f,totalAmount:g,orderStatus:h,items:i})=>(0,b.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 md:p-8",children:[(0,b.jsx)("h2",{className:"text-xl md:text-2xl font-semibold mb-6 text-gray-900",style:{fontFamily:"'Poppins', sans-serif"},children:"Order Details"}),(0,b.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Order ID:"}),(0,b.jsx)("span",{className:"text-gray-900 font-mono text-sm",children:a})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Date:"}),(0,b.jsx)("span",{className:"text-gray-900 font-inter",children:c?new Date(1e3*c).toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]}),(0,b.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center py-1",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Subtotal:"}),(0,b.jsxs)("span",{className:"text-gray-900 font-inter",children:["Â£",d.toFixed(2)]})]}),e>0&&(0,b.jsxs)("div",{className:"flex justify-between items-center py-1",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"Shipping:"}),(0,b.jsxs)("span",{className:"text-gray-900 font-inter",children:["Â£",e.toFixed(2)]})]}),f>0&&(0,b.jsxs)("div",{className:"flex justify-between items-center py-1",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter",children:"VAT:"}),(0,b.jsxs)("span",{className:"text-gray-900 font-inter",children:["Â£",f.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-gray-200 mt-2",children:[(0,b.jsx)("span",{className:"text-gray-900 font-semibold font-inter",children:"Total:"}),(0,b.jsxs)("span",{className:"text-gray-900 font-semibold text-lg font-inter",children:["Â£",g.toFixed(2)]})]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-gray-200",children:[(0,b.jsx)("span",{className:"font-medium text-green-600 capitalize font-inter",children:"Status:"}),(0,b.jsx)("span",{className:"text-green-600 font-semibold capitalize font-inter",children:h})]})]}),i&&i.length>0&&(0,b.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 font-inter",children:"Items Ordered:"}),(0,b.jsx)("div",{className:"space-y-3",children:i.map((a,c)=>(0,b.jsx)(n.default,{item:a},c))})]})]}),p=({customerInfo:a})=>(0,b.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 md:p-8",children:[(0,b.jsx)("h2",{className:"text-xl md:text-2xl font-semibold mb-6 text-gray-900",style:{fontFamily:"'Poppins', sans-serif"},children:"Shipping Information"}),a&&a.name&&(0,b.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,b.jsxs)("div",{className:"py-2 border-b border-gray-100",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Name:"}),(0,b.jsx)("p",{className:"text-gray-900 font-inter",children:a.name})]}),a.email&&(0,b.jsxs)("div",{className:"py-2 border-b border-gray-100",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Email:"}),(0,b.jsx)("p",{className:"text-gray-900 font-inter",children:a.email})]}),a.address&&a.address.line1&&(0,b.jsxs)("div",{className:"py-2",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Address:"}),(0,b.jsxs)("p",{className:"text-gray-900 font-inter",children:[a.address.line1,a.address.line2&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("br",{}),a.address.line2]}),(0,b.jsx)("br",{}),a.address.city," ",a.address.postal_code,(0,b.jsx)("br",{}),a.address.country]})]})]}),(0,b.jsxs)("div",{className:"mt-6 p-4 md:p-5 bg-blue-50 rounded-lg border border-blue-100",children:[(0,b.jsx)("h3",{className:"font-semibold text-blue-900 mb-2 font-inter",children:"What's Next?"}),(0,b.jsx)("p",{className:"text-sm md:text-base text-blue-800 mb-3 font-inter",children:"Your order will be processed within 1-2 business days. You will receive a shipping confirmation email with tracking details once your items are dispatched."}),(0,b.jsxs)("p",{className:"text-sm md:text-base text-blue-800 font-inter",children:[(0,b.jsx)("strong",{children:"Estimated delivery:"})," 3-5 business days"]})]})]}),q=()=>{let a=(0,d.useRouter)();return(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mt-8 md:mt-12",children:[(0,b.jsxs)("button",{onClick:()=>a.push("/"),className:"px-6 py-3 rounded-md font-medium inline-flex items-center justify-center bg-gray-900 hover:bg-gray-800 text-white transition-all duration-200 font-inter",children:[(0,b.jsx)(k.FontAwesomeIcon,{icon:l.faHome,className:"mr-2"}),"Continue Shopping"]}),(0,b.jsxs)("button",{onClick:()=>window.print(),className:"px-6 py-3 rounded-md font-medium inline-flex items-center justify-center bg-white hover:bg-gray-50 text-gray-900 border border-gray-300 hover:border-gray-400 transition-all duration-200 font-inter",children:[(0,b.jsx)(k.FontAwesomeIcon,{icon:l.faShoppingBag,className:"mr-2"}),"Print Receipt"]})]})},r=()=>(0,b.jsx)("div",{className:"mt-8 md:mt-12 text-center",children:(0,b.jsxs)("p",{className:"text-gray-600 font-inter",children:["Questions about your order? Contact us at"," ",(0,b.jsx)("a",{href:"mailto:support@thehappycase.com",className:"text-gray-900 hover:underline font-medium",children:"support@thehappycase.com"})]})});a.s(["default",0,()=>{let a=(0,d.useSearchParams)(),f=a?.get("session_id"),[k,l]=c.default.useState(null);(0,c.useEffect)(()=>{let a=sessionStorage.getItem("paymentSuccessData");if(a)try{l(JSON.parse(a))}catch(a){console.error("Failed to parse payment data from sessionStorage:",a)}},[]);let{paymentIntent:n,customerInfo:s,items:t,shippingCost:u=0,vatAmount:v=0,totalWithShipping:w,subtotal:x}=k||{},{loading:y}=((a,b,f)=>{let i=(0,d.useSearchParams)(),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),p=i?.get("session_id"),q=(0,c.useRef)(!1),r=(0,c.useRef)({paymentIntent:a,customerInfo:b,items:f}),s=(0,c.useRef)(!1);return(0,c.useEffect)(()=>{if(a&&b&&f){r.current={paymentIntent:a,customerInfo:b,items:f};try{sessionStorage.setItem(g,JSON.stringify({paymentIntent:a,customerInfo:b,items:f,timestamp:Date.now()}))}catch(a){console.warn("âš ï¸ Could not save to sessionStorage:",a)}n&&o(null),s.current=!1}},[a,b,f,n]),(0,c.useEffect)(()=>{if((!a||!b||!f)&&p&&!n&&!s.current){s.current=!0;try{let a=sessionStorage.getItem(g);if(a){let b=JSON.parse(a);Date.now()-b.timestamp<36e5&&(console.log("ðŸ“¦ Recovering order data from sessionStorage"),o(b),r.current=b)}}catch(a){console.warn("âš ï¸ Could not recover from sessionStorage:",a)}}},[a,b,f,p,n]),(0,c.useEffect)(()=>{let c=a||n?.paymentIntent||r.current.paymentIntent,d=b||n?.customerInfo||r.current.customerInfo,g=f||n?.items||r.current.items;c&&d?.email&&g&&g.length>0&&!l&&!q.current&&(q.current=!0,(async()=>{try{let a,b=null;if(h)try{let{data:a,error:c}=await h.auth.getUser();!c&&a?.user?.id?(b=a.user.id,localStorage.setItem("userId",b),console.log("âœ… User ID retrieved from Supabase auth:",b)):(console.log("â„¹ï¸ No authenticated user found, order will be saved without user_id"),c&&console.log("   Auth error:",c.message))}catch(a){console.warn("âš ï¸ Error getting user ID from Supabase:",a)}b||console.log("â„¹ï¸ No user ID available - order will be saved without user_id"),console.log("ðŸ’¾ Attempting to save order to Supabase..."),console.log("  - Payment Intent:",c?.id),console.log("  - Customer Email:",d?.email),console.log("  - User ID:",b||"N/A"),console.log("  - Items:",g?.length||0);let f=await fetch((0,e.getApiUrl)("/api/save-order"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntent:c,customerInfo:d,items:g,userId:b})});console.log("ðŸ“¤ Order save response status:",f.status);let i=await f.text();if(i&&""!==i.trim())try{a=JSON.parse(i),console.log("ðŸ“¥ Order save response:",a)}catch(b){console.error("âŒ Failed to parse JSON response:",b),console.error("   Response text:",i.substring(0,200)),a={success:!1,error:"Invalid JSON response from server",rawResponse:i.substring(0,200),status:f.status}}else console.error("âŒ Empty response from server"),a={success:!1,error:"Empty response from server",status:f.status};f.ok&&a.success||a.alreadyExists?(a.alreadyExists?console.log("âœ… Order already exists (idempotent):",a.order_id):console.log("âœ… Order saved to Supabase successfully:",a.order_id),m(!0)):(console.error("âŒ Failed to save order:",{status:f.status,success:a.success,error:a.error||a.message,details:a.details}),a.success&&(a.message?.includes("already exists")||a.warning)&&(console.log("âš ï¸ Duplicate order detected, marking as saved to prevent retries"),m(!0))),console.log("ðŸ“§ Attempting to send order confirmation email...");try{let a=await fetch((0,e.getApiUrl)("/api/send-order-confirmation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntent:c,customerInfo:d,items:g})});if(console.log("ðŸ“¤ Email response status:",a.status),a.ok){let b=await a.json();console.log("ðŸ“¥ Email response:",b),b.success?(console.log("âœ… Order confirmation email sent successfully"),b.emailId&&console.log("   Email ID:",b.emailId)):b.message?.includes("Resend API key not configured")||b.warning?.includes("RESEND_API_KEY")?(console.warn("âš ï¸ Email not sent (configuration):",b.message||b.warning),console.warn("   This is expected if RESEND_API_KEY is not configured in .env"),console.warn("   Order was saved successfully, but email requires API key configuration")):(console.error("âŒ Failed to send email:",b.error||b.message),b.warning&&console.warn("   Warning:",b.warning))}else{let b=await a.text();console.error("âŒ Email endpoint returned error:",a.status),console.error("   Error response:",b);try{let a=JSON.parse(b);console.error("   Parsed error:",a)}catch(a){}}}catch(a){console.error("âŒ Exception sending email:",a),console.error("   Error message:",a.message),console.error("   Error stack:",a.stack)}}catch(a){console.error("âŒ Error processing order:",a)}finally{q.current=!1}})())},[a,b,f,l,p,n]),(0,c.useEffect)(()=>{!p||a||l||q.current?p&&!a&&k(!1):(k(!0),q.current=!0,fetch((0,e.getApiUrl)(`/session-status?session_id=${p}`)).then(a=>a.json()).then(async a=>{if("complete"===a.status&&a.payment_intent){console.log("âœ… Session complete, payment_intent:",a.payment_intent);try{let b=await fetch((0,e.getApiUrl)(`/api/orders?payment_intent_id=${a.payment_intent}`));if(b.ok){let a=await b.json();if(a&&a.success&&a.order){console.log("âœ… Order already exists in Supabase:",a.order.order_id),m(!0),k(!1),q.current=!1;return}}}catch(a){console.warn("âš ï¸ Could not check existing order:",a)}if(a.customer_email){console.log("â„¹ï¸ Session complete but order not found in Supabase. Checking sessionStorage..."),q.current=!1,k(!1);return}k(!1)}else k(!1);q.current=!1}).catch(a=>{console.error("Error fetching session:",a),k(!1),q.current=!1}))},[p,a,l]),{loading:j,orderSaved:l}})(n,s,t);if((0,c.useEffect)(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),y)return(0,b.jsx)(i,{});if(!n&&!f)return(0,b.jsx)(j,{});let z=void 0!==x?x:t&&0!==t.length?t.reduce((a,b)=>a+(b.totalPrice||b.price||0)*(b.quantity||1),0):0,A=u||0;!u&&s?.address?.country&&t?.length>0&&(A=({GB:3,US:16,FR:7})[s.address.country.toUpperCase()]??12);let B=v||0;if(!v&&s?.address?.country){let a=new Set(["FR","DE","ES","IT"]),b=s.address.country.toUpperCase();a.has(b)&&(B=.2*z)}let C=void 0!==w?w:z+B+A,D=n?.id||f||"N/A",E=n?.created||Date.now()/1e3,F=n?.status||"succeeded";return(0,b.jsx)("div",{className:"min-h-screen bg-white py-8 md:py-12",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,b.jsx)(m,{}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8",children:[(0,b.jsx)(o,{orderId:D,orderDate:E,subtotal:z,shippingCost:A,vatAmount:B,totalAmount:C,orderStatus:F,items:t}),(0,b.jsx)(p,{customerInfo:s})]}),(0,b.jsx)(q,{}),(0,b.jsx)(r,{})]})})}],88530)}];

//# sourceMappingURL=src_page-components_PaymentSuccess_index_jsx_3eaf9fe7._.js.map