var J=Object.defineProperty,K=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var Y=(e,a,s)=>a in e?J(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,F=(e,a)=>{for(var s in a||(a={}))_.call(a,s)&&Y(e,s,a[s]);if(V)for(var s of V(a))X.call(a,s)&&Y(e,s,a[s]);return e},T=(e,a)=>K(e,Q(a));var L=(e,a,s)=>new Promise((t,r)=>{var m=i=>{try{n(s.next(i))}catch(c){r(c)}},l=i=>{try{n(s.throw(i))}catch(c){r(c)}},n=i=>i.done?t(i.value):Promise.resolve(i.value).then(m,l);n((s=s.apply(e,a)).next())});const Z=[{id:1,name:"Economy Case",type:"economy",images:["/images/SmartCase/economycaselightpink.webp","/images/SmartCase/economycasered.webp","/images/SmartCase/economycasejeansblue.webp","/images/SmartCase/economycasebrown.webp","/images/SmartCase/economycaselightblue.webp","/images/SmartCase/economycasedarkbrown.webp","/images/SmartCase/economycaseblack.webp","/images/SmartCase/economycaselightbrown.webp"],colors:[{color:"#f49f90",image:"/images/SmartCase/economycaselightpink.webp"},{color:"#cb0025",image:"/images/SmartCase/economycasered.webp"},{color:"#9cb4b8",image:"/images/SmartCase/economycaselightblue.webp"},{color:"#627386",image:"/images/SmartCase/economycasejeansblue.webp"},{color:"#3a4763",image:"/images/SmartCase/economycasedarkblue.webp"},{color:"#c96e50",image:"/images/SmartCase/economycaselightbrown.webp"},{color:"#b0582c",image:"/images/SmartCase/economycasebrown.webp"},{color:"#59332e",image:"/images/SmartCase/economycasedarkbrown.webp"},{color:"#506258",image:"/images/SmartCase/economycasegreen.webp"},{color:"#89837e",image:"/images/SmartCase/economycasegray.webp"},{color:"#413f44",image:"/images/SmartCase/economycaseblack.webp"}],specifications:{dimensions:"14.9cm (W) x 10.7cm (H) x 1cm (D)",rfid:"Yes",material:"PU Leather",closure:"Magnetic Snap Closure",cardSlots:"3",features:"RFID Protection, Water Resistant, Lightweight Design",interior:"Document Pocket, Boarding Pass Slot, SIM Card Slot",care:"Wipe clean with damp cloth"},basePrice:8},{id:2,name:"Business Class Case",type:"business",images:["/images/BusinessClassCase/businessclasscasegray.webp","/images/BusinessClassCase/businessclasscasepink.webp","/images/BusinessClassCase/businessclasscaselightpink.webp","/images/BusinessClassCase/businessclasscasebrown.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclassinside.webp","/images/BusinessClassCase/businessclassinside2.webp"],colors:[{color:"#c8b593",image:"/images/BusinessClassCase/businessclasscasegray.webp"},{color:"#da8ca6",image:"/images/BusinessClassCase/businessclasscaselightpink.webp"},{color:"#daaf49",image:"/images/BusinessClassCase/businessclasscaseyellow.webp"},{color:"#d33d72",image:"/images/BusinessClassCase/businessclasscasepink.webp"},{color:"#c49154",image:"/images/BusinessClassCase/businessclasscasebrown.webp"},{color:"#36312b",image:"/images/BusinessClassCase/businessclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 9.5cm (H) x 1cm (D)",rfid:"No",material:"Genuine Leather",closure:"No Closure",cardSlots:"4",interior:"Passport Pocket, Document Pocket",care:"Clean with leather conditioner, avoid excessive moisture"},basePrice:12},{id:3,name:"First Class Case",type:"firstclass",images:["/images/FirstClassCase/firstclassbrown.webp","/images/FirstClassCase/firstclasscaseblack.webp","/images/FirstClassCase/firstclasscasenavyblue.webp","/images/FirstClassCase/firstclasscasebrickred.webp","/images/FirstClassCase/firstclasscasepink.webp","/images/FirstClassCase/firstclasscasebrown.webp","/images/FirstClassCase/firstclasscaseblue.webp","/images/FirstClassCase/firstclasscasegray.webp","/images/FirstClassCase/firstclasscasepurple.webp","/images/FirstClassCase/firstclasscasegreen.webp","/images/FirstClassCase/firstclasscasedarkpink.webp"],colors:[{color:"#d17956",image:"/images/FirstClassCase/firstclasscasebrown.webp"},{color:"#c76f82",image:"/images/FirstClassCase/firstclasscasebrickred.webp"},{color:"#adcfa8",image:"/images/FirstClassCase/firstclasscasegreen.webp"},{color:"#ab8b72",image:"/images/FirstClassCase/firstclasscasedarkpink.webp"},{color:"#bfa29c",image:"/images/FirstClassCase/firstclasscasepink.webp"},{color:"#a799ab",image:"/images/FirstClassCase/firstclasscasepurple.webp"},{color:"#afab9b",image:"/images/FirstClassCase/firstclasscasegray.webp"},{color:"#5f6074",image:"/images/FirstClassCase/firstclasscasenavyblue.webp"},{color:"#768695",image:"/images/FirstClassCase/firstclasscaseblue.webp"},{color:"#cea55c",image:"/images/FirstClassCase/firstclasscaselightbrown.webp"},{color:"#272a34",image:"/images/FirstClassCase/firstclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 10.5cm (H) x 1.5cm (D)",rfid:"Yes",material:"Genuine Leather",closure:"Button Snap Closure",cardSlots:"3",interior:" Document Pocket, Boarding Pass Slot, SIM Card Slot",features:"Coin Pouch, RFID Protection, Water Resistant"},basePrice:12}],ee={flags:[{id:1,name:"Albania Flag",src:"/images/Flags/albania.webp",price:2,size:.5,continent:"europe"},{id:2,name:"Armenia Flag",src:"/images/Flags/armenia.webp",price:2,size:.5,continent:"europe"},{id:3,name:"Belgium Flag",src:"/images/Flags/belgium.webp",price:2,size:.5,continent:"europe"},{id:4,name:"Bosnia  Flag",src:"/images/Flags/bosnia.webp",price:2,size:.5,continent:"europe"},{id:5,name:"Brazil Flag",src:"/images/Flags/brazil.webp",price:2,size:.5,continent:"americas"},{id:6,name:"British Virgin Islands Flag",src:"/images/Flags/britishvirginislands.webp",price:2,size:.5,continent:"americas"},{id:7,name:"Croatia Flag",src:"/images/Flags/croatia.webp",price:2,size:.5,continent:"europe"},{id:8,name:"Dublin Flag",src:"/images/Flags/dublin.webp",price:2,size:.5,continent:"europe"},{id:9,name:"Egypt Flag",src:"/images/Flags/egypt.webp",price:2,size:.5,continent:"africa"},{id:10,name:"France Flag",src:"/images/Flags/france.webp",price:2,size:.5,continent:"europe"},{id:11,name:"Germany Flag",src:"/images/Flags/germany.webp",price:2,size:.5,continent:"europe"},{id:12,name:"India Flag",src:"/images/Flags/india.webp",price:2,size:.5,continent:"asia"},{id:13,name:"Italy Flag",src:"/images/Flags/italy.webp",price:2,size:.5,continent:"europe"},{id:14,name:"Jamaica  Flag",src:"/images/Flags/jamaica.webp",price:2,size:.5,continent:"americas"},{id:15,name:"Japan  Flag",src:"/images/Flags/japan.webp",price:2,size:.5,continent:"americas"},{id:16,name:"Hungary Flag",src:"/images/Flags/hungary.webp",price:2,size:.5,continent:"americas"},{id:17,name:"LGBTQIA+ Flag",src:"/images/Flags/lgbtqia.webp",price:2,size:.5,continent:"special"},{id:18,name:"Netherlands Flag",src:"/images/Flags/netherlands.webp",price:2,size:.5,continent:"europe"},{id:19,name:"Norway Flag",src:"/images/Flags/norway.webp",price:2,size:.5,continent:"europe"},{id:20,name:"Portugal Flag",src:"/images/Flags/portugal.webp",price:2,size:.5,continent:"europe"},{id:21,name:"Puerto Rico  Flag",src:"/images/Flags/puertorico.webp",price:2,size:.5,continent:"americas"},{id:22,name:"Scotland Flag",src:"/images/Flags/scotland.webp",price:2,size:.5,continent:"europe"},{id:23,name:"South Africa Flag",src:"/images/Flags/southafrica.webp",price:2,size:.5,continent:"africa"},{id:24,name:"Spain Flag",src:"/images/Flags/spain.webp",price:2,size:.5,continent:"europe"},{id:25,name:"Sweden Flag",src:"/images/Flags/sweden.webp",price:2,size:.5,continent:"europe"},{id:26,name:"Switzerland Flag",src:"/images/Flags/switzerland.webp",price:2,size:.5,continent:"europe"},{id:27,name:"United Kingdon Flag",src:"/images/Flags/uk.webp",price:2,size:.5,continent:"europe"},{id:28,name:"United States Flag",src:"/images/Flags/eua.webp",price:2,size:.5,continent:"americas"}],colorful:[{id:1,name:"Be a Good Human",src:"/images/ColorfulPins/beagoodhuman.webp",price:2,size:.7,subCategory:"inspiration"},{id:2,name:"Airplane",src:"/images/ColorfulPins/airplane.webp",price:2,size:.75,subCategory:"travel"},{id:3,name:"Heart Globe",src:"/images/ColorfulPins/heartglobe.webp",price:2,size:.7},{id:4,name:"Dream Big",src:"/images/ColorfulPins/dreambig.webp",price:2,size:.9,subCategory:"inspiration"},{id:5,name:"Paw",src:"/images/ColorfulPins/paw.webp",price:2,size:.4},{id:6,name:"Colorful Camera",src:"/images/ColorfulPins/camera.webp",price:2,size:.55,subCategory:"camera"},{id:7,name:"Be Kind",src:"/images/ColorfulPins/bekind.webp",price:2,size:.75,subCategory:"inspiration"},{id:8,name:"Football",src:"/images/ColorfulPins/football.webp",price:2,size:.75},{id:9,name:"Ticket to Happiness",src:"/images/ColorfulPins/tickettohappiness.webp",price:2,size:.8,subCategory:"inspiration"},{id:10,name:"Be Happy",src:"/images/ColorfulPins/behappy.webp",price:2,size:.75,subCategory:"inspiration"},{id:11,name:"Lucky Leaf",src:"/images/ColorfulPins/luckyleafcharm.webp",price:2,size:.5,subCategory:"nature"},{id:12,name:"Beer",src:"/images/ColorfulPins/beer.webp",price:2,size:.65,subCategory:"drinks"},{id:13,name:"Bottle of Wine",src:"/images/ColorfulPins/bottleofwine.webp",price:2,size:.8,subCategory:"drinks"},{id:14,name:"Heart Notification",src:"/images/ColorfulPins/heartnotification.webp",price:2,size:.5,subCategory:"hearts"},{id:15,name:"Small Boarding Pass",src:"/images/ColorfulPins/smallboardingpass.webp",price:2,size:.75,subCategory:"travel"},{id:16,name:"Little Heart",src:"/images/ColorfulPins/littleheart.webp",price:2,size:.5,subCategory:"hearts"},{id:17,name:"Disney",src:"/images/ColorfulPins/disney.webp",price:2,size:.75,subCategory:"disney"},{id:18,name:"Pluto",src:"/images/ColorfulPins/pluto.webp",price:2,size:.85,subCategory:"disney"},{id:19,name:"Round Minnnie",src:"/images/ColorfulPins/roundminnie.webp",price:2,size:.85,subCategory:"disney"},{id:20,name:"Round Mickey",src:"/images/ColorfulPins/roundmickey.webp",price:2,size:.85,subCategory:"disney"},{id:21,name:"Guufy",src:"/images/ColorfulPins/guufy.webp",price:2,size:.85,subCategory:"disney"},{id:22,name:"Map",src:"/images/ColorfulPins/map.webp",price:2,size:.85,subCategory:"travel"},{id:23,name:"London Phone",src:"/images/ColorfulPins/telephone.webp",price:2,size:.85},{id:24,name:"Adventure Awaits Ticket",src:"/images/ColorfulPins/adventureawaits.webp",price:2,size:.85,subCategory:"travel"},{id:25,name:"Passport",src:"/images/ColorfulPins/passport.webp",price:2,size:.75,subCategory:"travel"},{id:26,name:"Coffee",src:"/images/ColorfulPins/coffee.webp",price:2,size:.5,subCategory:"drinks"},{id:27,name:"Coconut Tree",src:"/images/ColorfulPins/coconuttree.webp",price:2,size:.8,subCategory:"nature"},{id:28,name:"Wave",src:"/images/ColorfulPins/wave.webp",price:3.5,size:.6},{id:29,name:"Suitcase",src:"/images/ColorfulPins/orangeluggage.webp",price:2,size:.7,subCategory:"travel"},{id:30,name:"Black Camera",src:"/images/ColorfulPins/blackcamera.webp",price:2,size:.8,subCategory:"camera"},{id:31,name:"Pink Camera",src:"/images/ColorfulPins/pinkcamera.webp",price:2,size:.5,subCategory:"camera"},{id:32,name:"Daisy Duck",src:"/images/ColorfulPins/daisyduck.webp",price:2,size:.7,subCategory:"disney"},{id:33,name:"Duck",src:"/images/ColorfulPins/duck.webp",price:2,size:.75,subCategory:"disney"},{id:34,name:"Minnie",src:"/images/ColorfulPins/minnie.webp",price:2,size:.7,subCategory:"disney"},{id:35,name:"Mickey Mouse",src:"/images/ColorfulPins/mickey.webp",price:2,size:.75,subCategory:"disney"},{id:36,name:"Combi",src:"/images/ColorfulPins/combi.webp",price:2,size:.7,subCategory:"travel"},{id:37,name:"Wine",src:"/images/ColorfulPins/wineglass.webp",price:2,size:.4,subCategory:"drinks"},{id:38,name:"Vacation",src:"/images/ColorfulPins/vacation.webp",price:2,size:.8,subCategory:"travel"},{id:39,name:"Love",src:"/images/ColorfulPins/love.webp",price:2,size:.8,subCategory:"travel"}],bronze:[{id:1,name:"Airplane",src:"/images/BronzePins/airplane.webp",price:1,size:.7,subCategory:"travel"},{id:2,name:"Cardinal Points",src:"/images/BronzePins/cardinalpoints.webp",price:1,size:.65,subCategory:"symbols"},{id:3,name:"Camera",src:"/images/BronzePins/camera.webp",price:1,size:.55,subCategory:"symbols"},{id:4,name:"Globe",src:"/images/BronzePins/globe.webp",price:1,size:.55,subCategory:"travel"},{id:5,name:"Passport",src:"/images/BronzePins/passport.webp",price:1,size:.4,subCategory:"travel"},{id:6,name:"NYC Taxi",src:"/images/BronzePins/nyctaxi.webp",price:1,size:.9,subCategory:"travel"},{id:7,name:"Liberty Statue",src:"/images/BronzePins/libertystatue.webp",price:1,size:1,subCategory:"travel"},{id:8,name:"Luggage",src:"/images/BronzePins/luggage.webp",price:1,size:.45,subCategory:"travel"},{id:9,name:"London Bus",src:"/images/BronzePins/london.webp",price:1,size:.7,subCategory:"travel"},{id:10,name:"Lucky Leaf",src:"/images/BronzePins/luckyleaf.webp",price:1,size:.45,subCategory:"nature"},{id:11,name:"Little Heart",src:"/images/BronzePins/littleheart.webp",price:1,size:.25,subCategory:"love"},{id:12,name:"Eiffel Towel",src:"/images/BronzePins/eiffeltowel.webp",price:1,size:.8},{id:13,name:"Kangaroo",src:"/images/BronzePins/kangaroo.webp",price:1,size:.9,subCategory:"animals"},{id:14,name:"Koala",src:"/images/BronzePins/koala.webp",price:1,size:.5,subCategory:"animals"},{id:15,name:"Hamsa Hand",src:"/images/BronzePins/hamsahand.webp",price:1,size:.9,subCategory:"symbols"},{id:16,name:"Thailand",src:"/images/BronzePins/thailand.webp",price:1,size:.9,subCategory:"symbols"},{id:17,name:"Mummy",src:"/images/BronzePins/mummy.webp",price:1,size:.7,subCategory:"symbols"},{id:18,name:"Llama",src:"/images/BronzePins/llama.webp",price:1,size:.7,subCategory:"animals"},{id:19,name:"India",src:"/images/BronzePins/india.webp",price:1,size:.5,subCategory:"symbols"},{id:20,name:"Pyramid",src:"/images/BronzePins/pyramid.webp",price:1,size:.8},{id:21,name:"Arc The Triomphe",src:"/images/BronzePins/arcthetriomphe.webp",price:1,size:.5},{id:22,name:"Maple Leaf",src:"/images/BronzePins/mapleleaf.webp",price:1,size:.6,subCategory:"nature"},{id:23,name:"Love",src:"/images/BronzePins/love.webp",price:1,size:.8,subCategory:"love"},{id:24,name:"Airplane War",src:"/images/BronzePins/airplanewar.webp",price:1,size:.8},{id:25,name:"Enjoy the Journey",src:"/images/BronzePins/enjoythejourney.webp",price:1,size:1,subCategory:"symbols"},{id:26,name:"Heart",src:"/images/BronzePins/heart.webp",price:1,size:.7,subCategory:"love"},{id:27,name:"I love Jesus",src:"/images/BronzePins/ilovejesus.webp",price:1,size:.5,subCategory:"love"},{id:28,name:"Butterfly",src:"/images/BronzePins/butterfly.webp",price:1,size:.7,subCategory:"nature"},{id:29,name:"Squirrel",src:"/images/BronzePins/squirrel.webp",price:1,size:.5},{id:30,name:"Canada",src:"/images/BronzePins/canada.webp",price:1,size:.6,subCategory:"symbols"},{id:31,name:"Flipflop",src:"/images/BronzePins/flipflop.webp",price:1,size:.5,subCategory:"nature"},{id:32,name:"Paw",src:"/images/BronzePins/paw.webp",price:1,size:.5,subCategory:"animals"},{id:33,name:"PawDog",src:"/images/BronzePins/pawheart.webp",price:1,size:.45,subCategory:"animals"},{id:34,name:"I love my dog",src:"/images/BronzePins/ilovemydog.webp",price:1,size:.5,subCategory:"animals"},{id:35,name:"Money",src:"/images/BronzePins/money.webp",price:1,size:.55},{id:36,name:"Dog Bone",src:"/images/BronzePins/dogbone.webp",price:1,size:.5,subCategory:"animals"}]},P={cases:Z,pins:ee},G=e=>{var a,s;if(e.customDesign||e.designImage)return`custom-${e.id||Date.now()}`;if(e.type==="charm"||e.category&&e.pin){const t=e.category||e.pin&&e.pin.category||"colorful",r=((a=e.pin)==null?void 0:a.name)||((s=e.pin)==null?void 0:s.src)||e.name||"";return`charm-${t}-${r}`}if(e.caseType&&e.color){if(e.pins&&e.pins.length>0){const t=e.pins.map(r=>r.name||r.src).sort().join("-");return`case-${e.caseType}-${e.color}-pins-${t}`}return`case-${e.caseType}-${e.color}`}return e.id&&e.id.startsWith("case-")?`unique-${e.id}`:e.id?`item-${e.id}`:`item-${Date.now()}`},se=(e,a)=>G(e)===G(a),ae="http://localhost:3001",re=e=>{const a=e.startsWith("/")?e:`/${e}`;return`${ae}${a}`};let B=null,N=null,E=null,A=!1;const U=()=>L(void 0,null,function*(){return E||(E=L(void 0,null,function*(){var e,a,s,t,r,m,l,n,i,c,o,p,g,C,d,b,w,v,z,I,$;try{B||(A=!0);const D=re("/api/inventory"),M=new AbortController,x=setTimeout(()=>M.abort(),1e4),q=h=>L(void 0,null,function*(){const y=h.headers.get("content-type"),u=yield h.text();if(!y||!y.includes("application/json"))throw u.trim().startsWith("<!DOCTYPE")||u.trim().startsWith("<html")?new Error("HTML_RESPONSE_FALLBACK"):new Error(`Expected JSON, got: ${u.substring(0,100)}...`);try{return JSON.parse(u)}catch(k){throw new Error(`Failed to parse JSON response: ${k.message}`)}});try{console.log("[INVENTORY] ðŸ” Fetching inventory from:",D);const h=yield fetch(D,{signal:M.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(x),console.log("[INVENTORY] ðŸ“¡ Response status:",h.status,h.statusText),!h.ok)try{const y=yield h.text();console.error("[INVENTORY] âŒ Error response body:",y);try{const u=JSON.parse(y);console.error("[INVENTORY] âŒ Error details:",u)}catch(u){}}catch(y){console.error("[INVENTORY] âŒ Could not read error response:",y)}if(h.ok){const y=yield q(h);if(console.log("[INVENTORY] âœ… Received inventory data:",{success:y.success,hasInventory:!!y.inventory,inventoryType:typeof y.inventory,inventoryKeys:y.inventory?Object.keys(y.inventory):null,casesType:typeof((e=y.inventory)==null?void 0:e.cases),casesIsArray:Array.isArray((a=y.inventory)==null?void 0:a.cases),casesLength:(t=(s=y.inventory)==null?void 0:s.cases)==null?void 0:t.length,casesValue:(r=y.inventory)==null?void 0:r.cases,caseColorsType:typeof((m=y.inventory)==null?void 0:m.caseColors),caseColorsIsArray:Array.isArray((l=y.inventory)==null?void 0:l.caseColors),caseColorsLength:(i=(n=y.inventory)==null?void 0:n.caseColors)==null?void 0:i.length,caseColorsValue:(c=y.inventory)==null?void 0:c.caseColors,pinsType:typeof((o=y.inventory)==null?void 0:o.pins),pinsKeys:(p=y.inventory)!=null&&p.pins?Object.keys(y.inventory.pins):null,pinsFlagsLength:(d=(C=(g=y.inventory)==null?void 0:g.pins)==null?void 0:C.flags)==null?void 0:d.length,pinsColorfulLength:(v=(w=(b=y.inventory)==null?void 0:b.pins)==null?void 0:w.colorful)==null?void 0:v.length,pinsBronzeLength:($=(I=(z=y.inventory)==null?void 0:z.pins)==null?void 0:I.bronze)==null?void 0:$.length,fullInventory:y.inventory}),y.success&&y.inventory){console.log("[INVENTORY] ðŸ”„ STEP 5: Parsing inventory data from API response...");const u={cases:y.inventory.cases,caseColors:y.inventory.caseColors,pins:y.inventory.pins};console.log("[INVENTORY] ðŸ” STEP 5.1: Parsed quantities structure:",{casesType:typeof u.cases,casesIsArray:Array.isArray(u.cases),casesValue:u.cases,caseColorsType:typeof u.caseColors,caseColorsIsArray:Array.isArray(u.caseColors),caseColorsValue:u.caseColors,pinsType:typeof u.pins,pinsValue:u.pins});const k=u.cases&&Array.isArray(u.cases)&&u.cases.some(f=>f!==null)||u.caseColors&&Array.isArray(u.caseColors)&&u.caseColors.some(f=>f&&f.some(S=>S!==null))||u.pins&&(u.pins.flags&&u.pins.flags.some(f=>f!==null)||u.pins.colorful&&u.pins.colorful.some(f=>f!==null)||u.pins.bronze&&u.pins.bronze.some(f=>f!==null));if(console.log("[INVENTORY] ðŸ“Š Inventory summary:",{hasInventoryData:k,cacheTimestamp:Date.now(),casesType:typeof u.cases,casesIsArray:Array.isArray(u.cases),casesPreview:Array.isArray(u.cases)?u.cases.slice(0,5):u.cases,caseColorsType:typeof u.caseColors,caseColorsIsArray:Array.isArray(u.caseColors),caseColorsPreview:Array.isArray(u.caseColors)?u.caseColors.slice(0,2).map(f=>Array.isArray(f)?f.slice(0,3):f):u.caseColors,pinsPreview:u.pins}),console.log("[INVENTORY] ðŸ”„ STEP 5.4: Updating in-memory cache..."),B=u,N=Date.now(),typeof window!="undefined"){const f={timestamp:N};window.dispatchEvent(new CustomEvent("inventoryCacheUpdated",{detail:f})),window.dispatchEvent(new CustomEvent("inventoryUpdated",{detail:f}))}return A=!1,console.log("[INVENTORY] âœ… STEP 5.7: Inventory fetch complete and cache ready"),u}}else if(h.status===404){const y=D.replace("/api/inventory","/.netlify/functions/inventory");try{const u=yield fetch(y,{signal:M.signal,headers:{"Content-Type":"application/json"}});if(u.ok){const k=yield q(u);if(k.success&&k.inventory){const f={cases:k.inventory.cases,caseColors:k.inventory.caseColors,pins:k.inventory.pins};return B=f,N=Date.now(),f}}}catch(u){}}}catch(h){if(clearTimeout(x),A=!1,console.error("[INVENTORY] âŒ Error fetching inventory:",{message:h.message,name:h.name,apiUrl:D,errorType:h.name==="TypeError"&&h.message==="Failed to fetch"?"Network error - Backend server may not be running":"Other error"}),h.message==="HTML_RESPONSE_FALLBACK"){console.log("[INVENTORY] ðŸ”„ Trying fallback URL (HTML response detected)");const y=D.replace("/api/inventory","/.netlify/functions/inventory");try{const u=new AbortController,k=setTimeout(()=>u.abort(),1e4),f=yield fetch(y,{signal:u.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(k),f.ok){const S=yield q(f);if(S.success&&S.inventory){const j={cases:S.inventory.cases,caseColors:S.inventory.caseColors,pins:S.inventory.pins};return B=j,N=Date.now(),j}}}catch(u){}}}}catch(D){A=!1}finally{E=null,A=!1}return null}),E)}),W=(e,a)=>{var m,l;if(!B&&E&&A)return null;const s=N?Date.now()-N:1/0;(!B||s>60*1e3)&&!A&&U().catch(()=>{});const r=B;if(!r||!r.caseColors&&!r.cases&&!r.pins)return null;if(e.caseType&&e.color){const n=P.cases.find(p=>p.type===e.caseType);if(!n)return null;let i=null;if(r&&r.caseColors){const p=P.cases.findIndex(g=>g.type===e.caseType);if(p!==-1&&r.caseColors[p]){const g=n.colors.findIndex(C=>C.color===e.color);g!==-1&&r.caseColors[p][g]!==null&&r.caseColors[p][g]!==void 0&&(i=r.caseColors[p][g])}}if(i===null&&r&&r.cases){const p=P.cases.findIndex(g=>g.type===e.caseType);p!==-1&&r.cases[p]!==null&&r.cases[p]!==void 0&&(i=r.cases[p])}if(i==null)return null;if(i===0)return 0;const c=a.reduce((p,g)=>g.caseType===e.caseType&&g.color===e.color?p+(g.quantity||1):p,0),o=i-c;return Math.max(0,o)}if(e.type==="charm"||e.category||e.pin){const n=e.category||e.pin&&e.pin.category,i=((m=e.pin)==null?void 0:m.name)||((l=e.pin)==null?void 0:l.src)||e.name;if(!n||!i)return null;let c=null;if(P.pins&&P.pins[n]&&(c=P.pins[n].find(d=>d.name===i||d.src===i)),!c)return null;let o=null;const p=n==="flags"?"flags":n;if(r&&r.pins&&r.pins[p]){const d=P.pins[p].findIndex(b=>b.name===i||b.src===i||b.id===c.id);d!==-1&&r.pins[p][d]!==void 0&&(o=r.pins[p][d])}if(o==null)return null;if(o===0)return 0;const g=a.reduce((d,b)=>se(e,b)?d+(b.quantity||1):d,0),C=o-g;return Math.max(0,C)}return null},ne=()=>B,pe=()=>L(void 0,null,function*(){return B=null,N=null,yield U()}),ue=e=>{if(!e||e.startsWith("data:image/")||e.startsWith("data:application/")||e.startsWith("http://")||e.startsWith("https://"))return e;let a=e.replace(/^\/TheHappyCase\//,"/");return a=a.replace(/\/+/g,"/"),a.startsWith("/"),a},me=()=>{var a,s,t,r,m,l;const e=ne();if(!e)return P;try{const n=F({},P);return e.cases&&(n.cases=n.cases.map((i,c)=>{const o=T(F({},i),{quantity:e.cases[c]!==void 0?e.cases[c]:i.quantity});return e.caseColors&&e.caseColors[c]&&(o.colors=o.colors.map((p,g)=>T(F({},p),{quantity:e.caseColors[c][g]!==void 0?e.caseColors[c][g]:p.quantity}))),o})),e.pins&&(n.pins=T(F({},n.pins),{flags:((s=(a=n.pins)==null?void 0:a.flags)==null?void 0:s.map((i,c)=>{var o;return T(F({},i),{quantity:((o=e.pins.flags)==null?void 0:o[c])!==void 0?e.pins.flags[c]:i.quantity})}))||[],colorful:((r=(t=n.pins)==null?void 0:t.colorful)==null?void 0:r.map((i,c)=>{var o;return T(F({},i),{quantity:((o=e.pins.colorful)==null?void 0:o[c])!==void 0?e.pins.colorful[c]:i.quantity})}))||[],bronze:((l=(m=n.pins)==null?void 0:m.bronze)==null?void 0:l.map((i,c)=>{var o;return T(F({},i),{quantity:((o=e.pins.bronze)==null?void 0:o[c])!==void 0?e.pins.bronze[c]:i.quantity})}))||[]})),n}catch(n){return console.error("Error loading saved quantities:",n),P}},O=(e,a=null)=>{let s=null,t=a;if(!a&&e&&!e.startsWith("#")?(t=e,s=null):(s=e&&e.startsWith("#")?e:null,t=a||(e&&!e.startsWith("#")?e:null)),t){let m=t.split("/").pop().replace(/\.(webp|png|jpg)$/i,"").toLowerCase().replace(/^economycase/i,"").replace(/^businessclasscase/i,"").replace(/^firstclasscase/i,"").replace(/^smartcase/i,"").replace(/^premiumcase/i,"").replace(/^firstclass/i,"");const l={lightpink:"Light Pink",lightblue:"Light Blue",lightbrown:"Light Brown",darkbrown:"Dark Brown",darkblue:"Dark Blue",jeansblue:"Jeans Blue",brickred:"Brick Red",ligthpink:"Light Pink",navyblue:"Navy Blue",gray:"Gray",grey:"Gray",black:"Black",brown:"Brown",red:"Red",pink:"Pink",blue:"Blue",green:"Green",purple:"Purple",yellow:"Yellow",orange:"Orange",darkpink:"Dark Pink"};if(l[m])return l[m];if(m=m.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/(dark|light|navy|jeans|brick)([a-z]+)/g,"$1 $2").split(/(?=[A-Z])|(?=dark|light|navy|jeans|brick)/).filter(n=>n.length>0).join(" ").toLowerCase().split(" ").map(n=>l[n]?l[n]:n.charAt(0).toUpperCase()+n.slice(1)).join(" "),m&&m!=="Color")return m}if(s){s.toLowerCase().replace("#","");const r={"#f49f90":"Light Pink","#cb0025":"Red","#9cb4b8":"Light Blue","#627386":"Jeans Blue","#3a4763":"Dark Blue","#c96e50":"Light Brown","#b0582c":"Brown","#59332e":"Dark Brown","#506258":"Green","#89837e":"Gray","#413f44":"Black","#c8b593":"Gray","#da8ca6":"Light Pink","#daaf49":"Yellow","#d33d72":"Pink","#c49154":"Brown","#36312b":"Black","#d17956":"Brown","#c76f82":"Brick Red","#adcfa8":"Green","#ab8b72":"Dark Pink","#bfa29c":"Pink","#a799ab":"Purple","#afab9b":"Gray","#5f6074":"Navy Blue","#768695":"Blue","#cea55c":"Light Brown","#272a34":"Black"};if(r[s.toLowerCase()])return r[s.toLowerCase()]}return s||""},ge=e=>{const a=e==null?void 0:e.get("case"),s=e==null?void 0:e.get("color"),t="economy";let r="",m="";if(a){const n=P.cases.find(i=>i.type===a);if(n){if(s){const i=n.colors.find(c=>c.color===s);if(i)return{caseType:n.type,color:i.color,image:i.image}}if(n.colors&&n.colors.length>0){const i=n.colors[0];return{caseType:n.type,color:i.color,image:i.image}}}}const l=P.cases.find(n=>n.type===t);if(l&&l.colors&&l.colors.length>0){const n=l.colors[0];return{caseType:t,color:n.color,image:n.image}}return{caseType:t,color:r,image:m}},ie=(e,a,s)=>{if(!e.current)return null;const t=a.current?a.current.visible:!0,r=s.current?s.current.visible:!0;a.current&&(a.current.visible=!1),s.current&&(s.current.visible=!1);const m=e.current.toDataURL({format:"png",quality:1,multiplier:2,backgroundColor:"white"});return a.current&&(a.current.visible=t),s.current&&(s.current.visible=r),(a.current||s.current)&&e.current.renderAll(),m},oe=(e,a,s=300,t=350)=>new Promise((r,m)=>{if(!e&&!a){r(null);return}const l=document.createElement("canvas");l.width=s,l.height=t;const n=l.getContext("2d");n.fillStyle="white",n.fillRect(0,0,s,t);const i=()=>{if(!e){console.log("âš ï¸ No case image URL provided, using canvas content only"),c();return}const o=new Image;!e.startsWith("data:")&&!e.startsWith("blob:")&&(o.crossOrigin="anonymous");const p=setTimeout(()=>{console.error("â±ï¸ Timeout loading case image:",e),c()},1e4);o.onload=()=>{clearTimeout(p),console.log("âœ… Case image loaded successfully:",{width:o.width,height:o.height,src:e.substring(0,50)+"..."});const g=o.width/o.height,C=s/t;let d,b,w,v;const z=270;g>C?(b=z,d=b*g):(d=z,b=d/g),w=(s-d)/2,v=t*.45-b/2,n.drawImage(o,w,v,d,b),c()},o.onerror=g=>{clearTimeout(p),console.error("âŒ Failed to load case image:",{url:e,error:g,message:"Will continue with canvas content only"}),c()},console.log("ðŸ”„ Loading case image:",e),o.src=e},c=()=>{if(!a){console.log("âš ï¸ No canvas data URL, resolving with case image or white canvas"),r(l.toDataURL("image/png",1));return}const o=new Image,p=setTimeout(()=>{console.error("â±ï¸ Timeout loading canvas content"),r(l.toDataURL("image/png",1))},1e4);o.onload=()=>{clearTimeout(p),console.log("âœ… Canvas content loaded successfully:",{width:o.width,height:o.height});const g=o.width/o.height,C=s/t;let d,b,w,v;g>C?(d=s,b=s/g):(b=t,d=t*g),w=(s-d)/2,v=(t-b)/2,n.drawImage(o,w,v,d,b);const z=l.toDataURL("image/png",1);console.log("ðŸŽ¨ Composite image created:",{isDataURL:z.startsWith("data:image/"),length:z.length}),r(z)},o.onerror=g=>{clearTimeout(p),console.error("âŒ Failed to load canvas content:",g),r(l.toDataURL("image/png",1))},console.log("ðŸ”„ Loading canvas content..."),o.src=a};i()}),ye=(e,a,s)=>{const t=ie(e,a,s);if(!t)return;const r=document.createElement("a");r.download=`passport-case-design-${Date.now()}.webp`,r.href=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)},de=(e,a,s,t,r)=>{var o;const l=W({caseType:e,color:a},s),n=(r==null?void 0:r.name)||"Passport Case",i=(o=r==null?void 0:r.colors)==null?void 0:o.find(p=>p.color===a),c=i?O(i.color,i.image):a?O(a):"";if(l!==null&&l===0){const p=c?` in ${c}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${n}${p} in stock right now, so you can't add more to your basket.`}}if(l!==null&&t>l){const p=c?` in ${c}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${n}${p} in stock right now, so you can't add more to your basket.`,maxAvailable:l}}return{valid:!0}},be=(e,a,s,t)=>{for(const{pin:r}of e){const m=(r==null?void 0:r.category)||t||"colorful",l=(r==null?void 0:r.name)||"charm",i=W({type:"charm",category:m,pin:r,name:l},a);if(i!==null&&i===0)return{valid:!1,errorMessage:`Oops! We don't have any more ${l} in stock right now, so you can't add more to your basket.`};if(i!==null&&s>i)return{valid:!1,errorMessage:`Oops! We don't have any more ${l} in stock right now, so you can't add more to your basket.`}}return{valid:!0}},fe=(e,a)=>L(void 0,null,function*(){let s=e;if(e&&a)try{s=yield oe(e,a,300,350),(!s||!s.startsWith("data:image/"))&&(console.warn("âš ï¸ Composite image creation returned invalid result, using case image fallback"),s=e)}catch(t){console.error("âŒ Error creating composite design image:",t),s=e}else a?s=a:e&&(s=e);return(!s||typeof s=="string"&&s.trim().length===0)&&(console.error("âŒ No valid design image available, using case image fallback"),s=e||""),s}),Ce=(e,a)=>e.map(({pin:s})=>{const t=s!=null&&s.category&&s.category.trim()!==""?s.category:a&&a.trim()!==""?a:"colorful";return T(F({},s),{name:(s==null?void 0:s.name)||"Charm",src:(s==null?void 0:s.src)||"",price:(s==null?void 0:s.price)||0,category:t})}),we=({selectedCase:e,selectedCaseType:a,selectedColor:s,selectedCaseImage:t,selectedPins:r,caseBasePrice:m,quantity:l,designImage:n,normalizedCaseImage:i,pinsDetails:c,selectedCategory:o})=>{const p=Math.max(l,1),g=Date.now(),C=(e==null?void 0:e.name)||"Passport Case",d={id:`case-${g}-${Math.random().toString(36).substr(2,9)}`,name:C,caseType:a,caseName:C,color:s,basePrice:m,casePrice:m,totalPrice:m,price:m,image:n,designImage:n,caseImage:i,customDesign:!0,quantity:p},b=c.map((w,v)=>{const z=w.category||o||"colorful",I=w.name||"Charm",$=w.price||2;return{id:`charm-${g}-${v}-${Math.random().toString(36).substr(2,9)}`,name:I,price:$,totalPrice:$,image:w.src||"",pin:w,category:z,type:"charm",quantity:p}});return{caseProduct:d,charmProducts:b}},R=(e,a,s,t,r,m)=>{let l=0;return e.forEach(n=>{if(n.type==="charm"){if(n.id===r||r===void 0&&e.indexOf(n)===m)return;const o=n.pin||n,p=o.name||o.src,g=o.category||n.category||t;(p===a||p===s)&&g===t&&(l+=n.quantity||1)}}),l},H=(e,a,s,t,r,m)=>{let l=0;return e.forEach(n=>{if(n.type==="charm"||n.id===r||e.indexOf(n)===m)return;(n.pins||n.pinsDetails||[]).forEach(c=>{if(!c)return;const o=c.name||c.src,p=c.src||"",g=c.category||t;(o===a||o===s||p===a||p===s)&&g===t&&(l+=n.quantity||1)})}),l},te=(e,a,s,t)=>e.filter(r=>{const m=r.pin||r,l=m.name||m.src,n=m.category||t;return(l===a||l===s)&&n===t}).length,ce=(e,a="colorful")=>{const s=a&&a.trim()!==""?a:"colorful",t=e.name||e.src||"",r=e.src||"";return{name:t,price:e.price||2,totalPrice:e.price||2,image:r,pin:e,category:s,type:"charm"}},he=(e,a,s,t)=>{var d,b,w,v,z;const r=W(e,a),m=e.category||((d=e.pin)==null?void 0:d.category)||"colorful",l=((b=e.pin)==null?void 0:b.name)||e.name||"",n=((w=e.pin)==null?void 0:w.src)||"";if(r!==null&&r===0)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((v=e.pin)==null?void 0:v.name)||"Charm"} in stock right now, so you can't add more to your basket.`};if(r===null)return{canIncrement:!0};const i=R(a,l,n,m,s,t),c=H(a,l,n,m,s,t),o=e.quantity||1,p=r+i;return o+1+c>p?{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((z=e.pin)==null?void 0:z.name)||"Charm"} in stock right now, so you can't add more to your basket.`}:{canIncrement:!0}},ve=(e,a,s,t)=>{const r=W(e,a),m=e.pins||e.pinsDetails||[],l=e.quantity||1;if(!(r===null||r>0)){const i=e.caseName||e.name||"Passport Case",c=e.color?O(e.color,e.caseImage||e.case_image||e.image):"",o=c?` in ${c}`:"";return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${i}${o} in stock right now, so you can't add more to your basket.`,errorType:"case"}}for(const i of m){if(!i)continue;const c=i.category&&i.category.trim()!==""?i.category:"colorful",o=i.name||i.src||"",p=i.src||"",g=ce(i,c),C=W(g,a);if(C===null)continue;const d=R(a,o,p,c,s,t),b=H(a,o,p,c,s,t),w=te(m,o,p,c),v=C+d,I=d+b+w*l+w;if(C===0||I>v)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${i.name||"this charm"} in stock right now, so you can't add more to your basket.`,errorType:"charm",errorKey:`${o}-${c}`,charmProduct:g}}return{canIncrement:!0}};export{P,se as a,O as b,ge as c,ye as d,ie as e,me as f,W as g,be as h,fe as i,we as j,he as k,ve as l,ce as m,ue as n,re as o,Ce as p,ne as q,pe as r,de as v};
