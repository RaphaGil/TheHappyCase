var xe=Object.defineProperty,he=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var se=(t,s,l)=>s in t?xe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l,L=(t,s)=>{for(var l in s||(s={}))fe.call(s,l)&&se(t,l,s[l]);if(te)for(var l of te(s))ye.call(s,l)&&se(t,l,s[l]);return t},R=(t,s)=>he(t,ge(s));var G=(t,s,l)=>new Promise((n,u)=>{var h=g=>{try{a(l.next(g))}catch(d){u(d)}},b=g=>{try{a(l.throw(g))}catch(d){u(d)}},a=g=>g.done?n(g.value):Promise.resolve(g.value).then(h,b);a((l=l.apply(t,s)).next())});import{j as e,L as q,u as H,P as pe,r as f,E as be,f as je,h as Ne}from"./react-vendor-oGZ_6Ua-.js";import{l as ve}from"./stripe-vendor-C-FvrBRD.js";import{a as Y,L as we,u as ae}from"./index-ReX4aZ57.js";import{o as Ce,n as W,g as ke}from"./shared-utils-Ex4kHLmS.js";import"./vendor-Q-ueIuah.js";import"./fontawesome-vendor-DeakGBTR.js";import"./supabase-vendor-rHdX91gy.js";const Se=t=>G(void 0,null,function*(){var h,b;const{amount:s,currency:l="gbp",items:n,customerInfo:u}=t;if(!s||s<=0)throw new Error("Amount is required and must be greater than 0");if(!l)throw new Error("Currency is required");try{const a=Ce("/api/create-payment-intent");console.log("ðŸ“ž Calling backend to create payment intent"),console.log("   URL:",a),console.log("   Request payload:",{amount:s,currency:l,itemCount:Array.isArray(n)?n.length:0,hasCustomerInfo:!!u,customerEmail:(u==null?void 0:u.email)||"N/A"});const g={amount:s,currency:l,items:n,customerInfo:u};console.log("   Full request body:",JSON.stringify(g,null,2));const d=yield fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(console.log("ðŸ“¥ Response received:",{status:d.status,statusText:d.statusText,ok:d.ok,headers:Object.fromEntries(d.headers.entries())}),!d.ok){let i;const C=d.headers.get("content-type");try{if(C&&C.includes("application/json"))i=yield d.json(),console.error("âŒ Backend error response (JSON):",{status:d.status,statusText:d.statusText,error:i.error||i.message||i,fullBody:i});else{i=yield d.text(),console.error("âŒ Backend error response (text/plain):",{status:d.status,statusText:d.statusText,contentType:C,body:i,bodyLength:i.length,fullBody:i});try{const N=JSON.parse(i);console.error("   Parsed text as JSON:",N),i=N}catch(N){console.error("   Response is plain text, not JSON")}}}catch(N){console.error("âŒ Failed to parse error response:",N),i="Unable to parse error response"}const j=typeof i=="string"?i.substring(0,200):((i==null?void 0:i.error)||(i==null?void 0:i.message)||JSON.stringify(i)).substring(0,200);throw new Error(`Backend responded with ${d.status} ${d.statusText}: ${j}`)}const y=yield d.json();if(console.log("âœ… Backend response received:",{hasClientSecret:!!y.clientSecret,keys:Object.keys(y),dataType:typeof y}),!y.clientSecret)throw console.error("âŒ Backend response missing clientSecret"),console.error("   Response data:",y),console.error("   Response keys:",Object.keys(y)),new Error("Backend did not return a clientSecret");return console.log("âœ… Payment intent created successfully"),{client_secret:y.clientSecret}}catch(a){throw console.error("âŒ Failed to create payment intent via backend"),console.error("   Error name:",a==null?void 0:a.name),console.error("   Error message:",a==null?void 0:a.message),console.error("   Error type:",(h=a==null?void 0:a.constructor)==null?void 0:h.name),a instanceof TypeError&&a.message.includes("fetch")&&(console.error("   âš ï¸ Network error detected - server may be down or unreachable"),console.error("   Check if backend server is running on port 3001")),(b=a==null?void 0:a.message)!=null&&b.includes("500")&&(console.error("   âš ï¸ Server 500 error detected"),console.error("   This indicates a server-side error. Check server logs for details.")),console.error("   Full error:",a),a!=null&&a.stack&&console.error("   Stack trace:",a.stack),new Error(`Failed to create payment intent: ${a.message}. Please ensure your backend server is running on port 3001.`)}}),le=({className:t="",showOnDesktop:s=!1,showOnMobile:l=!1,title:n="Custom Duties & Import Fees",message:u="International orders may be subject to customs duties, taxes, and fees imposed by your country. These charges are the responsibility of the recipient and are not included in the order total.",variant:h="yellow"})=>{const b=s&&l?"":s?"hidden lg:block":l?"lg:hidden":"",a=h==="yellow"?"bg-yellow-50":"bg-gray-100",g=h==="yellow"?"border-yellow-200":"border-gray-200",d=h==="yellow"?"text-yellow-600":"text-gray-600",y=h==="yellow"?"text-yellow-800":"text-gray-800",i=h==="yellow"?"text-yellow-700":"text-gray-500";return e.jsx("div",{className:`${b} ${t}`,children:e.jsx("div",{className:`${a} border ${g} rounded-lg p-4`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`${d} text-xl flex-shrink-0`,children:"âš ï¸"}),e.jsxs("div",{className:"flex-1 font-inter",children:[e.jsx("h3",{className:`text-sm font-semibold ${y} mb-1`,children:n}),e.jsx("p",{className:`text-xs ${i} font-light leading-relaxed font-inter`,children:u})]})]})})})},re=()=>{const{getTotalQuantity:t}=Y(),s=t();return e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between px-4 lg:px-6 py-5",children:[e.jsx(q,{to:"/",className:"hover:opacity-90 transition-opacity duration-300","aria-label":"HappyCase home",children:e.jsx("img",{src:we,alt:"The Happy Case Logo",className:"h-14 w-auto "})}),e.jsxs(q,{to:"/cart",className:"relative flex items-center justify-center p-2 text-gray-900 hover:text-gray-700 transition-colors z-10","aria-label":"Go to cart",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640",className:"w-6 h-6",fill:"currentColor",children:e.jsx("path",{d:"M8 64C3.6 64 0 67.6 0 72C0 76.4 3.6 80 8 80L53.7 80C65.1 80 75 88.1 77.2 99.4L136.6 402.8C141.7 429.1 164.8 448 191.6 448L488 448C492.4 448 496 444.4 496 440C496 435.6 492.4 432 488 432L191.5 432C172.4 432 155.9 418.5 152.2 399.7L142.9 352L461.2 352C494.7 352 523.7 328.9 531.3 296.4L566.6 145.1C572.5 120 553.4 96 527.7 96L92.8 96C89 77.4 72.7 64 53.7 64L8 64zM96 112L527.7 112C543.2 112 554.6 126.4 551.1 141.5L515.8 292.7C509.9 318 487.3 336 461.3 336L139.8 336L96 112zM176 528C176 510.3 190.3 496 208 496C225.7 496 240 510.3 240 528C240 545.7 225.7 560 208 560C190.3 560 176 545.7 176 528zM256 528C256 501.5 234.5 480 208 480C181.5 480 160 501.5 160 528C160 554.5 181.5 576 208 576C234.5 576 256 554.5 256 528zM432 496C449.7 496 464 510.3 464 528C464 545.7 449.7 560 432 560C414.3 560 400 545.7 400 528C400 510.3 414.3 496 432 496zM432 576C458.5 576 480 554.5 480 528C480 501.5 458.5 480 432 480C405.5 480 384 501.5 384 528C384 554.5 405.5 576 432 576z"})}),s>0&&e.jsx("span",{className:"absolute top-0 right-0 bg-gray-900 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-light",children:s})]})]})})},ne=()=>e.jsx("div",{className:"min-h-screen bg-white py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto p-6 bg-white border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-light font-inter",children:"Loading checkout..."})]})})})}),Ee=({customerInfo:t,onInputChange:s,isAuthenticated:l,authenticatedEmail:n,onSignIn:u,onSignOut:h})=>{const b=H(),a=()=>{b("/login?redirect=/checkout")};return e.jsxs("div",{className:"space-y-4 ",children:[e.jsx("h3",{className:"text-md uppercase tracking-wider text-gray-900 mb-4 font-bold font-inter",children:"Contact"}),l?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("label",{className:"block text-sm text-gray-500 font-light font-inter",children:"Email Address *"}),e.jsx("button",{type:"button",onClick:h,className:"text-xs text-gray-600 hover:text-gray-900 font-light font-inter underline",children:"Sign Out"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-200 rounded-sm bg-gray-50 text-gray-900 font-light font-inter text-sm",children:n}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 font-light font-inter",children:["Signed in as ",n]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("label",{className:"block text-sm text-gray-500 font-light font-inter",children:"Email Address *"}),e.jsx("button",{type:"button",onClick:a,className:"text-xs text-gray-600 hover:text-gray-900 font-light font-inter underline",children:"Sign In"})]}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:s,required:!0,placeholder:"your.email@example.com",className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-sm"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 font-light font-inter",children:"We'll send your order confirmation to this email"})]}),e.jsx("h3",{className:"text-md uppercase tracking-wider text-gray-900 mb-4 font-bold font-inter",children:"Delivery"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1.5 font-light font-inter",children:"Name *"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:s,required:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1.5 font-light font-inter",children:"Surname *"}),e.jsx("input",{type:"text",name:"surname",value:t.surname,onChange:s,required:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1.5 font-light font-inter",children:"Address Line 1 *"}),e.jsx("input",{type:"text",name:"address.line1",value:t.address.line1,onChange:s,required:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1.5 font-light font-inter",children:"Address Line 2"}),e.jsx("input",{type:"text",name:"address.line2",value:t.address.line2,onChange:s,className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1.5 font-light font-inter",children:"City *"}),e.jsx("input",{type:"text",name:"address.city",value:t.address.city,onChange:s,required:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1.5 font-light font-inter",children:"Postal Code *"}),e.jsx("input",{type:"text",name:"address.postal_code",value:t.address.postal_code,onChange:s,required:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1.5 font-light font-inter",children:"Country *"}),e.jsxs("select",{name:"address.country",value:t.address.country,onChange:s,className:"w-full px-3 py-2 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-yellow-100 focus:border-yellow-100 bg-white text-gray-900 font-light font-inter text-sm",children:[e.jsx("option",{value:"GB",children:"United Kingdom"}),e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"}),e.jsx("option",{value:"AU",children:"Australia"}),e.jsx("option",{value:"DE",children:"Germany"}),e.jsx("option",{value:"FR",children:"France"}),e.jsx("option",{value:"ES",children:"Spain"}),e.jsx("option",{value:"IT",children:"Italy"})]})]})]})]})},Pe=({paymentElementReady:t,error:s,onPaymentReady:l,onPaymentError:n})=>e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("h3",{className:"text-sm sm:text-md uppercase tracking-wider text-gray-900 mb-3 sm:mb-4 font-bold font-inter",children:"Payment"}),e.jsxs("div",{className:"p-3 sm:p-4 border border-gray-200 rounded-sm bg-gray-50",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 font-light font-inter mb-3 text-center",children:"Express Checkout"}),e.jsx("div",{className:"express-checkout-container flex flex-col space-y-2 min-h-[60px]",children:!t&&e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 font-light font-inter italic text-center py-2",children:"Express checkout options will appear here when available"})}),e.jsxs("div",{className:"relative flex items-center my-3",children:[e.jsx("div",{className:"flex-grow border-t border-gray-300"}),e.jsx("span",{className:"px-2 sm:px-3 text-xs sm:text-sm text-gray-500 font-light font-inter",children:"or"}),e.jsx("div",{className:"flex-grow border-t border-gray-300"})]})]}),e.jsxs("div",{className:"p-3 sm:p-4 border border-gray-200 rounded-sm overflow-hidden",children:[!t&&e.jsx("div",{className:"mb-2 text-xs sm:text-sm text-gray-500 font-light font-inter",children:"Loading payment form..."}),e.jsx("div",{className:"w-full flex flex-col space-y-2",children:e.jsx(pe,{options:{layout:"accordion",fields:{billingDetails:{email:"never",phone:"never",address:"never"}},wallets:{applePay:"auto",googlePay:"auto"},business:{name:"The Happy Case"}},onReady:l,onError:u=>{console.error("âŒ Payment Element error:",u),n&&n(u.message||"Failed to load payment form. Please refresh the page.")}})})]}),s&&e.jsx("div",{className:"text-red-600 text-xs sm:text-sm bg-red-50 p-2 sm:p-3 rounded-sm font-light font-inter",children:s})]}),Te=({item:t,index:s,formatPrice:l,onIncrement:n,onDecrement:u,onRemove:h,errorMessage:b})=>{const[a,g]=f.useState(!1),d=f.useRef(null);if(f.useEffect(()=>{const o=r=>{const p=r.target,O=p.tagName==="BUTTON"||p.closest("button")!==null||p.closest('[role="button"]')!==null||p.closest('[aria-label*="quantity"]')!==null,k=p.tagName==="INPUT"||p.tagName==="TEXTAREA";O||k||a&&d.current&&!d.current.contains(r.target)&&g(!1)};if(a){const r=setTimeout(()=>{document.addEventListener("mousedown",o)},200);return()=>{clearTimeout(r),document.removeEventListener("mousedown",o)}}},[a]),t.type==="charm"){const o=t.pin||t,r=t.price||0,p=t.quantity||1,O=r*p;return e.jsx("div",{className:" pb-4 ",ref:d,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"relative flex-shrink-0 w-20 h-20 bg-gray-50 rounded-sm border border-gray-200 flex items-center justify-center overflow-visible",children:[t.image?e.jsx("img",{src:W(t.image),alt:t.name||"Charm",className:"w-full h-full object-contain p-2",loading:"lazy"}):o!=null&&o.src?e.jsx("img",{src:W(o.src),alt:o.name||"Charm",className:"w-full h-full object-contain p-2",loading:"lazy"}):e.jsx("div",{className:"w-full h-full rounded-sm bg-gray-100"}),e.jsx("span",{className:"absolute -top-1.5 -right-1.5 bg-gray-900 text-white text-[10px] font-medium rounded-full h-5 w-5 flex items-center justify-center font-inter",children:p})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 font-inter leading-tight",children:t.name||(o==null?void 0:o.name)||"Charm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 font-inter",children:t.category==="bronze"?"Bronze Charm":t.category==="flags"?"Flag":"Colorful Charm"})]}),e.jsx("div",{className:"flex-shrink-0 text-right",children:e.jsx("span",{className:"text-sm font-medium text-gray-900 font-inter",children:l(O)})})]}),!a&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:k=>{k.stopPropagation(),g(!0)},className:"text-xs text-gray-600 hover:text-gray-900 font-light font-inter uppercase tracking-wider transition-colors",children:"Edit"})}),a&&n&&u&&e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 border border-gray-200 rounded-sm p-1",children:[e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation();const P=t.id!==void 0?t.id:s;console.log("âž– Charm item decrement clicked:",{identifier:P,itemId:t.id,index:s,currentQty:t.quantity,itemName:t.name,itemType:t.type,hasOnDecrement:!!u}),u&&u(P)},className:"w-6 h-6 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Decrease quantity",type:"button",children:"âˆ’"}),e.jsx("div",{className:"px-2 py-0.5 text-xs text-gray-900 font-light font-inter min-w-[1.5rem] text-center",children:p}),e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation();const P=t.id!==void 0?t.id:s;console.log("âž• Charm item increment clicked:",{identifier:P,itemId:t.id,index:s,currentQty:t.quantity,itemName:t.name,itemType:t.type,hasOnIncrement:!!n}),n&&n(P)},className:"w-6 h-6 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Increase quantity",type:"button",children:"+"})]}),h&&e.jsx("button",{onClick:()=>{h(s),g(!1)},className:"text-xs text-red-600 hover:text-red-700 font-light font-inter uppercase tracking-wider transition-colors",children:"Remove"})]}),b&&e.jsx("p",{className:"text-xs text-red-600 font-inter mt-2",children:b})]})]})},s)}const y=typeof t.basePrice=="number"?t.basePrice:typeof t.casePrice=="number"?t.casePrice:typeof t.price=="number"?t.price:8,i=t.pinsDetails&&t.pinsDetails.length?t.pinsDetails.reduce((o,r)=>o+(r.price||0),0):0,C=y+i,j=t.quantity||1,N=C*j;return e.jsx("div",{className:" pb-4 last:border-b-0",ref:d,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"relative flex-shrink-0 w-20 h-20 bg-gray-50 rounded-sm border border-gray-200 flex items-center justify-center overflow-visible",children:[t.designImage?e.jsx("img",{src:W(t.designImage),alt:"Custom Case Design",className:"w-full h-full object-contain p-2 rounded-sm",loading:"lazy"}):t.caseImage?e.jsx("img",{src:W(t.caseImage),alt:"Custom Case",className:"w-full h-full object-contain p-2 rounded-sm",loading:"lazy"}):e.jsx("div",{className:"w-full h-full rounded-sm",style:{background:t.color}}),e.jsx("span",{className:"absolute -top-1.5 -right-1.5 bg-gray-900 text-white text-[10px] font-medium rounded-full h-5 w-5 flex items-center justify-center font-inter",children:j})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 font-inter leading-tight",children:t.caseName||t.name||"Passport Case"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-inter",children:"Color:"}),e.jsx("span",{className:"inline-flex h-4 w-4 rounded-full border border-gray-300 shadow-sm",style:{backgroundColor:t.color},"aria-label":`Selected color ${t.color}`})]})]}),e.jsx("div",{className:"flex-shrink-0 text-right",children:e.jsx("span",{className:"text-sm font-medium text-gray-900 font-inter",children:l(N)})})]}),!a&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:o=>{o.stopPropagation(),g(!0)},className:"text-xs text-gray-600 hover:text-gray-900 font-light font-inter uppercase tracking-wider transition-colors",children:"Edit"})}),a&&n&&u&&e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 border border-gray-200 rounded-sm p-1",children:[e.jsx("button",{onClick:o=>{o.preventDefault(),o.stopPropagation();const r=t.id!==void 0?t.id:s;console.log("âž– Case item decrement clicked:",{identifier:r,itemId:t.id,index:s,currentQty:t.quantity,itemName:t.caseName||t.name,hasOnDecrement:!!u}),u?u(r):console.error("âŒ onDecrement handler is missing!")},className:"w-6 h-6 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Decrease quantity",type:"button",children:"âˆ’"}),e.jsx("div",{className:"px-2 py-0.5 text-xs text-gray-900 font-light font-inter min-w-[1.5rem] text-center",children:j}),e.jsx("button",{onClick:o=>{o.preventDefault(),o.stopPropagation();const r=t.id!==void 0?t.id:s;console.log("âž• Case item increment clicked:",{identifier:r,itemId:t.id,index:s,currentQty:t.quantity,itemName:t.caseName||t.name,hasOnIncrement:!!n}),n?n(r):console.error("âŒ onIncrement handler is missing!")},className:"w-6 h-6 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Increase quantity",type:"button",children:"+"})]}),h&&e.jsx("button",{onClick:()=>{h(s),g(!1)},className:"text-xs text-red-600 hover:text-red-700 font-light font-inter uppercase tracking-wider transition-colors",children:"Remove"})]}),t.pinsDetails&&t.pinsDetails.length>0&&e.jsx("div",{className:"mt-3 pt-3 ",children:e.jsx("div",{className:"flex flex-col gap-2",children:Object.values(t.pinsDetails.reduce((o,r)=>(o[r.src]=o[r.src]||R(L({},r),{quantity:0}),o[r.src].quantity++,o),{})).map((o,r)=>{const O=(o.price||0)*o.quantity;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-10 h-10 bg-gray-50 rounded-sm border border-gray-200 flex items-center justify-center overflow-visible",children:[e.jsx("img",{src:o.src,alt:o.name,className:"w-full h-full object-contain p-1",loading:"lazy"}),e.jsx("span",{className:"absolute -top-1 -right-1 bg-gray-900 text-white text-[10px] font-medium rounded-full h-4 w-4 flex items-center justify-center font-inter",children:o.quantity})]}),e.jsx("span",{className:"text-xs font-light text-gray-700 font-inter",children:o.name})]}),e.jsx("span",{className:"text-xs font-medium text-gray-900 font-inter",children:l(O)})]},r)})})})]})]})},s)},oe=({cart:t,formatPrice:s,subtotal:l,vatAmount:n,shippingCost:u,shippingLabel:h,totalWithShipping:b,showInternationalNote:a,onShowShippingInfo:g,onIncrement:d,onDecrement:y,onRemove:i,itemErrors:C})=>e.jsxs("div",{className:"flex flex-col h-full min-h-0 mt-4",children:[e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2 min-h-0 order-summary-scroll",style:{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"},children:e.jsx("div",{className:"pr-2 pb-2",children:t.length===0?e.jsx("p",{className:"text-sm text-gray-500 font-inter py-8 text-center",children:"Your cart is empty"}):e.jsx("div",{className:"space-y-0 mt-2",children:t.map((j,N)=>e.jsx(Te,{item:j,index:N,formatPrice:s,onIncrement:d,onDecrement:y,onRemove:i,errorMessage:C==null?void 0:C[j.id||N]},j.id||`item-${N}`))})})}),e.jsxs("div",{className:"flex-shrink-0 pt-6  mt-4 ",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm font-light text-gray-700 font-inter",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-medium text-gray-900 font-inter",children:s(l)})]}),n>0&&e.jsxs("div",{className:"flex justify-between text-sm font-light text-gray-700 font-inter",children:[e.jsx("span",{children:"VAT"}),e.jsx("span",{className:"font-medium text-gray-900 font-inter",children:s(n)})]}),e.jsxs("div",{className:"flex justify-between text-sm font-light text-gray-700 font-inter",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:["Shipping (",h,")",e.jsx("button",{type:"button",onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors w-4 h-4 rounded-full border border-gray-300 flex items-center justify-center text-[10px] leading-none",title:"Quick delivery information",children:"?"})]}),e.jsx("span",{className:"font-medium text-gray-900 font-inter",children:u===0?"Free":s(u)})]})]}),e.jsxs("div",{className:"flex justify-between py-4 border-t border-gray-200 mt-4 pt-4",children:[e.jsx("span",{className:"text-base font-medium text-gray-900 font-inter uppercase tracking-wider",children:"Total"}),e.jsx("span",{className:"text-xl font-semibold text-gray-900 font-inter",children:s(b)})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("p",{className:"text-xs text-gray-500 font-light font-inter leading-relaxed",children:["Shipping and taxes are calculated at checkout if applicable."," ",e.jsx(q,{to:"/shipping",className:"text-gray-600 hover:text-gray-900 underline transition-colors",title:"Learn more about shipping information",children:"Learn more"})]})}),a&&e.jsx("div",{className:"mt-4",children:e.jsx(le,{showOnDesktop:!0,showOnMobile:!1,title:"Custom Duties & Taxes Included",message:"The total amount you pay includes all applicable customs duties & taxes. We guarantee no additional charges on delivery.",variant:"gray"})})]})]}),Le=({isOpen:t,onToggle:s,cartLength:l,totalWithShipping:n,formatPrice:u,cart:h,subtotal:b,vatAmount:a,shippingCost:g,shippingLabel:d,showInternationalNote:y,onShowShippingInfo:i,onIncrement:C,onDecrement:j,onRemove:N,itemErrors:o})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"lg:hidden ",children:e.jsxs("button",{type:"button",onClick:s,className:"w-full flex items-center justify-between px-4 py-3 text-xs uppercase tracking-wider text-gray-600 hover:text-gray-900 border border-gray-200 hover:border-gray-400 transition-all duration-200 font-light font-inter","aria-expanded":t,"aria-controls":"mobile-order-summary",children:[e.jsxs("span",{children:["Order Summary (",l," item",l===1?"":"s",")"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:u(n)}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${t?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M19 9l-7 7-7-7"})})]})]})}),t&&e.jsx("div",{id:"mobile-order-summary",className:"lg:hidden  pb-4",children:e.jsx("div",{className:"mt-2 bg-yellow-50 p-4",children:e.jsx(oe,{cart:h,formatPrice:u,subtotal:b,vatAmount:a,shippingCost:g,shippingLabel:d,totalWithShipping:n,showInternationalNote:y,onShowShippingInfo:i,onIncrement:C,onDecrement:j,onRemove:N,itemErrors:o})})})]}),Ie=({isOpen:t,onClose:s})=>t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:e.jsxs("div",{className:"bg-white border border-gray-200 max-w-md w-full p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"text-sm uppercase tracking-wider text-gray-900 font-light font-inter",children:"Delivery Information"}),e.jsx("button",{type:"button",onClick:s,className:"text-gray-400 hover:text-gray-900 transition-colors font-inter","aria-label":"Close delivery information",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 font-light font-inter",children:"We dispatch orders within 2 - 3 business days. Shipping costs depend on your delivery country."}),e.jsx("p",{className:"text-xs text-gray-500 font-light font-inter",children:"Including Ireland, Europe, Asia, North America, South America, Canada, Australia and New Zealand. Shipping charges are calculated at the checkout depending on location and parcel size."}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-2 font-light font-inter font-medium",children:[e.jsxs("li",{children:[e.jsx("span",{children:"UK:"})," 3-4 business days"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium font-medium",children:"Europe:"})," 5-10 business days"]}),e.jsxs("li",{children:[e.jsx("span",{children:"USA & Canada:"})," 7-14 business days"]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Rest of World:"})," 10-21 business days"]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100",children:e.jsx("p",{className:"text-xs text-gray-500 font-light font-inter leading-relaxed",children:"Orders delivered outside of the UK may be subject to import duties and taxes. These are levied when the delivery reaches its specific destination, and you will be responsible for the payment of any such duties and taxes. For more information, please contact your local customs office."})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{to:"/shipping",className:"text-xs text-gray-500 hover:text-gray-900 underline transition-colors font-light font-inter",onClick:s,children:"View full shipping policy"})})]})}):null,ie="pk_test_51SRxFZFJzpn39buGuSe4Smdsfrnrm8S3IeVJYCra5wXLFeVBGfAdOeFGYGBfStlhZnUlzUVFvajHzioLv92EVyWn00hOlOtcU4";ie.startsWith("pk_")||console.warn('âš ï¸ Invalid Stripe publishable key format. Key should start with "pk_"');const Oe=ve(ie),Ae={GB:3,US:16,FR:7},qe={GB:"UK",US:"USA",FR:"France"},Re=12,Fe=new Set(["FR","DE","ES","IT"]),ze=.2,Ue=()=>{var ee;const t=je(),s=Ne(),l=H(),{cart:n,getTotalPrice:u,clearCart:h,incrementItemQty:b,decrementItemQty:a,removeFromCart:g}=Y(),{formatPrice:d}=ae(),[y,i]=f.useState(!1),[C,j]=f.useState(null),[N,o]=f.useState(!1),[r,p]=f.useState(!1),[O,k]=f.useState(!1),[P,A]=f.useState(!1),[Q,S]=f.useState(""),[T,B]=f.useState({}),[E,V]=f.useState({email:"",name:"",address:{line1:"",line2:"",city:"",postal_code:"",country:"GB",state:""}}),ce=f.useRef({}),M=f.useRef(!1),F=u(),U=E.address.country,_=n.length===0?0:(ee=Ae[U])!=null?ee:Re,Z=qe[U]||"International",D=Fe.has(U)?F*ze:0,J=U&&U.toUpperCase()!=="GB"&&n.length>0,$=F+D+_;f.useEffect(()=>{const c=()=>{const x=localStorage.getItem("userEmail");localStorage.getItem("isLoggedIn")==="true"&&x?(A(!0),S(x),V(w=>w.email?w:R(L({},w),{email:x}))):(A(!1),S(""))};c();const m=()=>{c()},v=x=>{(x.key==="userEmail"||x.key==="isLoggedIn")&&c()};return window.addEventListener("focus",m),window.addEventListener("storage",v),()=>{window.removeEventListener("focus",m),window.removeEventListener("storage",v)}},[]),f.useEffect(()=>{const c=ce.current;return Object.keys(T).forEach(m=>{c[m]&&clearTimeout(c[m]),c[m]=setTimeout(()=>{B(v=>{const x=L({},v);return(typeof x[m]=="string"||x[m]&&typeof x[m]=="object")&&delete x[m],x}),delete c[m]},3e3)}),()=>{Object.values(c).forEach(m=>{clearTimeout(m)})}},[T]),f.useEffect(()=>{n.length===0&&!M.current&&l("/cart")},[n,l]),f.useEffect(()=>{o(!1)},[s]);const X=c=>{var I;console.log("ðŸ”„ handleIncrementWithCheck called:",{itemId:c,cartLength:n.length,cartItems:n.map((w,z)=>({index:z,id:w.id,name:w.name||w.caseName,type:w.type}))});const m=typeof c=="string"?n.find(w=>w.id===c):typeof c=="number"&&c>=0&&c<n.length?n[c]:null;if(console.log("ðŸ“¦ Item found:",m?{name:m.name||m.caseName,id:m.id,type:m.type,quantity:m.quantity}:"NOT FOUND"),!m){console.error("âŒ Item not found for increment:",c);return}const v=ke(m,n),x=v===null||v>0;if(console.log("ðŸ“Š Inventory check:",{maxAvailable:v,canIncrement:x,currentQty:m.quantity}),x)console.log("âœ… Calling incrementItemQty with:",c),b(c),B(w=>{const z=L({},w);return delete z[c],z});else{let w="";if(m.type==="charm"){w=m.name||((I=m.pin)==null?void 0:I.name)||"Charm";const z=`Oops! We don't have any more ${w} in stock right now, so you can't add more to your basket.`;B(ue=>R(L({},ue),{[c]:z}))}else console.log("âš ï¸ Case item - incrementing anyway despite inventory check"),b(c)}},K=c=>{a(c),B(m=>{const v=L({},m);return delete v[c],v})};f.useEffect(()=>{n.length===0&&!M.current&&l("/cart")},[n,l]),f.useEffect(()=>{o(!1)},[s]);const de=c=>{const{name:m,value:v}=c.target;if(m.includes(".")){const[x,I]=m.split(".");V(w=>R(L({},w),{[x]:R(L({},w[x]),{[I]:v})}))}else V(x=>R(L({},x),{[m]:v}))},me=c=>G(void 0,null,function*(){if(c.preventDefault(),!t||!s){j("Stripe is not loaded. Please wait...");return}if(!s.getElement("payment")){j("Payment form is not ready. Please wait...");return}if(!N){j("Payment form is still loading. Please wait...");return}i(!0),j(null);try{const{error:v,paymentIntent:x}=yield t.confirmPayment({elements:s,confirmParams:{return_url:`${window.location.origin}/payment-success`,payment_method_data:{billing_details:{name:E.name,email:E.email,phone:null,address:{line1:E.address.line1,line2:E.address.line2,city:E.address.city,postal_code:E.address.postal_code,country:E.address.country,state:E.address.state}}}},redirect:"if_required"});if(v){j(v.message||"An error occurred while processing your payment."),i(!1);return}if(x&&x.status==="succeeded"){M.current=!0;const I=[...n];h(),l("/payment-success",{state:{paymentIntent:x,customerInfo:E,items:I,shippingCost:_,vatAmount:D,totalWithShipping:$,subtotal:F}})}else if(!(x&&x.status==="requires_action")){if(x){M.current=!0;const I=[...n];h(),l("/payment-success",{state:{paymentIntent:x,customerInfo:E,items:I,shippingCost:_,vatAmount:D,totalWithShipping:$,subtotal:F}})}}}catch(v){j("An error occurred while processing your payment."),console.error("Payment error:",v)}finally{i(!1)}});return e.jsxs("div",{className:"h-full w-full",children:[e.jsx(Le,{isOpen:O,onToggle:()=>k(c=>!c),cartLength:n.length,totalWithShipping:$,formatPrice:d,cart:n,subtotal:F,vatAmount:D,shippingCost:_,shippingLabel:Z,showInternationalNote:J,onShowShippingInfo:()=>p(!0),onIncrement:X,onDecrement:K,onRemove:g,itemErrors:T}),e.jsxs("div",{className:"flex flex-col lg:flex-row  w-full ",children:[e.jsxs("form",{onSubmit:me,className:"space-y-6  mt-6 lg:mt-0 lg:p-6 w-full lg:w-1/2 lg:flex-shrink-0",children:[e.jsx(Ee,{customerInfo:E,onInputChange:de,isAuthenticated:P,authenticatedEmail:Q,onSignIn:c=>{A(!0),S(c)},onSignOut:()=>{A(!1),S(""),localStorage.removeItem("userId")}}),e.jsx(Pe,{paymentElementReady:N,error:C,onPaymentReady:()=>o(!0),onPaymentError:c=>{console.error("Payment Element load error:",c),j(c)}}),e.jsx("button",{type:"submit",disabled:!t||!s||y||!N,className:"w-full py-3 text-sm uppercase tracking-wider font-light disabled:opacity-50 disabled:cursor-not-allowed font-inter bg-btn-primary hover:bg-btn-primary-hover text-btn-primary-text border border-btn-primary-border hover:border-btn-primary-hover transition-all duration-200",children:y?"Processing...":"Complete Payment"}),J&&e.jsx(le,{className:"mt-4",showOnDesktop:!1,showOnMobile:!0,title:"Custom Duties & Taxes Included",message:"The total amount you pay includes all applicable customs duties & taxes. We guarantee no additional charges on delivery.",variant:"gray"})]}),e.jsx("aside",{className:"hidden lg:flex border border-gray-200 bg-yellow-50 p-6 w-full lg:w-1/2 lg:sticky lg:top-20 mt-4 lg:mt-0 flex-col max-h-[calc(100vh-8rem)]",children:e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:e.jsx(oe,{cart:n,formatPrice:d,subtotal:F,vatAmount:D,shippingCost:_,shippingLabel:Z,totalWithShipping:$,showInternationalNote:J,onShowShippingInfo:()=>p(!0),onIncrement:X,onDecrement:K,onRemove:g,itemErrors:T})})}),e.jsx(Ie,{isOpen:r,onClose:()=>p(!1)})]}),e.jsx("div",{className:"w-full border-t border-gray-200 mt-8 pt-6 pb-6",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 lg:px-6",children:e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 md:gap-6 text-xs text-gray-600 font-light font-inter",children:[e.jsx(q,{to:"/returns",className:"hover:text-gray-900 transition-colors underline",children:"Refund Policy"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx(q,{to:"/shipping",className:"hover:text-gray-900 transition-colors underline",children:"Shipping"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx(q,{to:"/returns",className:"hover:text-gray-900 transition-colors underline",children:"Cancellations"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx(q,{to:"/about",className:"hover:text-gray-900 transition-colors underline",children:"Contact"})]})})})]})},Je=()=>{const{cart:t,getTotalPrice:s}=Y(),{currency:l,convertPrice:n}=ae(),u=H(),[h,b]=f.useState(null),[a,g]=f.useState(!0),[d,y]=f.useState(null),i=f.useRef(!1);return f.useEffect(()=>{const C=window.location.pathname;if(t.length===0&&(C==="/checkout"||C.includes("/checkout"))){u("/cart");return}if(t.length===0||i.current||h!==null)return;G(void 0,null,function*(){var N,o;try{i.current=!0,g(!0),y(null),console.log("ðŸš€ Starting payment initialization..."),console.log("ðŸ“¦ Cart details:",{itemCount:t.length,items:t.map(T=>({id:T.id,name:T.name||T.caseName,quantity:T.quantity,price:T.price||T.totalPrice}))});const r=s(),p=n(r),k={jpy:1,krw:1,vnd:1}[l.toLowerCase()]||100,P=Math.round(p*k),A=l.toLowerCase();console.log("ðŸ’³ Payment intent calculation:",{totalPriceGBP:r,totalPriceInCurrency:p,currency:A,amount:P,multiplier:k,cartLength:t.length});const Q={amount:P,currency:A,items:t,customerInfo:{}};console.log("ðŸ“¤ Sending payment intent request:",{url:"POST /api/create-payment-intent",amount:P,currency:A,itemCount:t.length,hasItems:Array.isArray(t)&&t.length>0});const S=yield Se(Q);console.log("âœ… Payment intent created successfully:",{hasClientSecret:!!(S!=null&&S.client_secret),clientSecretLength:(N=S==null?void 0:S.client_secret)==null?void 0:N.length}),console.log("Client Secret received:",S.client_secret),b({clientSecret:S.client_secret,appearance:{theme:"stripe",variables:{colorPrimary:"#3b82f6",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#ef4444",fontFamily:"system-ui, sans-serif",spacingUnit:"4px",borderRadius:"8px"}}}),console.log("âœ… Payment options initialized successfully")}catch(r){console.error("âŒ Failed to initialize payment options"),console.error("âŒ Error type:",((o=r==null?void 0:r.constructor)==null?void 0:o.name)||typeof r),console.error("âŒ Error message:",r==null?void 0:r.message),console.error("âŒ Error stack:",r==null?void 0:r.stack),console.error("âŒ Full error object:",L({name:r==null?void 0:r.name,message:r==null?void 0:r.message,cause:r==null?void 0:r.cause},(r==null?void 0:r.response)&&{response:{status:r.response.status,statusText:r.response.statusText,data:r.response.data}}));let p="Failed to initialize payment. ";r!=null&&r.message?p+=r.message:p+="Please ensure the backend server is running on port 3001.",y(p),i.current=!1}finally{g(!1),console.log("ðŸ Payment initialization completed")}})},[t.length]),a?e.jsx(ne,{}):d?e.jsxs("div",{className:"min-h-screen flex flex-col bg-white",children:[e.jsx(re,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center bg-white py-10",children:e.jsx("div",{className:"max-w-md mx-auto px-4 text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-900 mb-3",style:{fontFamily:"'Poppins', sans-serif"},children:"Payment Setup Error"}),e.jsx("p",{className:"text-red-700 mb-4 font-inter",children:d}),e.jsxs("div",{className:"text-sm text-red-600 mb-4 font-inter",children:[e.jsx("p",{className:"mb-2",children:"To fix this issue:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-left",children:[e.jsxs("li",{children:["Make sure your backend server is running: ",e.jsx("code",{className:"bg-red-100 px-1 rounded",children:"npm run server"})]}),e.jsx("li",{children:"Verify the server is running on port 3001"}),e.jsx("li",{children:"Check that the proxy is configured correctly"}),e.jsx("li",{children:"Refresh this page to retry"})]})]}),e.jsx("button",{onClick:()=>{y(null),i.current=!1,window.location.reload()},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors font-inter",children:"Retry"})]})})})]}):h?e.jsxs("div",{className:"min-h-screen flex flex-col bg-white",children:[e.jsx(re,{}),e.jsx("div",{className:"flex-1 flex items-stretch bg-white py-10",children:e.jsx("div",{className:"flex-1 max-w-6xl mx-auto px-4 lg:px-6",children:e.jsx(be,{stripe:Oe,options:h,children:e.jsx(Ue,{})})})})]}):e.jsx(ne,{})};export{Je as default};
