var S=(n,d,m)=>new Promise((v,g)=>{var b=i=>{try{u(m.next(i))}catch(f){g(f)}},p=i=>{try{u(m.throw(i))}catch(f){g(f)}},u=i=>i.done?v(i.value):Promise.resolve(i.value).then(b,p);u((m=m.apply(n,d)).next())});import{u as I,r as h,j as e,F as O}from"./react-vendor-oGZ_6Ua-.js";import{g as A}from"./index-Pwh41yKl.js";import{o as _}from"./shared-utils-BXIkjLkP.js";import{O as F}from"./OrderItem-4HG5lR_S.js";import{j as M}from"./fontawesome-vendor-DeakGBTR.js";import"./vendor-Q-ueIuah.js";import"./supabase-vendor-rHdX91gy.js";const L=A(),T="thehappycase.shop@gmail.com",R=n=>{if(!n)return"N/A";let d;if(typeof n=="string")d=new Date(n);else if(typeof n=="number")d=new Date(n*1e3);else return"N/A";return d.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},Y=()=>{const n=I(),[d,m]=h.useState([]),[v,g]=h.useState(!0),[b,p]=h.useState(""),[u,i]=h.useState(!1),[f,w]=h.useState(!1),[P,C]=h.useState(null);h.useEffect(()=>{const s=localStorage.getItem("userEmail");if(!(localStorage.getItem("isLoggedIn")==="true")||!s){n("/login?redirect=/my-orders");return}const a=s==null?void 0:s.toLowerCase().trim(),t=T.toLowerCase().trim();a===t&&w(!0),L?L.auth.getUser().then(({data:o,error:l})=>{var r,c,j;if(!l&&(o!=null&&o.user)){const N=(c=(r=o.user)==null?void 0:r.email)==null?void 0:c.toLowerCase().trim();w(N===t),(j=o.user)!=null&&j.id?(C(o.user.id),y(o.user.id,s)):y(null,s)}else y(null,s)}):y(null,s)},[n]);const y=(s=null,x=null)=>S(void 0,null,function*(){g(!0),p("");try{let a;if(s)a=_(`/get-orders?user_id=${encodeURIComponent(s)}`),console.log("ðŸ“¡ Fetching orders by user_id:",s);else if(x)a=_(`/get-orders?email=${encodeURIComponent(x)}`),console.log("ðŸ“¡ Fetching orders by email:",x);else throw new Error("No user_id or email provided");console.log("ðŸ“¡ Fetching orders from:",a);const t=yield fetch(a);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");const l=yield t.text();if(!l||l.trim()==="")throw console.error("âŒ Empty response received. Status:",t.status,t.statusText),console.error("âŒ Response headers:",Object.fromEntries(t.headers.entries())),new Error(`Server returned empty response (${t.status}). Check server logs for errors. Make sure the backend server is running on port 3001.`);let r;try{r=JSON.parse(l)}catch(c){throw console.error("âŒ Failed to parse JSON response:",c),console.error("âŒ Response status:",t.status,t.statusText),console.error("âŒ Response text (first 500 chars):",l.substring(0,500)),new Error(`Server returned invalid JSON (${t.status}): ${c.message}. Response: ${l.substring(0,200)}`)}if(!t.ok){console.error("âŒ Server error response:",{status:t.status,data:r});const c=(r==null?void 0:r.error)||(r==null?void 0:r.message)||`Server error: ${t.status} ${t.statusText}`;throw new Error(c)}r.success&&r.orders!==void 0?m(r.orders||[]):r.error?p(r.error||"Failed to load orders"):m(Array.isArray(r)?r:r.orders||[])}catch(a){console.error("Error fetching orders:",a),p(a.message||"Failed to load your orders. Please try again later.")}finally{g(!1)}}),E=()=>{localStorage.removeItem("userEmail"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userId"),n("/login")},k=localStorage.getItem("userEmail");return v?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 md:py-12",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),e.jsx("p",{className:"mt-4 text-gray-600 font-inter",children:"Loading your orders..."})]})})}):b?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 md:py-12",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 md:p-8 text-center",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",style:{fontFamily:"'Poppins', sans-serif"},children:"Error Loading Orders"}),e.jsx("p",{className:"text-gray-600 mb-6 font-inter",children:b}),e.jsx("button",{onClick:()=>y(k),className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Try Again"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 md:py-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-2",style:{fontFamily:"'Poppins', sans-serif"},children:"My Orders"}),e.jsx("p",{className:"text-gray-600 font-inter",children:k})]}),e.jsxs("div",{className:"flex items-center gap-3 self-start",children:[f&&e.jsxs("button",{onClick:()=>n("/dashboard"),className:"px-4 py-2 text-sm text-white bg-gray-900 hover:bg-gray-800 rounded-md transition-colors font-inter flex items-center gap-2",children:[e.jsx(O,{icon:M,className:"w-4 h-4"}),"Dashboard"]}),e.jsx("button",{onClick:E,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-900 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors font-inter",children:"Sign Out"})]})]})}),d.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 md:p-12 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("svg",{className:"mx-auto h-16 w-16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",style:{fontFamily:"'Poppins', sans-serif"},children:"No Orders Yet"}),e.jsx("p",{className:"text-gray-600 mb-6 font-inter",children:"You haven't placed any orders yet. Start shopping to see your orders here!"}),e.jsx("button",{onClick:()=>n("/"),className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Start Shopping"})]}):e.jsx("div",{className:"space-y-6",children:d.map(s=>{var x,a,t,o,l,r,c;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-1 font-inter",children:["Order #",s.order_id.slice(-8).toUpperCase()]}),e.jsxs("p",{className:"text-sm text-gray-600 font-inter",children:["Placed on ",R(s.order_date)]})]}),e.jsxs("div",{className:"flex flex-col sm:items-end gap-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold font-inter ${s.status==="succeeded"||s.status==="complete"?"bg-green-100 text-green-800":s.status==="processing"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:((x=s.status)==null?void 0:x.charAt(0).toUpperCase())+((a=s.status)==null?void 0:a.slice(1))})}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 font-inter",children:["Â£",parseFloat(s.total_amount).toFixed(2)]})]})]})}),e.jsxs("div",{className:"p-6",children:[s.items&&Array.isArray(s.items)&&s.items.length>0?e.jsx("div",{className:"space-y-3",children:s.items.map((j,N)=>e.jsx(F,{item:j},N))}):e.jsx("p",{className:"text-gray-600 font-inter",children:"No items found in this order."}),((t=s.metadata)==null?void 0:t.dispatched)&&(((o=s.tracking)==null?void 0:o.tracking_number)||((l=s.tracking)==null?void 0:l.tracking_link))&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 font-inter flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Tracking Information"]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3",children:[((r=s.tracking)==null?void 0:r.tracking_number)&&e.jsxs("div",{className:"text-sm font-inter",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Tracking Number:"})," ",e.jsx("span",{className:"text-gray-900 font-mono",children:s.tracking.tracking_number})]}),((c=s.tracking)==null?void 0:c.tracking_link)&&e.jsx("div",{className:"text-sm font-inter",children:e.jsxs("a",{href:s.tracking.tracking_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 hover:underline font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Track Your Package"]})})]})]}),s.shipping_address&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2 font-inter",children:"Shipping Address"}),e.jsxs("div",{className:"text-sm text-gray-600 font-inter",children:[s.customer_name&&e.jsx("p",{children:s.customer_name}),s.shipping_address.line1&&e.jsx("p",{children:s.shipping_address.line1}),s.shipping_address.line2&&e.jsx("p",{children:s.shipping_address.line2}),e.jsxs("p",{children:[s.shipping_address.city,s.shipping_address.postal_code&&` ${s.shipping_address.postal_code}`]}),s.shipping_address.country&&e.jsx("p",{children:s.shipping_address.country})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors font-inter",children:"Request Refund"})})]})]},s.order_id)})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 md:p-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",style:{fontFamily:"'Poppins', sans-serif"},children:"Refund Policy"}),e.jsx("div",{className:"w-12 h-px bg-gray-300 mb-4"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-gray-700 mt-4 mb-4 leading-relaxed font-inter",children:["If you find there is an issue with your item, please contact us at"," ",e.jsx("a",{href:"mailto:thehappycase.shop@gmail.com",className:"text-blue-600 hover:text-blue-800 underline font-inter",children:"thehappycase.shop@gmail.com"}),". Please allow us to reply in 5 working days and we will do our best to assist you."]}),e.jsx("p",{className:"text-gray-700 leading-relaxed font-inter",children:"Please note that there is no returns or refunds for customised products. We only offer returns/refunds if there has been a fault on our end. This is due to our stock being made-to-order."}),e.jsx("p",{className:"text-gray-700 mt-3 font-semibold font-inter",children:"Thanks for understanding!"})]}),e.jsx("button",{onClick:()=>i(!1),className:"w-full px-4 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition-colors font-inter",children:"Understood"})]})})]})})};export{Y as default};
