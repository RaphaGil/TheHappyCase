var B=Object.defineProperty,J=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var U=(s,t,r)=>t in s?B(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,C=(s,t)=>{for(var r in t||(t={}))A.call(t,r)&&U(s,r,t[r]);if(M)for(var r of M(t))H.call(t,r)&&U(s,r,t[r]);return s},k=(s,t)=>J(s,P(t));var N=(s,t,r)=>new Promise((o,g)=>{var m=p=>{try{c(r.next(p))}catch(x){g(x)}},u=p=>{try{c(r.throw(p))}catch(x){g(x)}},c=p=>p.done?o(p.value):Promise.resolve(p.value).then(m,u);c((r=r.apply(s,t)).next())});import{j as e,r as f}from"./react-vendor-BwkbXqKG.js";import{P as j,l as O}from"./shared-utils-DkooxM7j.js";import"./vendor-BupaDLyo.js";import"./fontawesome-vendor-BEuASCuQ.js";const K=({activeTab:s,onTabChange:t})=>e.jsxs("div",{className:"mb-6 border-b",children:[e.jsx("button",{onClick:()=>t("inventory"),className:`mr-6 pb-2 ${s==="inventory"?"border-b-2 border-black":"text-gray-400"}`,children:"Inventory"}),e.jsx("button",{onClick:()=>t("orders"),className:`pb-2 ${s==="orders"?"border-b-2 border-black":"text-gray-400"}`,children:"Orders"})]}),V=({source:s,loading:t})=>{if(t)return e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 text-blue-800 rounded-sm text-sm font-inter",children:e.jsx("span",{children:"â³ Loading inventory from Supabase..."})});if(!s)return null;const r=()=>{switch(s){case"supabase":return"bg-green-50 border border-green-200 text-green-800";case"localStorage":return"bg-yellow-50 border border-yellow-200 text-yellow-800";default:return"bg-gray-50 border border-gray-200 text-gray-800"}},o=()=>{switch(s){case"supabase":return e.jsxs("span",{children:["âœ… ",e.jsx("strong",{children:"Loaded from Supabase:"})," All saved inventory quantities are displayed. Data is persisted and will be available after deployment."]});case"localStorage":return e.jsxs("span",{children:["âš ï¸ ",e.jsx("strong",{children:"Using cached data:"})," Supabase unavailable. Showing cached quantities from localStorage."]});default:return e.jsxs("span",{children:["â„¹ï¸ ",e.jsx("strong",{children:"Using default quantities:"}),' No saved data found. Set quantities and click "Save Changes" to persist to Supabase.']})}};return e.jsx("div",{className:`mb-4 p-3 rounded-sm text-sm font-inter ${r()}`,children:o()})},_=({onRefresh:s,onSave:t,loadingInventory:r,saved:o})=>e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("button",{onClick:s,disabled:r,className:"font-inter px-4 py-2 uppercase text-xs bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50",children:r?"Refreshing...":"ðŸ”„ Refresh from Supabase"}),e.jsx("button",{onClick:t,disabled:r,className:`font-inter px-6 py-2 uppercase text-sm ${o?"bg-green-600 text-white":r?"bg-gray-400 text-white cursor-not-allowed":"bg-black text-white hover:bg-gray-800"}`,children:r?"Loading...":o?"âœ“ Saved to Supabase":"Save Changes to Supabase"})]}),z=({quantity:s,size:t="small"})=>{const r=s===0,o=s!==null&&s>0&&s<=5,g=s!==null&&s>5;if(s==null)return null;const u=t==="large"?"w-6 h-6":"w-5 h-5",c=t==="large"?"w-4 h-4":"w-3 h-3";return r?e.jsx("div",{className:`bg-red-500 text-white rounded-full ${u} flex items-center justify-center shadow-lg`,children:e.jsx("svg",{className:c,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}):o?e.jsx("div",{className:`bg-orange-500 text-white rounded-full ${u} flex items-center justify-center shadow-lg`,children:e.jsx("svg",{className:c,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}):g?e.jsx("div",{className:`bg-green-500 text-white rounded-full ${u} flex items-center justify-center shadow-lg`,children:e.jsx("svg",{className:c,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}):null},L=({quantity:s,size:t="normal"})=>{const r=s===0,o=s!==null&&s>0&&s<=5,g=s!==null&&s>5,m=s==null,u=t==="small"?"p-1.5":"p-2",c=t==="small"?"text-[10px]":"text-xs",p=t==="small"?"mt-1 w-full":"";return r?e.jsx("div",{className:`${u} bg-red-50 border border-red-200 rounded-sm ${p}`,children:e.jsx("p",{className:`${c} text-red-700 font-medium font-inter ${t==="small"?"text-center":""}`,children:"OUT OF STOCK"})}):o?e.jsx("div",{className:`${u} bg-orange-50 border border-orange-200 rounded-sm ${p}`,children:e.jsxs("p",{className:`${c} text-orange-700 font-medium font-inter ${t==="small"?"text-center":""}`,children:["LOW STOCK (",s,")"]})}):g?e.jsx("div",{className:`${u} bg-green-50 border border-green-200 rounded-sm ${p}`,children:e.jsxs("p",{className:`${c} text-green-700 font-medium font-inter ${t==="small"?"text-center":""}`,children:["IN STOCK (",s,")"]})}):m?e.jsx("div",{className:`${u} bg-gray-50 border border-gray-200 rounded-sm ${p}`,children:e.jsx("p",{className:`${c} text-gray-600 font-medium font-inter ${t==="small"?"text-center":""}`,children:"UNLIMITED"})}):null},W=({caseItem:s,index:t,onQuantityChange:r})=>{var u;const o=s.quantity!==void 0?s.quantity:null,g=o===0,m=o==null;return e.jsxs("div",{className:"mb-8 border border-gray-200 rounded-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 font-inter",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[!m&&e.jsx("div",{children:e.jsx(z,{quantity:o,size:"large"})}),g&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"SOLD OUT"})]})]}),e.jsxs("div",{className:"mb-6 pb-4 border-b border-gray-100",children:[e.jsx("label",{className:"text-sm text-gray-600 font-medium mb-2 block font-inter",children:"Overall Quantity (Optional):"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",min:"0",value:(u=s.quantity)!=null?u:"",onChange:c=>r("case",t,null,c.target.value),className:"w-24 px-3 py-2 border border-gray-300 rounded-sm text-sm focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"}),e.jsx(L,{quantity:o,size:"normal"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-4 font-inter",children:"Quantity per Color:"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.colors.map((c,p)=>{var h;const x=c.quantity!==void 0?c.quantity:null,$=x==null;return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-sm hover:border-gray-300 transition-colors relative",children:[!$&&e.jsx("div",{className:"absolute -top-1 -right-1 z-10",children:e.jsx(z,{quantity:x,size:"small"})}),e.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-gray-300 shadow-sm",style:{backgroundColor:c.color},title:c.color}),c.name&&e.jsx("span",{className:"text-xs text-gray-600 text-center font-inter",children:c.name}),e.jsxs("div",{className:"w-full flex flex-col items-center gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-inter",children:"Qty:"}),e.jsx("input",{type:"number",min:"0",value:(h=c.quantity)!=null?h:"",onChange:T=>r("case",t,null,T.target.value,p),className:"w-full px-2 py-1 border border-gray-300 rounded-sm text-xs text-center focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"})]}),e.jsx(L,{quantity:x,size:"small"})]},p)})})]})]})},G=({cases:s,onQuantityChange:t})=>e.jsxs("div",{className:"bg-white border p-6 rounded-sm",children:[e.jsx("h2",{className:"text-xl mb-6 font-inter",children:"Passport Cases"}),s.map((r,o)=>e.jsx(W,{caseItem:r,index:o,onQuantityChange:t},o))]}),I=({charm:s,index:t,category:r,onQuantityChange:o})=>{var u;const g=s.quantity!==void 0?s.quantity:null,m=g==null;return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-sm hover:border-gray-300 transition-colors relative",children:[!m&&e.jsx("div",{className:"absolute -top-1 -right-1 z-10",children:e.jsx(z,{quantity:g,size:"small"})}),s.image&&e.jsx("div",{className:"w-16 h-16 flex items-center justify-center border border-gray-200 rounded-sm bg-white",children:e.jsx("img",{src:s.image,alt:s.name,className:"max-w-full max-h-full object-contain"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-inter font-medium",children:s.name}),e.jsxs("div",{className:"w-full flex flex-col items-center gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-inter",children:"Qty:"}),e.jsx("input",{type:"number",min:"0",value:(u=s.quantity)!=null?u:"",onChange:c=>o("charm",t,r,c.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-sm text-xs text-center focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"})]}),e.jsx(L,{quantity:g,size:"small"})]})},X=({charms:s,onQuantityChange:t})=>e.jsxs("div",{className:"bg-white border p-6 rounded-sm mt-8",children:[e.jsx("h2",{className:"text-xl mb-6 font-inter",children:"Charms"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Flags"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.flags.map((r,o)=>e.jsx(I,{charm:r,index:o,category:"flags",onQuantityChange:t},o))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Colorful Charms"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.colorful.map((r,o)=>e.jsx(I,{charm:r,index:o,category:"colorful",onQuantityChange:t},o))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Bronze Charms"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.bronze.map((r,o)=>e.jsx(I,{charm:r,index:o,category:"bronze",onQuantityChange:t},o))})]})]}),Y=({products:s,inventorySource:t,loadingInventory:r,saved:o,onRefresh:g,onSave:m,onQuantityChange:u})=>e.jsxs(e.Fragment,{children:[e.jsx(V,{source:t,loading:r}),e.jsx(_,{onRefresh:g,onSave:m,loadingInventory:r,saved:o}),e.jsx(G,{cases:s.cases,onQuantityChange:u}),e.jsx(X,{charms:s.pins,onQuantityChange:u})]}),Z=({orders:s,loadingOrders:t,ordersError:r})=>e.jsxs("div",{className:"bg-white border p-6",children:[t&&e.jsx("p",{children:"Loading..."}),r&&e.jsx("p",{className:"text-red-600",children:r}),!t&&!r&&s.length===0&&e.jsx("p",{children:"No orders found."}),!t&&s.map(o=>e.jsx("div",{className:"border-b py-4",children:e.jsx("p",{children:o.customer_email})},o.id))]}),ne=()=>{const[s,t]=f.useState("inventory"),[r,o]=f.useState(j),[g,m]=f.useState(!1),[u,c]=f.useState([]),[p,x]=f.useState(!1),[$,h]=f.useState(null),[T,v]=f.useState(!0),[Q,y]=f.useState(null),w=(d,n)=>{n.cases&&(d.cases=d.cases.map((a,l)=>{var b;const i=k(C({},a),{quantity:n.cases[l]!==void 0&&n.cases[l]!==null?n.cases[l]:a.quantity});return(b=n.caseColors)!=null&&b[l]&&(i.colors=i.colors.map((S,D)=>k(C({},S),{quantity:n.caseColors[l][D]!==void 0&&n.caseColors[l][D]!==null?n.caseColors[l][D]:S.quantity}))),i})),n.pins&&["flags","colorful","bronze"].forEach(a=>{n.pins[a]&&(d.pins[a]=d.pins[a].map((l,i)=>k(C({},l),{quantity:n.pins[a][i]!==void 0&&n.pins[a][i]!==null?n.pins[a][i]:l.quantity})))})};f.useEffect(()=>{N(void 0,null,function*(){v(!0),console.log("ðŸ“¥ Dashboard: Loading inventory from Supabase...");try{const a=yield fetch(O("/api/inventory")),l=a.headers.get("content-type");if(l&&l.includes("text/html"))throw console.warn("âš ï¸ Dashboard: Received HTML response instead of JSON. Backend server may not be running or proxy not configured correctly."),console.warn("âš ï¸ Dashboard: Make sure backend server is running: npm run server"),console.warn("âš ï¸ Dashboard: Falling back to localStorage cache"),new Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");if(a.ok){const i=yield a.json();if(i.success&&i.inventory){const b={cases:i.inventory.cases,caseColors:i.inventory.caseColors,pins:i.inventory.pins};localStorage.setItem("productQuantities",JSON.stringify(b)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString());const S=structuredClone(j);w(S,b),o(S),y("supabase"),console.log("âœ… Dashboard: Inventory loaded from Supabase inventory_items table"),console.log("âœ… Dashboard: All saved quantities are now displayed"),console.log("ðŸ’¾ Dashboard: Data source: Supabase (persisted, will be available after deployment)"),v(!1);return}}else{console.warn("âš ï¸ Dashboard: Supabase API returned non-OK response:",a.status);try{const i=yield a.json();console.warn("âš ï¸ Dashboard: Error details:",i)}catch(i){console.warn("âš ï¸ Dashboard: Non-JSON error response received")}}}catch(a){console.warn("âš ï¸ Dashboard: Failed to load from Supabase:",a.message),console.warn("âš ï¸ Dashboard: Falling back to localStorage cache")}const n=localStorage.getItem("productQuantities");if(n)try{const a=JSON.parse(n),l=structuredClone(j);w(l,a),o(l),y("localStorage"),console.log("âš ï¸ Dashboard: Using cached data from localStorage (Supabase unavailable)"),v(!1);return}catch(a){console.error("âŒ Dashboard: Error parsing localStorage data:",a)}o(j),y("default"),console.log("âš ï¸ Dashboard: Using default quantities from products.json (no saved data found)"),v(!1)})},[]),f.useEffect(()=>{s==="orders"&&R()},[s]);const R=()=>N(void 0,null,function*(){x(!0),h(null);try{const n=yield(yield fetch(O("/get-orders?limit=100"))).json();n.success?c(n.orders||[]):h(n.error||"Failed to fetch orders")}catch(d){h("Failed to fetch orders.")}finally{x(!1)}}),E=(d,n,a,l,i=null)=>{const b=structuredClone(r);d==="case"&&(i!==null?b.cases[n].colors[i].quantity=parseInt(l)||0:b.cases[n].quantity=parseInt(l)||0),d==="charm"&&(b.pins[a][n].quantity=parseInt(l)||0),o(b),m(!1)},F=()=>N(void 0,null,function*(){const d={cases:r.cases.map(n=>{var a;return(a=n.quantity)!=null?a:null}),caseColors:r.cases.map(n=>{var a;return(a=n.colors)==null?void 0:a.map(l=>{var i;return(i=l.quantity)!=null?i:null})}),pins:{flags:r.pins.flags.map(n=>{var a;return(a=n.quantity)!=null?a:null}),colorful:r.pins.colorful.map(n=>{var a;return(a=n.quantity)!=null?a:null}),bronze:r.pins.bronze.map(n=>{var a;return(a=n.quantity)!=null?a:null})}};try{const n=yield fetch(O("/api/inventory"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),a=n.headers.get("content-type");if(!a||!a.includes("application/json")){const l=a!=null&&a.includes("text/html")?"Backend server returned HTML (likely 404). Make sure the backend server is running on port 3001 (npm run server) and the proxy is configured correctly.":`Server returned non-JSON response (${a}). Make sure the backend server is running on port 3001.`;throw console.error("âŒ Error saving inventory:",l),new Error(l)}if(n.ok){const l=yield n.json();if(console.log("âœ… Inventory saved to Supabase:",l),console.log(`ðŸ“Š Saved ${l.updatedCount||0} items to inventory_items table`),console.log("ðŸ’¾ All inventory data is now persisted in Supabase and will be available after deployment"),l.success&&l.updatedCount>0){console.log("âœ… Verification: Inventory successfully saved to Supabase database"),console.log("âœ… This data will persist after deployment");const i={cases:d.cases,caseColors:d.caseColors,pins:d.pins},b=structuredClone(j);w(b,i),o(b),y("supabase")}localStorage.setItem("productQuantities",JSON.stringify(d)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()),m(!0),setTimeout(()=>m(!1),3e3)}else{let l="Unknown error";try{const i=yield n.json();l=i.error||i.message||"Unknown error"}catch(i){l=`HTTP ${n.status}: ${n.statusText}`}console.error("Failed to save inventory to Supabase:",l),alert(`Failed to save to Supabase: ${l}. Falling back to localStorage.`),localStorage.setItem("productQuantities",JSON.stringify(d)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()),m(!0),setTimeout(()=>m(!1),2e3)}}catch(n){console.error("Error saving inventory to Supabase:",n);const a=n.message||"Unknown error",l=a.includes("HTML")||a.includes("404")?`Error: Backend server not reachable.

Troubleshooting steps:
1. Check if backend server is running: npm run server
2. Verify server is on port 3001
3. Restart React dev server if you just configured proxy
4. Check setupProxy.js is in src/ directory

Falling back to localStorage for now.`:`Error saving to Supabase: ${a}

Falling back to localStorage.`;alert(l),localStorage.setItem("productQuantities",JSON.stringify(d)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()),m(!0),setTimeout(()=>m(!1),2e3)}}),q=()=>N(void 0,null,function*(){v(!0),y(null);try{const d=yield fetch(O("/api/inventory"));if(d.ok){const n=yield d.json();if(n.success&&n.inventory){const a={cases:n.inventory.cases,caseColors:n.inventory.caseColors,pins:n.inventory.pins},l=structuredClone(j);w(l,a),o(l),y("supabase"),console.log("âœ… Refreshed: Inventory reloaded from Supabase")}}}catch(d){console.error("Failed to refresh from Supabase:",d)}finally{v(!1)}});return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-3xl font-light mb-6 font-inter",children:"Dashboard"}),e.jsx(K,{activeTab:s,onTabChange:t}),s==="inventory"&&e.jsx(Y,{products:r,inventorySource:Q,loadingInventory:T,saved:g,onRefresh:q,onSave:F,onQuantityChange:E}),s==="orders"&&e.jsx(Z,{orders:u,loadingOrders:p,ordersError:$})]})})};export{ne as default};
