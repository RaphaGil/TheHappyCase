var W=Object.defineProperty,M=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var B=(e,a,s)=>a in e?W(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,h=(e,a)=>{for(var s in a||(a={}))L.call(a,s)&&B(e,s,a[s]);if(S)for(var s of S(a))N.call(a,s)&&B(e,s,a[s]);return e},z=(e,a)=>M(e,A(a));var v=(e,a,s)=>new Promise((r,n)=>{var p=l=>{try{o(s.next(l))}catch(m){n(m)}},c=l=>{try{o(s.throw(l))}catch(m){n(m)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(p,c);o((s=s.apply(e,a)).next())});const Q=[{id:1,name:"Economy Case",type:"economy",images:["/images/SmartCase/economycaselightpink.webp","/images/SmartCase/economycasered.webp","/images/SmartCase/economycasejeansblue.webp","/images/SmartCase/economycasebrown.webp","/images/SmartCase/economycaselightblue.webp","/images/SmartCase/economycasedarkbrown.webp","/images/SmartCase/economycaseblack.webp","/images/SmartCase/economycaselightbrown.webp"],colors:[{color:"#f49f90",image:"/images/SmartCase/economycaselightpink.webp"},{color:"#cb0025",image:"/images/SmartCase/economycasered.webp"},{color:"#9cb4b8",image:"/images/SmartCase/economycaselightblue.webp"},{color:"#627386",image:"/images/SmartCase/economycasejeansblue.webp"},{color:"#3a4763",image:"/images/SmartCase/economycasedarkblue.webp"},{color:"#c96e50",image:"/images/SmartCase/economycaselightbrown.webp"},{color:"#b0582c",image:"/images/SmartCase/economycasebrown.webp"},{color:"#59332e",image:"/images/SmartCase/economycasedarkbrown.webp"},{color:"#506258",image:"/images/SmartCase/economycasegreen.webp"},{color:"#89837e",image:"/images/SmartCase/economycasegray.webp"},{color:"#413f44",image:"/images/SmartCase/economycaseblack.webp"}],specifications:{dimensions:"14.9cm (W) x 10.7cm (H) x 1cm (D)",rfid:"Yes",material:"PU Leather",closure:"Magnetic Snap Closure",cardSlots:"3",features:"RFID Protection, Water Resistant, Lightweight Design",interior:"Document Pocket, Boarding Pass Slot, SIM Card Slot",care:"Wipe clean with damp cloth"},basePrice:8},{id:2,name:"Business Class Case",type:"business",images:["/images/BusinessClassCase/businessclasscasegray.webp","/images/BusinessClassCase/businessclasscasepink.webp","/images/BusinessClassCase/businessclasscaselightpink.webp","/images/BusinessClassCase/businessclasscasebrown.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclassinside.webp","/images/BusinessClassCase/businessclassinside2.webp"],colors:[{color:"#c8b593",image:"/images/BusinessClassCase/businessclasscasegray.webp"},{color:"#da8ca6",image:"/images/BusinessClassCase/businessclasscaselightpink.webp"},{color:"#daaf49",image:"/images/BusinessClassCase/businessclasscaseyellow.webp"},{color:"#d33d72",image:"/images/BusinessClassCase/businessclasscasepink.webp"},{color:"#c49154",image:"/images/BusinessClassCase/businessclasscasebrown.webp"},{color:"#36312b",image:"/images/BusinessClassCase/businessclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 9.5cm (H) x 1cm (D)",rfid:"No",material:"Genuine Leather",closure:"No Closure",cardSlots:"4",interior:"Passport Pocket, Document Pocket",care:"Clean with leather conditioner, avoid excessive moisture"},basePrice:12},{id:3,name:"First Class Case",type:"firstclass",images:["/images/FirstClassCase/firstclassbrown.webp","/images/FirstClassCase/firstclasscaseblack.webp","/images/FirstClassCase/firstclasscasenavyblue.webp","/images/FirstClassCase/firstclasscasebrickred.webp","/images/FirstClassCase/firstclasscasepink.webp","/images/FirstClassCase/firstclasscasebrown.webp","/images/FirstClassCase/firstclasscaseblue.webp","/images/FirstClassCase/firstclasscasegray.webp","/images/FirstClassCase/firstclasscasepurple.webp","/images/FirstClassCase/firstclasscasegreen.webp","/images/FirstClassCase/firstclasscasedarkpink.webp"],colors:[{color:"#d17956",image:"/images/FirstClassCase/firstclasscasebrown.webp"},{color:"#c76f82",image:"/images/FirstClassCase/firstclasscasebrickred.webp"},{color:"#adcfa8",image:"/images/FirstClassCase/firstclasscasegreen.webp"},{color:"#ab8b72",image:"/images/FirstClassCase/firstclasscasedarkpink.webp"},{color:"#bfa29c",image:"/images/FirstClassCase/firstclasscasepink.webp"},{color:"#a799ab",image:"/images/FirstClassCase/firstclasscasepurple.webp"},{color:"#afab9b",image:"/images/FirstClassCase/firstclasscasegray.webp"},{color:"#5f6074",image:"/images/FirstClassCase/firstclasscasenavyblue.webp"},{color:"#768695",image:"/images/FirstClassCase/firstclasscaseblue.webp"},{color:"#cea55c",image:"/images/FirstClassCase/firstclasscaselightbrown.webp"},{color:"#272a34",image:"/images/FirstClassCase/firstclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 10.5cm (H) x 1.5cm (D)",rfid:"Yes",material:"Genuine Leather",closure:"Button Snap Closure",cardSlots:"3",interior:" Document Pocket, Boarding Pass Slot, SIM Card Slot",features:"Coin Pouch, RFID Protection, Water Resistant"},basePrice:12}],x={flags:[{id:1,name:"Albania Flag",src:"/images/Flags/albania.webp",price:2,size:.5,continent:"europe"},{id:2,name:"Armenia Flag",src:"/images/Flags/armenia.webp",price:2,size:.5,continent:"europe"},{id:3,name:"Belgium Flag",src:"/images/Flags/belgium.webp",price:2,size:.5,continent:"europe"},{id:4,name:"Bosnia  Flag",src:"/images/Flags/bosnia.webp",price:2,size:.5,continent:"europe"},{id:5,name:"Brazil Flag",src:"/images/Flags/brazil.webp",price:2,size:.5,continent:"americas"},{id:6,name:"British Virgin Islands Flag",src:"/images/Flags/britishvirginislands.webp",price:2,size:.5,continent:"americas"},{id:7,name:"Croatia Flag",src:"/images/Flags/croatia.webp",price:2,size:.5,continent:"europe"},{id:8,name:"Dublin Flag",src:"/images/Flags/dublin.webp",price:2,size:.5,continent:"europe"},{id:9,name:"Egypt Flag",src:"/images/Flags/egypt.webp",price:2,size:.5,continent:"africa"},{id:10,name:"France Flag",src:"/images/Flags/france.webp",price:2,size:.5,continent:"europe"},{id:11,name:"Germany Flag",src:"/images/Flags/germany.webp",price:2,size:.5,continent:"europe"},{id:12,name:"India Flag",src:"/images/Flags/india.webp",price:2,size:.5,continent:"asia"},{id:13,name:"Italy Flag",src:"/images/Flags/italy.webp",price:2,size:.5,continent:"europe"},{id:14,name:"Jamaica  Flag",src:"/images/Flags/jamaica.webp",price:2,size:.5,continent:"americas"},{id:15,name:"Japan  Flag",src:"/images/Flags/japan.webp",price:2,size:.5,continent:"americas"},{id:16,name:"Hungary Flag",src:"/images/Flags/hungary.webp",price:2,size:.5,continent:"americas"},{id:17,name:"LGBTQIA+ Flag",src:"/images/Flags/lgbtqia.webp",price:2,size:.5,continent:"special"},{id:18,name:"Netherlands Flag",src:"/images/Flags/netherlands.webp",price:2,size:.5,continent:"europe"},{id:19,name:"Norway Flag",src:"/images/Flags/norway.webp",price:2,size:.5,continent:"europe"},{id:20,name:"Portugal Flag",src:"/images/Flags/portugal.webp",price:2,size:.5,continent:"europe"},{id:21,name:"Puerto Rico  Flag",src:"/images/Flags/puertorico.webp",price:2,size:.5,continent:"americas"},{id:22,name:"Scotland Flag",src:"/images/Flags/scotland.webp",price:2,size:.5,continent:"europe"},{id:23,name:"South Africa Flag",src:"/images/Flags/southafrica.webp",price:2,size:.5,continent:"africa"},{id:24,name:"Spain Flag",src:"/images/Flags/spain.webp",price:2,size:.5,continent:"europe"},{id:25,name:"Sweden Flag",src:"/images/Flags/sweden.webp",price:2,size:.5,continent:"europe"},{id:26,name:"Switzerland Flag",src:"/images/Flags/switzerland.webp",price:2,size:.5,continent:"europe"},{id:27,name:"United Kingdon Flag",src:"/images/Flags/uk.webp",price:2,size:.5,continent:"europe"},{id:28,name:"United States Flag",src:"/images/Flags/eua.webp",price:2,size:.5,continent:"americas"}],colorful:[{id:1,name:"Be a Good Human",src:"/images/ColorfulPins/beagoodhuman.webp",price:2,size:.7,subCategory:"inspiration"},{id:2,name:"Airplane",src:"/images/ColorfulPins/airplane.webp",price:2,size:.75,subCategory:"travel"},{id:3,name:"Heart Globe",src:"/images/ColorfulPins/heartglobe.webp",price:2,size:.7},{id:4,name:"Dream Big",src:"/images/ColorfulPins/dreambig.webp",price:2,size:.9,subCategory:"inspiration"},{id:5,name:"Paw",src:"/images/ColorfulPins/paw.webp",price:2,size:.4},{id:6,name:"Colorful Camera",src:"/images/ColorfulPins/camera.webp",price:2,size:.55,subCategory:"camera"},{id:7,name:"Be Kind",src:"/images/ColorfulPins/bekind.webp",price:2,size:.75,subCategory:"inspiration"},{id:8,name:"Football",src:"/images/ColorfulPins/football.webp",price:2,size:.75},{id:9,name:"Ticket to Happiness",src:"/images/ColorfulPins/tickettohappiness.webp",price:2,size:.8,subCategory:"inspiration"},{id:10,name:"Be Happy",src:"/images/ColorfulPins/behappy.webp",price:2,size:.75,subCategory:"inspiration"},{id:11,name:"Lucky Leaf",src:"/images/ColorfulPins/luckyleafcharm.webp",price:2,size:.5,subCategory:"nature"},{id:12,name:"Beer",src:"/images/ColorfulPins/beer.webp",price:2,size:.65,subCategory:"drinks"},{id:13,name:"Bottle of Wine",src:"/images/ColorfulPins/bottleofwine.webp",price:2,size:.8,subCategory:"drinks"},{id:14,name:"Heart Notification",src:"/images/ColorfulPins/heartnotification.webp",price:2,size:.5,subCategory:"hearts"},{id:15,name:"Small Boarding Pass",src:"/images/ColorfulPins/smallboardingpass.webp",price:2,size:.75,subCategory:"travel"},{id:16,name:"Little Heart",src:"/images/ColorfulPins/littleheart.webp",price:2,size:.5,subCategory:"hearts"},{id:17,name:"Disney",src:"/images/ColorfulPins/disney.webp",price:2,size:.75,subCategory:"disney"},{id:18,name:"Pluto",src:"/images/ColorfulPins/pluto.webp",price:2,size:.85,subCategory:"disney"},{id:19,name:"Round Minnnie",src:"/images/ColorfulPins/roundminnie.webp",price:2,size:.85,subCategory:"disney"},{id:20,name:"Round Mickey",src:"/images/ColorfulPins/roundmickey.webp",price:2,size:.85,subCategory:"disney"},{id:21,name:"Guufy",src:"/images/ColorfulPins/guufy.webp",price:2,size:.85,subCategory:"disney"},{id:22,name:"Map",src:"/images/ColorfulPins/map.webp",price:2,size:.85,subCategory:"travel"},{id:23,name:"London Phone",src:"/images/ColorfulPins/telephone.webp",price:2,size:.85},{id:24,name:"Adventure Awaits Ticket",src:"/images/ColorfulPins/adventureawaits.webp",price:2,size:.85,subCategory:"travel"},{id:25,name:"Passport",src:"/images/ColorfulPins/passport.webp",price:2,size:.75,subCategory:"travel"},{id:26,name:"Coffee",src:"/images/ColorfulPins/coffee.webp",price:2,size:.5,subCategory:"drinks"},{id:27,name:"Coconut Tree",src:"/images/ColorfulPins/coconuttree.webp",price:2,size:.8,subCategory:"nature"},{id:28,name:"Wave",src:"/images/ColorfulPins/wave.webp",price:3.5,size:.6},{id:29,name:"Suitcase",src:"/images/ColorfulPins/orangeluggage.webp",price:2,size:.7,subCategory:"travel"},{id:30,name:"Black Camera",src:"/images/ColorfulPins/blackcamera.webp",price:2,size:.8,subCategory:"camera"},{id:31,name:"Pink Camera",src:"/images/ColorfulPins/pinkcamera.webp",price:2,size:.5,subCategory:"camera"},{id:32,name:"Daisy Duck",src:"/images/ColorfulPins/daisyduck.webp",price:2,size:.7,subCategory:"disney"},{id:33,name:"Duck",src:"/images/ColorfulPins/duck.webp",price:2,size:.75,subCategory:"disney"},{id:34,name:"Minnie",src:"/images/ColorfulPins/minnie.webp",price:2,size:.7,subCategory:"disney"},{id:35,name:"Mickey Mouse",src:"/images/ColorfulPins/mickey.webp",price:2,size:.75,subCategory:"disney"},{id:36,name:"Combi",src:"/images/ColorfulPins/combi.webp",price:2,size:.7,subCategory:"travel"},{id:37,name:"Wine",src:"/images/ColorfulPins/wineglass.webp",price:2,size:.4,subCategory:"drinks"},{id:38,name:"Vacation",src:"/images/ColorfulPins/vacation.webp",price:2,size:.8,subCategory:"travel"},{id:39,name:"Love",src:"/images/ColorfulPins/love.webp",price:2,size:.8,subCategory:"travel"}],bronze:[{id:1,name:"Airplane",src:"/images/BronzePins/airplane.webp",price:1,size:.7,subCategory:"travel"},{id:2,name:"Cardinal Points",src:"/images/BronzePins/cardinalpoints.webp",price:1,size:.65,subCategory:"symbols"},{id:3,name:"Camera",src:"/images/BronzePins/camera.webp",price:1,size:.55,subCategory:"symbols"},{id:4,name:"Globe",src:"/images/BronzePins/globe.webp",price:1,size:.55,subCategory:"travel"},{id:5,name:"Passport",src:"/images/BronzePins/passport.webp",price:1,size:.4,subCategory:"travel"},{id:6,name:"NYC Taxi",src:"/images/BronzePins/nyctaxi.webp",price:1,size:.9,subCategory:"travel"},{id:7,name:"Liberty Statue",src:"/images/BronzePins/libertystatue.webp",price:1,size:1,subCategory:"travel"},{id:8,name:"Luggage",src:"/images/BronzePins/luggage.webp",price:1,size:.45,subCategory:"travel"},{id:9,name:"London Bus",src:"/images/BronzePins/london.webp",price:1,size:.7,subCategory:"travel"},{id:10,name:"Lucky Leaf",src:"/images/BronzePins/luckyleaf.webp",price:1,size:.45,subCategory:"nature"},{id:11,name:"Little Heart",src:"/images/BronzePins/littleheart.webp",price:1,size:.25,subCategory:"love"},{id:12,name:"Eiffel Towel",src:"/images/BronzePins/eiffeltowel.webp",price:1,size:.8},{id:13,name:"Kangaroo",src:"/images/BronzePins/kangaroo.webp",price:1,size:.9,subCategory:"animals"},{id:14,name:"Koala",src:"/images/BronzePins/koala.webp",price:1,size:.5,subCategory:"animals"},{id:15,name:"Hamsa Hand",src:"/images/BronzePins/hamsahand.webp",price:1,size:.9,subCategory:"symbols"},{id:16,name:"Thailand",src:"/images/BronzePins/thailand.webp",price:1,size:.9,subCategory:"symbols"},{id:17,name:"Mummy",src:"/images/BronzePins/mummy.webp",price:1,size:.7,subCategory:"symbols"},{id:18,name:"Llama",src:"/images/BronzePins/llama.webp",price:1,size:.7,subCategory:"animals"},{id:19,name:"India",src:"/images/BronzePins/india.webp",price:1,size:.5,subCategory:"symbols"},{id:20,name:"Pyramid",src:"/images/BronzePins/pyramid.webp",price:1,size:.8},{id:21,name:"Arc The Triomphe",src:"/images/BronzePins/arcthetriomphe.webp",price:1,size:.5},{id:22,name:"Maple Leaf",src:"/images/BronzePins/mapleleaf.webp",price:1,size:.6,subCategory:"nature"},{id:23,name:"Love",src:"/images/BronzePins/love.webp",price:1,size:.8,subCategory:"love"},{id:24,name:"Airplane War",src:"/images/BronzePins/airplanewar.webp",price:1,size:.8},{id:25,name:"Enjoy the Journey",src:"/images/BronzePins/enjoythejourney.webp",price:1,size:1,subCategory:"symbols"},{id:26,name:"Heart",src:"/images/BronzePins/heart.webp",price:1,size:.7,subCategory:"love"},{id:27,name:"I love Jesus",src:"/images/BronzePins/ilovejesus.webp",price:1,size:.5,subCategory:"love"},{id:28,name:"Butterfly",src:"/images/BronzePins/butterfly.webp",price:1,size:.7,subCategory:"nature"},{id:29,name:"Squirrel",src:"/images/BronzePins/squirrel.webp",price:1,size:.5},{id:30,name:"Canada",src:"/images/BronzePins/canada.webp",price:1,size:.6,subCategory:"symbols"},{id:31,name:"Flipflop",src:"/images/BronzePins/flipflop.webp",price:1,size:.5,subCategory:"nature"},{id:32,name:"Paw",src:"/images/BronzePins/paw.webp",price:1,size:.5,subCategory:"animals"},{id:33,name:"PawDog",src:"/images/BronzePins/pawheart.webp",price:1,size:.45,subCategory:"animals"},{id:34,name:"I love my dog",src:"/images/BronzePins/ilovemydog.webp",price:1,size:.5,subCategory:"animals"},{id:35,name:"Money",src:"/images/BronzePins/money.webp",price:1,size:.55},{id:36,name:"Dog Bone",src:"/images/BronzePins/dogbone.webp",price:1,size:.5,subCategory:"animals"}]},C={cases:Q,pins:x},I=e=>{var a,s;if(e.customDesign||e.designImage)return`custom-${e.id||Date.now()}`;if(e.type==="charm"||e.category&&e.pin){const r=e.category||e.pin&&e.pin.category||"colorful",n=((a=e.pin)==null?void 0:a.name)||((s=e.pin)==null?void 0:s.src)||e.name||"";return`charm-${r}-${n}`}if(e.caseType&&e.color){if(e.pins&&e.pins.length>0){const r=e.pins.map(n=>n.name||n.src).sort().join("-");return`case-${e.caseType}-${e.color}-pins-${r}`}return`case-${e.caseType}-${e.color}`}return e.id&&e.id.startsWith("case-")?`unique-${e.id}`:e.id?`item-${e.id}`:`item-${Date.now()}`},O=(e,a)=>I(e)===I(a),H="http://localhost:3001",U=()=>H,E=e=>{const a=U(),s=e.startsWith("/")?e:`/${e}`;return a?`${a.endsWith("/")?a.slice(0,-1):a}${s}`:s};let T=!1;const j=()=>v(void 0,null,function*(){try{const e=E("/api/inventory");console.log("ðŸ”„ Fetching inventory from:",e);const a=new AbortController,s=setTimeout(()=>a.abort(),1e4);try{const r=yield fetch(e,{signal:a.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(s),r.ok){const n=yield r.json();if(n.success&&n.inventory){const p={cases:n.inventory.cases,caseColors:n.inventory.caseColors,pins:n.inventory.pins};return localStorage.setItem("productQuantities",JSON.stringify(p)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()),console.log("âœ… Inventory loaded from Supabase inventory_items table"),p}}else r.status!==404&&console.warn(`âš ï¸ Inventory API returned status ${r.status}: ${r.statusText}`)}catch(r){if(clearTimeout(s),r.name==="AbortError")console.debug("Inventory fetch timed out, using localStorage fallback");else if(r.message&&r.message.includes("Failed to fetch"))console.debug("Backend server not available, using localStorage fallback");else throw r}}catch(e){console.debug("Failed to fetch inventory from Supabase, using localStorage fallback:",e.message)}return null}),D=()=>v(void 0,null,function*(){var n,p,c,o,l,m;const e=localStorage.getItem("productQuantities"),a=localStorage.getItem("productQuantitiesTimestamp"),s=a&&Date.now()-parseInt(a)<5*60*1e3;if(e&&s)try{JSON.parse(e);return}catch(i){localStorage.removeItem("productQuantities"),localStorage.removeItem("productQuantitiesTimestamp")}if(!(yield j()))try{const i={cases:C.cases.map(u=>{var g;return(g=u.quantity)!=null?g:null}),caseColors:C.cases.map(u=>{var g;return((g=u.colors)==null?void 0:g.map(b=>{var d;return(d=b.quantity)!=null?d:null}))||[]}),pins:{flags:((p=(n=C.pins)==null?void 0:n.flags)==null?void 0:p.map(u=>{var g;return(g=u.quantity)!=null?g:null}))||[],colorful:((o=(c=C.pins)==null?void 0:c.colorful)==null?void 0:o.map(u=>{var g;return(g=u.quantity)!=null?g:null}))||[],bronze:((m=(l=C.pins)==null?void 0:l.bronze)==null?void 0:m.map(u=>{var g;return(g=u.quantity)!=null?g:null}))||[]}};(i.cases.some(u=>u!==null)||i.caseColors.some(u=>u.some(g=>g!==null))||Object.values(i.pins).some(u=>u.some(g=>g!==null)))&&(localStorage.setItem("productQuantities",JSON.stringify(i)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()))}catch(i){T||(console.error("Error initializing quantities:",i),T=!0)}}),P=(e,a)=>{var n,p;localStorage.getItem("productQuantities")||D();const s=localStorage.getItem("productQuantities");let r=null;if(s)try{r=JSON.parse(s)}catch(c){console.error("Error parsing saved quantities:",c)}if(!r)return D(),null;if(e.caseType&&e.color){const c=C.cases.find(i=>i.type===e.caseType);if(!c)return null;let o=null;if(r&&r.caseColors){const i=C.cases.findIndex(t=>t.type===e.caseType);if(i!==-1&&r.caseColors[i]){const t=c.colors.findIndex(u=>u.color===e.color);t!==-1&&r.caseColors[i][t]!==void 0&&(o=r.caseColors[i][t])}}if(o===null&&r&&r.cases){const i=C.cases.findIndex(t=>t.type===e.caseType);i!==-1&&r.cases[i]!==void 0&&(o=r.cases[i])}if(o==null)return null;const l=a.reduce((i,t)=>t.caseType===e.caseType&&t.color===e.color?i+(t.quantity||1):i,0),m=o-l;return Math.max(0,m)}if(e.type==="charm"||e.category||e.pin){const c=e.category||e.pin&&e.pin.category,o=((n=e.pin)==null?void 0:n.name)||((p=e.pin)==null?void 0:p.src)||e.name;if(!c||!o)return null;let l=null;if(C.pins&&C.pins[c]&&(l=C.pins[c].find(g=>g.name===o||g.src===o)),!l)return null;let m=null;const i=c==="flags"?"flags":c;if(r&&r.pins&&r.pins[i]){const g=C.pins[i].findIndex(b=>b.name===o||b.src===o||b.id===l.id);g!==-1&&r.pins[i][g]!==void 0&&(m=r.pins[i][g])}if(m==null)return null;const t=a.reduce((g,b)=>O(e,b)?g+(b.quantity||1):g,0),u=m-t;return Math.max(0,u)}return null},_=e=>{if(!e||e.startsWith("data:image/")||e.startsWith("data:application/")||e.startsWith("http://")||e.startsWith("https://"))return e;let a=e.replace(/^\/TheHappyCase\//,"/");return a=a.replace(/\/+/g,"/"),a.startsWith("/"),a},G=(e,a,s)=>{if(!e.current)return null;const r=a.current?a.current.visible:!0,n=s.current?s.current.visible:!0;a.current&&(a.current.visible=!1),s.current&&(s.current.visible=!1);const p=e.current.toDataURL({format:"png",quality:1,multiplier:2,backgroundColor:"white"});return a.current&&(a.current.visible=r),s.current&&(s.current.visible=n),(a.current||s.current)&&e.current.renderAll(),p},J=(e,a,s=300,r=350)=>new Promise((n,p)=>{if(!e&&!a){n(null);return}const c=document.createElement("canvas");c.width=s,c.height=r;const o=c.getContext("2d");o.fillStyle="white",o.fillRect(0,0,s,r);const l=()=>{if(!e){console.log("âš ï¸ No case image URL provided, using canvas content only"),m();return}const i=new Image;!e.startsWith("data:")&&!e.startsWith("blob:")&&(i.crossOrigin="anonymous");const t=setTimeout(()=>{console.error("â±ï¸ Timeout loading case image:",e),m()},1e4);i.onload=()=>{clearTimeout(t),console.log("âœ… Case image loaded successfully:",{width:i.width,height:i.height,src:e.substring(0,50)+"..."});const u=i.width/i.height,g=s/r;let b,d,y,f;const w=270;u>g?(d=w,b=d*u):(b=w,d=b/u),y=(s-b)/2,f=r*.45-d/2,o.drawImage(i,y,f,b,d),m()},i.onerror=u=>{clearTimeout(t),console.error("âŒ Failed to load case image:",{url:e,error:u,message:"Will continue with canvas content only"}),m()},console.log("ðŸ”„ Loading case image:",e),i.src=e},m=()=>{if(!a){console.log("âš ï¸ No canvas data URL, resolving with case image or white canvas"),n(c.toDataURL("image/png",1));return}const i=new Image,t=setTimeout(()=>{console.error("â±ï¸ Timeout loading canvas content"),n(c.toDataURL("image/png",1))},1e4);i.onload=()=>{clearTimeout(t),console.log("âœ… Canvas content loaded successfully:",{width:i.width,height:i.height});const u=i.width/i.height,g=s/r;let b,d,y,f;u>g?(b=s,d=s/u):(d=r,b=r*u),y=(s-b)/2,f=(r-d)/2,o.drawImage(i,y,f,b,d);const w=c.toDataURL("image/png",1);console.log("ðŸŽ¨ Composite image created:",{isDataURL:w.startsWith("data:image/"),length:w.length}),n(w)},i.onerror=u=>{clearTimeout(t),console.error("âŒ Failed to load canvas content:",u),n(c.toDataURL("image/png",1))},console.log("ðŸ”„ Loading canvas content..."),i.src=a};l()}),X=(e,a,s)=>{const r=G(e,a,s);if(!r)return;const n=document.createElement("a");n.download=`passport-case-design-${Date.now()}.webp`,n.href=r,document.body.appendChild(n),n.click(),document.body.removeChild(n)},Z=()=>{var a,s,r,n,p,c;const e=localStorage.getItem("productQuantities");if(!e)return C;try{const o=JSON.parse(e),l=h({},C);return o.cases&&(l.cases=l.cases.map((m,i)=>{const t=z(h({},m),{quantity:o.cases[i]!==void 0?o.cases[i]:m.quantity});return o.caseColors&&o.caseColors[i]&&(t.colors=t.colors.map((u,g)=>z(h({},u),{quantity:o.caseColors[i][g]!==void 0?o.caseColors[i][g]:u.quantity}))),t})),o.pins&&(l.pins=z(h({},l.pins),{flags:((s=(a=l.pins)==null?void 0:a.flags)==null?void 0:s.map((m,i)=>{var t;return z(h({},m),{quantity:((t=o.pins.flags)==null?void 0:t[i])!==void 0?o.pins.flags[i]:m.quantity})}))||[],colorful:((n=(r=l.pins)==null?void 0:r.colorful)==null?void 0:n.map((m,i)=>{var t;return z(h({},m),{quantity:((t=o.pins.colorful)==null?void 0:t[i])!==void 0?o.pins.colorful[i]:m.quantity})}))||[],bronze:((c=(p=l.pins)==null?void 0:p.bronze)==null?void 0:c.map((m,i)=>{var t;return z(h({},m),{quantity:((t=o.pins.bronze)==null?void 0:t[i])!==void 0?o.pins.bronze[i]:m.quantity})}))||[]})),l}catch(o){return console.error("Error loading saved quantities:",o),C}},R=(e,a,s,r,n)=>{var i;const c=P({caseType:e,color:a},s),o=(n==null?void 0:n.name)||"Passport Case",l=(i=n==null?void 0:n.colors)==null?void 0:i.find(t=>t.color===a),m=(l==null?void 0:l.color)||a||"";if(c!==null&&c===0){const t=m?` in ${m}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${o}${t} in stock right now, so you can't add more to your basket.`}}if(c!==null&&r>c){const t=m?` in ${m}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${o}${t} in stock right now, so you can't add more to your basket.`,maxAvailable:c}}return{valid:!0}},ee=(e,a,s,r)=>{for(const{pin:n}of e){const p=(n==null?void 0:n.category)||r||"colorful",c=(n==null?void 0:n.name)||"charm",l=P({type:"charm",category:p,pin:n,name:c},a);if(l!==null&&l===0)return{valid:!1,errorMessage:`Oops! We don't have any more ${c} in stock right now, so you can't add more to your basket.`};if(l!==null&&s>l)return{valid:!1,errorMessage:`Oops! We don't have any more ${c} in stock right now, so you can't add more to your basket.`}}return{valid:!0}},se=(e,a)=>v(void 0,null,function*(){let s=e;if(e&&a)try{s=yield J(e,a,300,350),(!s||!s.startsWith("data:image/"))&&(console.warn("âš ï¸ Composite image creation returned invalid result, using case image fallback"),s=e)}catch(r){console.error("âŒ Error creating composite design image:",r),s=e}else a?s=a:e&&(s=e);return(!s||typeof s=="string"&&s.trim().length===0)&&(console.error("âŒ No valid design image available, using case image fallback"),s=e||""),s}),ae=(e,a)=>e.map(({pin:s})=>{const r=s!=null&&s.category&&s.category.trim()!==""?s.category:a&&a.trim()!==""?a:"colorful";return z(h({},s),{name:(s==null?void 0:s.name)||"Charm",src:(s==null?void 0:s.src)||"",price:(s==null?void 0:s.price)||0,category:r})}),ie=({selectedCase:e,selectedCaseType:a,selectedColor:s,selectedCaseImage:r,selectedPins:n,caseBasePrice:p,quantity:c,designImage:o,normalizedCaseImage:l,pinsDetails:m,selectedCategory:i})=>{const t=Math.max(c,1),u=Date.now(),g=(e==null?void 0:e.name)||"Passport Case",b={id:`case-${u}-${Math.random().toString(36).substr(2,9)}`,name:g,caseType:a,caseName:g,color:s,basePrice:p,casePrice:p,totalPrice:p,price:p,image:o,designImage:o,caseImage:l,customDesign:!0,quantity:t},d=m.map((y,f)=>{const w=y.category||i||"colorful",F=y.name||"Charm",k=y.price||2;return{id:`charm-${u}-${f}-${Math.random().toString(36).substr(2,9)}`,name:F,price:k,totalPrice:k,image:y.src||"",pin:y,category:w,type:"charm",quantity:t}});return{caseProduct:b,charmProducts:d}},q=(e,a,s,r,n,p)=>{let c=0;return e.forEach(o=>{if(o.type==="charm"){if(o.id===n||n===void 0&&e.indexOf(o)===p)return;const i=o.pin||o,t=i.name||i.src,u=i.category||o.category||r;(t===a||t===s)&&u===r&&(c+=o.quantity||1)}}),c},$=(e,a,s,r,n,p)=>{let c=0;return e.forEach(o=>{if(o.type==="charm"||o.id===n||e.indexOf(o)===p)return;(o.pins||o.pinsDetails||[]).forEach(m=>{if(!m)return;const i=m.name||m.src,t=m.src||"",u=m.category||r;(i===a||i===s||t===a||t===s)&&u===r&&(c+=o.quantity||1)})}),c},K=(e,a,s,r)=>e.filter(n=>{const p=n.pin||n,c=p.name||p.src,o=p.category||r;return(c===a||c===s)&&o===r}).length,Y=(e,a="colorful")=>{const s=a&&a.trim()!==""?a:"colorful",r=e.name||e.src||"",n=e.src||"";return{name:r,price:e.price||2,totalPrice:e.price||2,image:n,pin:e,category:s,type:"charm"}},re=(e,a,s,r)=>{var b,d,y,f,w;const n=P(e,a),p=e.category||((b=e.pin)==null?void 0:b.category)||"colorful",c=((d=e.pin)==null?void 0:d.name)||e.name||"",o=((y=e.pin)==null?void 0:y.src)||"";if(n!==null&&n===0)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((f=e.pin)==null?void 0:f.name)||"Charm"} in stock right now, so you can't add more to your basket.`};if(n===null)return{canIncrement:!0};const l=q(a,c,o,p,s,r),m=$(a,c,o,p,s,r),i=e.quantity||1,t=n+l;return i+1+m>t?{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((w=e.pin)==null?void 0:w.name)||"Charm"} in stock right now, so you can't add more to your basket.`}:{canIncrement:!0}},ne=(e,a,s,r)=>{const n=P(e,a),p=e.pins||e.pinsDetails||[],c=e.quantity||1;if(!(n===null||n>0))return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.caseName||e.name||"Passport Case"} in stock right now, so you can't add more to your basket.`,errorType:"case"};for(const l of p){if(!l)continue;const m=l.category&&l.category.trim()!==""?l.category:"colorful",i=l.name||l.src||"",t=l.src||"",u=Y(l,m),g=P(u,a);if(g===null)continue;const b=q(a,i,t,m,s,r),d=$(a,i,t,m,s,r),y=K(p,i,t,m),f=g+b,F=b+d+y*c+y;if(g===0||F>f)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${l.name||"this charm"} in stock right now, so you can't add more to your basket.`,errorType:"charm",errorKey:`${i}-${m}`,charmProduct:u}}return{canIncrement:!0}};export{C as P,O as a,Z as b,ee as c,X as d,G as e,se as f,P as g,ie as h,re as i,ne as j,Y as k,E as l,_ as n,ae as p,R as v};
