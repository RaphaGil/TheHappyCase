var f=(s,a,t)=>new Promise((i,r)=>{var o=n=>{try{m(t.next(n))}catch(l){r(l)}},d=n=>{try{m(t.throw(n))}catch(l){r(l)}},m=n=>n.done?i(n.value):Promise.resolve(n.value).then(o,d);m((t=t.apply(s,a)).next())});import{e as b,r as h,j as e,u as y,F as p,a as j}from"./react-vendor-BwkbXqKG.js";import{l as u,n as N}from"./shared-utils-DkooxM7j.js";import{u as v,v as w,w as S}from"./fontawesome-vendor-BEuASCuQ.js";import"./vendor-BupaDLyo.js";const O=(s,a,t)=>{const[i]=b(),[r,o]=h.useState(!1),[d,m]=h.useState(!1),n=i.get("session_id");return h.useEffect(()=>{s&&(a!=null&&a.email)&&t&&t.length>0&&!d&&f(void 0,null,function*(){try{console.log("ðŸ’¾ Attempting to save order to Supabase..."),console.log("  - Payment Intent:",s==null?void 0:s.id),console.log("  - Customer Email:",a==null?void 0:a.email),console.log("  - Items:",(t==null?void 0:t.length)||0);const c=yield fetch(u("/api/save-order"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntent:s,customerInfo:a,items:t})});console.log("ðŸ“¤ Order save response status:",c.status);const x=yield c.json();console.log("ðŸ“¥ Order save response:",x),c.ok&&x.success?(console.log("âœ… Order saved to Supabase successfully:",x.order_id),m(!0)):console.error("âŒ Failed to save order:",{status:c.status,success:x.success,error:x.error||x.message,details:x.details});const g=yield(yield fetch(u("/api/send-order-confirmation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntent:s,customerInfo:a,items:t})})).json();g.success?console.log("âœ… Order confirmation email sent successfully"):console.error("âŒ Failed to send email:",g.error||g.message)}catch(c){console.error("âŒ Error processing order:",c)}})},[s,a,t,d]),h.useEffect(()=>{n&&!s&&(o(!0),fetch(u(`/session-status?session_id=${n}`)).then(l=>l.json()).then(l=>{l.status,o(!1)}).catch(l=>{console.error("Error fetching session:",l),o(!1)}))},[n,s]),{loading:r,orderSaved:d}},P=s=>s?new Date(s*1e3).toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",C=s=>!s||s.length===0?0:s.reduce((a,t)=>{const i=t.totalPrice||t.price||0,r=t.quantity||1;return a+i*r},0),A=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-inter",children:"Loading payment details..."})]})}),D=()=>{const s=y();return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",style:{fontFamily:"'Poppins', sans-serif"},children:"Invalid Access"}),e.jsx("p",{className:"text-gray-600 mb-6 font-inter",children:"This page can only be accessed after a successful payment."}),e.jsx("button",{onClick:()=>s("/"),className:"px-6 py-3 rounded-md bg-gray-900 hover:bg-gray-800 text-white transition-all duration-200 font-inter",children:"Go Home"})]})})},E=()=>e.jsxs("div",{className:"text-center mb-8 md:mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 md:w-24 md:h-24 rounded-full bg-green-100 mb-6",children:e.jsx(p,{icon:v,className:"text-green-600 text-4xl md:text-5xl"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-3",style:{fontFamily:"'Poppins', sans-serif"},children:"Payment Successful!"}),e.jsx("p",{className:"text-base md:text-lg text-gray-600 max-w-2xl mx-auto font-inter",children:"Thank you for your order. We've received your payment and will process your items shortly."})]}),F=({item:s})=>{const a=s.designImage||s.caseImage||s.image,t=s.caseName||s.name||"Custom Case",i=(s.totalPrice||s.price||0)*(s.quantity||1);return e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:e.jsxs("div",{className:"flex items-start gap-4",children:[a&&e.jsx("img",{src:N(a),alt:t,className:"w-16 h-16 md:w-20 md:h-20 object-contain rounded",loading:"lazy"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1 font-inter",children:t}),s.color&&e.jsxs("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Color: ",e.jsx("span",{className:"font-medium",children:s.color})]}),s.pinsDetails&&s.pinsDetails.length>0&&e.jsxs("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Charms: ",e.jsx("span",{className:"font-medium",children:s.pinsDetails.length})]}),s.quantity>1&&e.jsxs("p",{className:"text-sm text-gray-600 mb-1 font-inter",children:["Quantity: ",e.jsx("span",{className:"font-medium",children:s.quantity})]}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900 mt-2 font-inter",children:["Â£",i.toFixed(2)]})]})]})})},k=({orderId:s,orderDate:a,totalAmount:t,orderStatus:i,items:r})=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold mb-6 text-gray-900",style:{fontFamily:"'Poppins', sans-serif"},children:"Order Details"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium font-inter",children:"Order ID:"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm",children:s})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium font-inter",children:"Date:"}),e.jsx("span",{className:"text-gray-900 font-inter",children:P(a)})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium font-inter",children:"Amount:"}),e.jsxs("span",{className:"text-gray-900 font-semibold font-inter",children:["Â£",t.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"font-medium text-green-600 capitalize font-inter",children:"Status:"}),e.jsx("span",{className:"text-green-600 font-semibold capitalize font-inter",children:i})]})]}),r&&r.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 font-inter",children:"Items Ordered:"}),e.jsx("div",{className:"space-y-3",children:r.map((o,d)=>e.jsx(F,{item:o},d))})]})]}),R=({customerInfo:s})=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-semibold mb-6 text-gray-900",style:{fontFamily:"'Poppins', sans-serif"},children:"Shipping Information"}),s&&s.name&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Name:"}),e.jsx("p",{className:"text-gray-900 font-inter",children:s.name})]}),s.email&&e.jsxs("div",{className:"py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Email:"}),e.jsx("p",{className:"text-gray-900 font-inter",children:s.email})]}),s.address&&s.address.line1&&e.jsxs("div",{className:"py-2",children:[e.jsx("span",{className:"text-gray-600 font-medium font-inter block mb-1",children:"Address:"}),e.jsxs("p",{className:"text-gray-900 font-inter",children:[s.address.line1,s.address.line2&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),s.address.line2]}),e.jsx("br",{}),s.address.city," ",s.address.postal_code,e.jsx("br",{}),s.address.country]})]})]}),e.jsxs("div",{className:"mt-6 p-4 md:p-5 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2 font-inter",children:"What's Next?"}),e.jsx("p",{className:"text-sm md:text-base text-blue-800 mb-3 font-inter",children:"Your order will be processed within 1-2 business days. You will receive a shipping confirmation email with tracking details once your items are dispatched."}),e.jsxs("p",{className:"text-sm md:text-base text-blue-800 font-inter",children:[e.jsx("strong",{children:"Estimated delivery:"})," 3-5 business days"]})]})]}),T=()=>{const s=y();return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mt-8 md:mt-12",children:[e.jsxs("button",{onClick:()=>s("/"),className:"px-6 py-3 rounded-md font-medium inline-flex items-center justify-center bg-gray-900 hover:bg-gray-800 text-white transition-all duration-200 font-inter",children:[e.jsx(p,{icon:w,className:"mr-2"}),"Continue Shopping"]}),e.jsxs("button",{onClick:()=>window.print(),className:"px-6 py-3 rounded-md font-medium inline-flex items-center justify-center bg-white hover:bg-gray-50 text-gray-900 border border-gray-300 hover:border-gray-400 transition-all duration-200 font-inter",children:[e.jsx(p,{icon:S,className:"mr-2"}),"Print Receipt"]})]})},q=()=>e.jsx("div",{className:"mt-8 md:mt-12 text-center",children:e.jsxs("p",{className:"text-gray-600 font-inter",children:["Questions about your order? Contact us at"," ",e.jsx("a",{href:"mailto:support@thehappycase.com",className:"text-gray-900 hover:underline font-medium",children:"support@thehappycase.com"})]})}),J=()=>{const s=j(),[a]=b(),{paymentIntent:t,customerInfo:i,items:r}=s.state||{},o=a.get("session_id"),{loading:d}=O(t,i,r);if(d)return e.jsx(A,{});if(!t&&!o)return e.jsx(D,{});const m=C(r),n=(t==null?void 0:t.id)||o||"N/A",l=(t==null?void 0:t.created)||Date.now()/1e3,c=(t==null?void 0:t.status)||"succeeded";return e.jsx("div",{className:"min-h-screen bg-white py-8 md:py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx(E,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8",children:[e.jsx(k,{orderId:n,orderDate:l,totalAmount:m,orderStatus:c,items:r}),e.jsx(R,{customerInfo:i})]}),e.jsx(T,{}),e.jsx(q,{})]})})};export{J as default};
