var B=Object.defineProperty,R=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var P=(s,i,l)=>i in s?B(s,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[i]=l,I=(s,i)=>{for(var l in i||(i={}))H.call(i,l)&&P(s,l,i[l]);if(Q)for(var l of Q(i))J.call(i,l)&&P(s,l,i[l]);return s},L=(s,i)=>R(s,q(i));var _=(s,i,l)=>new Promise((o,g)=>{var h=p=>{try{x(l.next(p))}catch(y){g(y)}},u=p=>{try{x(l.throw(p))}catch(y){g(y)}},x=p=>p.done?o(p.value):Promise.resolve(p.value).then(h,u);x((l=l.apply(s,i)).next())});import{j as e,r as f}from"./react-vendor-DEB5L_3o.js";import{l as $,P as D}from"./shared-utils-DkooxM7j.js";import"./vendor-DosGu80M.js";import"./fontawesome-vendor-BEuASCuQ.js";const K=({activeTab:s,onTabChange:i})=>e.jsxs("div",{className:"mb-6 border-b",children:[e.jsx("button",{onClick:()=>i("inventory"),className:`mr-6 pb-2 ${s==="inventory"?"border-b-2 border-black":"text-gray-400"}`,children:"Inventory"}),e.jsx("button",{onClick:()=>i("orders"),className:`pb-2 ${s==="orders"?"border-b-2 border-black":"text-gray-400"}`,children:"Orders"})]}),V=({source:s,loading:i})=>{if(i)return e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 text-blue-800 rounded-sm text-sm font-inter",children:e.jsx("span",{children:"â³ Loading inventory from Supabase..."})});if(!s)return null;const l=()=>{switch(s){case"supabase":return"bg-green-50 border border-green-200 text-green-800";case"localStorage":return"bg-yellow-50 border border-yellow-200 text-yellow-800";default:return"bg-gray-50 border border-gray-200 text-gray-800"}},o=()=>{switch(s){case"supabase":return e.jsxs("span",{children:["âœ… ",e.jsx("strong",{children:"Loaded from Supabase:"})," All saved inventory quantities are displayed. Data is persisted and will be available after deployment."]});case"localStorage":return e.jsxs("span",{children:["âš ï¸ ",e.jsx("strong",{children:"Using cached data:"})," Supabase unavailable. Showing cached quantities from localStorage."]});default:return e.jsxs("span",{children:["â„¹ï¸ ",e.jsx("strong",{children:"Using default quantities:"}),' No saved data found. Set quantities and click "Save Changes" to persist to Supabase.']})}};return e.jsx("div",{className:`mb-4 p-3 rounded-sm text-sm font-inter ${l()}`,children:o()})},W=({onRefresh:s,onSave:i,loadingInventory:l,saved:o})=>e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("button",{onClick:s,disabled:l,className:"font-inter px-4 py-2 uppercase text-xs bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50",children:l?"Refreshing...":"ðŸ”„ Refresh from Supabase"}),e.jsx("button",{onClick:i,disabled:l,className:`font-inter px-6 py-2 uppercase text-sm ${o?"bg-green-600 text-white":l?"bg-gray-400 text-white cursor-not-allowed":"bg-black text-white hover:bg-gray-800"}`,children:l?"Loading...":o?"âœ“ Saved to Supabase":"Save Changes to Supabase"})]}),A=({quantity:s,size:i="small"})=>{const l=s===0,o=s!==null&&s>0&&s<=5,g=s!==null&&s>5;if(s==null)return null;const u=i==="large"?"w-6 h-6":"w-5 h-5",x=i==="large"?"w-4 h-4":"w-3 h-3";return l?e.jsx("div",{className:`bg-red-500 text-white rounded-full ${u} flex items-center justify-center shadow-lg`,children:e.jsx("svg",{className:x,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}):o?e.jsx("div",{className:`bg-orange-500 text-white rounded-full ${u} flex items-center justify-center shadow-lg`,children:e.jsx("svg",{className:x,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}):g?e.jsx("div",{className:`bg-green-500 text-white rounded-full ${u} flex items-center justify-center shadow-lg`,children:e.jsx("svg",{className:x,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}):null},F=({quantity:s,size:i="normal"})=>{const l=s===0,o=s!==null&&s>0&&s<=5,g=s!==null&&s>5,h=s==null,u=i==="small"?"p-1.5":"p-2",x=i==="small"?"text-[10px]":"text-xs",p=i==="small"?"mt-1 w-full":"";return l?e.jsx("div",{className:`${u} bg-red-50 border border-red-200 rounded-sm ${p}`,children:e.jsx("p",{className:`${x} text-red-700 font-medium font-inter ${i==="small"?"text-center":""}`,children:"OUT OF STOCK"})}):o?e.jsx("div",{className:`${u} bg-orange-50 border border-orange-200 rounded-sm ${p}`,children:e.jsxs("p",{className:`${x} text-orange-700 font-medium font-inter ${i==="small"?"text-center":""}`,children:["LOW STOCK (",s,")"]})}):g?e.jsx("div",{className:`${u} bg-green-50 border border-green-200 rounded-sm ${p}`,children:e.jsxs("p",{className:`${x} text-green-700 font-medium font-inter ${i==="small"?"text-center":""}`,children:["IN STOCK (",s,")"]})}):h?e.jsx("div",{className:`${u} bg-gray-50 border border-gray-200 rounded-sm ${p}`,children:e.jsx("p",{className:`${x} text-gray-600 font-medium font-inter ${i==="small"?"text-center":""}`,children:"UNLIMITED"})}):null},Y=({caseItem:s,index:i,onQuantityChange:l})=>{var u;const o=s.quantity!==void 0?s.quantity:null,g=o===0,h=o==null;return e.jsxs("div",{className:"mb-8 border border-gray-200 rounded-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 font-inter",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[!h&&e.jsx("div",{children:e.jsx(A,{quantity:o,size:"large"})}),g&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"SOLD OUT"})]})]}),e.jsxs("div",{className:"mb-6 pb-4 border-b border-gray-100",children:[e.jsx("label",{className:"text-sm text-gray-600 font-medium mb-2 block font-inter",children:"Overall Quantity (Optional):"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",min:"0",value:(u=s.quantity)!=null?u:"",onChange:x=>l("case",i,null,x.target.value),className:"w-24 px-3 py-2 border border-gray-300 rounded-sm text-sm focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"}),e.jsx(F,{quantity:o,size:"normal"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-4 font-inter",children:"Quantity per Color:"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.colors.map((x,p)=>{var j;const y=x.quantity!==void 0?x.quantity:null,C=y==null;return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-sm hover:border-gray-300 transition-colors relative",children:[!C&&e.jsx("div",{className:"absolute -top-1 -right-1 z-10",children:e.jsx(A,{quantity:y,size:"small"})}),e.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-gray-300 shadow-sm",style:{backgroundColor:x.color},title:x.color}),x.name&&e.jsx("span",{className:"text-xs text-gray-600 text-center font-inter",children:x.name}),e.jsxs("div",{className:"w-full flex flex-col items-center gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-inter",children:"Qty:"}),e.jsx("input",{type:"number",min:"0",value:(j=x.quantity)!=null?j:"",onChange:k=>l("case",i,null,k.target.value,p),className:"w-full px-2 py-1 border border-gray-300 rounded-sm text-xs text-center focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"})]}),e.jsx(F,{quantity:y,size:"small"})]},p)})})]})]})},G=({cases:s,onQuantityChange:i})=>e.jsxs("div",{className:"bg-white border p-6 rounded-sm",children:[e.jsx("h2",{className:"text-xl mb-6 font-inter",children:"Passport Cases"}),s.map((l,o)=>e.jsx(Y,{caseItem:l,index:o,onQuantityChange:i},o))]}),U=({charm:s,index:i,category:l,onQuantityChange:o})=>{var u;const g=s.quantity!==void 0?s.quantity:null,h=g==null;return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-sm hover:border-gray-300 transition-colors relative",children:[!h&&e.jsx("div",{className:"absolute -top-1 -right-1 z-10",children:e.jsx(A,{quantity:g,size:"small"})}),s.image&&e.jsx("div",{className:"w-16 h-16 flex items-center justify-center border border-gray-200 rounded-sm bg-white",children:e.jsx("img",{src:s.image,alt:s.name,className:"max-w-full max-h-full object-contain"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-inter font-medium",children:s.name}),e.jsxs("div",{className:"w-full flex flex-col items-center gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-inter",children:"Qty:"}),e.jsx("input",{type:"number",min:"0",value:(u=s.quantity)!=null?u:"",onChange:x=>o("charm",i,l,x.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-sm text-xs text-center focus:outline-none focus:border-gray-400 font-inter",placeholder:"0"})]}),e.jsx(F,{quantity:g,size:"small"})]})},X=({charms:s,onQuantityChange:i})=>e.jsxs("div",{className:"bg-white border p-6 rounded-sm mt-8",children:[e.jsx("h2",{className:"text-xl mb-6 font-inter",children:"Charms"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Flags"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.flags.map((l,o)=>e.jsx(U,{charm:l,index:o,category:"flags",onQuantityChange:i},o))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Colorful Charms"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.colorful.map((l,o)=>e.jsx(U,{charm:l,index:o,category:"colorful",onQuantityChange:i},o))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4 font-inter",children:"Bronze Charms"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.bronze.map((l,o)=>e.jsx(U,{charm:l,index:o,category:"bronze",onQuantityChange:i},o))})]})]}),Z=({products:s,inventorySource:i,loadingInventory:l,saved:o,onRefresh:g,onSave:h,onQuantityChange:u})=>e.jsxs(e.Fragment,{children:[e.jsx(V,{source:i,loading:l}),e.jsx(W,{onRefresh:g,onSave:h,loadingInventory:l,saved:o}),e.jsx(G,{cases:s.cases,onQuantityChange:u}),e.jsx(X,{charms:s.pins,onQuantityChange:u})]}),ee=({orders:s,loadingOrders:i,ordersError:l,onRefresh:o})=>{var M,E;const[g,h]=f.useState(null),[u,x]=f.useState("all"),[p,y]=f.useState(new Set),C=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",j=(r,c="gbp")=>!r&&r!==0?"N/A":new Intl.NumberFormat("en-GB",{style:"currency",currency:c.toUpperCase()}).format(r),k=r=>{h(g===r?null:r)},S=(r,c)=>_(void 0,null,function*(){const a=!c;y(t=>new Set(t).add(r));try{const t=$(`/api/orders/${r}/dispatched`);console.log("Updating dispatched status:",{orderId:r,dispatched:a,apiUrl:t});const n=yield fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({dispatched:a})}),m=n.headers.get("content-type");if(m&&m.includes("text/html"))throw new Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");if(!n.ok){let N="Failed to update dispatched status";try{const b=yield n.json();N=b.message||b.error||N}catch(b){N=`HTTP ${n.status}: ${n.statusText}`}throw new Error(N)}const d=yield n.json();console.log("âœ… Dispatched status updated:",d),o&&o()}catch(t){console.error("Error updating dispatched status:",t);const n=t.message||"Failed to update dispatched status. Make sure the backend server is running.";alert(`Failed to update dispatched status: ${n}`)}finally{y(t=>{const n=new Set(t);return n.delete(r),n})}}),O=r=>{var c;return((c=r.metadata)==null?void 0:c.dispatched)===!0},w=f.useMemo(()=>{if(!s||s.length===0)return[];const r=new Map;return s.forEach(c=>{if(c.order_date){const a=new Date(c.order_date),t=a.getFullYear(),n=a.getMonth(),m=`${t}-${String(n+1).padStart(2,"0")}`,d=a.toLocaleDateString("en-US",{year:"numeric",month:"long"});r.has(m)||r.set(m,{key:m,label:d,year:t,month:n})}}),Array.from(r.values()).sort((c,a)=>c.year!==a.year?a.year-c.year:a.month-c.month)},[s]),v=f.useMemo(()=>{if(u==="all")return s;const[r,c]=u.split("-").map(Number);return s.filter(a=>{if(!a.order_date)return!1;const t=new Date(a.order_date);return t.getFullYear()===r&&t.getMonth()===c-1})},[s,u]),T=f.useMemo(()=>v.reduce((r,c)=>r+(c.total_amount||0),0),[v]);return i?e.jsxs("div",{className:"bg-white border rounded-lg p-8 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading orders..."})]}):l?e.jsx("div",{className:"bg-white border rounded-lg p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-4",children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Error loading orders"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l}),o&&e.jsx("button",{onClick:o,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Retry"})]})}):!s||s.length===0?e.jsxs("div",{className:"bg-white border rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"No orders found."}),o&&e.jsx("button",{onClick:o,className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800",children:"Refresh"})]}):v.length===0&&u!=="all"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white border rounded-lg p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Orders"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," total order(s) â€¢ ",v.length," in selected period"]})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("select",{value:u,onChange:r=>x(r.target.value),className:"px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Orders"}),w.map(r=>e.jsx("option",{value:r.key,children:r.label},r.key))]}),o&&e.jsx("button",{onClick:o,className:"px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 text-sm",children:"Refresh"})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"No orders found for the selected period."}),e.jsx("button",{onClick:()=>x("all"),className:"mt-4 px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 text-sm",children:"Show All Orders"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white border rounded-lg p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Orders"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[u==="all"?e.jsxs("span",{children:[v.length," order(s) found"]}):e.jsxs("span",{children:[v.length," order(s) in ",((M=w.find(r=>r.key===u))==null?void 0:M.label)||"selected period",T>0&&v.length>0&&e.jsxs("span",{className:"ml-2 font-medium",children:["â€¢ Total: ",j(T,((E=v[0])==null?void 0:E.currency)||"gbp")]})]}),u!=="all"&&e.jsxs("span",{className:"text-gray-400 ml-2",children:["(of ",s.length," total)"]})]})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("select",{value:u,onChange:r=>x(r.target.value),className:"px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm bg-white",children:[e.jsx("option",{value:"all",children:"All Orders"}),w.map(r=>e.jsx("option",{value:r.key,children:r.label},r.key))]}),o&&e.jsx("button",{onClick:o,className:"px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 text-sm",children:"Refresh"})]})]}),v.map(r=>{var n,m;const c=g===r.order_id,a=r.items||[],t=r.shipping_address||{};return e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>k(r.order_id),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Order #",(n=r.order_id)==null?void 0:n.substring(0,20),"..."]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${r.status==="succeeded"?"bg-green-100 text-green-800":r.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.status||"unknown"}),O(r)&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 text-blue-800 flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Dispatched"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Customer:"})," ",r.customer_name||r.customer_email]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",C(r.order_date)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," ",j(r.total_amount,r.currency)]})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[a.length," item(s) â€¢ ",r.customer_email]})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",onClick:d=>{d.stopPropagation(),S(r.order_id,O(r))},children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:O(r),onChange:()=>{},disabled:p.has(r.order_id),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 cursor-pointer disabled:opacity-50"}),e.jsx("span",{className:"text-sm text-gray-600",children:p.has(r.order_id)?"Updating...":"Dispatched"})]})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>k(r.order_id),children:e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${c?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),c&&e.jsxs("div",{className:"border-t bg-gray-50 p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-900",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Name:"})," ",r.customer_name||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Email:"})," ",e.jsx("a",{href:`mailto:${r.customer_email}`,className:"text-blue-600 hover:underline",children:r.customer_email})]}),r.customer_phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Phone:"})," ",e.jsx("a",{href:`tel:${r.customer_phone}`,className:"text-blue-600 hover:underline",children:r.customer_phone})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-900",children:"Shipping Address"}),t.line1?e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("div",{children:t.line1}),t.line2&&e.jsx("div",{children:t.line2}),e.jsxs("div",{children:[t.city,t.state&&`, ${t.state}`]}),e.jsxs("div",{children:[t.postal_code," ",t.country]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"No shipping address provided"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-900",children:"Order Items"}),e.jsx("div",{className:"space-y-4",children:a.map((d,N)=>e.jsxs("div",{className:"bg-white border rounded p-4 flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:d.design_image?e.jsx("img",{src:d.design_image,alt:d.name||"Custom design",className:"w-24 h-24 object-cover rounded border",onError:b=>{d.case_image&&b.target.src!==d.case_image?b.target.src=d.case_image:b.target.style.display="none"}}):d.case_image?e.jsx("img",{src:d.case_image,alt:d.name||"Case",className:"w-24 h-24 object-cover rounded border",onError:b=>{b.target.style.display="none"}}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded border flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:"No image"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:d.name||"Custom Case"}),e.jsxs("div",{className:"mt-1 space-y-1 text-sm text-gray-600",children:[d.case_type&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",d.case_type]}),d.color&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Color:"})," ",d.color]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",d.quantity||1]}),d.pins&&d.pins.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pins:"})," ",d.pins.map((b,z)=>e.jsxs("span",{children:[b.name||b,z<d.pins.length-1?", ":""]},z))]}),d.custom_design&&e.jsx("span",{className:"inline-block px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded mt-1",children:"Custom Design"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:j(d.total_price||d.unit_price||0,r.currency)}),d.quantity>1&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[j(d.unit_price||0,r.currency)," each"]})]})]},N))})]}),e.jsx("div",{className:"mt-6 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Payment Intent:"})," ",e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:r.payment_intent_id||"N/A"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"font-medium",children:"Order ID:"})," ",e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:r.order_id})]}),O(r)&&((m=r.metadata)==null?void 0:m.dispatched_at)&&e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"font-medium",children:"Dispatched:"})," ",e.jsx("span",{className:"text-blue-600",children:C(r.metadata.dispatched_at)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:j(r.total_amount,r.currency)})]})]})})]})]},r.order_id)})]})},le=()=>{const[s,i]=f.useState("inventory"),[l,o]=f.useState(D),[g,h]=f.useState(!1),[u,x]=f.useState([]),[p,y]=f.useState(!1),[C,j]=f.useState(null),[k,S]=f.useState(!0),[O,w]=f.useState(null),v=(c,a)=>{a.cases&&(c.cases=c.cases.map((t,n)=>{var d;const m=L(I({},t),{quantity:a.cases[n]!==void 0&&a.cases[n]!==null?a.cases[n]:t.quantity});return(d=a.caseColors)!=null&&d[n]&&(m.colors=m.colors.map((N,b)=>L(I({},N),{quantity:a.caseColors[n][b]!==void 0&&a.caseColors[n][b]!==null?a.caseColors[n][b]:N.quantity}))),m})),a.pins&&["flags","colorful","bronze"].forEach(t=>{a.pins[t]&&(c.pins[t]=c.pins[t].map((n,m)=>L(I({},n),{quantity:a.pins[t][m]!==void 0&&a.pins[t][m]!==null?a.pins[t][m]:n.quantity})))})};f.useEffect(()=>{_(void 0,null,function*(){S(!0),console.log("ðŸ“¥ Dashboard: Loading inventory from Supabase...");try{const t=yield fetch($("/api/inventory")),n=t.headers.get("content-type");if(n&&n.includes("text/html"))throw console.warn("âš ï¸ Dashboard: Received HTML response instead of JSON. Backend server may not be running or proxy not configured correctly."),console.warn("âš ï¸ Dashboard: Make sure backend server is running: npm run server"),console.warn("âš ï¸ Dashboard: Falling back to localStorage cache"),new Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");if(t.ok){const m=yield t.json();if(m.success&&m.inventory){const d={cases:m.inventory.cases,caseColors:m.inventory.caseColors,pins:m.inventory.pins};localStorage.setItem("productQuantities",JSON.stringify(d)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString());const N=structuredClone(D);v(N,d),o(N),w("supabase"),console.log("âœ… Dashboard: Inventory loaded from Supabase inventory_items table"),console.log("âœ… Dashboard: All saved quantities are now displayed"),console.log("ðŸ’¾ Dashboard: Data source: Supabase (persisted, will be available after deployment)"),S(!1);return}}else{console.warn("âš ï¸ Dashboard: Supabase API returned non-OK response:",t.status);try{const m=yield t.json();console.warn("âš ï¸ Dashboard: Error details:",m)}catch(m){console.warn("âš ï¸ Dashboard: Non-JSON error response received")}}}catch(t){console.warn("âš ï¸ Dashboard: Failed to load from Supabase:",t.message),console.warn("âš ï¸ Dashboard: Falling back to localStorage cache")}const a=localStorage.getItem("productQuantities");if(a)try{const t=JSON.parse(a),n=structuredClone(D);v(n,t),o(n),w("localStorage"),console.log("âš ï¸ Dashboard: Using cached data from localStorage (Supabase unavailable)"),S(!1);return}catch(t){console.error("âŒ Dashboard: Error parsing localStorage data:",t)}o(D),w("default"),console.log("âš ï¸ Dashboard: Using default quantities from products.json (no saved data found)"),S(!1)})},[]),f.useEffect(()=>{s==="orders"&&T()},[s]);const T=()=>_(void 0,null,function*(){var c;y(!0),j(null);try{const a=yield fetch($("/get-orders?limit=100")),t=a.headers.get("content-type");if(t&&t.includes("text/html"))throw new Error("Backend server returned HTML (likely 404). Is the server running on port 3001?");const n=yield a.json();n.success?(x(n.orders||[]),console.log(`âœ… Loaded ${((c=n.orders)==null?void 0:c.length)||0} orders from Supabase`)):j(n.error||"Failed to fetch orders")}catch(a){console.error("Error fetching orders:",a),j(a.message||"Failed to fetch orders. Make sure the backend server is running.")}finally{y(!1)}}),M=(c,a,t,n,m=null)=>{const d=structuredClone(l);c==="case"&&(m!==null?d.cases[a].colors[m].quantity=parseInt(n)||0:d.cases[a].quantity=parseInt(n)||0),c==="charm"&&(d.pins[t][a].quantity=parseInt(n)||0),o(d),h(!1)},E=()=>_(void 0,null,function*(){const c={cases:l.cases.map(a=>{var t;return(t=a.quantity)!=null?t:null}),caseColors:l.cases.map(a=>{var t;return(t=a.colors)==null?void 0:t.map(n=>{var m;return(m=n.quantity)!=null?m:null})}),pins:{flags:l.pins.flags.map(a=>{var t;return(t=a.quantity)!=null?t:null}),colorful:l.pins.colorful.map(a=>{var t;return(t=a.quantity)!=null?t:null}),bronze:l.pins.bronze.map(a=>{var t;return(t=a.quantity)!=null?t:null})}};try{const a=yield fetch($("/api/inventory"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),t=a.headers.get("content-type");if(!t||!t.includes("application/json")){const n=t!=null&&t.includes("text/html")?"Backend server returned HTML (likely 404). Make sure the backend server is running on port 3001 (npm run server) and the proxy is configured correctly.":`Server returned non-JSON response (${t}). Make sure the backend server is running on port 3001.`;throw console.error("âŒ Error saving inventory:",n),new Error(n)}if(a.ok){const n=yield a.json();if(console.log("âœ… Inventory saved to Supabase:",n),console.log(`ðŸ“Š Saved ${n.updatedCount||0} items to inventory_items table`),console.log("ðŸ’¾ All inventory data is now persisted in Supabase and will be available after deployment"),n.success&&n.updatedCount>0){console.log("âœ… Verification: Inventory successfully saved to Supabase database"),console.log("âœ… This data will persist after deployment");const m={cases:c.cases,caseColors:c.caseColors,pins:c.pins},d=structuredClone(D);v(d,m),o(d),w("supabase")}localStorage.setItem("productQuantities",JSON.stringify(c)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()),h(!0),setTimeout(()=>h(!1),3e3)}else{let n="Unknown error";try{const m=yield a.json();n=m.error||m.message||"Unknown error"}catch(m){n=`HTTP ${a.status}: ${a.statusText}`}console.error("Failed to save inventory to Supabase:",n),alert(`Failed to save to Supabase: ${n}. Falling back to localStorage.`),localStorage.setItem("productQuantities",JSON.stringify(c)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()),h(!0),setTimeout(()=>h(!1),2e3)}}catch(a){console.error("Error saving inventory to Supabase:",a);const t=a.message||"Unknown error",n=t.includes("HTML")||t.includes("404")?`Error: Backend server not reachable.

Troubleshooting steps:
1. Check if backend server is running: npm run server
2. Verify server is on port 3001
3. Restart React dev server if you just configured proxy
4. Check setupProxy.js is in src/ directory

Falling back to localStorage for now.`:`Error saving to Supabase: ${t}

Falling back to localStorage.`;alert(n),localStorage.setItem("productQuantities",JSON.stringify(c)),localStorage.setItem("productQuantitiesTimestamp",Date.now().toString()),h(!0),setTimeout(()=>h(!1),2e3)}}),r=()=>_(void 0,null,function*(){S(!0),w(null);try{const c=yield fetch($("/api/inventory"));if(c.ok){const a=yield c.json();if(a.success&&a.inventory){const t={cases:a.inventory.cases,caseColors:a.inventory.caseColors,pins:a.inventory.pins},n=structuredClone(D);v(n,t),o(n),w("supabase"),console.log("âœ… Refreshed: Inventory reloaded from Supabase")}}}catch(c){console.error("Failed to refresh from Supabase:",c)}finally{S(!1)}});return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-3xl font-light mb-6 font-inter",children:"Dashboard"}),e.jsx(K,{activeTab:s,onTabChange:i}),s==="inventory"&&e.jsx(Z,{products:l,inventorySource:O,loadingInventory:k,saved:g,onRefresh:r,onSave:E,onQuantityChange:M}),s==="orders"&&e.jsx(ee,{orders:u,loadingOrders:p,ordersError:C,onRefresh:T})]})})};export{le as default};
