var v=(h,p,o)=>new Promise((l,b)=>{var m=i=>{try{d(o.next(i))}catch(c){b(c)}},y=i=>{try{d(o.throw(i))}catch(c){b(c)}},d=i=>i.done?l(i.value):Promise.resolve(i.value).then(m,y);d((o=o.apply(h,p)).next())});import{u as O,e as R,r as f,j as e}from"./react-vendor-oGZ_6Ua-.js";import{g as L}from"./index-CpP7Ajis.js";import"./vendor-Q-ueIuah.js";import"./fontawesome-vendor-DeakGBTR.js";import"./shared-utils-BOp1Mq5I.js";import"./supabase-vendor-rHdX91gy.js";const x=L(),A=()=>{const h=O(),[p]=R(),o=p.get("email")||"",[l,b]=f.useState(o),[m,y]=f.useState(""),[d,i]=f.useState(o?"code":"email"),[c,a]=f.useState(!1),[w,t]=f.useState(""),[E,g]=f.useState(!1);f.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"});const n=localStorage.getItem("userEmail");if(localStorage.getItem("isLoggedIn")==="true"&&n){const r=p.get("redirect")||"/my-orders";h(r,{replace:!0});return}o&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)&&N(o)},[h,p,o]);const N=n=>v(void 0,null,function*(){a(!0),t("");try{if(!x)throw new Error("Supabase is not configured. Please check your environment variables.");const{data:s,error:r}=yield x.auth.signInWithOtp({email:n,options:{emailRedirectTo:null}});if(r){console.error("❌ Error sending OTP:",r),t(r.message||"Failed to send verification code. Please try again."),a(!1);return}console.log("✅ OTP sent successfully:",s),a(!1),i("code"),g(!0),setTimeout(()=>g(!1),3e3)}catch(s){console.error("❌ Exception sending OTP:",s),a(!1),t(s.message||"Failed to send verification code. Please try again.")}}),j=n=>v(void 0,null,function*(){if(n.preventDefault(),!l){t("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)){t("Please enter a valid email address");return}a(!0),t(""),g(!1);try{if(!x)throw new Error("Supabase is not configured. Please check your environment variables.");const{data:r,error:u}=yield x.auth.signInWithOtp({email:l.trim(),options:{emailRedirectTo:null}});if(u){console.error("❌ Error sending OTP:",u),t(u.message||"Failed to send verification code. Please try again."),a(!1);return}console.log("✅ OTP sent successfully:",r),a(!1),i("code"),g(!0),setTimeout(()=>g(!1),3e3)}catch(r){console.error("❌ Exception sending OTP:",r),a(!1),t(r.message||"Failed to send verification code. Please try again.")}}),T=n=>v(void 0,null,function*(){if(n.preventDefault(),!m||m.length!==6){t("Please enter the 6-digit code");return}a(!0),t(""),g(!1);try{if(!x)throw new Error("Supabase is not configured. Please check your environment variables.");const{data:s,error:r}=yield x.auth.verifyOtp({email:l.trim(),token:m.trim(),type:"email"});if(r){console.error("❌ Error verifying OTP:",r),t(r.message||"Invalid code. Please try again."),a(!1);return}console.log("✅ OTP verified successfully:",s);const{data:{user:u},error:P}=yield x.auth.getUser();if(P||!u){console.error("❌ Error getting user:",P),t("Failed to get user information. Please try again."),a(!1);return}const S=u.email||l;localStorage.setItem("userEmail",S),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",u.id),console.log("✅ User logged in:",S),console.log("✅ User ID:",u.id);const k=p.get("redirect")||"/my-orders";h(k)}catch(s){console.error("❌ Exception verifying OTP:",s),t(s.message||"Invalid code. Please try again."),a(!1)}}),C=()=>{y(""),t(""),g(!1),j({preventDefault:()=>{}})},I=()=>{i("email"),y(""),t(""),g(!1),h("/login")};return e.jsx("div",{className:"min-h-screen bg-white py-12 md:py-16",children:e.jsxs("div",{className:"max-w-md mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-title md:text-title-lg font-light text-gray-900 mb-2 font-inter tracking-title",children:d==="email"?"Log In":"Verify Code"}),e.jsx("div",{className:"w-16 h-px bg-gray-300 mx-auto mb-4"})]}),E&&d==="code"&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 font-light font-inter",children:["Verification code sent to ",e.jsx("strong",{children:l})]})}),w&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 font-light font-inter",children:w})}),d==="email"&&e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Email Address *"}),e.jsx("input",{type:"email",value:l,onChange:n=>{b(n.target.value),t("")},placeholder:"your.email@example.com",autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-base",required:!0})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Sending Code...":"Send Verification Code"}),e.jsx("p",{className:"text-xs text-gray-500 text-center font-light font-inter",children:"By continuing, you agree to our Terms of Use and Privacy Policy."})]}),d==="code"&&e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 font-light font-inter mb-4 text-center",children:["We've sent a 6-digit verification code to ",e.jsx("strong",{children:l}),". Please enter it below."]}),e.jsx("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Verification Code *"}),e.jsx("input",{type:"text",value:m,onChange:n=>{const s=n.target.value.replace(/\D/g,"").slice(0,6);y(s),t("")},placeholder:"000000",maxLength:6,autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-2xl text-center tracking-widest",required:!0})]}),e.jsx("button",{type:"submit",disabled:c||m.length!==6,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Verifying...":"Verify Code"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{type:"button",onClick:C,disabled:c,className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline disabled:opacity-50",children:"Resend Code"}),e.jsx("button",{type:"button",onClick:I,className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter",children:"← Back to email"})]})]})]})})};export{A as default};
