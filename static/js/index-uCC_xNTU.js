var v=(h,p,o)=>new Promise((l,b)=>{var m=n=>{try{d(o.next(n))}catch(c){b(c)}},y=n=>{try{d(o.throw(n))}catch(c){b(c)}},d=n=>n.done?l(n.value):Promise.resolve(n.value).then(m,y);d((o=o.apply(h,p)).next())});import{u as O,e as F,r as f,j as e}from"./react-vendor-oGZ_6Ua-.js";import{c as L}from"./supabase-vendor-rHdX91gy.js";import"./vendor-Q-ueIuah.js";import"./fontawesome-vendor-DeakGBTR.js";const R="https://cjpkfllqvakukzrqtcqc.supabase.co",D="sb_publishable_Fz26XygnmLZDruazTuFDjg_4m4foumC",x=L(R,D),B=()=>{const h=O(),[p]=F(),o=p.get("email")||"",[l,b]=f.useState(o),[m,y]=f.useState(""),[d,n]=f.useState(o?"code":"email"),[c,a]=f.useState(!1),[j,t]=f.useState(""),[N,g]=f.useState(!1);f.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"});const i=localStorage.getItem("userEmail");if(localStorage.getItem("isLoggedIn")==="true"&&i){const r=p.get("redirect")||"/my-orders";h(r,{replace:!0});return}o&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)&&S(o)},[h,p,o]);const S=i=>v(void 0,null,function*(){a(!0),t("");try{if(!x)throw new Error("Supabase is not configured. Please check your environment variables.");const{data:s,error:r}=yield x.auth.signInWithOtp({email:i,options:{emailRedirectTo:null}});if(r){console.error("❌ Error sending OTP:",r),t(r.message||"Failed to send verification code. Please try again."),a(!1);return}console.log("✅ OTP sent successfully:",s),a(!1),n("code"),g(!0),setTimeout(()=>g(!1),3e3)}catch(s){console.error("❌ Exception sending OTP:",s),a(!1),t(s.message||"Failed to send verification code. Please try again.")}}),w=i=>v(void 0,null,function*(){if(i.preventDefault(),!l){t("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)){t("Please enter a valid email address");return}a(!0),t(""),g(!1);try{if(!x)throw new Error("Supabase is not configured. Please check your environment variables.");const{data:r,error:u}=yield x.auth.signInWithOtp({email:l.trim(),options:{emailRedirectTo:null}});if(u){console.error("❌ Error sending OTP:",u),t(u.message||"Failed to send verification code. Please try again."),a(!1);return}console.log("✅ OTP sent successfully:",r),a(!1),n("code"),g(!0),setTimeout(()=>g(!1),3e3)}catch(r){console.error("❌ Exception sending OTP:",r),a(!1),t(r.message||"Failed to send verification code. Please try again.")}}),T=i=>v(void 0,null,function*(){if(i.preventDefault(),!m||m.length!==6){t("Please enter the 6-digit code");return}a(!0),t(""),g(!1);try{if(!x)throw new Error("Supabase is not configured. Please check your environment variables.");const{data:s,error:r}=yield x.auth.verifyOtp({email:l.trim(),token:m.trim(),type:"email"});if(r){console.error("❌ Error verifying OTP:",r),t(r.message||"Invalid code. Please try again."),a(!1);return}console.log("✅ OTP verified successfully:",s);const{data:{user:u},error:P}=yield x.auth.getUser();if(P||!u){console.error("❌ Error getting user:",P),t("Failed to get user information. Please try again."),a(!1);return}const E=u.email||l;localStorage.setItem("userEmail",E),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",u.id),console.log("✅ User logged in:",E),console.log("✅ User ID:",u.id);const I=p.get("redirect")||"/my-orders";h(I)}catch(s){console.error("❌ Exception verifying OTP:",s),t(s.message||"Invalid code. Please try again."),a(!1)}}),k=()=>{y(""),t(""),g(!1),w({preventDefault:()=>{}})},C=()=>{n("email"),y(""),t(""),g(!1),h("/login")};return e.jsx("div",{className:"min-h-screen bg-white py-12 md:py-16",children:e.jsxs("div",{className:"max-w-md mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-title md:text-title-lg font-light text-gray-900 mb-2 font-inter tracking-title",children:d==="email"?"Log In":"Verify Code"}),e.jsx("div",{className:"w-16 h-px bg-gray-300 mx-auto mb-4"})]}),N&&d==="code"&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 font-light font-inter",children:["Verification code sent to ",e.jsx("strong",{children:l})]})}),j&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 font-light font-inter",children:j})}),d==="email"&&e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Email Address *"}),e.jsx("input",{type:"email",value:l,onChange:i=>{b(i.target.value),t("")},placeholder:"your.email@example.com",autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-base",required:!0})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Sending Code...":"Send Verification Code"}),e.jsx("p",{className:"text-xs text-gray-500 text-center font-light font-inter",children:"By continuing, you agree to our Terms of Use and Privacy Policy."})]}),d==="code"&&e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 font-light font-inter mb-4 text-center",children:["We've sent a 6-digit verification code to ",e.jsx("strong",{children:l}),". Please enter it below."]}),e.jsx("label",{className:"block text-sm text-gray-700 mb-2 font-light font-inter",children:"Verification Code *"}),e.jsx("input",{type:"text",value:m,onChange:i=>{const s=i.target.value.replace(/\D/g,"").slice(0,6);y(s),t("")},placeholder:"000000",maxLength:6,autoFocus:!0,className:"w-full px-4 py-3 border border-gray-200 rounded-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 placeholder-gray-400 font-light font-inter text-2xl text-center tracking-widest",required:!0})]}),e.jsx("button",{type:"submit",disabled:c||m.length!==6,className:"w-full px-4 py-3 text-sm uppercase tracking-wider font-light font-inter bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Verifying...":"Verify Code"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{type:"button",onClick:k,disabled:c,className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter underline disabled:opacity-50",children:"Resend Code"}),e.jsx("button",{type:"button",onClick:C,className:"text-sm text-gray-600 hover:text-gray-900 font-light font-inter",children:"← Back to email"})]})]})]})})};export{B as default};
