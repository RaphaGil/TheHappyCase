var Q=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var V=(e,n,a)=>n in e?Q(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,O=(e,n)=>{for(var a in n||(n={}))Z.call(n,a)&&V(e,a,n[a]);if(M)for(var a of M(n))ee.call(n,a)&&V(e,a,n[a]);return e},F=(e,n)=>J(e,X(n));var N=(e,n,a)=>new Promise((c,s)=>{var m=i=>{try{o(a.next(i))}catch(r){s(r)}},l=i=>{try{o(a.throw(i))}catch(r){s(r)}},o=i=>i.done?c(i.value):Promise.resolve(i.value).then(m,l);o((a=a.apply(e,n)).next())});const se=[{id:1,name:"Economy Case",type:"economy",images:["/images/SmartCase/economycaselightpink.webp","/images/SmartCase/economycasered.webp","/images/SmartCase/economycasejeansblue.webp","/images/SmartCase/economycasebrown.webp","/images/SmartCase/economycaselightblue.webp","/images/SmartCase/economycasedarkbrown.webp","/images/SmartCase/economycaseblack.webp","/images/SmartCase/economycaselightbrown.webp"],colors:[{color:"#f49f90",image:"/images/SmartCase/economycaselightpink.webp"},{color:"#cb0025",image:"/images/SmartCase/economycasered.webp"},{color:"#9cb4b8",image:"/images/SmartCase/economycaselightblue.webp"},{color:"#627386",image:"/images/SmartCase/economycasejeansblue.webp"},{color:"#3a4763",image:"/images/SmartCase/economycasedarkblue.webp"},{color:"#c96e50",image:"/images/SmartCase/economycaselightbrown.webp"},{color:"#b0582c",image:"/images/SmartCase/economycasebrown.webp"},{color:"#59332e",image:"/images/SmartCase/economycasedarkbrown.webp"},{color:"#506258",image:"/images/SmartCase/economycasegreen.webp"},{color:"#89837e",image:"/images/SmartCase/economycasegray.webp"},{color:"#413f44",image:"/images/SmartCase/economycaseblack.webp"}],specifications:{dimensions:"14.9cm (W) x 10.7cm (H) x 1cm (D)",rfid:"Yes",material:"PU Leather",closure:"Magnetic Snap Closure",cardSlots:"3",features:"RFID Protection, Water Resistant, Lightweight Design",interior:"Document Pocket, Boarding Pass Slot, SIM Card Slot",care:"Wipe clean with damp cloth"},basePrice:8},{id:2,name:"Business Class Case",type:"business",images:["/images/BusinessClassCase/businessclasscasegray.webp","/images/BusinessClassCase/businessclasscasepink.webp","/images/BusinessClassCase/businessclasscaselightpink.webp","/images/BusinessClassCase/businessclasscasebrown.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclassinside.webp","/images/BusinessClassCase/businessclassinside2.webp"],colors:[{color:"#c8b593",image:"/images/BusinessClassCase/businessclasscasegray.webp"},{color:"#da8ca6",image:"/images/BusinessClassCase/businessclasscaselightpink.webp"},{color:"#daaf49",image:"/images/BusinessClassCase/businessclasscaseyellow.webp"},{color:"#d33d72",image:"/images/BusinessClassCase/businessclasscasepink.webp"},{color:"#c49154",image:"/images/BusinessClassCase/businessclasscasebrown.webp"},{color:"#36312b",image:"/images/BusinessClassCase/businessclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 9.5cm (H) x 1cm (D)",rfid:"No",material:"Genuine Leather",closure:"No Closure",cardSlots:"4",interior:"Passport Pocket, Document Pocket",care:"Clean with leather conditioner, avoid excessive moisture"},basePrice:12},{id:3,name:"First Class Case",type:"firstclass",images:["/images/FirstClassCase/firstclassbrown.webp","/images/FirstClassCase/firstclasscaseblack.webp","/images/FirstClassCase/firstclasscasenavyblue.webp","/images/FirstClassCase/firstclasscasebrickred.webp","/images/FirstClassCase/firstclasscasepink.webp","/images/FirstClassCase/firstclasscasebrown.webp","/images/FirstClassCase/firstclasscaseblue.webp","/images/FirstClassCase/firstclasscasegray.webp","/images/FirstClassCase/firstclasscasepurple.webp","/images/FirstClassCase/firstclasscasegreen.webp","/images/FirstClassCase/firstclasscasedarkpink.webp"],colors:[{color:"#d17956",image:"/images/FirstClassCase/firstclasscasebrown.webp"},{color:"#c76f82",image:"/images/FirstClassCase/firstclasscasebrickred.webp"},{color:"#adcfa8",image:"/images/FirstClassCase/firstclasscasegreen.webp"},{color:"#ab8b72",image:"/images/FirstClassCase/firstclasscasedarkpink.webp"},{color:"#bfa29c",image:"/images/FirstClassCase/firstclasscasepink.webp"},{color:"#a799ab",image:"/images/FirstClassCase/firstclasscasepurple.webp"},{color:"#afab9b",image:"/images/FirstClassCase/firstclasscasegray.webp"},{color:"#5f6074",image:"/images/FirstClassCase/firstclasscasenavyblue.webp"},{color:"#768695",image:"/images/FirstClassCase/firstclasscaseblue.webp"},{color:"#cea55c",image:"/images/FirstClassCase/firstclasscaselightbrown.webp"},{color:"#272a34",image:"/images/FirstClassCase/firstclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 10.5cm (H) x 1.5cm (D)",rfid:"Yes",material:"Genuine Leather",closure:"Button Snap Closure",cardSlots:"3",interior:" Document Pocket, Boarding Pass Slot, SIM Card Slot",features:"Coin Pouch, RFID Protection, Water Resistant"},basePrice:12}],ae={flags:[{id:1,name:"Albania Flag",src:"/images/Flags/albania.webp",price:2,size:.5,continent:"europe"},{id:2,name:"Armenia Flag",src:"/images/Flags/armenia.webp",price:2,size:.5,continent:"europe"},{id:3,name:"Belgium Flag",src:"/images/Flags/belgium.webp",price:2,size:.5,continent:"europe"},{id:4,name:"Bosnia  Flag",src:"/images/Flags/bosnia.webp",price:2,size:.5,continent:"europe"},{id:5,name:"Brazil Flag",src:"/images/Flags/brazil.webp",price:2,size:.5,continent:"americas"},{id:6,name:"British Virgin Islands Flag",src:"/images/Flags/britishvirginislands.webp",price:2,size:.5,continent:"americas"},{id:7,name:"Croatia Flag",src:"/images/Flags/croatia.webp",price:2,size:.5,continent:"europe"},{id:8,name:"Dublin Flag",src:"/images/Flags/dublin.webp",price:2,size:.5,continent:"europe"},{id:9,name:"Egypt Flag",src:"/images/Flags/egypt.webp",price:2,size:.5,continent:"africa"},{id:10,name:"France Flag",src:"/images/Flags/france.webp",price:2,size:.5,continent:"europe"},{id:11,name:"Germany Flag",src:"/images/Flags/germany.webp",price:2,size:.5,continent:"europe"},{id:12,name:"India Flag",src:"/images/Flags/india.webp",price:2,size:.5,continent:"asia"},{id:13,name:"Italy Flag",src:"/images/Flags/italy.webp",price:2,size:.5,continent:"europe"},{id:14,name:"Jamaica  Flag",src:"/images/Flags/jamaica.webp",price:2,size:.5,continent:"americas"},{id:15,name:"Japan  Flag",src:"/images/Flags/japan.webp",price:2,size:.5,continent:"americas"},{id:16,name:"Hungary Flag",src:"/images/Flags/hungary.webp",price:2,size:.5,continent:"americas"},{id:17,name:"LGBTQIA+ Flag",src:"/images/Flags/lgbtqia.webp",price:2,size:.5,continent:"special"},{id:18,name:"Netherlands Flag",src:"/images/Flags/netherlands.webp",price:2,size:.5,continent:"europe"},{id:19,name:"Norway Flag",src:"/images/Flags/norway.webp",price:2,size:.5,continent:"europe"},{id:20,name:"Portugal Flag",src:"/images/Flags/portugal.webp",price:2,size:.5,continent:"europe"},{id:21,name:"Puerto Rico  Flag",src:"/images/Flags/puertorico.webp",price:2,size:.5,continent:"americas"},{id:22,name:"Scotland Flag",src:"/images/Flags/scotland.webp",price:2,size:.5,continent:"europe"},{id:23,name:"South Africa Flag",src:"/images/Flags/southafrica.webp",price:2,size:.5,continent:"africa"},{id:24,name:"Spain Flag",src:"/images/Flags/spain.webp",price:2,size:.5,continent:"europe"},{id:25,name:"Sweden Flag",src:"/images/Flags/sweden.webp",price:2,size:.5,continent:"europe"},{id:26,name:"Switzerland Flag",src:"/images/Flags/switzerland.webp",price:2,size:.5,continent:"europe"},{id:27,name:"United Kingdon Flag",src:"/images/Flags/uk.webp",price:2,size:.5,continent:"europe"},{id:28,name:"United States Flag",src:"/images/Flags/eua.webp",price:2,size:.5,continent:"americas"}],colorful:[{id:1,name:"Be a Good Human",src:"/images/ColorfulPins/beagoodhuman.webp",price:2,size:.7,subCategory:"inspiration"},{id:2,name:"Airplane",src:"/images/ColorfulPins/airplane.webp",price:2,size:.75,subCategory:"travel"},{id:3,name:"Heart Globe",src:"/images/ColorfulPins/heartglobe.webp",price:2,size:.7},{id:4,name:"Dream Big",src:"/images/ColorfulPins/dreambig.webp",price:2,size:.9,subCategory:"inspiration"},{id:5,name:"Paw",src:"/images/ColorfulPins/paw.webp",price:2,size:.4},{id:6,name:"Colorful Camera",src:"/images/ColorfulPins/camera.webp",price:2,size:.55,subCategory:"camera"},{id:7,name:"Be Kind",src:"/images/ColorfulPins/bekind.webp",price:2,size:.75,subCategory:"inspiration"},{id:8,name:"Football",src:"/images/ColorfulPins/football.webp",price:2,size:.75},{id:9,name:"Ticket to Happiness",src:"/images/ColorfulPins/tickettohappiness.webp",price:2,size:.8,subCategory:"inspiration"},{id:10,name:"Be Happy",src:"/images/ColorfulPins/behappy.webp",price:2,size:.75,subCategory:"inspiration"},{id:11,name:"Lucky Leaf",src:"/images/ColorfulPins/luckyleafcharm.webp",price:2,size:.5,subCategory:"nature"},{id:12,name:"Beer",src:"/images/ColorfulPins/beer.webp",price:2,size:.65,subCategory:"drinks"},{id:13,name:"Bottle of Wine",src:"/images/ColorfulPins/bottleofwine.webp",price:2,size:.8,subCategory:"drinks"},{id:14,name:"Heart Notification",src:"/images/ColorfulPins/heartnotification.webp",price:2,size:.5,subCategory:"hearts"},{id:15,name:"Small Boarding Pass",src:"/images/ColorfulPins/smallboardingpass.webp",price:2,size:.75,subCategory:"travel"},{id:16,name:"Little Heart",src:"/images/ColorfulPins/littleheart.webp",price:2,size:.5,subCategory:"hearts"},{id:17,name:"Disney",src:"/images/ColorfulPins/disney.webp",price:2,size:.75,subCategory:"disney"},{id:18,name:"Pluto",src:"/images/ColorfulPins/pluto.webp",price:2,size:.85,subCategory:"disney"},{id:19,name:"Round Minnnie",src:"/images/ColorfulPins/roundminnie.webp",price:2,size:.85,subCategory:"disney"},{id:20,name:"Round Mickey",src:"/images/ColorfulPins/roundmickey.webp",price:2,size:.85,subCategory:"disney"},{id:21,name:"Guufy",src:"/images/ColorfulPins/guufy.webp",price:2,size:.85,subCategory:"disney"},{id:22,name:"Map",src:"/images/ColorfulPins/map.webp",price:2,size:.85,subCategory:"travel"},{id:23,name:"London Phone",src:"/images/ColorfulPins/telephone.webp",price:2,size:.85},{id:24,name:"Adventure Awaits Ticket",src:"/images/ColorfulPins/adventureawaits.webp",price:2,size:.85,subCategory:"travel"},{id:25,name:"Passport",src:"/images/ColorfulPins/passport.webp",price:2,size:.75,subCategory:"travel"},{id:26,name:"Coffee",src:"/images/ColorfulPins/coffee.webp",price:2,size:.5,subCategory:"drinks"},{id:27,name:"Coconut Tree",src:"/images/ColorfulPins/coconuttree.webp",price:2,size:.8,subCategory:"nature"},{id:28,name:"Wave",src:"/images/ColorfulPins/wave.webp",price:3.5,size:.6},{id:29,name:"Suitcase",src:"/images/ColorfulPins/orangeluggage.webp",price:2,size:.7,subCategory:"travel"},{id:30,name:"Black Camera",src:"/images/ColorfulPins/blackcamera.webp",price:2,size:.8,subCategory:"camera"},{id:31,name:"Pink Camera",src:"/images/ColorfulPins/pinkcamera.webp",price:2,size:.5,subCategory:"camera"},{id:32,name:"Daisy Duck",src:"/images/ColorfulPins/daisyduck.webp",price:2,size:.7,subCategory:"disney"},{id:33,name:"Duck",src:"/images/ColorfulPins/duck.webp",price:2,size:.75,subCategory:"disney"},{id:34,name:"Minnie",src:"/images/ColorfulPins/minnie.webp",price:2,size:.7,subCategory:"disney"},{id:35,name:"Mickey Mouse",src:"/images/ColorfulPins/mickey.webp",price:2,size:.75,subCategory:"disney"},{id:36,name:"Combi",src:"/images/ColorfulPins/combi.webp",price:2,size:.7,subCategory:"travel"},{id:37,name:"Wine",src:"/images/ColorfulPins/wineglass.webp",price:2,size:.4,subCategory:"drinks"},{id:38,name:"Vacation",src:"/images/ColorfulPins/vacation.webp",price:2,size:.8,subCategory:"travel"},{id:39,name:"Love",src:"/images/ColorfulPins/love.webp",price:2,size:.8,subCategory:"travel"}],bronze:[{id:1,name:"Airplane",src:"/images/BronzePins/airplane.webp",price:1,size:.7,subCategory:"travel"},{id:2,name:"Cardinal Points",src:"/images/BronzePins/cardinalpoints.webp",price:1,size:.65,subCategory:"symbols"},{id:3,name:"Camera",src:"/images/BronzePins/camera.webp",price:1,size:.55,subCategory:"symbols"},{id:4,name:"Globe",src:"/images/BronzePins/globe.webp",price:1,size:.55,subCategory:"travel"},{id:5,name:"Passport",src:"/images/BronzePins/passport.webp",price:1,size:.4,subCategory:"travel"},{id:6,name:"NYC Taxi",src:"/images/BronzePins/nyctaxi.webp",price:1,size:.9,subCategory:"travel"},{id:7,name:"Liberty Statue",src:"/images/BronzePins/libertystatue.webp",price:1,size:1,subCategory:"travel"},{id:8,name:"Luggage",src:"/images/BronzePins/luggage.webp",price:1,size:.45,subCategory:"travel"},{id:9,name:"London Bus",src:"/images/BronzePins/london.webp",price:1,size:.7,subCategory:"travel"},{id:10,name:"Lucky Leaf",src:"/images/BronzePins/luckyleaf.webp",price:1,size:.45,subCategory:"nature"},{id:11,name:"Little Heart",src:"/images/BronzePins/littleheart.webp",price:1,size:.25,subCategory:"love"},{id:12,name:"Eiffel Towel",src:"/images/BronzePins/eiffeltowel.webp",price:1,size:.8},{id:13,name:"Kangaroo",src:"/images/BronzePins/kangaroo.webp",price:1,size:.9,subCategory:"animals"},{id:14,name:"Koala",src:"/images/BronzePins/koala.webp",price:1,size:.5,subCategory:"animals"},{id:15,name:"Hamsa Hand",src:"/images/BronzePins/hamsahand.webp",price:1,size:.9,subCategory:"symbols"},{id:16,name:"Thailand",src:"/images/BronzePins/thailand.webp",price:1,size:.9,subCategory:"symbols"},{id:17,name:"Mummy",src:"/images/BronzePins/mummy.webp",price:1,size:.7,subCategory:"symbols"},{id:18,name:"Llama",src:"/images/BronzePins/llama.webp",price:1,size:.7,subCategory:"animals"},{id:19,name:"India",src:"/images/BronzePins/india.webp",price:1,size:.5,subCategory:"symbols"},{id:20,name:"Pyramid",src:"/images/BronzePins/pyramid.webp",price:1,size:.8},{id:21,name:"Arc The Triomphe",src:"/images/BronzePins/arcthetriomphe.webp",price:1,size:.5},{id:22,name:"Maple Leaf",src:"/images/BronzePins/mapleleaf.webp",price:1,size:.6,subCategory:"nature"},{id:23,name:"Love",src:"/images/BronzePins/love.webp",price:1,size:.8,subCategory:"love"},{id:24,name:"Airplane War",src:"/images/BronzePins/airplanewar.webp",price:1,size:.8},{id:25,name:"Enjoy the Journey",src:"/images/BronzePins/enjoythejourney.webp",price:1,size:1,subCategory:"symbols"},{id:26,name:"Heart",src:"/images/BronzePins/heart.webp",price:1,size:.7,subCategory:"love"},{id:27,name:"I love Jesus",src:"/images/BronzePins/ilovejesus.webp",price:1,size:.5,subCategory:"love"},{id:28,name:"Butterfly",src:"/images/BronzePins/butterfly.webp",price:1,size:.7,subCategory:"nature"},{id:29,name:"Squirrel",src:"/images/BronzePins/squirrel.webp",price:1,size:.5},{id:30,name:"Canada",src:"/images/BronzePins/canada.webp",price:1,size:.6,subCategory:"symbols"},{id:31,name:"Flipflop",src:"/images/BronzePins/flipflop.webp",price:1,size:.5,subCategory:"nature"},{id:32,name:"Paw",src:"/images/BronzePins/paw.webp",price:1,size:.5,subCategory:"animals"},{id:33,name:"PawDog",src:"/images/BronzePins/pawheart.webp",price:1,size:.45,subCategory:"animals"},{id:34,name:"I love my dog",src:"/images/BronzePins/ilovemydog.webp",price:1,size:.5,subCategory:"animals"},{id:35,name:"Money",src:"/images/BronzePins/money.webp",price:1,size:.55},{id:36,name:"Dog Bone",src:"/images/BronzePins/dogbone.webp",price:1,size:.5,subCategory:"animals"}]},S={cases:se,pins:ae},Y=e=>{var n,a;if(e.customDesign||e.designImage)return`custom-${e.id||Date.now()}`;if(e.type==="charm"||e.category&&e.pin){const c=e.category||e.pin&&e.pin.category||"colorful",s=((n=e.pin)==null?void 0:n.name)||((a=e.pin)==null?void 0:a.src)||e.name||"";return`charm-${c}-${s}`}if(e.caseType&&e.color){if(e.pins&&e.pins.length>0){const c=e.pins.map(s=>s.name||s.src).sort().join("-");return`case-${e.caseType}-${e.color}-pins-${c}`}return`case-${e.caseType}-${e.color}`}return e.id&&e.id.startsWith("case-")?`unique-${e.id}`:e.id?`item-${e.id}`:`item-${Date.now()}`},ne=(e,n)=>Y(e)===Y(n),re="http://localhost:3001",oe=e=>{const n=e.startsWith("/")?e:`/${e}`;return`${re}${n}`};let T=null,D=null,I=null,L=!1;const j=()=>N(void 0,null,function*(){return I||(I=N(void 0,null,function*(){var e,n,a,c,s,m,l,o,i,r,t,y,C,w,u,p,b,h,v,B,_,W;try{T||(L=!0);const A=oe("/api/inventory"),H=new AbortController,q=setTimeout(()=>H.abort(),1e4),K=z=>N(void 0,null,function*(){const f=z.headers.get("content-type"),g=yield z.text();if(!f||!f.includes("application/json"))throw g.trim().startsWith("<!DOCTYPE")||g.trim().startsWith("<html")?new Error("HTML_RESPONSE_FALLBACK"):new Error(`Expected JSON, got: ${g.substring(0,100)}...`);try{return JSON.parse(g)}catch(k){throw new Error(`Failed to parse JSON response: ${k.message}`)}});try{console.log("[INVENTORY] ðŸ” Fetching inventory from:",A);const z=yield fetch(A,{signal:H.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(q),console.log("[INVENTORY] ðŸ“¡ Response status:",z.status,z.statusText),z.ok){const f=yield K(z);if(console.log("[INVENTORY] âœ… Received inventory data:",{success:f.success,hasInventory:!!f.inventory,inventoryType:typeof f.inventory,inventoryKeys:f.inventory?Object.keys(f.inventory):null,casesType:typeof((e=f.inventory)==null?void 0:e.cases),casesIsArray:Array.isArray((n=f.inventory)==null?void 0:n.cases),casesLength:(c=(a=f.inventory)==null?void 0:a.cases)==null?void 0:c.length,casesValue:(s=f.inventory)==null?void 0:s.cases,caseColorsType:typeof((m=f.inventory)==null?void 0:m.caseColors),caseColorsIsArray:Array.isArray((l=f.inventory)==null?void 0:l.caseColors),caseColorsLength:(i=(o=f.inventory)==null?void 0:o.caseColors)==null?void 0:i.length,caseColorsValue:(r=f.inventory)==null?void 0:r.caseColors,pinsType:typeof((t=f.inventory)==null?void 0:t.pins),pinsKeys:(y=f.inventory)!=null&&y.pins?Object.keys(f.inventory.pins):null,pinsFlagsLength:(u=(w=(C=f.inventory)==null?void 0:C.pins)==null?void 0:w.flags)==null?void 0:u.length,pinsColorfulLength:(h=(b=(p=f.inventory)==null?void 0:p.pins)==null?void 0:b.colorful)==null?void 0:h.length,pinsBronzeLength:(_=(B=(v=f.inventory)==null?void 0:v.pins)==null?void 0:B.bronze)==null?void 0:_.length,fullInventory:f.inventory}),f.success&&f.inventory){console.log("[INVENTORY] ðŸ”„ STEP 5: Parsing inventory data from API response...");const g={cases:f.inventory.cases,caseColors:f.inventory.caseColors,pins:f.inventory.pins};console.log("[INVENTORY] ðŸ” STEP 5.1: Parsed quantities structure:",{casesType:typeof g.cases,casesIsArray:Array.isArray(g.cases),casesValue:g.cases,caseColorsType:typeof g.caseColors,caseColorsIsArray:Array.isArray(g.caseColors),caseColorsValue:g.caseColors,pinsType:typeof g.pins,pinsValue:g.pins}),Array.isArray(g.caseColors)&&(console.log("[INVENTORY] ðŸ” STEP 5.2: Sample caseColors received (first 2 cases):"),g.caseColors.slice(0,2).forEach((d,P)=>{console.log(`[INVENTORY]   Case ${P}:`,{arrayLength:d==null?void 0:d.length,isArray:Array.isArray(d),first3Colors:d==null?void 0:d.slice(0,3).map((E,U)=>({index:U,value:E,type:typeof E,is_zero:E===0,is_null:E===null}))})})),console.log("[INVENTORY] ðŸ”„ STEP 5.3: Checking for sold out items in received data..."),g.caseColors&&Array.isArray(g.caseColors)?g.caseColors.forEach((d,P)=>{Array.isArray(d)&&d.forEach((E,U)=>{E===0&&console.log(`[INVENTORY] ðŸš« STEP 5.3: SOLD OUT detected - Case ${P}, Color ${U}: qty = 0`)})}):console.warn("[INVENTORY] âš ï¸ STEP 5.3: caseColors is not an array, cannot check sold out items");const k=g.cases&&Array.isArray(g.cases)&&g.cases.some(d=>d!==null)||g.caseColors&&Array.isArray(g.caseColors)&&g.caseColors.some(d=>d&&d.some(P=>P!==null))||g.pins&&(g.pins.flags&&g.pins.flags.some(d=>d!==null)||g.pins.colorful&&g.pins.colorful.some(d=>d!==null)||g.pins.bronze&&g.pins.bronze.some(d=>d!==null));if(console.log("[INVENTORY] ðŸ“Š Inventory summary:",{hasInventoryData:k,cacheTimestamp:Date.now(),casesType:typeof g.cases,casesIsArray:Array.isArray(g.cases),casesPreview:Array.isArray(g.cases)?g.cases.slice(0,5):g.cases,caseColorsType:typeof g.caseColors,caseColorsIsArray:Array.isArray(g.caseColors),caseColorsPreview:Array.isArray(g.caseColors)?g.caseColors.slice(0,2).map(d=>Array.isArray(d)?d.slice(0,3):d):g.caseColors,pinsPreview:g.pins}),console.log("[INVENTORY] ðŸ”„ STEP 5.4: Updating in-memory cache..."),T=g,D=Date.now(),console.log("[INVENTORY] âœ… STEP 5.5: Cache updated. Verifying cache contents:"),console.log("[INVENTORY]   Cache structure:",{hasCaseColors:!!T.caseColors,caseColorsType:typeof T.caseColors,caseColorsIsArray:Array.isArray(T.caseColors),caseColorsLength:(W=T.caseColors)==null?void 0:W.length}),Array.isArray(T.caseColors)&&(console.log("[INVENTORY] ðŸ”„ STEP 5.6: Verifying sold out items in cache..."),T.caseColors.forEach((d,P)=>{Array.isArray(d)&&d.forEach((E,U)=>{E===0&&console.log(`[INVENTORY] âœ… STEP 5.6: SOLD OUT confirmed in cache - Case ${P}, Color ${U}: qty = 0`)})})),typeof window!="undefined"){const d={timestamp:D};window.dispatchEvent(new CustomEvent("inventoryCacheUpdated",{detail:d})),window.dispatchEvent(new CustomEvent("inventoryUpdated",{detail:d}))}return L=!1,console.log("[INVENTORY] âœ… STEP 5.7: Inventory fetch complete and cache ready"),g}}else if(z.status===404){const f=A.replace("/api/inventory","/.netlify/functions/inventory");try{const g=yield fetch(f,{signal:H.signal,headers:{"Content-Type":"application/json"}});if(g.ok){const k=yield K(g);if(k.success&&k.inventory){const d={cases:k.inventory.cases,caseColors:k.inventory.caseColors,pins:k.inventory.pins};return T=d,D=Date.now(),d}}}catch(g){}}}catch(z){if(clearTimeout(q),L=!1,console.error("[INVENTORY] âŒ Error fetching inventory:",{message:z.message,name:z.name,apiUrl:A}),z.message==="HTML_RESPONSE_FALLBACK"){console.log("[INVENTORY] ðŸ”„ Trying fallback URL (HTML response detected)");const f=A.replace("/api/inventory","/.netlify/functions/inventory");try{const g=new AbortController,k=setTimeout(()=>g.abort(),1e4),d=yield fetch(f,{signal:g.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(k),d.ok){const P=yield K(d);if(P.success&&P.inventory){const E={cases:P.inventory.cases,caseColors:P.inventory.caseColors,pins:P.inventory.pins};return T=E,D=Date.now(),E}}}catch(g){}}}}catch(A){L=!1}finally{I=null,L=!1}return null}),I)}),$=(e,n)=>{var m,l,o;if(!T&&I&&L)return null;const a=D?Date.now()-D:1/0;(!T||a>60*1e3)&&!L&&j().catch(()=>{});const s=T;if(!s)return console.log("[SOLD_OUT_CHECK] âš ï¸ No inventory cache available"),null;if(console.log("[SOLD_OUT_CHECK] ðŸ” Checking cache structure:",{hasQuantities:!!s,quantitiesType:typeof s,quantitiesKeys:s?Object.keys(s):null,hasCaseColors:!!s.caseColors,caseColorsType:typeof s.caseColors,caseColorsIsArray:Array.isArray(s.caseColors),hasCases:!!s.cases,casesType:typeof s.cases,casesIsArray:Array.isArray(s.cases),hasPins:!!s.pins,pinsType:typeof s.pins}),!s.caseColors&&!s.cases&&!s.pins)return console.log("[SOLD_OUT_CHECK] âš ï¸ Cache exists but has no valid structure - treating as unlimited"),null;if(e.caseType&&e.color){const i=S.cases.find(u=>u.type===e.caseType);if(!i)return console.log("[SOLD_OUT_CHECK] âš ï¸ Case not found:",e.caseType),null;let r=null,t="none";if(console.log("[SOLD_OUT_CHECK] ðŸ”„ STEP 6: Checking caseColors array..."),console.log("[SOLD_OUT_CHECK]   Looking for:",{caseType:e.caseType,color:e.color}),s&&s.caseColors){console.log("[SOLD_OUT_CHECK] âœ… STEP 6.1: caseColors exists, type:",typeof s.caseColors,"isArray:",Array.isArray(s.caseColors));const u=S.cases.findIndex(p=>p.type===e.caseType);if(console.log("[SOLD_OUT_CHECK] ðŸ” STEP 6.2: Found case index:",u),u!==-1&&s.caseColors[u]){console.log("[SOLD_OUT_CHECK] âœ… STEP 6.3: Case array exists at index",u),console.log("[SOLD_OUT_CHECK]   Case array type:",typeof s.caseColors[u],"isArray:",Array.isArray(s.caseColors[u])),console.log("[SOLD_OUT_CHECK]   Case array length:",(m=s.caseColors[u])==null?void 0:m.length);const p=i.colors.findIndex(b=>b.color===e.color);if(console.log("[SOLD_OUT_CHECK] ðŸ” STEP 6.4: Found color index:",p),p!==-1&&s.caseColors[u][p]!==null&&s.caseColors[u][p]!==void 0){const b=s.caseColors[u][p];console.log("[SOLD_OUT_CHECK] âœ… STEP 6.5: Found stock value:",{stock:b,type:typeof b,is_zero:b===0,is_null:b===null,is_undefined:b===void 0}),r=b,t=`caseColors[${u}][${p}]`,console.log("[SOLD_OUT_CHECK] âœ… STEP 6.6: Set maxQuantity =",r,"from",t)}else console.log("[SOLD_OUT_CHECK] âš ï¸ STEP 6.5: Stock value not found or is null/undefined:",{colorIndex:p,value:p!==-1?s.caseColors[u][p]:"colorIndex not found",is_null:p!==-1?s.caseColors[u][p]===null:"N/A",is_undefined:p!==-1?s.caseColors[u][p]===void 0:"N/A"})}else console.log("[SOLD_OUT_CHECK] âš ï¸ STEP 6.3: Case array does not exist at index",u)}else console.log("[SOLD_OUT_CHECK] âš ï¸ STEP 6.1: caseColors does not exist or is falsy");if(r===null&&s&&s.cases){const u=S.cases.findIndex(p=>p.type===e.caseType);u!==-1&&s.cases[u]!==null&&s.cases[u]!==void 0&&(r=s.cases[u],t=`cases[${u}]`)}if(console.log("[SOLD_OUT_CHECK] ðŸ”„ STEP 7: Evaluating maxQuantity..."),console.log("[SOLD_OUT_CHECK]   maxQuantity:",r,"type:",typeof r,"source:",t),r==null)return console.log("[SOLD_OUT_CHECK] âœ… STEP 7.1: DECISION - Unlimited stock:",{caseType:e.caseType,color:e.color,reason:"Not in Supabase inventory",maxQuantity:r,source:t}),null;if(r===0)return console.log("[SOLD_OUT_CHECK] âœ… STEP 7.2: DECISION - SOLD OUT (Supabase qty = 0):",{caseType:e.caseType,color:e.color,source:t,maxQuantity:r,cartItems:n.length}),0;console.log("[SOLD_OUT_CHECK] âœ… STEP 7.3: Item has stock, maxQuantity =",r);const y=n.reduce((u,p)=>p.caseType===e.caseType&&p.color===e.color?u+(p.quantity||1):u,0);console.log("[SOLD_OUT_CHECK] ðŸ”„ STEP 8: Calculating available stock..."),console.log("[SOLD_OUT_CHECK]   Counting items in cart...");const C=r-y;console.log("[SOLD_OUT_CHECK] âœ… STEP 8.1: Calculation complete:",{caseType:e.caseType,color:e.color,source:t,supabaseQty:r,alreadyInCart:y,available:C,isSoldOut:C===0});const w=Math.max(0,C);return console.log("[SOLD_OUT_CHECK] âœ… STEP 8.2: FINAL DECISION - Returning:",{result:w,isSoldOut:w===0,caseType:e.caseType,color:e.color}),w}if(e.type==="charm"||e.category||e.pin){const i=e.category||e.pin&&e.pin.category,r=((l=e.pin)==null?void 0:l.name)||((o=e.pin)==null?void 0:o.src)||e.name;if(!i||!r)return null;let t=null;if(S.pins&&S.pins[i]&&(t=S.pins[i].find(p=>p.name===r||p.src===r)),!t)return null;let y=null;const C=i==="flags"?"flags":i;if(s&&s.pins&&s.pins[C]){const p=S.pins[C].findIndex(b=>b.name===r||b.src===r||b.id===t.id);p!==-1&&s.pins[C][p]!==void 0&&(y=s.pins[C][p])}if(y==null)return console.log("[SOLD_OUT_CHECK] â™¾ï¸ Unlimited stock (charm/pin):",{category:i,pinName:r,reason:"Not in Supabase inventory"}),null;if(y===0)return console.log("[SOLD_OUT_CHECK] ðŸš« SOLD OUT (Supabase qty = 0) - charm/pin:",{category:i,pinName:r,maxQuantity:y,cartItems:n.length}),0;const w=n.reduce((p,b)=>ne(e,b)?p+(b.quantity||1):p,0),u=y-w;return console.log("[SOLD_OUT_CHECK] ðŸ“¦ Stock check (charm/pin):",{category:i,pinName:r,supabaseQty:y,alreadyInCart:w,available:u,isSoldOut:u===0}),Math.max(0,u)}return null},ie=()=>T,ge=()=>N(void 0,null,function*(){return T=null,D=null,yield j()}),me=e=>{if(!e||e.startsWith("data:image/")||e.startsWith("data:application/")||e.startsWith("http://")||e.startsWith("https://"))return e;let n=e.replace(/^\/TheHappyCase\//,"/");return n=n.replace(/\/+/g,"/"),n.startsWith("/"),n},ye=()=>{var n,a,c,s,m,l;const e=ie();if(!e)return S;try{const o=O({},S);return e.cases&&(o.cases=o.cases.map((i,r)=>{const t=F(O({},i),{quantity:e.cases[r]!==void 0?e.cases[r]:i.quantity});return e.caseColors&&e.caseColors[r]&&(t.colors=t.colors.map((y,C)=>F(O({},y),{quantity:e.caseColors[r][C]!==void 0?e.caseColors[r][C]:y.quantity}))),t})),e.pins&&(o.pins=F(O({},o.pins),{flags:((a=(n=o.pins)==null?void 0:n.flags)==null?void 0:a.map((i,r)=>{var t;return F(O({},i),{quantity:((t=e.pins.flags)==null?void 0:t[r])!==void 0?e.pins.flags[r]:i.quantity})}))||[],colorful:((s=(c=o.pins)==null?void 0:c.colorful)==null?void 0:s.map((i,r)=>{var t;return F(O({},i),{quantity:((t=e.pins.colorful)==null?void 0:t[r])!==void 0?e.pins.colorful[r]:i.quantity})}))||[],bronze:((l=(m=o.pins)==null?void 0:m.bronze)==null?void 0:l.map((i,r)=>{var t;return F(O({},i),{quantity:((t=e.pins.bronze)==null?void 0:t[r])!==void 0?e.pins.bronze[r]:i.quantity})}))||[]})),o}catch(o){return console.error("Error loading saved quantities:",o),S}},x=(e,n=null)=>{let a=null,c=n;if(!n&&e&&!e.startsWith("#")?(c=e,a=null):(a=e&&e.startsWith("#")?e:null,c=n||(e&&!e.startsWith("#")?e:null)),c){let m=c.split("/").pop().replace(/\.(webp|png|jpg)$/i,"").toLowerCase().replace(/^economycase/i,"").replace(/^businessclasscase/i,"").replace(/^firstclasscase/i,"").replace(/^smartcase/i,"").replace(/^premiumcase/i,"").replace(/^firstclass/i,"");const l={lightpink:"Light Pink",lightblue:"Light Blue",lightbrown:"Light Brown",darkbrown:"Dark Brown",darkblue:"Dark Blue",jeansblue:"Jeans Blue",brickred:"Brick Red",ligthpink:"Light Pink",navyblue:"Navy Blue",gray:"Gray",grey:"Gray",black:"Black",brown:"Brown",red:"Red",pink:"Pink",blue:"Blue",green:"Green",purple:"Purple",yellow:"Yellow",orange:"Orange",darkpink:"Dark Pink"};if(l[m])return l[m];if(m=m.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/(dark|light|navy|jeans|brick)([a-z]+)/g,"$1 $2").split(/(?=[A-Z])|(?=dark|light|navy|jeans|brick)/).filter(o=>o.length>0).join(" ").toLowerCase().split(" ").map(o=>l[o]?l[o]:o.charAt(0).toUpperCase()+o.slice(1)).join(" "),m&&m!=="Color")return m}if(a){a.toLowerCase().replace("#","");const s={"#f49f90":"Light Pink","#cb0025":"Red","#9cb4b8":"Light Blue","#627386":"Jeans Blue","#3a4763":"Dark Blue","#c96e50":"Light Brown","#b0582c":"Brown","#59332e":"Dark Brown","#506258":"Green","#89837e":"Gray","#413f44":"Black","#c8b593":"Gray","#da8ca6":"Light Pink","#daaf49":"Yellow","#d33d72":"Pink","#c49154":"Brown","#36312b":"Black","#d17956":"Brown","#c76f82":"Brick Red","#adcfa8":"Green","#ab8b72":"Dark Pink","#bfa29c":"Pink","#a799ab":"Purple","#afab9b":"Gray","#5f6074":"Navy Blue","#768695":"Blue","#cea55c":"Light Brown","#272a34":"Black"};if(s[a.toLowerCase()])return s[a.toLowerCase()]}return a||""},Ce=e=>{const n=e==null?void 0:e.get("case"),a=e==null?void 0:e.get("color"),c="economy";let s="",m="";if(n){const o=S.cases.find(i=>i.type===n);if(o){if(a){const i=o.colors.find(r=>r.color===a);if(i)return{caseType:o.type,color:i.color,image:i.image}}if(o.colors&&o.colors.length>0){const i=o.colors[0];return{caseType:o.type,color:i.color,image:i.image}}}}const l=S.cases.find(o=>o.type===c);if(l&&l.colors&&l.colors.length>0){const o=l.colors[0];return{caseType:c,color:o.color,image:o.image}}return{caseType:c,color:s,image:m}},te=(e,n,a)=>{if(!e.current)return null;const c=n.current?n.current.visible:!0,s=a.current?a.current.visible:!0;n.current&&(n.current.visible=!1),a.current&&(a.current.visible=!1);const m=e.current.toDataURL({format:"png",quality:1,multiplier:2,backgroundColor:"white"});return n.current&&(n.current.visible=c),a.current&&(a.current.visible=s),(n.current||a.current)&&e.current.renderAll(),m},ce=(e,n,a=300,c=350)=>new Promise((s,m)=>{if(!e&&!n){s(null);return}const l=document.createElement("canvas");l.width=a,l.height=c;const o=l.getContext("2d");o.fillStyle="white",o.fillRect(0,0,a,c);const i=()=>{if(!e){console.log("âš ï¸ No case image URL provided, using canvas content only"),r();return}const t=new Image;!e.startsWith("data:")&&!e.startsWith("blob:")&&(t.crossOrigin="anonymous");const y=setTimeout(()=>{console.error("â±ï¸ Timeout loading case image:",e),r()},1e4);t.onload=()=>{clearTimeout(y),console.log("âœ… Case image loaded successfully:",{width:t.width,height:t.height,src:e.substring(0,50)+"..."});const C=t.width/t.height,w=a/c;let u,p,b,h;const v=270;C>w?(p=v,u=p*C):(u=v,p=u/C),b=(a-u)/2,h=c*.45-p/2,o.drawImage(t,b,h,u,p),r()},t.onerror=C=>{clearTimeout(y),console.error("âŒ Failed to load case image:",{url:e,error:C,message:"Will continue with canvas content only"}),r()},console.log("ðŸ”„ Loading case image:",e),t.src=e},r=()=>{if(!n){console.log("âš ï¸ No canvas data URL, resolving with case image or white canvas"),s(l.toDataURL("image/png",1));return}const t=new Image,y=setTimeout(()=>{console.error("â±ï¸ Timeout loading canvas content"),s(l.toDataURL("image/png",1))},1e4);t.onload=()=>{clearTimeout(y),console.log("âœ… Canvas content loaded successfully:",{width:t.width,height:t.height});const C=t.width/t.height,w=a/c;let u,p,b,h;C>w?(u=a,p=a/C):(p=c,u=c*C),b=(a-u)/2,h=(c-p)/2,o.drawImage(t,b,h,u,p);const v=l.toDataURL("image/png",1);console.log("ðŸŽ¨ Composite image created:",{isDataURL:v.startsWith("data:image/"),length:v.length}),s(v)},t.onerror=C=>{clearTimeout(y),console.error("âŒ Failed to load canvas content:",C),s(l.toDataURL("image/png",1))},console.log("ðŸ”„ Loading canvas content..."),t.src=n};i()}),de=(e,n,a)=>{const c=te(e,n,a);if(!c)return;const s=document.createElement("a");s.download=`passport-case-design-${Date.now()}.webp`,s.href=c,document.body.appendChild(s),s.click(),document.body.removeChild(s)},be=(e,n,a,c,s)=>{var t;const l=$({caseType:e,color:n},a),o=(s==null?void 0:s.name)||"Passport Case",i=(t=s==null?void 0:s.colors)==null?void 0:t.find(y=>y.color===n),r=i?x(i.color,i.image):n?x(n):"";if(l!==null&&l===0){const y=r?` in ${r}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${o}${y} in stock right now, so you can't add more to your basket.`}}if(l!==null&&c>l){const y=r?` in ${r}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${o}${y} in stock right now, so you can't add more to your basket.`,maxAvailable:l}}return{valid:!0}},fe=(e,n,a,c)=>{for(const{pin:s}of e){const m=(s==null?void 0:s.category)||c||"colorful",l=(s==null?void 0:s.name)||"charm",i=$({type:"charm",category:m,pin:s,name:l},n);if(i!==null&&i===0)return{valid:!1,errorMessage:`Oops! We don't have any more ${l} in stock right now, so you can't add more to your basket.`};if(i!==null&&a>i)return{valid:!1,errorMessage:`Oops! We don't have any more ${l} in stock right now, so you can't add more to your basket.`}}return{valid:!0}},we=(e,n)=>N(void 0,null,function*(){let a=e;if(e&&n)try{a=yield ce(e,n,300,350),(!a||!a.startsWith("data:image/"))&&(console.warn("âš ï¸ Composite image creation returned invalid result, using case image fallback"),a=e)}catch(c){console.error("âŒ Error creating composite design image:",c),a=e}else n?a=n:e&&(a=e);return(!a||typeof a=="string"&&a.trim().length===0)&&(console.error("âŒ No valid design image available, using case image fallback"),a=e||""),a}),he=(e,n)=>e.map(({pin:a})=>{const c=a!=null&&a.category&&a.category.trim()!==""?a.category:n&&n.trim()!==""?n:"colorful";return F(O({},a),{name:(a==null?void 0:a.name)||"Charm",src:(a==null?void 0:a.src)||"",price:(a==null?void 0:a.price)||0,category:c})}),ve=({selectedCase:e,selectedCaseType:n,selectedColor:a,selectedCaseImage:c,selectedPins:s,caseBasePrice:m,quantity:l,designImage:o,normalizedCaseImage:i,pinsDetails:r,selectedCategory:t})=>{const y=Math.max(l,1),C=Date.now(),w=(e==null?void 0:e.name)||"Passport Case",u={id:`case-${C}-${Math.random().toString(36).substr(2,9)}`,name:w,caseType:n,caseName:w,color:a,basePrice:m,casePrice:m,totalPrice:m,price:m,image:o,designImage:o,caseImage:i,customDesign:!0,quantity:y},p=r.map((b,h)=>{const v=b.category||t||"colorful",B=b.name||"Charm",_=b.price||2;return{id:`charm-${C}-${h}-${Math.random().toString(36).substr(2,9)}`,name:B,price:_,totalPrice:_,image:b.src||"",pin:b,category:v,type:"charm",quantity:y}});return{caseProduct:u,charmProducts:p}},R=(e,n,a,c,s,m)=>{let l=0;return e.forEach(o=>{if(o.type==="charm"){if(o.id===s||s===void 0&&e.indexOf(o)===m)return;const t=o.pin||o,y=t.name||t.src,C=t.category||o.category||c;(y===n||y===a)&&C===c&&(l+=o.quantity||1)}}),l},G=(e,n,a,c,s,m)=>{let l=0;return e.forEach(o=>{if(o.type==="charm"||o.id===s||e.indexOf(o)===m)return;(o.pins||o.pinsDetails||[]).forEach(r=>{if(!r)return;const t=r.name||r.src,y=r.src||"",C=r.category||c;(t===n||t===a||y===n||y===a)&&C===c&&(l+=o.quantity||1)})}),l},le=(e,n,a,c)=>e.filter(s=>{const m=s.pin||s,l=m.name||m.src,o=m.category||c;return(l===n||l===a)&&o===c}).length,ue=(e,n="colorful")=>{const a=n&&n.trim()!==""?n:"colorful",c=e.name||e.src||"",s=e.src||"";return{name:c,price:e.price||2,totalPrice:e.price||2,image:s,pin:e,category:a,type:"charm"}},Te=(e,n,a,c)=>{var u,p,b,h,v;const s=$(e,n),m=e.category||((u=e.pin)==null?void 0:u.category)||"colorful",l=((p=e.pin)==null?void 0:p.name)||e.name||"",o=((b=e.pin)==null?void 0:b.src)||"";if(s!==null&&s===0)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((h=e.pin)==null?void 0:h.name)||"Charm"} in stock right now, so you can't add more to your basket.`};if(s===null)return{canIncrement:!0};const i=R(n,l,o,m,a,c),r=G(n,l,o,m,a,c),t=e.quantity||1,y=s+i;return t+1+r>y?{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((v=e.pin)==null?void 0:v.name)||"Charm"} in stock right now, so you can't add more to your basket.`}:{canIncrement:!0}},Pe=(e,n,a,c)=>{const s=$(e,n),m=e.pins||e.pinsDetails||[],l=e.quantity||1;if(!(s===null||s>0)){const i=e.caseName||e.name||"Passport Case",r=e.color?x(e.color,e.caseImage||e.case_image||e.image):"",t=r?` in ${r}`:"";return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${i}${t} in stock right now, so you can't add more to your basket.`,errorType:"case"}}for(const i of m){if(!i)continue;const r=i.category&&i.category.trim()!==""?i.category:"colorful",t=i.name||i.src||"",y=i.src||"",C=ue(i,r),w=$(C,n);if(w===null)continue;const u=R(n,t,y,r,a,c),p=G(n,t,y,r,a,c),b=le(m,t,y,r),h=w+u,B=u+p+b*l+b;if(w===0||B>h)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${i.name||"this charm"} in stock right now, so you can't add more to your basket.`,errorType:"charm",errorKey:`${t}-${r}`,charmProduct:C}}return{canIncrement:!0}};export{S as P,ne as a,x as b,Ce as c,de as d,te as e,ye as f,$ as g,fe as h,we as i,ve as j,Te as k,Pe as l,ue as m,me as n,oe as o,he as p,ie as q,ge as r,be as v};
