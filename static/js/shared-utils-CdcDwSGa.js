var W=Object.defineProperty,M=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var A=(e,n,s)=>n in e?W(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,h=(e,n)=>{for(var s in n||(n={}))U.call(n,s)&&A(e,s,n[s]);if(I)for(var s of I(n))O.call(n,s)&&A(e,s,n[s]);return e},z=(e,n)=>M(e,x(n));var F=(e,n,s)=>new Promise((u,a)=>{var l=i=>{try{r(s.next(i))}catch(t){a(t)}},o=i=>{try{r(s.throw(i))}catch(t){a(t)}},r=i=>i.done?u(i.value):Promise.resolve(i.value).then(l,o);r((s=s.apply(e,n)).next())});const _=[{id:1,name:"Economy Case",type:"economy",images:["/images/SmartCase/economycaselightpink.webp","/images/SmartCase/economycasered.webp","/images/SmartCase/economycasejeansblue.webp","/images/SmartCase/economycasebrown.webp","/images/SmartCase/economycaselightblue.webp","/images/SmartCase/economycasedarkbrown.webp","/images/SmartCase/economycaseblack.webp","/images/SmartCase/economycaselightbrown.webp"],colors:[{color:"#f49f90",image:"/images/SmartCase/economycaselightpink.webp"},{color:"#cb0025",image:"/images/SmartCase/economycasered.webp"},{color:"#9cb4b8",image:"/images/SmartCase/economycaselightblue.webp"},{color:"#627386",image:"/images/SmartCase/economycasejeansblue.webp"},{color:"#3a4763",image:"/images/SmartCase/economycasedarkblue.webp"},{color:"#c96e50",image:"/images/SmartCase/economycaselightbrown.webp"},{color:"#b0582c",image:"/images/SmartCase/economycasebrown.webp"},{color:"#59332e",image:"/images/SmartCase/economycasedarkbrown.webp"},{color:"#506258",image:"/images/SmartCase/economycasegreen.webp"},{color:"#89837e",image:"/images/SmartCase/economycasegray.webp"},{color:"#413f44",image:"/images/SmartCase/economycaseblack.webp"}],specifications:{dimensions:"14.9cm (W) x 10.7cm (H) x 1cm (D)",rfid:"Yes",material:"PU Leather",closure:"Magnetic Snap Closure",cardSlots:"3",features:"RFID Protection, Water Resistant, Lightweight Design",interior:"Document Pocket, Boarding Pass Slot, SIM Card Slot",care:"Wipe clean with damp cloth"},basePrice:8},{id:2,name:"Business Class Case",type:"business",images:["/images/BusinessClassCase/businessclasscasegray.webp","/images/BusinessClassCase/businessclasscasepink.webp","/images/BusinessClassCase/businessclasscaselightpink.webp","/images/BusinessClassCase/businessclasscasebrown.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclasscaseblack.webp","/images/BusinessClassCase/businessclassinside.webp","/images/BusinessClassCase/businessclassinside2.webp"],colors:[{color:"#c8b593",image:"/images/BusinessClassCase/businessclasscasegray.webp"},{color:"#da8ca6",image:"/images/BusinessClassCase/businessclasscaselightpink.webp"},{color:"#daaf49",image:"/images/BusinessClassCase/businessclasscaseyellow.webp"},{color:"#d33d72",image:"/images/BusinessClassCase/businessclasscasepink.webp"},{color:"#c49154",image:"/images/BusinessClassCase/businessclasscasebrown.webp"},{color:"#36312b",image:"/images/BusinessClassCase/businessclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 9.5cm (H) x 1cm (D)",rfid:"No",material:"Genuine Leather",closure:"No Closure",cardSlots:"4",interior:"Passport Pocket, Document Pocket",care:"Clean with leather conditioner, avoid excessive moisture"},basePrice:12},{id:3,name:"First Class Case",type:"firstclass",images:["/images/FirstClassCase/firstclassbrown.webp","/images/FirstClassCase/firstclasscaseblack.webp","/images/FirstClassCase/firstclasscasenavyblue.webp","/images/FirstClassCase/firstclasscasebrickred.webp","/images/FirstClassCase/firstclasscasepink.webp","/images/FirstClassCase/firstclasscasebrown.webp","/images/FirstClassCase/firstclasscaseblue.webp","/images/FirstClassCase/firstclasscasegray.webp","/images/FirstClassCase/firstclasscasepurple.webp","/images/FirstClassCase/firstclasscasegreen.webp","/images/FirstClassCase/firstclasscasedarkpink.webp"],colors:[{color:"#d17956",image:"/images/FirstClassCase/firstclasscasebrown.webp"},{color:"#c76f82",image:"/images/FirstClassCase/firstclasscasebrickred.webp"},{color:"#adcfa8",image:"/images/FirstClassCase/firstclasscasegreen.webp"},{color:"#ab8b72",image:"/images/FirstClassCase/firstclasscasedarkpink.webp"},{color:"#bfa29c",image:"/images/FirstClassCase/firstclasscasepink.webp"},{color:"#a799ab",image:"/images/FirstClassCase/firstclasscasepurple.webp"},{color:"#afab9b",image:"/images/FirstClassCase/firstclasscasegray.webp"},{color:"#5f6074",image:"/images/FirstClassCase/firstclasscasenavyblue.webp"},{color:"#768695",image:"/images/FirstClassCase/firstclasscaseblue.webp"},{color:"#cea55c",image:"/images/FirstClassCase/firstclasscaselightbrown.webp"},{color:"#272a34",image:"/images/FirstClassCase/firstclasscaseblack.webp"}],specifications:{dimensions:"14cm (W) x 10.5cm (H) x 1.5cm (D)",rfid:"Yes",material:"Genuine Leather",closure:"Button Snap Closure",cardSlots:"3",interior:" Document Pocket, Boarding Pass Slot, SIM Card Slot",features:"Coin Pouch, RFID Protection, Water Resistant"},basePrice:12}],j={flags:[{id:1,name:"Albania Flag",src:"/images/Flags/albania.webp",price:2,size:.5,continent:"europe"},{id:2,name:"Armenia Flag",src:"/images/Flags/armenia.webp",price:2,size:.5,continent:"europe"},{id:3,name:"Belgium Flag",src:"/images/Flags/belgium.webp",price:2,size:.5,continent:"europe"},{id:4,name:"Bosnia  Flag",src:"/images/Flags/bosnia.webp",price:2,size:.5,continent:"europe"},{id:5,name:"Brazil Flag",src:"/images/Flags/brazil.webp",price:2,size:.5,continent:"americas"},{id:6,name:"British Virgin Islands Flag",src:"/images/Flags/britishvirginislands.webp",price:2,size:.5,continent:"americas"},{id:7,name:"Croatia Flag",src:"/images/Flags/croatia.webp",price:2,size:.5,continent:"europe"},{id:8,name:"Dublin Flag",src:"/images/Flags/dublin.webp",price:2,size:.5,continent:"europe"},{id:9,name:"Egypt Flag",src:"/images/Flags/egypt.webp",price:2,size:.5,continent:"africa"},{id:10,name:"France Flag",src:"/images/Flags/france.webp",price:2,size:.5,continent:"europe"},{id:11,name:"Germany Flag",src:"/images/Flags/germany.webp",price:2,size:.5,continent:"europe"},{id:12,name:"India Flag",src:"/images/Flags/india.webp",price:2,size:.5,continent:"asia"},{id:13,name:"Italy Flag",src:"/images/Flags/italy.webp",price:2,size:.5,continent:"europe"},{id:14,name:"Jamaica  Flag",src:"/images/Flags/jamaica.webp",price:2,size:.5,continent:"americas"},{id:15,name:"Japan  Flag",src:"/images/Flags/japan.webp",price:2,size:.5,continent:"americas"},{id:16,name:"Hungary Flag",src:"/images/Flags/hungary.webp",price:2,size:.5,continent:"americas"},{id:17,name:"LGBTQIA+ Flag",src:"/images/Flags/lgbtqia.webp",price:2,size:.5,continent:"special"},{id:18,name:"Netherlands Flag",src:"/images/Flags/netherlands.webp",price:2,size:.5,continent:"europe"},{id:19,name:"Norway Flag",src:"/images/Flags/norway.webp",price:2,size:.5,continent:"europe"},{id:20,name:"Portugal Flag",src:"/images/Flags/portugal.webp",price:2,size:.5,continent:"europe"},{id:21,name:"Puerto Rico  Flag",src:"/images/Flags/puertorico.webp",price:2,size:.5,continent:"americas"},{id:22,name:"Scotland Flag",src:"/images/Flags/scotland.webp",price:2,size:.5,continent:"europe"},{id:23,name:"South Africa Flag",src:"/images/Flags/southafrica.webp",price:2,size:.5,continent:"africa"},{id:24,name:"Spain Flag",src:"/images/Flags/spain.webp",price:2,size:.5,continent:"europe"},{id:25,name:"Sweden Flag",src:"/images/Flags/sweden.webp",price:2,size:.5,continent:"europe"},{id:26,name:"Switzerland Flag",src:"/images/Flags/switzerland.webp",price:2,size:.5,continent:"europe"},{id:27,name:"United Kingdon Flag",src:"/images/Flags/uk.webp",price:2,size:.5,continent:"europe"},{id:28,name:"United States Flag",src:"/images/Flags/eua.webp",price:2,size:.5,continent:"americas"}],colorful:[{id:1,name:"Be a Good Human",src:"/images/ColorfulPins/beagoodhuman.webp",price:2,size:.7,subCategory:"inspiration"},{id:2,name:"Airplane",src:"/images/ColorfulPins/airplane.webp",price:2,size:.75,subCategory:"travel"},{id:3,name:"Heart Globe",src:"/images/ColorfulPins/heartglobe.webp",price:2,size:.7},{id:4,name:"Dream Big",src:"/images/ColorfulPins/dreambig.webp",price:2,size:.9,subCategory:"inspiration"},{id:5,name:"Paw",src:"/images/ColorfulPins/paw.webp",price:2,size:.4},{id:6,name:"Colorful Camera",src:"/images/ColorfulPins/camera.webp",price:2,size:.55,subCategory:"camera"},{id:7,name:"Be Kind",src:"/images/ColorfulPins/bekind.webp",price:2,size:.75,subCategory:"inspiration"},{id:8,name:"Football",src:"/images/ColorfulPins/football.webp",price:2,size:.75},{id:9,name:"Ticket to Happiness",src:"/images/ColorfulPins/tickettohappiness.webp",price:2,size:.8,subCategory:"inspiration"},{id:10,name:"Be Happy",src:"/images/ColorfulPins/behappy.webp",price:2,size:.75,subCategory:"inspiration"},{id:11,name:"Lucky Leaf",src:"/images/ColorfulPins/luckyleafcharm.webp",price:2,size:.5,subCategory:"nature"},{id:12,name:"Beer",src:"/images/ColorfulPins/beer.webp",price:2,size:.65,subCategory:"drinks"},{id:13,name:"Bottle of Wine",src:"/images/ColorfulPins/bottleofwine.webp",price:2,size:.8,subCategory:"drinks"},{id:14,name:"Heart Notification",src:"/images/ColorfulPins/heartnotification.webp",price:2,size:.5,subCategory:"hearts"},{id:15,name:"Small Boarding Pass",src:"/images/ColorfulPins/smallboardingpass.webp",price:2,size:.75,subCategory:"travel"},{id:16,name:"Little Heart",src:"/images/ColorfulPins/littleheart.webp",price:2,size:.5,subCategory:"hearts"},{id:17,name:"Disney",src:"/images/ColorfulPins/disney.webp",price:2,size:.75,subCategory:"disney"},{id:18,name:"Pluto",src:"/images/ColorfulPins/pluto.webp",price:2,size:.85,subCategory:"disney"},{id:19,name:"Round Minnnie",src:"/images/ColorfulPins/roundminnie.webp",price:2,size:.85,subCategory:"disney"},{id:20,name:"Round Mickey",src:"/images/ColorfulPins/roundmickey.webp",price:2,size:.85,subCategory:"disney"},{id:21,name:"Guufy",src:"/images/ColorfulPins/guufy.webp",price:2,size:.85,subCategory:"disney"},{id:22,name:"Map",src:"/images/ColorfulPins/map.webp",price:2,size:.85,subCategory:"travel"},{id:23,name:"London Phone",src:"/images/ColorfulPins/telephone.webp",price:2,size:.85},{id:24,name:"Adventure Awaits Ticket",src:"/images/ColorfulPins/adventureawaits.webp",price:2,size:.85,subCategory:"travel"},{id:25,name:"Passport",src:"/images/ColorfulPins/passport.webp",price:2,size:.75,subCategory:"travel"},{id:26,name:"Coffee",src:"/images/ColorfulPins/coffee.webp",price:2,size:.5,subCategory:"drinks"},{id:27,name:"Coconut Tree",src:"/images/ColorfulPins/coconuttree.webp",price:2,size:.8,subCategory:"nature"},{id:28,name:"Wave",src:"/images/ColorfulPins/wave.webp",price:3.5,size:.6},{id:29,name:"Suitcase",src:"/images/ColorfulPins/orangeluggage.webp",price:2,size:.7,subCategory:"travel"},{id:30,name:"Black Camera",src:"/images/ColorfulPins/blackcamera.webp",price:2,size:.8,subCategory:"camera"},{id:31,name:"Pink Camera",src:"/images/ColorfulPins/pinkcamera.webp",price:2,size:.5,subCategory:"camera"},{id:32,name:"Daisy Duck",src:"/images/ColorfulPins/daisyduck.webp",price:2,size:.7,subCategory:"disney"},{id:33,name:"Duck",src:"/images/ColorfulPins/duck.webp",price:2,size:.75,subCategory:"disney"},{id:34,name:"Minnie",src:"/images/ColorfulPins/minnie.webp",price:2,size:.7,subCategory:"disney"},{id:35,name:"Mickey Mouse",src:"/images/ColorfulPins/mickey.webp",price:2,size:.75,subCategory:"disney"},{id:36,name:"Combi",src:"/images/ColorfulPins/combi.webp",price:2,size:.7,subCategory:"travel"},{id:37,name:"Wine",src:"/images/ColorfulPins/wineglass.webp",price:2,size:.4,subCategory:"drinks"},{id:38,name:"Vacation",src:"/images/ColorfulPins/vacation.webp",price:2,size:.8,subCategory:"travel"},{id:39,name:"Love",src:"/images/ColorfulPins/love.webp",price:2,size:.8,subCategory:"travel"}],bronze:[{id:1,name:"Airplane",src:"/images/BronzePins/airplane.webp",price:1,size:.7,subCategory:"travel"},{id:2,name:"Cardinal Points",src:"/images/BronzePins/cardinalpoints.webp",price:1,size:.65,subCategory:"symbols"},{id:3,name:"Camera",src:"/images/BronzePins/camera.webp",price:1,size:.55,subCategory:"symbols"},{id:4,name:"Globe",src:"/images/BronzePins/globe.webp",price:1,size:.55,subCategory:"travel"},{id:5,name:"Passport",src:"/images/BronzePins/passport.webp",price:1,size:.4,subCategory:"travel"},{id:6,name:"NYC Taxi",src:"/images/BronzePins/nyctaxi.webp",price:1,size:.9,subCategory:"travel"},{id:7,name:"Liberty Statue",src:"/images/BronzePins/libertystatue.webp",price:1,size:1,subCategory:"travel"},{id:8,name:"Luggage",src:"/images/BronzePins/luggage.webp",price:1,size:.45,subCategory:"travel"},{id:9,name:"London Bus",src:"/images/BronzePins/london.webp",price:1,size:.7,subCategory:"travel"},{id:10,name:"Lucky Leaf",src:"/images/BronzePins/luckyleaf.webp",price:1,size:.45,subCategory:"nature"},{id:11,name:"Little Heart",src:"/images/BronzePins/littleheart.webp",price:1,size:.25,subCategory:"love"},{id:12,name:"Eiffel Towel",src:"/images/BronzePins/eiffeltowel.webp",price:1,size:.8},{id:13,name:"Kangaroo",src:"/images/BronzePins/kangaroo.webp",price:1,size:.9,subCategory:"animals"},{id:14,name:"Koala",src:"/images/BronzePins/koala.webp",price:1,size:.5,subCategory:"animals"},{id:15,name:"Hamsa Hand",src:"/images/BronzePins/hamsahand.webp",price:1,size:.9,subCategory:"symbols"},{id:16,name:"Thailand",src:"/images/BronzePins/thailand.webp",price:1,size:.9,subCategory:"symbols"},{id:17,name:"Mummy",src:"/images/BronzePins/mummy.webp",price:1,size:.7,subCategory:"symbols"},{id:18,name:"Llama",src:"/images/BronzePins/llama.webp",price:1,size:.7,subCategory:"animals"},{id:19,name:"India",src:"/images/BronzePins/india.webp",price:1,size:.5,subCategory:"symbols"},{id:20,name:"Pyramid",src:"/images/BronzePins/pyramid.webp",price:1,size:.8},{id:21,name:"Arc The Triomphe",src:"/images/BronzePins/arcthetriomphe.webp",price:1,size:.5},{id:22,name:"Maple Leaf",src:"/images/BronzePins/mapleleaf.webp",price:1,size:.6,subCategory:"nature"},{id:23,name:"Love",src:"/images/BronzePins/love.webp",price:1,size:.8,subCategory:"love"},{id:24,name:"Airplane War",src:"/images/BronzePins/airplanewar.webp",price:1,size:.8},{id:25,name:"Enjoy the Journey",src:"/images/BronzePins/enjoythejourney.webp",price:1,size:1,subCategory:"symbols"},{id:26,name:"Heart",src:"/images/BronzePins/heart.webp",price:1,size:.7,subCategory:"love"},{id:27,name:"I love Jesus",src:"/images/BronzePins/ilovejesus.webp",price:1,size:.5,subCategory:"love"},{id:28,name:"Butterfly",src:"/images/BronzePins/butterfly.webp",price:1,size:.7,subCategory:"nature"},{id:29,name:"Squirrel",src:"/images/BronzePins/squirrel.webp",price:1,size:.5},{id:30,name:"Canada",src:"/images/BronzePins/canada.webp",price:1,size:.6,subCategory:"symbols"},{id:31,name:"Flipflop",src:"/images/BronzePins/flipflop.webp",price:1,size:.5,subCategory:"nature"},{id:32,name:"Paw",src:"/images/BronzePins/paw.webp",price:1,size:.5,subCategory:"animals"},{id:33,name:"PawDog",src:"/images/BronzePins/pawheart.webp",price:1,size:.45,subCategory:"animals"},{id:34,name:"I love my dog",src:"/images/BronzePins/ilovemydog.webp",price:1,size:.5,subCategory:"animals"},{id:35,name:"Money",src:"/images/BronzePins/money.webp",price:1,size:.55},{id:36,name:"Dog Bone",src:"/images/BronzePins/dogbone.webp",price:1,size:.5,subCategory:"animals"}]},w={cases:_,pins:j},L=e=>{var n,s;if(e.customDesign||e.designImage)return`custom-${e.id||Date.now()}`;if(e.type==="charm"||e.category&&e.pin){const u=e.category||e.pin&&e.pin.category||"colorful",a=((n=e.pin)==null?void 0:n.name)||((s=e.pin)==null?void 0:s.src)||e.name||"";return`charm-${u}-${a}`}if(e.caseType&&e.color){if(e.pins&&e.pins.length>0){const u=e.pins.map(a=>a.name||a.src).sort().join("-");return`case-${e.caseType}-${e.color}-pins-${u}`}return`case-${e.caseType}-${e.color}`}return e.id&&e.id.startsWith("case-")?`unique-${e.id}`:e.id?`item-${e.id}`:`item-${Date.now()}`},G=(e,n)=>L(e)===L(n),H="http://localhost:3001",R=e=>{const n=e.startsWith("/")?e:`/${e}`;return`${H}${n}`};let v=null,P=null,B=null,k=!1;const E=()=>F(void 0,null,function*(){return B||(B=F(void 0,null,function*(){try{v||(k=!0);const e=R("/api/inventory"),n=new AbortController,s=setTimeout(()=>n.abort(),1e4),u=a=>F(void 0,null,function*(){const l=a.headers.get("content-type"),o=yield a.text();if(!l||!l.includes("application/json"))throw o.trim().startsWith("<!DOCTYPE")||o.trim().startsWith("<html")?new Error("HTML_RESPONSE_FALLBACK"):new Error(`Expected JSON, got: ${o.substring(0,100)}...`);try{return JSON.parse(o)}catch(r){throw new Error(`Failed to parse JSON response: ${r.message}`)}});try{console.log(`ðŸŒ Fetching inventory from: ${e}`);const a=yield fetch(e,{signal:n.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(s),console.log(`ðŸ“¡ Inventory API response status: ${a.status} ${a.statusText}`),a.ok){const l=yield u(a);if(console.log("âœ… Inventory API response received:",{success:l.success,hasInventory:!!l.inventory,hasCases:!!(l.inventory&&l.inventory.cases),hasCaseColors:!!(l.inventory&&l.inventory.caseColors)}),l.success&&l.inventory){const o={cases:l.inventory.cases,caseColors:l.inventory.caseColors,pins:l.inventory.pins},r=o.cases&&Array.isArray(o.cases)&&o.cases.some(i=>i!==null)||o.caseColors&&Array.isArray(o.caseColors)&&o.caseColors.some(i=>i&&i.some(t=>t!==null))||o.pins&&(o.pins.flags&&o.pins.flags.some(i=>i!==null)||o.pins.colorful&&o.pins.colorful.some(i=>i!==null)||o.pins.bronze&&o.pins.bronze.some(i=>i!==null));if(r||(console.warn("âš ï¸ ============================================"),console.warn("âš ï¸ INVENTORY CONFIGURATION ISSUE DETECTED"),console.warn("âš ï¸ ============================================"),console.warn("âš ï¸ The API returned success but all quantities are null."),console.warn("âš ï¸ This means:"),console.warn("âš ï¸   1. Supabase environment variables may not be set in Netlify"),console.warn("âš ï¸   2. OR the inventory_items table is empty"),console.warn("âš ï¸   3. OR Supabase is not properly configured"),console.warn("âš ï¸"),console.warn('âš ï¸ RESULT: All items will show as "Unlimited" stock'),console.warn("âš ï¸"),console.warn("âš ï¸ TO FIX:"),console.warn("âš ï¸   1. Check Netlify environment variables:"),console.warn("âš ï¸      - SUPABASE_URL"),console.warn("âš ï¸      - SUPABASE_SERVICE_ROLE_KEY"),console.warn("âš ï¸   2. Ensure inventory_items table exists in Supabase"),console.warn("âš ï¸   3. Add inventory data to the table"),console.warn("âš ï¸ ============================================")),v=o,P=Date.now(),console.log("ðŸ’¾ Inventory cache updated:",{timestamp:new Date(P).toISOString(),casesCount:o.cases?o.cases.length:0,caseColorsCount:o.caseColors?o.caseColors.length:0,hasInventoryData:r}),typeof window!="undefined"){const i={timestamp:P};window.dispatchEvent(new CustomEvent("inventoryCacheUpdated",{detail:i})),window.dispatchEvent(new CustomEvent("inventoryUpdated",{detail:i}))}return k=!1,o}else console.warn("âš ï¸ Inventory API response missing success or inventory data:",{success:l.success,hasInventory:!!l.inventory})}else if(a.status===404){const l=e.replace("/api/inventory","/.netlify/functions/inventory");try{const o=yield fetch(l,{signal:n.signal,headers:{"Content-Type":"application/json"}});if(o.ok){const r=yield u(o);if(r.success&&r.inventory){const i={cases:r.inventory.cases,caseColors:r.inventory.caseColors,pins:r.inventory.pins};return v=i,P=Date.now(),i}}}catch(o){}}}catch(a){if(clearTimeout(s),k=!1,a.message==="HTML_RESPONSE_FALLBACK"){const l=e.replace("/api/inventory","/.netlify/functions/inventory");try{const o=new AbortController,r=setTimeout(()=>o.abort(),1e4),i=yield fetch(l,{signal:o.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(r),i.ok){const t=yield u(i);if(t.success&&t.inventory){const c={cases:t.inventory.cases,caseColors:t.inventory.caseColors,pins:t.inventory.pins};return v=c,P=Date.now(),c}}}catch(o){}}a.name==="AbortError"?console.warn("âš ï¸ Inventory fetch timed out"):a.message&&a.message.includes("Failed to fetch")?console.warn("âš ï¸ Failed to fetch inventory from API"):console.error("âŒ Error fetching inventory:",a.message)}}catch(e){console.error("âŒ Error in fetchInventoryFromSupabase:",e.message),k=!1}finally{B=null,k=!1}return null}),B)}),S=(e,n)=>{var l,o;if(!v&&B&&k)return null;const s=P?Date.now()-P:1/0;(!v||s>60*1e3)&&!k&&E().catch(r=>{console.warn("âš ï¸ Background inventory fetch failed:",r.message)});const a=v;if(!a)return k||(console.warn(`âš ï¸ getMaxAvailableQuantity: Cache is empty for ${e.caseType||e.type||"item"} - returning null (unlimited)`),console.warn("   This may mean inventory hasn't loaded yet or Supabase is not configured")),null;if(!a.caseColors&&!a.cases&&!a.pins)return null;if(e.caseType&&e.color){const r=w.cases.find(m=>m.type===e.caseType);if(!r)return null;let i=null;if(a&&a.caseColors){const m=w.cases.findIndex(d=>d.type===e.caseType);if(m!==-1&&a.caseColors[m]){const d=r.colors.findIndex(p=>p.color===e.color);if(d!==-1&&a.caseColors[m][d]!==null&&a.caseColors[m][d]!==void 0){const p=a.caseColors[m][d];i=p,console.log(`ðŸ“Š Inventory Check - ${r.name} (${e.caseType}, ${e.color}):`),console.log(`   Reading from cache: quantities.caseColors[${m}][${d}]`),console.log(`   qty_in_stock from Supabase: ${p}`),console.log(`   Stock value type: ${p===null?"null (unlimited)":typeof p}`)}}}if(i===null&&a&&a.cases){const m=w.cases.findIndex(d=>d.type===e.caseType);if(m!==-1&&a.cases[m]!==null&&a.cases[m]!==void 0){const d=a.cases[m];i=d,console.log(`ðŸ“Š Inventory Check (fallback) - ${r.name} (${e.caseType}):`),console.log(`   Reading from cache: quantities.cases[${m}]`),console.log(`   qty_in_stock from Supabase: ${d}`)}}if(i==null)return console.log("   â†’ Item not in Supabase inventory_items table â†’ Returning null (unlimited stock)"),null;if(console.log(`   â†’ qty_in_stock from Supabase: ${i}`),i===0)return console.log("   â†’ qty_in_stock is 0 â†’ Returning 0 (SOLD OUT)"),0;const t=n.reduce((m,d)=>d.caseType===e.caseType&&d.color===e.color?m+(d.quantity||1):m,0);console.log(`   â†’ Items already in cart: ${t}`);const c=i-t;console.log(`   â†’ Available = qty_in_stock (${i}) - cart (${t}) = ${c}`);const g=Math.max(0,c);return console.log(`   â†’ Final result: ${g} ${g===0?"(SOLD OUT)":"available"}`),g}if(e.type==="charm"||e.category||e.pin){const r=e.category||e.pin&&e.pin.category,i=((l=e.pin)==null?void 0:l.name)||((o=e.pin)==null?void 0:o.src)||e.name;if(!r||!i)return null;let t=null;if(w.pins&&w.pins[r]&&(t=w.pins[r].find(p=>p.name===i||p.src===i)),!t)return null;let c=null;const g=r==="flags"?"flags":r;if(a&&a.pins&&a.pins[g]){const p=w.pins[g].findIndex(b=>b.name===i||b.src===i||b.id===t.id);p!==-1&&a.pins[g][p]!==void 0&&(c=a.pins[g][p])}if(c==null)return null;if(c===0)return 0;const m=n.reduce((p,b)=>G(e,b)?p+(b.quantity||1):p,0),d=c-m;return Math.max(0,d)}return null},K=()=>v,Z=()=>F(void 0,null,function*(){return v=null,P=null,yield E()}),ee=e=>{if(!e||e.startsWith("data:image/")||e.startsWith("data:application/")||e.startsWith("http://")||e.startsWith("https://"))return e;let n=e.replace(/^\/TheHappyCase\//,"/");return n=n.replace(/\/+/g,"/"),n.startsWith("/"),n},se=()=>{var n,s,u,a,l,o;const e=K();if(!e)return w;try{const r=h({},w);return e.cases&&(r.cases=r.cases.map((i,t)=>{const c=z(h({},i),{quantity:e.cases[t]!==void 0?e.cases[t]:i.quantity});return e.caseColors&&e.caseColors[t]&&(c.colors=c.colors.map((g,m)=>z(h({},g),{quantity:e.caseColors[t][m]!==void 0?e.caseColors[t][m]:g.quantity}))),c})),e.pins&&(r.pins=z(h({},r.pins),{flags:((s=(n=r.pins)==null?void 0:n.flags)==null?void 0:s.map((i,t)=>{var c;return z(h({},i),{quantity:((c=e.pins.flags)==null?void 0:c[t])!==void 0?e.pins.flags[t]:i.quantity})}))||[],colorful:((a=(u=r.pins)==null?void 0:u.colorful)==null?void 0:a.map((i,t)=>{var c;return z(h({},i),{quantity:((c=e.pins.colorful)==null?void 0:c[t])!==void 0?e.pins.colorful[t]:i.quantity})}))||[],bronze:((o=(l=r.pins)==null?void 0:l.bronze)==null?void 0:o.map((i,t)=>{var c;return z(h({},i),{quantity:((c=e.pins.bronze)==null?void 0:c[t])!==void 0?e.pins.bronze[t]:i.quantity})}))||[]})),r}catch(r){return console.error("Error loading saved quantities:",r),w}},$=(e,n=null)=>{let s=null,u=n;if(!n&&e&&!e.startsWith("#")?(u=e,s=null):(s=e&&e.startsWith("#")?e:null,u=n||(e&&!e.startsWith("#")?e:null)),u){let l=u.split("/").pop().replace(/\.(webp|png|jpg)$/i,"").toLowerCase().replace(/^economycase/i,"").replace(/^businessclasscase/i,"").replace(/^firstclasscase/i,"").replace(/^smartcase/i,"").replace(/^premiumcase/i,"").replace(/^firstclass/i,"");const o={lightpink:"Light Pink",lightblue:"Light Blue",lightbrown:"Light Brown",darkbrown:"Dark Brown",darkblue:"Dark Blue",jeansblue:"Jeans Blue",brickred:"Brick Red",ligthpink:"Light Pink",navyblue:"Navy Blue",gray:"Gray",grey:"Gray",black:"Black",brown:"Brown",red:"Red",pink:"Pink",blue:"Blue",green:"Green",purple:"Purple",yellow:"Yellow",orange:"Orange",darkpink:"Dark Pink"};if(o[l])return o[l];if(l=l.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/(dark|light|navy|jeans|brick)([a-z]+)/g,"$1 $2").split(/(?=[A-Z])|(?=dark|light|navy|jeans|brick)/).filter(r=>r.length>0).join(" ").toLowerCase().split(" ").map(r=>o[r]?o[r]:r.charAt(0).toUpperCase()+r.slice(1)).join(" "),l&&l!=="Color")return l}if(s){s.toLowerCase().replace("#","");const a={"#f49f90":"Light Pink","#cb0025":"Red","#9cb4b8":"Light Blue","#627386":"Jeans Blue","#3a4763":"Dark Blue","#c96e50":"Light Brown","#b0582c":"Brown","#59332e":"Dark Brown","#506258":"Green","#89837e":"Gray","#413f44":"Black","#c8b593":"Gray","#da8ca6":"Light Pink","#daaf49":"Yellow","#d33d72":"Pink","#c49154":"Brown","#36312b":"Black","#d17956":"Brown","#c76f82":"Brick Red","#adcfa8":"Green","#ab8b72":"Dark Pink","#bfa29c":"Pink","#a799ab":"Purple","#afab9b":"Gray","#5f6074":"Navy Blue","#768695":"Blue","#cea55c":"Light Brown","#272a34":"Black"};if(a[s.toLowerCase()])return a[s.toLowerCase()]}return s||""},ae=e=>{const n=e==null?void 0:e.get("case"),s=e==null?void 0:e.get("color"),u="economy";let a="",l="";if(n){const r=w.cases.find(i=>i.type===n);if(r){if(s){const i=r.colors.find(t=>t.color===s);if(i)return{caseType:r.type,color:i.color,image:i.image}}if(r.colors&&r.colors.length>0){const i=r.colors[0];return{caseType:r.type,color:i.color,image:i.image}}}}const o=w.cases.find(r=>r.type===u);if(o&&o.colors&&o.colors.length>0){const r=o.colors[0];return{caseType:u,color:r.color,image:r.image}}return{caseType:u,color:a,image:l}},Q=(e,n,s)=>{if(!e.current)return null;const u=n.current?n.current.visible:!0,a=s.current?s.current.visible:!0;n.current&&(n.current.visible=!1),s.current&&(s.current.visible=!1);const l=e.current.toDataURL({format:"png",quality:1,multiplier:2,backgroundColor:"white"});return n.current&&(n.current.visible=u),s.current&&(s.current.visible=a),(n.current||s.current)&&e.current.renderAll(),l},J=(e,n,s=300,u=350)=>new Promise((a,l)=>{if(!e&&!n){a(null);return}const o=document.createElement("canvas");o.width=s,o.height=u;const r=o.getContext("2d");r.fillStyle="white",r.fillRect(0,0,s,u);const i=()=>{if(!e){console.log("âš ï¸ No case image URL provided, using canvas content only"),t();return}const c=new Image;!e.startsWith("data:")&&!e.startsWith("blob:")&&(c.crossOrigin="anonymous");const g=setTimeout(()=>{console.error("â±ï¸ Timeout loading case image:",e),t()},1e4);c.onload=()=>{clearTimeout(g),console.log("âœ… Case image loaded successfully:",{width:c.width,height:c.height,src:e.substring(0,50)+"..."});const m=c.width/c.height,d=s/u;let p,b,y,f;const C=270;m>d?(b=C,p=b*m):(p=C,b=p/m),y=(s-p)/2,f=u*.45-b/2,r.drawImage(c,y,f,p,b),t()},c.onerror=m=>{clearTimeout(g),console.error("âŒ Failed to load case image:",{url:e,error:m,message:"Will continue with canvas content only"}),t()},console.log("ðŸ”„ Loading case image:",e),c.src=e},t=()=>{if(!n){console.log("âš ï¸ No canvas data URL, resolving with case image or white canvas"),a(o.toDataURL("image/png",1));return}const c=new Image,g=setTimeout(()=>{console.error("â±ï¸ Timeout loading canvas content"),a(o.toDataURL("image/png",1))},1e4);c.onload=()=>{clearTimeout(g),console.log("âœ… Canvas content loaded successfully:",{width:c.width,height:c.height});const m=c.width/c.height,d=s/u;let p,b,y,f;m>d?(p=s,b=s/m):(b=u,p=u*m),y=(s-p)/2,f=(u-b)/2,r.drawImage(c,y,f,p,b);const C=o.toDataURL("image/png",1);console.log("ðŸŽ¨ Composite image created:",{isDataURL:C.startsWith("data:image/"),length:C.length}),a(C)},c.onerror=m=>{clearTimeout(g),console.error("âŒ Failed to load canvas content:",m),a(o.toDataURL("image/png",1))},console.log("ðŸ”„ Loading canvas content..."),c.src=n};i()}),ne=(e,n,s)=>{const u=Q(e,n,s);if(!u)return;const a=document.createElement("a");a.download=`passport-case-design-${Date.now()}.webp`,a.href=u,document.body.appendChild(a),a.click(),document.body.removeChild(a)},re=(e,n,s,u,a)=>{var c;const o=S({caseType:e,color:n},s),r=(a==null?void 0:a.name)||"Passport Case",i=(c=a==null?void 0:a.colors)==null?void 0:c.find(g=>g.color===n),t=i?$(i.color,i.image):n?$(n):"";if(o!==null&&o===0){const g=t?` in ${t}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${r}${g} in stock right now, so you can't add more to your basket.`}}if(o!==null&&u>o){const g=t?` in ${t}`:"";return{valid:!1,errorMessage:`Oops! We don't have any more ${r}${g} in stock right now, so you can't add more to your basket.`,maxAvailable:o}}return{valid:!0}},ie=(e,n,s,u)=>{for(const{pin:a}of e){const l=(a==null?void 0:a.category)||u||"colorful",o=(a==null?void 0:a.name)||"charm",i=S({type:"charm",category:l,pin:a,name:o},n);if(i!==null&&i===0)return{valid:!1,errorMessage:`Oops! We don't have any more ${o} in stock right now, so you can't add more to your basket.`};if(i!==null&&s>i)return{valid:!1,errorMessage:`Oops! We don't have any more ${o} in stock right now, so you can't add more to your basket.`}}return{valid:!0}},oe=(e,n)=>F(void 0,null,function*(){let s=e;if(e&&n)try{s=yield J(e,n,300,350),(!s||!s.startsWith("data:image/"))&&(console.warn("âš ï¸ Composite image creation returned invalid result, using case image fallback"),s=e)}catch(u){console.error("âŒ Error creating composite design image:",u),s=e}else n?s=n:e&&(s=e);return(!s||typeof s=="string"&&s.trim().length===0)&&(console.error("âŒ No valid design image available, using case image fallback"),s=e||""),s}),te=(e,n)=>e.map(({pin:s})=>{const u=s!=null&&s.category&&s.category.trim()!==""?s.category:n&&n.trim()!==""?n:"colorful";return z(h({},s),{name:(s==null?void 0:s.name)||"Charm",src:(s==null?void 0:s.src)||"",price:(s==null?void 0:s.price)||0,category:u})}),ce=({selectedCase:e,selectedCaseType:n,selectedColor:s,selectedCaseImage:u,selectedPins:a,caseBasePrice:l,quantity:o,designImage:r,normalizedCaseImage:i,pinsDetails:t,selectedCategory:c})=>{const g=Math.max(o,1),m=Date.now(),d=(e==null?void 0:e.name)||"Passport Case",p={id:`case-${m}-${Math.random().toString(36).substr(2,9)}`,name:d,caseType:n,caseName:d,color:s,basePrice:l,casePrice:l,totalPrice:l,price:l,image:r,designImage:r,caseImage:i,customDesign:!0,quantity:g},b=t.map((y,f)=>{const C=y.category||c||"colorful",T=y.name||"Charm",D=y.price||2;return{id:`charm-${m}-${f}-${Math.random().toString(36).substr(2,9)}`,name:T,price:D,totalPrice:D,image:y.src||"",pin:y,category:C,type:"charm",quantity:g}});return{caseProduct:p,charmProducts:b}},q=(e,n,s,u,a,l)=>{let o=0;return e.forEach(r=>{if(r.type==="charm"){if(r.id===a||a===void 0&&e.indexOf(r)===l)return;const c=r.pin||r,g=c.name||c.src,m=c.category||r.category||u;(g===n||g===s)&&m===u&&(o+=r.quantity||1)}}),o},N=(e,n,s,u,a,l)=>{let o=0;return e.forEach(r=>{if(r.type==="charm"||r.id===a||e.indexOf(r)===l)return;(r.pins||r.pinsDetails||[]).forEach(t=>{if(!t)return;const c=t.name||t.src,g=t.src||"",m=t.category||u;(c===n||c===s||g===n||g===s)&&m===u&&(o+=r.quantity||1)})}),o},Y=(e,n,s,u)=>e.filter(a=>{const l=a.pin||a,o=l.name||l.src,r=l.category||u;return(o===n||o===s)&&r===u}).length,V=(e,n="colorful")=>{const s=n&&n.trim()!==""?n:"colorful",u=e.name||e.src||"",a=e.src||"";return{name:u,price:e.price||2,totalPrice:e.price||2,image:a,pin:e,category:s,type:"charm"}},le=(e,n,s,u)=>{var p,b,y,f,C;const a=S(e,n),l=e.category||((p=e.pin)==null?void 0:p.category)||"colorful",o=((b=e.pin)==null?void 0:b.name)||e.name||"",r=((y=e.pin)==null?void 0:y.src)||"";if(a!==null&&a===0)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((f=e.pin)==null?void 0:f.name)||"Charm"} in stock right now, so you can't add more to your basket.`};if(a===null)return{canIncrement:!0};const i=q(n,o,r,l,s,u),t=N(n,o,r,l,s,u),c=e.quantity||1,g=a+i;return c+1+t>g?{canIncrement:!1,errorMessage:`Oops! We don't have any more ${e.name||((C=e.pin)==null?void 0:C.name)||"Charm"} in stock right now, so you can't add more to your basket.`}:{canIncrement:!0}},ue=(e,n,s,u)=>{const a=S(e,n),l=e.pins||e.pinsDetails||[],o=e.quantity||1;if(!(a===null||a>0)){const i=e.caseName||e.name||"Passport Case",t=e.color?$(e.color,e.caseImage||e.case_image||e.image):"",c=t?` in ${t}`:"";return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${i}${c} in stock right now, so you can't add more to your basket.`,errorType:"case"}}for(const i of l){if(!i)continue;const t=i.category&&i.category.trim()!==""?i.category:"colorful",c=i.name||i.src||"",g=i.src||"",m=V(i,t),d=S(m,n);if(d===null)continue;const p=q(n,c,g,t,s,u),b=N(n,c,g,t,s,u),y=Y(l,c,g,t),f=d+p,T=p+b+y*o+y;if(d===0||T>f)return{canIncrement:!1,errorMessage:`Oops! We don't have any more ${i.name||"this charm"} in stock right now, so you can't add more to your basket.`,errorType:"charm",errorKey:`${c}-${t}`,charmProduct:m}}return{canIncrement:!0}};export{w as P,G as a,$ as b,ae as c,ne as d,Q as e,se as f,S as g,ie as h,oe as i,ce as j,le as k,ue as l,V as m,ee as n,R as o,te as p,K as q,Z as r,re as v};
